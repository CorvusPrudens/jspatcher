{"version":3,"sources":["webpack://JSPatcher/./src/core/objects/importer/New.tsx"],"names":["NewUI","ImportedObjectUI","New","DefaultObject","Wrapper","inputs","result","outletAll","state","subscribe","on","Fn","imported","argsCount","Math","max","length","box","args","getProp","inlets","outlets","patcher","activeLib","error","prototype","StaticMethod","slice","props","data","inlet","Bang","execute","output","e","callback","loading","updateUI","name","c","path","Object","r","reduce","acc","cur","root","v","constructor","parent","forEach","key","isHot","type","description","varLength","optional","default"],"mappings":"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","file":"js/06974dc2d38c64a776e5.js","sourcesContent":["import { StaticMethod } from \"./StaticMethod\";\nimport { DefaultObject, Bang } from \"../Base\";\nimport { ImportedObject, ImportedObjectUI } from \"./ImportedObject\";\nimport { TMeta } from \"../../types\";\n\nclass NewUI extends ImportedObjectUI<New> {\n    prependColor = \"rgb(78, 201, 176)\";\n}\ntype TAnyConstructor = new (...args: any[]) => any;\ntype S = { Wrapper: typeof StaticMethod; inputs: any[]; result: any };\nexport default class New extends DefaultObject<{}, S, [any | Bang, ...any[]], [any, ...any[]], any[], { args: number }, { loading: boolean }> {\n    static description = \"Call function as a constructor\";\n    static inlets: TMeta[\"inlets\"] = [{\n        isHot: true,\n        type: \"anything\",\n        description: \"Constructor argument, output instance constructed\"\n    }, {\n        isHot: false,\n        type: \"anything\",\n        varLength: true,\n        description: \"Constructor argument\"\n    }];\n    static outlets: TMeta[\"outlets\"] = [{\n        type: \"anything\",\n        description: \"Instance constructed\"\n    }, {\n        type: \"anything\",\n        varLength: true,\n        description: \"Argument after constructor called\"\n    }];\n    static args: TMeta[\"args\"] = [{\n        type: \"string\",\n        optional: false,\n        varLength: false,\n        description: \"Constructor name\"\n    }, {\n        type: \"anything\",\n        optional: true,\n        varLength: true,\n        description: \"Set arguments while loaded\"\n    }];\n    static props: TMeta[\"props\"] = {\n        args: {\n            type: \"number\",\n            default: 0,\n            description: \"arguments count for method\"\n        }\n    };\n    static ui = NewUI;\n    state: S = { Wrapper: null, inputs: [], result: null };\n    subscribe() {\n        super.subscribe();\n        this.on(\"postInit\", () => {\n            const Fn = this.imported;\n            const argsCount = Math.max(Fn.length, this.box.args.length - 1, ~~+this.getProp(\"args\"));\n            this.inlets = Math.max(1, argsCount);\n            this.outlets = 1 + this.inlets;\n        });\n        this.on(\"updateArgs\", (args) => {\n            if (typeof args[0] !== \"undefined\") {\n                const Wrapper = this.patcher.activeLib[args[0]];\n                if (!Wrapper) this.error(`Function ${args[0]} not found.`);\n                else if (Wrapper.prototype instanceof StaticMethod) {\n                    this.state.Wrapper = Wrapper as typeof StaticMethod;\n                    const Fn = this.imported;\n                    const argsCount = Math.max(Fn.length, args.length - 1, ~~+this.getProp(\"args\"));\n                    this.inlets = Math.max(1, argsCount);\n                    this.outlets = 1 + this.inlets;\n                } else {\n                    this.error(\"Given function is not constructable\");\n                }\n            } else {\n                this.error(\"A constructor is needed.\");\n            }\n            this.state.inputs = args.slice(1);\n        });\n        this.on(\"updateProps\", (props) => {\n            if (props.args && typeof props.args === \"number\" && props.args >= 0) {\n                const Fn = this.imported;\n                const argsCount = Math.max(Fn.length, this.box.args.length - 1, ~~+props.args);\n                this.inlets = Math.max(1, argsCount);\n                this.outlets = 1 + this.inlets;\n            }\n        });\n        this.on(\"inlet\", ({ data, inlet }) => {\n            if (inlet === 0) {\n                if (!(data instanceof Bang)) this.state.inputs[inlet] = data;\n                if (this.execute()) this.output();\n            } else {\n                this.state.inputs[inlet] = data;\n            }\n        });\n    }\n    execute() {\n        const Fn = this.imported;\n        try {\n            this.state.result = new Fn(...this.state.inputs);\n            return true;\n        } catch (e) {\n            this.error(e);\n            return false;\n        }\n    }\n    callback = () => this.outletAll([this.state.result, ...this.state.inputs]);\n    output() {\n        return this.callback();\n    }\n    set loading(loading: boolean) {\n        this.updateUI({ loading });\n    }\n    get name() {\n        const c = this.state.Wrapper;\n        return c.path[c.path.length - 1];\n    }\n    get imported(): TAnyConstructor {\n        const c = this.state.Wrapper || this.patcher.activeLib.Object as typeof StaticMethod;\n        let r: TAnyConstructor;\n        try {\n            r = c.path.reduce((acc, cur) => acc[cur], c.root);\n        } catch (e) {\n            this.error(e);\n        }\n        return r;\n    }\n    set imported(v: TAnyConstructor) {\n        const c = (this.constructor as typeof ImportedObject);\n        let parent = c.root;\n        try {\n            if (!c.path.length) {\n                c.root = v;\n            } else {\n                c.path.slice(0, -1).forEach(key => parent = parent[key]);\n                parent[c.path[c.path.length - 1]] = v;\n            }\n        } catch (e) {\n            this.error(e);\n        }\n    }\n}\n"],"sourceRoot":""}