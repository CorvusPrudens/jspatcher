{"version":3,"sources":["webpack://JSPatcher/webpack/bootstrap","webpack://JSPatcher/./src/core/objects/dsp/AudioWorklet/TemporalAnalyser.worklet.ts","webpack://JSPatcher/./src/core/objects/dsp/utils.ts","webpack://JSPatcher/./src/utils/math.ts"],"names":["processorID","TemporalAnalyserProcessor","AudioWorkletProcessor","parameterDescriptors","defaultValue","maxValue","minValue","name","constructor","options","destroyed","window","$","port","onmessage","e","id","data","destroy","rms","postMessage","zcr","buffer","map","startPointer","process","inputs","outputs","parameters","input","windowSize","length","splice","bufferSize","i","channel","Float32Array","oldWindow","oldWindowSize","set","subarray","setBuffer","close","registerProcessor","energy","signal","sum","sample","Math","sqrt","lastPositive","positive","to","from","offsetTo","offsetFrom","toLength","fromLength","spillLength","min","spilled","$to","mod","$from","$spillLength","$fromEnd","getSubBuffer","offset","fftw2Amp","amps","real","imag","x","y","round","floor","ceil","toRad","degrees","PI","toMIDI","f","atodb","a","log10","dbtoa","db","iNormExp","max","normExp"],"mappings":"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","file":"js/d656bfea3574349bf4de.worklet.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./node_modules/babel-loader/lib/index.js!./src/core/objects/dsp/AudioWorklet/TemporalAnalyser.worklet.ts\");\n","// import { RFFT } from \"fftw-js\";\nimport { DataToProcessor, DataFromProcessor, Parameters } from \"./TemporalAnalyser\";\nimport { rms, zcr, setBuffer } from \"../utils\";\n\nconst processorID = \"__JSPatcher_TemporalAnalyser\";\n\nclass TemporalAnalyserProcessor extends AudioWorkletProcessor<DataToProcessor, DataFromProcessor, Parameters> {\n    static get parameterDescriptors(): AudioWorkletAudioParamDescriptor<Parameters>[] {\n        return [{\n            defaultValue: 1024,\n            maxValue: 2 ** 32,\n            minValue: 128,\n            name: \"windowSize\"\n        }];\n    }\n    destroyed = false;\n    window: Float32Array[] = [];\n    /**\n     * Starting point index of current buffer\n     *\n     * @memberof TemporalAnalyserProcessor\n     */\n    $ = 0;\n    constructor(options: AudioWorkletNodeOptions) {\n        super(options);\n        this.port.onmessage = (e) => {\n            const { id } = e.data;\n            if (e.data.destroy) this.destroy();\n            if (e.data.rms) this.port.postMessage({ id, rms: this.rms });\n            if (e.data.zcr) this.port.postMessage({ id, zcr: this.zcr });\n            if (e.data.buffer) this.port.postMessage({ id, buffer: this.buffer });\n        };\n    }\n    get rms() {\n        return this.window.map(rms);\n    }\n    get zcr() {\n        return this.window.map(zcr);\n    }\n    get buffer() {\n        return { startPointer: this.$, data: this.window };\n    }\n    process(inputs: Float32Array[][], outputs: Float32Array[][], parameters: { [key in Parameters]: Float32Array }) {\n        if (this.destroyed) return false;\n        const input = inputs[0];\n        const windowSize = ~~parameters.windowSize[0] || 1024;\n        this.$ %= windowSize;\n        if (this.window.length > input.length) this.window.splice(input.length);\n        if (input.length === 0) return true;\n        const bufferSize = input[0].length || 128;\n        for (let i = 0; i < input.length; i++) {\n            let channel = input[i];\n            if (!channel.length) channel = new Float32Array(bufferSize);\n            if (!this.window[i]) {\n                this.window[i] = new Float32Array(windowSize);\n            } else if (this.window[i].length !== windowSize) {\n                const oldWindow = this.window[i];\n                const oldWindowSize = oldWindow.length;\n                const window = new Float32Array(windowSize);\n                if (oldWindowSize > windowSize) {\n                    window.set(oldWindow.subarray(oldWindowSize - windowSize));\n                    this.$ = 0;\n                } else {\n                    window.set(oldWindow);\n                }\n                this.window[i] = window;\n            }\n            const window = this.window[i];\n            let $ = this.$;\n            if (bufferSize > windowSize) {\n                window.set(channel.subarray(bufferSize - windowSize));\n                $ = 0;\n            } else {\n                setBuffer(window, channel, $);\n                $ = ($ + bufferSize) % windowSize;\n            }\n            if (i === input.length - 1) this.$ = $;\n        }\n        return true;\n    }\n    destroy() {\n        this.destroyed = true;\n        this.port.close();\n        this.window = [];\n    }\n}\nregisterProcessor(processorID, TemporalAnalyserProcessor);\n","import { mod } from \"../../../utils/math\";\n\nexport const energy = (signal: Float32Array) => {\n    let sum = 0;\n    let sample = 0;\n    for (let i = 0; i < signal.length; i++) {\n        sample = signal[i];\n        sum += sample * sample;\n    }\n    return sum;\n};\nexport const rms = (signal: Float32Array) => Math.sqrt(energy(signal) / signal.length);\nexport const zcr = (signal: Float32Array) => {\n    let zcr = 0;\n    let lastPositive = true;\n    let positive = true;\n    for (let i = 0; i < signal.length; i++) {\n        positive = signal[i] >= 0;\n        if (positive !== lastPositive) zcr++;\n        lastPositive = positive;\n    }\n    return zcr;\n};\ntype TypedArray = Int8Array | Uint8Array | Int16Array | Uint16Array | Int32Array | Uint32Array | Uint8ClampedArray | Float32Array | Float64Array;\ntype TypedArrayConstructor = typeof Int8Array | typeof Uint8Array | typeof Int16Array | typeof Uint16Array | typeof Int32Array | typeof Uint32Array | typeof Uint8ClampedArray | typeof Float32Array | typeof Float64Array;\nexport const setBuffer = (to: TypedArray, from: TypedArray, offsetTo?: number, offsetFrom?: number) => {\n    const toLength = to.length;\n    const fromLength = from.length;\n    const spillLength = Math.min(toLength, fromLength);\n    let spilled = 0;\n    let $to = mod(offsetTo, toLength) || 0;\n    let $from = mod(offsetFrom, fromLength) || 0;\n    while (spilled < spillLength) {\n        const $spillLength = Math.min(spillLength - spilled, toLength - $to, fromLength - $from);\n        const $fromEnd = $from + $spillLength;\n        if ($from === 0 && $fromEnd === fromLength) to.set(from, $to);\n        to.set(from.subarray($from, $fromEnd), $to);\n        $to %= $to + $spillLength;\n        $from %= $fromEnd;\n        spilled += $spillLength;\n    }\n    return to;\n};\nexport const getSubBuffer = (from: TypedArray, length: number, offset?: number) => {\n    const fromLength = from.length;\n    const $ = mod(offset, fromLength) || 0;\n    if ($ === 0 && length === fromLength) return from;\n    if ($ + length < fromLength) return from.subarray($, $ + length);\n    const to = new (from.constructor as TypedArrayConstructor)(length);\n    return setBuffer(to, from, 0, $);\n};\n/**\n * http://www.fftw.org/fftw3_doc/The-Halfcomplex_002dformat-DFT.html\n *\n * @param {Float32Array} from\n */\nexport const fftw2Amp = (from: Float32Array) => {\n    const { length } = from;\n    const amps = new Float32Array(length / 2);\n    for (let i = 0; i < length / 2; i++) {\n        const real = from[i];\n        const imag = (i === 0 || i === length / 2 - 1) ? 0 : from[length - i];\n        amps[i] = (real * real + imag * imag) ** 0.5 / length * 2.38328;\n    }\n    return amps;\n};\n","/**\n * Mod support wrapping with negative numbers\n *\n * @param {number} x\n * @param {number} y\n */\nexport const mod = (x: number, y: number) => (x % y + y) % y;\n/**\n * Round a number to multiple of another\n *\n * @param {number} x\n * @param {number} to\n * @returns\n */\nexport const round = (x: number, to: number) => Math.round(x / to) * to;\n/**\n * Floor a number to multiple of another\n *\n * @param {number} x\n * @param {number} to\n * @returns\n */\nexport const floor = (x: number, to: number) => Math.floor(x / to) * to;\n/**\n * Ceil a number to multiple of another\n *\n * @param {number} x\n * @param {number} to\n * @returns\n */\nexport const ceil = (x: number, to: number) => Math.ceil(x / to) * to;\nexport const toRad = (degrees: number) => degrees * Math.PI / 180;\nexport const toMIDI = (f: number) => [\"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\", \"G\", \"G#\", \"A\", \"A#\", \"B\"][(f % 12 + 12) % 12] + Math.round(f / 12 - 2);\nexport const atodb = (a: number) => 20 * Math.log10(a);\nexport const dbtoa = (db: number) => 10 ** (db / 20);\nexport const iNormExp = (x: number, e: number) => Math.max(0, x) ** (1.5 ** -e);\nexport const normExp = (x: number, e: number) => Math.max(0, x) ** (1.5 ** e);\n"],"sourceRoot":""}