{"version":3,"file":"src_core_hardware_HardwareEditor_ts.js/92268437d44acbec807a.worklet.js","mappings":";;;;;;;;;;;;;;;;AAA8D;AACqD;AAmBpG,MAAM,oBAA+E,gEAAiB,CAAc;AAAA,EAoB/H,YAAY,WAAoB,OAAqB;AAxCzD;AAyCQ,UAAM;AAnBV,gBAAO;AAoBH,SAAK,KAAK,MAAM;AAChB,SAAK,OAAO,MAAM;AAClB,SAAK,OAAQ,MAAM,QAAQ,CAAC;AAC5B,SAAK,QAAS,MAAM,SAAS,CAAC;AAC9B,SAAK,MAAM,MAAM;AACjB,SAAK,WAAW,IAAI,MAAM,KAAK,GAAG,EAAE,KAAK,IAAI,EAAE,IAAI,MAAM,oBAAI,IAAkB,CAAC;AAChF,SAAK,OAAO,MAAM;AAClB,SAAK,aAAa,MAAM;AACxB,SAAK,eAAe,MAAM;AAC1B,SAAK,mBAAmB,MAAM;AAC9B,QAAI,CAAC,KAAK;AAAkB,WAAK,mBAAmB,KAAK,KAAK,MAAM;AACpE,SAAK,SAAS,MAAM,UAAU;AAC9B,SAAK,OAAO,MAAM,UAAS,WAAc,aAAd,mBAAwB,YAAW,CAAC;AAC/D,SAAK,WAAW,CAAC,CAAC,MAAM;AACxB,SAAK,WAAW;AAChB,SAAK,GAAG,eAAe,MAAM,KAAK,SAAS,YAAY,CAAC;AACxD,SAAK,GAAG,eAAe,MAAM,KAAK,SAAS,YAAY,CAAC;AACxD,SAAK,GAAG,gBAAgB,MAAM,KAAK,SAAS,YAAY,CAAC;AAAA,EAC7D;AAAA,EACA,MAAM,OAAO;AACT,SAAK,UAAU,YAAY,aAAa,KAAK,IAAI;AACjD,UAAM,UAAU,KAAK,SAAS,cAAc,KAAK,OAAO;AACxD,eAAW,OAAO,KAAK,OAAO;AAC1B,UAAI,CAAC,QAAQ,MAAM,GAAG;AAAG,eAAO,KAAK,MAAM,GAAG;AAAA,IAClD;AACA,QAAI,KAAK,QAAQ,KAAK;AAAQ,WAAK,OAAO,KAAK,QAAQ;AACvD,WAAO,OAAO,KAAK,OAAO,KAAK,QAAQ,KAAK;AAC5C,UAAM,cAAc,KAAK,SAAS,qBAAqB,KAAK,OAAO;AACnE,QAAI,gBAAgB,KAAK,SAAS,UAAU,eAAe;AACvD,WAAK,MAAM,UAAU,KAAK,QAAQ,kBAAkB;AAAA,IACxD;AACA,SAAK,UAAU;AACf,QAAI,CAAC,KAAK,KAAK,MAAM,OAAK,IAAI,CAAC;AAAG,WAAK,OAAO,KAAK;AACnD,QAAI,CAAC,iEAAmB,CAAC,KAAK,gBAAgB,KAAM,KAAK,iBAAiB,MAAM,OAAK,OAAO,MAAM,QAAQ,KAAK,CAAC,KAAK,iBAAiB,MAAM,OAAK,IAAI,CAAC;AAAI,WAAK,mBAAmB,KAAK;AACvL,QAAI,KAAK,YAAY;AACjB,WAAK,UAAU,IAAI,YAAY,MAAM,KAAK,QAAQ;AAClD,YAAM,KAAK,QAAQ,KAAK;AAAA,IAC5B;AACA,WAAO;AAAA,EACX;AAAA,EACA,MAAM,WAAW;AAlFrB;AAmFQ,YAAM,UAAK,YAAL,mBAAc;AACpB,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA,EAIA,GAAG,OAAe,MAAW;AAzFjC;AA0FQ,eAAK,YAAL,mBAAc,GAAG,OAAO;AACxB,WAAO;AAAA,EACX;AAAA,EACA,IAAI,KAAK;AACL,WAAO,KAAK,QAAQ;AAAA,EACxB;AAAA,EACA,IAAI,cAAc;AAhGtB;AAiGQ,aAAO,UAAK,OAAL,mBAAS,gBAAe,CAAC,IAAI,EAAE;AAAA,EAC1C;AAAA,EACA,IAAI,OAAO;AAnGf;AAoGQ,YAAO,UAAK,YAAL,mBAAc;AAAA,EACzB;AAAA,EACA,IAAI,UAAU;AACV,WAAO,KAAK;AAAA,EAChB;AAAA,EACA,IAAI,aAAa;AACb,WAAO,KAAK,SAAS,MAAM;AAAA,EAC/B;AAAA,EACA,IAAI,SAAS;AACT,WAAO,KAAK;AAAA,EAChB;AAAA,EACA,IAAI,OAAO,KAAQ;AACf,SAAK,UAAU;AAAA,EACnB;AAAA,EACA,IAAI,SAAS;AACT,WAAO,KAAK;AAAA,EAChB;AAAA,EACA,IAAI,SAAS;AACT,WAAO,KAAK;AAAA,EAChB;AAAA,EACA,UAAU,MAAoB,KAAc;AACxC,UAAM,QAAQ,MAAM,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC;AAC5C,QAAI,CAAC,KAAK,SAAS,KAAK;AACpB,WAAK,SAAS,KAAK,IAAI,oBAAI,IAAkB;AACjD,SAAK,SAAS,KAAK,EAAE,IAAI,IAAI;AAAA,EACjC;AAAA,EACA,aAAa,MAAoB,KAAc;AAC3C,UAAM,QAAQ,MAAM,KAAK,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC;AAC5C,QAAI,KAAK,SAAS,KAAK;AACnB,WAAK,SAAS,KAAK,EAAE,OAAO,IAAI;AAAA,EACxC;AAAA,EAEA,OAAO,WAAyB;AAC5B,UAAM,QAAQ,KAAK;AACnB,UAAM,QAAQ,UAAQ,KAAK,QAAQ,CAAC;AAEpC,SAAK,MAAM;AACX,UAAM,QAAQ,UAAQ,KAAK,OAAO,CAAC;AAEnC,UAAM,cAAc,KAAK,SAAS;AAClC,QAAI,UAAU,SAAS;AACnB,WAAK,SAAS,KAAK,GAAG,IAAI,MAAM,UAAU,SAAS,WAAW,EAAE,KAAK,IAAI,EAAE,IAAI,MAAM,oBAAI,IAAkB,CAAC,CAAC;AAAA,aACxG,UAAU,SAAS;AACxB,WAAK,SAAS,OAAO,UAAU,MAAM;AACzC,SAAK,SAAS,QAAQ,SAAO,IAAI,QAAQ,UAAQ;AAAE,WAAK,UAAU;AAAG,WAAK,UAAU;AAAA,IAAG,CAAC,CAAC;AACzF,SAAK,KAAK,kBAAkB,IAAI;AAAA,EACpC;AAAA,EAEA,SAAS,MAAc;AACnB,UAAM,EAAE,MAAM,IAAI,IAAI;AACtB,UAAM,CAAC,MAAM,KAAK,OAAO,MAAM,IAAI;AAEnC,UAAM,CAAC,IAAI,IAAI,IAAI,EAAE,IAAI;AAAA,MACrB,KAAK,CAAC,MAAM,KAAK,OAAO,OAAO,GAAG;AAAA,MAClC,KAAK,CAAC,MAAM,MAAM,QAAQ,OAAO,OAAO,MAAM,MAAM;AAAA,MACpD,KAAK,CAAC,MAAM,KAAK,MAAM,MAAM,MAAM;AAAA,MACnC,KAAK,CAAC,OAAO,OAAO,KAAK,OAAO,OAAO,MAAM,MAAM;AAAA,IACvD,EAAE,IAAI,IAAI,EAAE,IAAI;AAEhB,QAAI,CAAC,OAAO,KAAK,IAAI,CAAC,KAAK,IAAI,KAAK,EAAE;AACtC,QAAI,YAAY,IAAI,IAAI,EAAE;AAE1B,WAAO,EAAE,KAAK,KAAK,QAAQ,WAAW,MAAM,KAAK,QAAQ,UAAU;AAAA,EACvE;AAAA,EAEA,IAAI,cAAc;AACd,UAAM,YAAY,CAAC;AACnB,aAAS,IAAI,GAAG,IAAI,KAAK,IAAI,QAAQ,KAAK;AACtC,gBAAU,CAAC,IAAI,KAAK,SAAS,CAAC;AAAA,IAClC;AACA,WAAO;AAAA,EACX;AAAA,EAEA,IAAI,WAAW;AACX,WAAO,KAAK,SAAS,QAAQ,SAAO,MAAM,KAAK,IAAI,OAAO,CAAC,CAAC;AAAA,EAChE;AAAA,EACA,YAAY,IAAY,YAAoB,YAAoB,QAAgB;AAC5E,QAAI,KAAK;AAAS,WAAK,QAAQ,YAAY,IAAI,YAAY,YAAY,MAAM;AAC7E,SAAK,KAAK,iBAAiB,EAAE,GAAG,CAAC;AACjC,WAAO;AAAA,EACX;AAAA,EACA,eAAe,IAAY,YAAoB,YAAoB,QAAgB;AAC/E,QAAI,KAAK;AAAS,WAAK,QAAQ,eAAe,IAAI,YAAY,YAAY,MAAM;AAChF,SAAK,KAAK,iBAAiB,EAAE,GAAG,CAAC;AACjC,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA2CA,cAAc,IAAY,UAAuB,SAAiB;AAC9D,UAAM,WAAW,KAAK,SAAS,EAAE,EAAE,OAAO;AAC1C,QAAI;AACJ,WAAO,EAAE,OAAO,SAAS,KAAK,GAAG,MAAM;AACnC,YAAM,OAAO,KAAK;AAClB,UAAK,KAAK,SAAS,YAAY,KAAK,IAAI,CAAC,MAAM,WAAa,KAAK,SAAS,YAAY,KAAK,IAAI,CAAC,MAAM;AAClG,eAAO;AAAA,IACf;AACA,WAAO;AAAA,EACX;AAAA,EAEA,MAAM,WAAW,QAAgB,OAAiB;AA/OtD;AAgPQ,QAAI,CAAC,SAAS,WAAW,KAAK;AAAM,aAAO;AAC3C,UAAM,EAAE,aAAa,eAAe,IAAI;AACxC,SAAK,SAAS,QAAQ,UAAQ,KAAK,QAAQ,CAAC;AAC5C,YAAM,UAAK,YAAL,mBAAc;AACpB,SAAK,OAAO;AACZ,SAAK,OAAO,CAAC;AACb,UAAM,KAAK,KAAK;AAChB,SAAK,SAAS,QAAQ,UAAQ,KAAK,OAAO,CAAC;AAC3C,UAAM,EAAE,YAAY,IAAI;AACxB,QAAI,CAAC,YAAY,MAAM,CAAC,GAAG,MAAM,MAAM,eAAe,CAAC,CAAC,GAAG;AACvD,WAAK,OAAO;AACZ,WAAK,mBAAmB;AAAA,IAC5B;AACA,SAAK,KAAK,eAAe,IAAI;AAC7B,eAAK,YAAL,mBAAc,QAAQ,KAAK,QAAQ;AACnC,UAAM,KAAK,SAAS;AACpB,WAAO;AAAA,EACX;AAAA,EACA,OAAO,GAAkD;AACrD,UAAM,EAAE,MAAM,MAAM,IAAI;AACxB,QAAI;AAAM,WAAK,OAAO;AACtB,QAAI,OAAO;AACP,UAAI,qDAAO,CAAC,MAAM,IAAI,GAAG;AACrB,aAAK,QAAQ,MAAM,IAAI;AACvB,eAAO,MAAM;AAAA,MACjB;AACA,UAAI,iEAAmB,CAAC,MAAM,gBAAgB,GAAG;AAC7C,aAAK,oBAAoB,MAAM,gBAAgB;AAC/C,eAAO,MAAM;AAAA,MACjB;AACA,UAAI,OAAO,MAAM,iBAAiB,WAAW;AACzC,aAAK,gBAAgB,MAAM,YAAY;AACvC,eAAO,MAAM;AAAA,MACjB;AACA,UAAI,OAAO,MAAM,eAAe,WAAW;AACvC,aAAK,cAAc,MAAM,UAAU;AACnC,eAAO,MAAM;AAAA,MACjB;AACA,WAAK,QAAQ,OAAO,OAAO,KAAK,OAAO,KAAK;AAAA,IAChD;AACA,WAAO;AAAA,EACX;AAAA,EACA,IAAI,WAAW;AACX,WAAO,KAAK,KAAK,MAAM,GAAG,CAAC;AAAA,EAC/B;AAAA,EACA,IAAI,SAAS,CAAC,QAAQ,KAAK,GAAqB;AAC5C,UAAM,CAAC,MAAM,KAAK,OAAO,MAAM,IAAI,KAAK;AACxC,SAAK,QAAQ,CAAC,OAAO,WAAW,WAAW,SAAS,MAAM,OAAO,UAAU,WAAW,QAAQ,KAAK,OAAO,MAAM,CAAU;AAAA,EAC9H;AAAA,EACA,IAAI,uBAAuB;AACvB,WAAO,KAAK,iBAAiB,MAAM,GAAG,CAAC;AAAA,EAC3C;AAAA,EACA,IAAI,qBAAqB,CAAC,QAAQ,KAAK,GAAuC;AAC1E,UAAM,CAAC,MAAM,KAAK,OAAO,MAAM,IAAI,KAAK;AACxC,SAAK,oBAAoB,CAAC,OAAO,WAAW,YAAY,OAAO,WAAW,WAAW,SAAS,MAAM,OAAO,UAAU,YAAY,OAAO,UAAU,WAAW,QAAQ,KAAK,OAAO,MAAM,CAAsB;AAAA,EACjN;AAAA,EACA,IAAI,OAAO;AACP,WAAO,KAAK,KAAK,MAAM,CAAC;AAAA,EAC5B;AAAA,EACA,IAAI,KAAK,CAAC,SAAS,QAAQ,GAAqB;AAC5C,UAAM,CAAC,MAAM,KAAK,OAAO,MAAM,IAAI,KAAK;AACxC,SAAK,QAAQ,CAAC,MAAM,KAAK,WAAW,OAAO,YAAY,MAAM,CAAU;AAAA,EAC3E;AAAA,EACA,IAAI,mBAAmB;AACnB,WAAO,KAAK,iBAAiB,MAAM,CAAC;AAAA,EACxC;AAAA,EACA,IAAI,iBAAiB,CAAC,SAAS,QAAQ,GAAuC;AAC1E,UAAM,CAAC,MAAM,KAAK,OAAO,MAAM,IAAI,KAAK;AACxC,SAAK,oBAAoB,CAAC,MAAM,KAAK,WAAW,OAAO,YAAY,MAAM,CAAsB;AAAA,EACnG;AAAA,EACA,QAAQ,iBAAiB,OAAO;AAC5B,UAAM,UAAU,iBAAiB,qBAAqB;AACtD,WAAO,KAAK,OAAO,EAAE,CAAC;AAAA,EAC1B;AAAA,EACA,QAAQ,QAAyB,iBAAiB,OAAO;AACrD,UAAM,cAAc,iBAAiB,yBAAyB;AAC9D,SAAK,WAAW,IAAI,CAAC,QAAe,MAAS;AAAA,EACjD;AAAA,EACA,OAAO,iBAAiB,OAAO;AAC3B,UAAM,UAAU,iBAAiB,qBAAqB;AACtD,WAAO,KAAK,OAAO,EAAE,CAAC;AAAA,EAC1B;AAAA,EACA,OAAO,OAAwB,iBAAiB,OAAO;AACnD,UAAM,cAAc,iBAAiB,yBAAyB;AAC9D,SAAK,WAAW,IAAI,CAAC,QAAW,KAAY;AAAA,EAChD;AAAA,EACA,SAAS,iBAAiB,OAAO;AAC7B,UAAM,UAAU,iBAAiB,qBAAqB;AACtD,WAAO,KAAK,OAAO,EAAE,CAAC;AAAA,EAC1B;AAAA,EACA,SAAS,SAA0B,iBAAiB,OAAO;AACvD,UAAM,UAAU,iBAAiB,qBAAqB;AACtD,SAAK,OAAO,IAAI,CAAC,SAAgB,MAAS;AAAA,EAC9C;AAAA,EACA,UAAU,iBAAiB,OAAO;AAC9B,UAAM,UAAU,iBAAiB,qBAAqB;AACtD,WAAO,KAAK,OAAO,EAAE,CAAC;AAAA,EAC1B;AAAA,EACA,UAAU,UAA2B,iBAAiB,OAAO;AACzD,UAAM,UAAU,iBAAiB,qBAAqB;AACtD,SAAK,OAAO,IAAI,CAAC,QAAW,QAAe;AAAA,EAC/C;AAAA,EACA,cAAc,MAAe;AACzB,QAAI,CAAC,CAAC,KAAK,eAAe,CAAC,CAAC;AAAM,aAAO;AACzC,SAAK,aAAa;AAClB,SAAK,KAAK,qBAAqB,IAAI;AACnC,WAAO;AAAA,EACX;AAAA,EACA,gBAAgB,MAAe;AAC3B,QAAI,CAAC,CAAC,KAAK,iBAAiB,CAAC,CAAC;AAAM,aAAO;AAC3C,SAAK,eAAe;AACpB,QAAI;AAAM,WAAK,mBAAmB,KAAK,KAAK,MAAM;AAClD,SAAK,KAAK,uBAAuB,IAAI;AACrC,WAAO;AAAA,EACX;AAAA,EACA,QAAQ,MAAa;AACjB,QAAI,CAAC,qDAAO,CAAC,IAAI;AAAG,aAAO;AAC3B,SAAK,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,CAAC,CAAC;AAC7B,SAAK,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,CAAC,CAAC;AAC7B,SAAK,CAAC,IAAI,KAAK,IAAI,IAAI,KAAK,CAAC,CAAC;AAC9B,SAAK,CAAC,IAAI,KAAK,IAAI,IAAI,KAAK,CAAC,CAAC;AAC9B,SAAK,OAAO;AACZ,SAAK,QAAQ,QAAQ,SAAO,IAAI,QAAQ,UAAQ;AAAE,WAAK,UAAU;AAAG,WAAK,UAAU;AAAA,IAAG,CAAC,CAAC;AAIxF,SAAK,KAAK,eAAe,IAAI;AAC7B,WAAO;AAAA,EACX;AAAA,EACA,oBAAoB,MAAyB;AACzC,QAAI,CAAC,iEAAmB,CAAC,IAAI;AAAG,aAAO;AACvC,QAAI,OAAO,KAAK,CAAC,MAAM;AAAU,WAAK,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,CAAC,CAAC;AAC9D,QAAI,OAAO,KAAK,CAAC,MAAM;AAAU,WAAK,CAAC,IAAI,KAAK,IAAI,GAAG,KAAK,CAAC,CAAC;AAC9D,QAAI,OAAO,KAAK,CAAC,MAAM;AAAU,WAAK,CAAC,IAAI,KAAK,IAAI,IAAI,KAAK,CAAC,CAAC;AAC/D,QAAI,OAAO,KAAK,CAAC,MAAM;AAAU,WAAK,CAAC,IAAI,KAAK,IAAI,IAAI,KAAK,CAAC,CAAC;AAC/D,SAAK,mBAAmB;AACxB,SAAK,KAAK,2BAA2B,IAAI;AACzC,WAAO;AAAA,EACX;AAAA,EACA,aAAa,iBAAiB,OAAO;AACjC,QAAI,CAAC;AAAgB,aAAO;AAC5B,WAAO,2DAAa,CAAC,KAAK,gBAAgB;AAAA,EAC9C;AAAA,EACA,eAAe,iBAAiB,OAAO;AACnC,QAAI,CAAC;AAAgB,aAAO;AAC5B,WAAO,6DAAe,CAAC,KAAK,gBAAgB;AAAA,EAChD;AAAA,EACA,UAAU,QAAgB;AACtB,UAAM,YAAY,KAAK;AACvB,SAAK,SAAS;AACd,SAAK,SAAS,EAAE,WAAW,OAAO,CAAC;AACnC,SAAK,SAAS,KAAK,iBAAiB,EAAE,OAAO,KAAK,IAAI,OAAO,CAAC;AAAA,EAClE;AAAA,EACA,MAAM,MAAc;AAChB,SAAK,KAAK,SAAS,IAAI;AACvB,SAAK,SAAS,OAAO,SAAS,WAAW,MAAM,IAAI;AAAA,EACvD;AAAA,EACA,YAAY;AACR,SAAK,SAAS,KAAK,gBAAgB,KAAK,EAAE;AAAA,EAC9C;AAAA,EACA,cAAc,OAAgB,WAAmB;AAC7C,SAAK,SAAS,KAAK,iBAAiB,EAAE,OAAO,KAAK,IAAI,OAAO,GAAG,UAAU,CAAC;AAAA,EAC/E;AAAA,EACA,SAAS,GAA4J;AACjK,SAAK,SAAS,WAAW,KAAK,IAAI,CAAC;AAAA,EACvC;AAAA,EACA,WAAW;AAGP,WAAO;AAAA,EACX;AAAA,EACA,MAAM,aAAa,EAAE,MAAM,OAAO,OAAO,OAAO,GAA4E,SAA+B;AA3Z/J;AA4ZQ,QAAI;AAAM,cAAM,UAAK,YAAL,mBAAc,WAAW,MAAM;AAC/C,QAAI;AAAO,cAAM,UAAK,YAAL,mBAAc,YAAY,OAAO;AAClD,QAAI;AAAO,cAAM,UAAK,YAAL,mBAAc,YAAY,OAAO;AAAA,EACtD;AAAA,EACA,MAAM,UAAU;AAhapB;AAiaQ,SAAK,SAAS,QAAQ,UAAQ,KAAK,SAAS,WAAW,KAAK,EAAE,CAAC;AAC/D,WAAO,KAAK,SAAS,MAAM,KAAK,EAAE;AAClC,YAAM,UAAK,YAAL,mBAAc;AACpB,WAAO;AAAA,EACX;AAAA,EACA,OAAO,aAAa,OAAe;AAC/B,UAAM,QAAQ;AACd,UAAM,WAAW,CAAC;AAClB,QAAI,QAAQ,MAAM,KAAK,KAAK;AAC5B,WAAO,SAAS,MAAM;AAGlB,eAAS,KAAK,MAAM,CAAC,IAAI,MAAM,CAAC,IAAI,MAAM,CAAC,CAAC;AAE5C,cAAQ,MAAM,KAAK,KAAK;AAAA,IAC5B;AACA,UAAM,SAAqE,EAAE,OAAO,IAAI,MAAM,CAAC,GAAG,OAAO,CAAC,EAAE;AAC5G,QAAI;AACJ,QAAI,SAAS;AAAQ,aAAO,QAAQ,SAAS,MAAM;AACnD,WAAO,SAAS,QAAQ;AACpB,YAAM,KAAK,SAAS,MAAM;AAC1B,UAAI,OAAO,aAAa,eAAe,GAAG,OAAO,CAAC,MAAM,KAAK;AAEzD,cAAM,SAAS,OAAO,EAAE;AAExB,YAAI,CAAC,MAAM,MAAM,GAAG;AAChB,iBAAO,KAAK,KAAK,MAAM;AACvB;AAAA,QACJ;AAEA,YAAI;AACA,iBAAO,KAAK,KAAK,KAAK,MAAM,EAAE,CAAC;AAAA,QACnC,SAAS,GAAP;AACE,iBAAO,KAAK,KAAK,EAAE;AAAA,QACvB;AACA;AAAA,MACJ;AACA,UAAI,GAAG,SAAS,KAAK,GAAG,OAAO,CAAC,MAAM,KAAK;AACvC,mBAAW,GAAG,OAAO,CAAC;AACtB,eAAO,MAAM,QAAQ,IAAI,CAAC;AAC1B;AAAA,MACJ;AACA,UAAI;AACA,eAAO,MAAM,QAAQ,EAAE,KAAK,KAAK,MAAM,EAAE,CAAC;AAAA,MAC9C,SAAS,GAAP;AACE,eAAO,MAAM,QAAQ,EAAE,KAAK,EAAE;AAAA,MAClC;AAAA,IACJ;AACA,eAAW,OAAO,OAAO,OAAO;AAC5B,UAAI,OAAO,MAAM,GAAG,EAAE,WAAW;AAAG,eAAO,MAAM,GAAG,IAAI;AAAA,eAC/C,OAAO,MAAM,GAAG,EAAE,WAAW;AAAG,eAAO,MAAM,GAAG,IAAI,8DAAgB,CAAC,OAAO,MAAM,GAAG,EAAE,CAAC,CAAC;AAAA;AAC7F,eAAO,MAAM,GAAG,IAAI,8DAAgB,CAAC,OAAO,MAAM,GAAG,EAAE,KAAK,GAAG,CAAC;AAAA,IACzE;AACA,WAAO;AAAA,EACX;AAAA,EACA,WAAW;AACP,UAAM,EAAE,IAAI,MAAM,KAAK,MAAM,YAAY,cAAc,kBAAkB,MAAM,OAAO,MAAM,OAAO,IAAI;AAEvG,UAAM,eAAoC,gBAAgB,KAAK;AAC/D,QAAI,WAAqB,CAAC;AAC1B,QAAI,KAAK,MAAM;AACX,iBAAW,OAAO,KAAK,KAAK,OAAO;AAC/B,YAAI,KAAK,KAAK,MAAM,GAAG,EAAE,iBAAiB;AACtC,cAAI,EAAE,OAAO,eAAe;AACxB,yBAAa,GAAG,IAAI,KAAK,KAAK,MAAM,GAAG,EAAE;AAAA,UAC7C;AAAA,QACJ;AAAA,MACJ;AACA,iBAAW,KAAK,KAAK,IAAI,IAAI,QAAM,GAAG,IAAI,OAAO;AAAA,IACrD;AAEA,WAAO,KAAK,UAAU,EAAE,IAAI,MAAM,UAAU,MAAM,YAAY,cAAc,kBAAkB,MAAM,OAAO,cAAc,MAAM,OAAO,CAAC;AAAA,EAC3I;AAAA,EACA,iBAA+B;AAC3B,WAAO,KAAK,MAAM,KAAK,SAAS,CAAC;AAAA,EACrC;AACJ;;;;;;;;;;;;;;;;AC3eA,SAAS,cAAc,MAAiB;AACtC,MAAI,WAAW;AACf,MAAI,WAAW;AAEf,OAAK,QAAQ,CAAC,QAAQ;AACpB,QAAI,IAAI,iBAAiB;AACvB,iBAAW,WAAW,IAAI,iBAAiB;AACzC,cAAM,MAAM,IAAI,gBAAgB,OAAO;AACvC,YAAI,IAAI,KAAK;AAEX,cAAI,IAAI;AAAK;AACb,cAAI,IAAI;AAAK;AAAA,QACf;AAAA,MACF;AAAA,IACF;AAAA,EACF,CAAC;AAED,SAAO,WAAW,KAAK,WAAW;AACpC;AAEA,SAAS,cAAc,MAAiB;AACtC,MAAI,aAAa;AACjB,MAAI,cAAc;AAClB,MAAI,UAAU;AAEd,OAAK,QAAQ,CAAC,QAAQ;AACpB,QAAI,IAAI,iBAAiB;AACvB,iBAAW,WAAW,IAAI,iBAAiB;AACzC,cAAM,MAAM,IAAI,gBAAgB,OAAO;AACvC,YAAI,IAAI,KAAK;AAEX,cAAI,IAAI;AAAO;AACf,cAAI,IAAI;AAAQ;AAChB,cAAI,IAAI;AAAI;AAAA,QACd;AAAA,MACF;AAAA,IACF;AAAA,EACF,CAAC;AAGD,QAAM,eAAe,KAAK,OAAO,CAAC,MAAM,EAAE,GAAG,EAAE;AAE/C,MACE,KAAK,WAAW,MACf,eAAe,KAAK,gBAAgB,KAAK,YAAY,MACtD,iBAAiB,GACjB;AAEA,WAAO;AAAA,EACT;AAEA,MAAI,cAAc,KAAK,eAAe,GAAG;AACvC,WAAO;AAAA,EACT;AAEA,SAAO;AACT;AAEA,SAAS,cAAc,MAAiB;AACtC,MAAI,kBAAkB,CAAC,eAAe,aAAa;AAEnD,SAAO,gBAAgB,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC;AAC5C;AAEA,SAAS,kBAAkB,MAAiB;AAC1C,MAAI,cAAc,KAAK,OAAO,CAAC,MAAM,EAAE,iBAAiB,CAAC,EAAE,YAAY,EAAE;AAEzE,MAAI,cAAc,GAAG;AACnB,WAAO;AAAA,EACT;AAGA,MAAI,UAAU,KAAK,IAAI,CAAC,GAAG,OAAO,EAAE,GAAG,EAAE,EAAE,EAAE,OAAO,CAAC,EAAE,EAAE,MAAM,EAAE,aAAa;AAE9E,MAAI,oBAAoB;AACxB,aAAW,UAAU,SAAS;AAC5B,UAAM,EAAE,GAAG,KAAK,GAAG,MAAM,IAAI;AAG7B,QAAI,KAAK,OAAO,CAAC,GAAG,MAAM,MAAM,KAAK,EAAE,MAAM,CAAC,MAAM,EAAE,gBAAgB,EAAE,GAAG,GAAG;AAC5E,0BAAoB;AACpB;AAAA,IACF;AAAA,EACF;AAGA,SAAO;AACT;AAEA,SAAS,iBAAiB,MAAiB;AACzC,MAAI,cAAc,KAAK,OAAO,CAAC,MAAM,EAAE,gBAAgB,CAAC,EAAE,WAAW,EAAE;AAEvE,MAAI,cAAc,GAAG;AACnB,WAAO;AAAA,EACT;AAGA,MAAI,UAAU,KAAK,IAAI,CAAC,GAAG,OAAO,EAAE,GAAG,EAAE,EAAE,EAAE,OAAO,CAAC,EAAE,EAAE,MAAM,EAAE,YAAY;AAE7E,MAAI,oBAAoB;AACxB,aAAW,UAAU,SAAS;AAC5B,UAAM,EAAE,GAAG,KAAK,GAAG,MAAM,IAAI;AAG7B,QAAI,KAAK,OAAO,CAAC,GAAG,MAAM,MAAM,KAAK,EAAE,MAAM,CAAC,MAAM,EAAE,eAAe,EAAE,GAAG,GAAG;AAC3E,0BAAoB;AACpB;AAAA,IACF;AAAA,EACF;AAGA,SAAO;AACT;AAEO,SAAS,eAAe,MAAiB;AAC9C,MAAI,kBAAkB,CAAC,eAAe,mBAAmB,gBAAgB;AAIzE,SAAO,gBAAgB,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC;AAC5C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzH0F;AAC9C;AACpB;AACE;AAUuB;AAuClC,MAAM,sBAAsB,wDAAU,CAAiC;AAAA,EA8ClF,YAAY,UAAmB;AAC3B,UAAM,QAAQ;AAzClB,iBAA4B;AAAA,MACxB,QAAQ;AAAA,MACR,cAAc;AAAA,MACd,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,iBAAiB;AAAA,MACjB,UAAU,CAAC;AAAA,IACf;AAyBA,+BAAsB,CAAC,MAAwC,KAAK,KAAK,iBAAiB,CAAC;AAC3F,mCAA0B,CAAC,MAA4C,KAAK,KAAK,UAAU,EAAE,OAAO,CAAC,GAAG,OAAO,EAAE,CAAC,EAAE,EAAE,GAAG,EAAE,eAAe,EAAE,EAAE,CAAC;AAC/I,4BAAmB,CAAC,MAAqC,KAAK,KAAK,cAAc,CAAC;AAClF,8BAAqB,CAAC,MAAuC,KAAK,KAAK,gBAAgB,CAAC;AACxF,+BAAsB,CAAC,MAAwC,KAAK,KAAK,iBAAiB,CAAC;AAC3F,8BAAqB,CAAC,MAAuC,KAAK,KAAK,gBAAgB,CAAC;AACxF,+BAAsB,CAAC,MAAwC,KAAK,KAAK,iBAAiB,CAAC;AAC3F,yBAAgB,MAAM,KAAK,SAAS,YAAY;AAG5C,UAAM,EAAE,mBAAmB,IAAI,KAAK;AACpC,SAAK,SAAS;AAAA,MACV,QAAQ;AAAA,MACR,cAAc,CAAC,CAAC;AAAA,MAChB,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,iBAAiB;AAAA,MACjB,UAAU,CAAC;AAAA,IACf,CAAC;AAAA,EACL;AAAA,EAxDA,aAAa,gBAAgB,EAAE,MAAM,KAAK,SAAS,WAAW,GAA2I;AACrM,UAAM,UAAU,MAAM,KAAK,YAAY,EAAE,KAAK,SAAS,WAAW,CAAC;AACnE,UAAM,SAAS,IAAI,KAAK,OAAO;AAC/B,WAAO,OAAO,KAAK;AAAA,EACvB;AAAA,EASA,IAAI,WAAW;AACX,WAAO,KAAK,MAAM;AAAA,EACtB;AAAA,EACA,IAAI,QAAQ;AACR,WAAO,KAAK,SAAS;AAAA,EACzB;AAAA,EACA,IAAI,QAAQ;AACR,WAAO,KAAK,SAAS;AAAA,EACzB;AAAA,EACA,IAAI,QAAQ;AACR,WAAO,KAAK,SAAS;AAAA,EACzB;AAAA,EACA,IAAI,cAAc;AACd,WAAO,KAAK,SAAS;AAAA,EACzB;AAAA,EACA,IAAI,gBAAgB;AAChB,WAAO,KAAK,SAAS;AAAA,EACzB;AAAA,EACA,IAAI,WAAW;AACX,WAAO,KAAK,SAAS;AAAA,EACzB;AAAA,EACA,IAAI,WAA0B;AAC1B,WAAO;AAAA,EACX;AAAA,EAqBA,MAAM,OAAO;AACT,QAAI,CAAC,KAAK,SAAS,SAAS;AACxB,YAAM,IAAI,QAAc,CAAC,SAAS,WAAW;AACzC,cAAM,cAAc,MAAM;AACtB,kBAAQ;AACR,eAAK,SAAS,IAAI,SAAS,WAAW;AAAA,QAC1C;AACA,aAAK,SAAS,GAAG,SAAS,WAAW;AAAA,MACzC,CAAC;AAAA,IACL;AACA,SAAK,GAAG,WAAW,KAAK,aAAa;AACrC,SAAK,SAAS,GAAG,iBAAiB,KAAK,mBAAmB;AAC1D,SAAK,SAAS,GAAG,qBAAqB,KAAK,uBAAuB;AAClE,SAAK,SAAS,GAAG,cAAc,KAAK,gBAAgB;AACpD,SAAK,SAAS,GAAG,gBAAgB,KAAK,kBAAkB;AACxD,SAAK,SAAS,GAAG,iBAAiB,KAAK,mBAAmB;AAC1D,SAAK,SAAS,GAAG,gBAAgB,KAAK,kBAAkB;AACxD,SAAK,SAAS,GAAG,iBAAiB,KAAK,mBAAmB;AAC1D,UAAM,EAAE,mBAAmB,IAAI,KAAK;AACpC,SAAK,SAAS;AAAA,MACV,QAAQ;AAAA,MACR,cAAc,CAAC,CAAC;AAAA,MAChB,UAAU;AAAA,MACV,YAAY;AAAA,MACZ,iBAAiB;AAAA,MACjB,UAAU,CAAC;AAAA,IACf,CAAC;AACD,SAAK,WAAW;AAChB,SAAK,KAAK,OAAO;AACjB,WAAO;AAAA,EACX;AAAA,EACA,SAAS,OAAoC;AACzC,QAAI,UAAU;AACd,eAAW,SAAS,OAAO;AACvB,YAAM,MAAM;AACZ,UAAI,KAAK,MAAM,GAAG,MAAM,MAAM,GAAG;AAAG;AACpC,gBAAU;AACV,UAAI,QAAQ,YAAY,QAAQ;AAAgB,aAAK,YAAY;AACjE,WAAK,MAAM,GAAG,IAAI,MAAM,GAAG;AAC3B,WAAK,KAAK,KAAK,MAAM,GAAG,CAAC;AAAA,IAC7B;AAEA,WAAO;AAAA,EACX;AAAA,EACA,MAAM,UAAU,OAAqB;AACjC,UAAM,MAAM,MAAM,KAAK,SAAS,UAAU,KAAK;AAC/C,SAAK,KAAK,UAAU,EAAE,OAAO,EAAE,CAAC,IAAI,EAAE,GAAG,IAAI,eAAe,EAAE,GAAG,OAAO,CAAC,EAAE,CAAC;AAC5E,UAAM,IAAI,SAAS;AACnB,WAAO;AAAA,EACX;AAAA,EACA,MAAM,kBAAkB,MAA6B,OAAmC;AACpF,UAAM,OAAO,KAAK;AAClB,UAAM,OAAO,KAAK;AAClB,UAAM,MAAM,KAAK;AACjB,QAAI,SAAS,WAAW;AACpB,YAAM,SAAiC,KAAK,MAAM,SAAS,UACrD,EAAE,MAAM,KAAK,OAAO,KAAK,QAAQ,OAAO,QAAQ,OAAO,QAAQ,SAAS,IACxE,KAAK,MAAM,SAAS,UAChB,EAAE,QAAQ,OAAO,QAAQ,IAAI,IAC7B,KAAK,MAAM,SAAS,QAChB,EAAE,QAAQ,MAAM,IAChB,CAAC;AACf,YAAM,MAAM,OAAO,GAAG;AACtB,UAAI;AAAK,cAAM,KAAK,UAAU,iBAAE,MAAM,GAAG,OAAO,UAAW,MAAO;AAAA,IACtE,WAAW,SAAS,SAAS;AACzB,YAAM,KAAK,UAAU,iBAAE,MAAM,WAAW,UAAW,MAAO;AAAA,IAC9D,WAAW,SAAS,SAAS;AACzB,YAAM,KAAK,UAAU,iBAAE,MAAM,OAAO,UAAW,MAAO;AAAA,IAC1D,WAAW,SAAS,QAAQ;AACxB,YAAM,KAAK,UAAU,iBAAE,MAAM,SAAS,UAAW,MAAO;AAAA,IAC5D;AAAA,EACJ;AAAA,EACA,MAAM,UAAU,OAAe;AAC3B,SAAK,SAAS,KAAK;AACnB,UAAM,MAAM,MAAM,KAAK,SAAS,UAAU,KAAK;AAC/C,QAAI,CAAC;AAAK,aAAO;AACjB,SAAK,KAAK,UAAU,EAAE,OAAO,EAAE,CAAC,IAAI,EAAE,GAAG,IAAI,eAAe,EAAE,GAAG,OAAO,CAAC,EAAE,CAAC;AAC5E,WAAO;AAAA,EACX;AAAA,EACA,WAAW,QAAuB;AAC9B,UAAM,OAAO,KAAK,SAAS,WAAW,MAAM;AAC5C,QAAI,CAAC;AAAM,aAAO;AAClB,SAAK,KAAK,UAAU,EAAE,OAAO,CAAC,GAAG,OAAO,EAAE,CAAC,KAAK,EAAE,GAAG,KAAK,eAAe,EAAE,EAAE,CAAC;AAC9E,WAAO;AAAA,EACX;AAAA,EACA,WAAW,QAAgB;AACvB,SAAK,SAAS,MAAM;AACpB,UAAM,OAAO,KAAK,SAAS,WAAW,MAAM;AAC5C,QAAI,CAAC;AAAM,aAAO;AAClB,SAAK,KAAK,UAAU,EAAE,OAAO,CAAC,GAAG,OAAO,EAAE,CAAC,KAAK,EAAE,GAAG,KAAK,eAAe,EAAE,EAAE,CAAC;AAC9E,WAAO;AAAA,EACX;AAAA,EACA,YAAY,QAAgB,KAAa,KAAa;AAClD,UAAM,IAAI,KAAK,SAAS,YAAY,QAAQ,KAAK,GAAG;AACpD,SAAK,KAAK,eAAe,CAAC;AAAA,EAC9B;AAAA,EACA,YAAY,QAAgB,KAAa,KAAa;AAClD,UAAM,IAAI,KAAK,SAAS,YAAY,QAAQ,KAAK,GAAG;AACpD,SAAK,KAAK,eAAe,CAAC;AAAA,EAC9B;AAAA,EACA,MAAM,UAAU,OAAe,QAAqG;AAnNxI;AAoNQ,QAAI,OAAO,OAAO,WAAW;AAAU,iBAAK,SAAS,MAAM,KAAK,MAAzB,mBAA4B,UAAU,OAAO;AACpF,YAAM,UAAK,SAAS,MAAM,KAAK,MAAzB,mBAA4B,aAAa;AAAA,EACnD;AAAA,EAEA,UAAU,KAAe;AACrB,QAAI,QAAQ,CAAC,OAAO;AAChB,UAAI,KAAK,MAAM,SAAS,QAAQ,EAAE,KAAK;AAAG;AAC1C,UAAI,KAAK,MAAM,EAAE,KAAK,KAAK,MAAM,EAAE;AAAG,aAAK,MAAM,SAAS,KAAK,EAAE;AAAA,IACrE,CAAC;AACD,SAAK,KAAK,YAAY,KAAK,MAAM,SAAS,MAAM,CAAC;AAAA,EACrD;AAAA,EACA,iBAAiB;AACb,QAAI,MAAM,OAAO,KAAK,KAAK,KAAK;AAChC,QAAI,KAAK,MAAM;AAAc,YAAM,IAAI,OAAO,QAAM,KAAK,MAAM,EAAE,EAAE,YAAY;AAC/E,SAAK,MAAM,WAAW;AACtB,SAAK,KAAK,YAAY,GAAG;AAAA,EAC7B;AAAA,EACA,cAAc,KAAe;AACzB,SAAK,MAAM,WAAW,CAAC;AACvB,SAAK,OAAO,GAAG,GAAG;AAAA,EACtB;AAAA,EACA,YAAY,KAAe;AACvB,QAAI,QAAQ,CAAC,OAAO;AAChB,YAAM,IAAI,KAAK,MAAM,SAAS,QAAQ,EAAE;AACxC,UAAI,MAAM;AAAI;AACd,WAAK,MAAM,SAAS,OAAO,GAAG,CAAC;AAAA,IACnC,CAAC;AACD,SAAK,KAAK,YAAY,KAAK,MAAM,SAAS,MAAM,CAAC;AAAA,EACrD;AAAA,EACA,cAAc;AACV,SAAK,MAAM,WAAW,CAAC;AACvB,SAAK,KAAK,YAAY,CAAC,CAAC;AAAA,EAC5B;AAAA,EACA,mBAAmB;AACf,UAAM,UAAU,oBAAI,IAAU;AAC9B,UAAM,UAA8B,EAAE,OAAO,CAAC,GAAG,OAAO,CAAC,EAAE;AAC3D,SAAK,MAAM,SACN,OAAO,QAAM,GAAG,WAAW,KAAK,KAAK,KAAK,MAAM,EAAE,CAAC,EACnD,IAAI,QAAM,KAAK,MAAM,EAAE,CAAC,EACxB,QAAQ,CAAC,QAAQ;AACd,UAAI,SAAS,QAAQ,UAAQ,QAAQ,IAAI,IAAI,CAAC;AAC9C,cAAQ,MAAM,IAAI,EAAE,IAAI,IAAI,eAAe;AAAA,IAC/C,CAAC;AACL,YAAQ,QAAQ,CAAC,SAAS;AACtB,UAAI,QAAQ,MAAM,KAAK,GAAG,KAAK,QAAQ,MAAM,KAAK,GAAG;AACjD,gBAAQ,MAAM,KAAK,EAAE,IAAI,KAAK,eAAe;AAAA,IACrD,CAAC;AACD,QAAI,CAAC,OAAO,KAAK,QAAQ,KAAK;AAAG,aAAO;AACxC,WAAO,KAAK,UAAU,SAAS,QAAW,CAAC;AAAA,EAC/C;AAAA,EACA,eAAe;AACX,SAAK,MAAM,SACN,OAAO,QAAM,GAAG,WAAW,KAAK,KAAK,KAAK,MAAM,EAAE,CAAC,EACnD,IAAI,QAAM,KAAK,MAAM,EAAE,CAAC,EACxB,QAAQ,CAAC,QAAQ;AACd,UAAI,UAAU,0DAAY,CAAC,CAAC;AAAA,IAChC,CAAC;AAAA,EACT;AAAA,EACA,aAAa;AACT,SAAK,MAAM,SACN,OAAO,QAAM,GAAG,WAAW,KAAK,KAAK,KAAK,MAAM,EAAE,CAAC,EACnD,IAAI,QAAM,KAAK,MAAM,EAAE,CAAC,EACxB,QAAQ,CAAC,QAAQ;AACd,UAAI,UAAU,CAAC,0DAAY,CAAC,CAAC;AAAA,IACjC,CAAC;AAAA,EACT;AAAA,EACA,MAAM,eAAe,WAA+B;AAChD,UAAM,QAAgC,CAAC;AACvC,UAAM,SAA6B,EAAE,OAAO,CAAC,GAAG,OAAO,CAAC,EAAE;AAC1D,QAAI,CAAC,aAAa,CAAC,UAAU;AAAO,aAAO;AAC3C,UAAM,QAAwB,CAAC;AAC/B,UAAM,YAA4B,CAAC;AAwDnC,QAAI,MAAM,QAAQ,UAAU,KAAK,KAAK,MAAM,QAAQ,UAAU,KAAK;AAC/D,aAAO;AACX,SAAK,SAAS,MAAM,qBAAqB;AACzC,eAAW,SAAS,UAAU,OAAO;AACjC,YAAM,MAAM,UAAU,MAAM,KAAK;AACjC,UAAI,KAAK,MAAM,IAAI,EAAE,GAAG;AACpB,cAAM,IAAI,EAAE,IAAI,SAAS,EAAE,KAAK,MAAM;AACtC,YAAI,KAAK,MAAM,IAAI,EAAE;AAAA,MACzB,OAAO;AACH,cAAM,IAAI,EAAE,IAAI,IAAI;AACpB,cAAM,QAAQ,SAAS,IAAI,GAAG,MAAM,KAAK,EAAE,CAAC,CAAC;AAC7C,YAAI,QAAQ,KAAK,MAAM;AAAe,eAAK,MAAM,gBAAgB;AAAA,MACrE;AACA,UAAI,OAAO,CAAC,IAAI,KAAK,CAAC,IAAI,IAAI,IAAI,KAAK,CAAC,IAAI,IAAI,IAAI,KAAK,CAAC,GAAG,IAAI,KAAK,CAAC,CAAC;AACxE,YAAM,KAAK,KAAK,SAAS,UAAU,GAAG,CAAC;AAAA,IAC3C;AACA,UAAM,gBAAgB,MAAM,QAAQ,IAAI,KAAK,GAAG,OAAO,SAAO,CAAC,CAAC,GAAG;AACnE,iBAAa,QAAQ,CAAC,QAAQ;AAC1B,aAAO,MAAM,IAAI,EAAE,IAAI,IAAI,eAAe;AAC1C,gBAAU,KAAK,IAAI,SAAS,CAAC;AAAA,IACjC,CAAC;AACD,UAAM,QAAQ,IAAI,SAAS;AAC3B,eAAW,UAAU,UAAU,OAAO;AAClC,YAAM,OAAO,UAAU,MAAM,MAAM;AACnC,WAAK,KAAK,UAAU,EAAE,KAAK,MAAM;AACjC,WAAK,IAAI,CAAC,IAAI,MAAM,KAAK,IAAI,CAAC,CAAC;AAC/B,WAAK,IAAI,CAAC,IAAI,MAAM,KAAK,IAAI,CAAC,CAAC;AAC/B,YAAM,cAAc,KAAK,SAAS,WAAW,IAAI;AACjD,UAAI;AAAa,eAAO,MAAM,YAAY,EAAE,IAAI,YAAY,eAAe;AAAA,IAC/E;AACA,SAAK,SAAS,MAAM,qBAAqB;AACzC,QAAI,OAAO,KAAK,OAAO,KAAK,EAAE,QAAQ;AAClC,UAAI,KAAK,MAAM,iBAAiB;AAC5B,aAAK,YAAY;AACjB,aAAK,OAAO,GAAG,OAAO,KAAK,OAAO,KAAK,CAAC;AAAA,MAC5C;AACA,WAAK,KAAK,UAAU,MAAM;AAC1B,WAAK,SAAS,iBAAiB;AAAA,IACnC;AACA,WAAO;AAAA,EACX;AAAA,EACA,MAAM,OAAO,SAA6B;AACtC,UAAM,QAAwB,CAAC;AAC/B,UAAM,YAA4B,CAAC;AACnC,UAAM,UAA8B,EAAE,OAAO,CAAC,GAAG,OAAO,CAAC,EAAE;AAC3D,eAAW,SAAS,QAAQ,OAAO;AAC/B,YAAM,QAAQ,QAAQ,MAAM,KAAK;AACjC,YAAM,MAAM,IAAI,4CAAG,CAAC,KAAK,UAAU,KAAK;AACxC,WAAK,MAAM,IAAI,EAAE,IAAI;AACrB,cAAQ,MAAM,IAAI,EAAE,IAAI,IAAI,eAAe;AAC3C,YAAM,KAAK,IAAI,KAAK,CAAC;AACrB,gBAAU,KAAK,IAAI,SAAS,CAAC;AAAA,IACjC;AACA,UAAM,QAAQ,IAAI,KAAK;AACvB,UAAM,QAAQ,IAAI,SAAS;AAC3B,eAAW,UAAU,QAAQ,OAAO;AAChC,YAAM,SAAS,QAAQ,MAAM,MAAM;AACnC,UAAI,CAAC,KAAK,SAAS,cAAc,MAAM;AAAG;AAC1C,YAAM,OAAO,IAAI,6CAAI,CAAC,KAAK,UAAU,MAAM;AAC3C,WAAK,MAAM,KAAK,EAAE,IAAI;AACtB,cAAQ,MAAM,KAAK,EAAE,IAAI,KAAK,eAAe;AAC7C,WAAK,OAAO;AAAA,IAChB;AACA,QAAI,KAAK,MAAM,iBAAiB;AAC5B,WAAK,YAAY;AACjB,WAAK,OAAO,GAAG,OAAO,KAAK,QAAQ,KAAK,CAAC;AAAA,IAC7C;AACA,SAAK,KAAK,UAAU,OAAO;AAC3B,SAAK,SAAS,iBAAiB;AAAA,EACnC;AAAA,EACA,MAAM,iBAAiB;AACnB,UAAM,SAAS,oBAAI,IAAS;AAC5B,UAAM,UAAU,oBAAI,IAAU;AAC9B,SAAK,MAAM,SAAS,OAAO,QAAM,GAAG,WAAW,MAAM,CAAC,EAAE,QAAQ,QAAM,QAAQ,IAAI,KAAK,MAAM,EAAE,CAAC,CAAC;AACjG,SAAK,MAAM,SAAS,OAAO,QAAM,GAAG,WAAW,KAAK,CAAC,EAAE,QAAQ,CAAC,OAAO;AACnE,aAAO,IAAI,KAAK,MAAM,EAAE,CAAC;AACzB,WAAK,MAAM,EAAE,EAAE,SAAS,QAAQ,UAAQ,QAAQ,IAAI,IAAI,CAAC;AAAA,IAC7D,CAAC;AACD,QAAI,CAAC,OAAO,QAAQ,CAAC,QAAQ;AAAM,aAAO;AAC1C,SAAK,MAAM,WAAW,CAAC;AACvB,UAAM,UAA8B,EAAE,OAAO,CAAC,GAAG,OAAO,CAAC,EAAE;AAC3D,UAAM,WAA2B,CAAC;AAClC,YAAQ,QAAQ,CAAC,SAAS;AACtB,cAAQ,MAAM,KAAK,EAAE,IAAI,KAAK,eAAe;AAC7C,WAAK,QAAQ;AAAA,IACjB,CAAC;AACD,WAAO,QAAQ,CAAC,QAAQ;AACpB,cAAQ,MAAM,IAAI,EAAE,IAAI,IAAI,eAAe;AAC3C,eAAS,KAAK,IAAI,QAAQ,CAAC;AAAA,IAC/B,CAAC;AACD,UAAM,QAAQ,IAAI,QAAQ;AAC1B,SAAK,KAAK,YAAY,KAAK,MAAM,SAAS,MAAM,CAAC;AACjD,SAAK,KAAK,UAAU,OAAO;AAC3B,SAAK,SAAS,iBAAiB;AAC/B,WAAO;AAAA,EACX;AAAA,EACA,MAAM,OAAO,SAA6B;AACtC,UAAM,UAA8B,EAAE,OAAO,CAAC,GAAG,OAAO,CAAC,EAAE;AAE3D,YAAQ,IAAI,oBAAoB,SAAS;AACzC,YAAQ,IAAI,KAAK,QAAQ;AACzB,YAAQ,IAAI,OAAO,KAAK,KAAK,KAAK,CAAC;AAEnC,eAAW,MAAM,QAAQ,OAAO;AAC5B,cAAQ,IAAI,OAAO,IAAI;AACvB,cAAQ,MAAM,EAAE,IAAI,KAAK,MAAM,EAAE,EAAE,QAAQ,EAAE,eAAe;AAAA,IAChE;AACA,UAAM,WAA2B,CAAC;AAClC,eAAW,MAAM,QAAQ,OAAO;AAC5B,cAAQ,MAAM,EAAE,IAAI,KAAK,MAAM,EAAE,EAAE,eAAe;AAClD,eAAS,KAAK,KAAK,MAAM,EAAE,EAAE,QAAQ,CAAC;AAAA,IAC1C;AACA,UAAM,QAAQ,IAAI,QAAQ;AAC1B,SAAK,KAAK,YAAY,KAAK,MAAM,SAAS,MAAM,CAAC;AACjD,SAAK,KAAK,UAAU,OAAO;AAC3B,SAAK,SAAS,iBAAiB;AAAA,EACnC;AAAA,EACA,MAAM,MAAM;AACR,QAAI,KAAK,MAAM;AAAQ;AACvB,UAAM,KAAK,KAAK;AAChB,SAAK,eAAe;AAAA,EACxB;AAAA,EACA,MAAM,OAAO;AACT,QAAI,KAAK,MAAM;AAAQ;AACvB,UAAM,IAAI,KAAK,iBAAiB;AAChC,QAAI,CAAC;AAAG;AACR,UAAM,UAAU,UAAU,UAAU,CAAC;AAAA,EACzC;AAAA,EACA,MAAM,QAAQ;AACV,QAAI,KAAK,MAAM;AAAQ;AACvB,UAAM,IAAI,MAAM,UAAU,UAAU,SAAS;AAC7C,QAAI,CAAC;AAAG;AACR,QAAI;AACJ,QAAI;AACA,eAAS,KAAK,MAAM,CAAC;AAAA,IACzB,SAAS,GAAP;AAAA,IAAY;AACd,UAAM,KAAK,eAAe,MAAM;AAAA,EACpC;AAAA,EACA,MAAM,YAAY;AACd,QAAI,KAAK,MAAM;AAAQ;AACvB,UAAM,IAAI,KAAK,iBAAiB;AAChC,QAAI,CAAC;AAAG;AACR,QAAI;AACJ,QAAI;AACA,eAAS,KAAK,MAAM,CAAC;AAAA,IACzB,SAAS,GAAP;AAAA,IAAY;AACd,UAAM,KAAK,eAAe,MAAM;AAAA,EACpC;AAAA,EACA,MAAM,YAAY;AACd,SAAK,eAAe;AAAA,EACxB;AAAA,EACA,aAAa,eAAyB,gBAA0B;AAC5D,QAAI,CAAC,MAAM,KAAK,OAAO,MAAM,IAAI;AACjC,QAAI,OAAO;AAAO,OAAC,MAAM,KAAK,IAAI,CAAC,OAAO,IAAI;AAC9C,QAAI,MAAM;AAAQ,OAAC,KAAK,MAAM,IAAI,CAAC,QAAQ,GAAG;AAC9C,UAAM,EAAE,aAAa,IAAI,KAAK;AAC9B,UAAM,UAAU,eAAe,qBAAqB;AACpD,UAAM,SAAS,eAAe,MAAM;AACpC,eAAW,SAAS,KAAK,OAAO;AAC5B,YAAM,MAAM,KAAK,MAAM,KAAK;AAC5B,UAAI,gBAAgB,CAAC,IAAI;AAAc;AACvC,YAAM,OAAO,IAAI,OAAO;AACxB,UAAI,CAAC,qDAAO,CAAC,IAAI;AAAG;AACpB,YAAM,CAAC,SAAS,QAAQ,UAAU,SAAS,IAAI;AAC/C,YAAM,CAAC,UAAU,SAAS,IAAI,CAAC,UAAU,UAAU,SAAS,SAAS;AACrE,UAAI,UAAU,SAAS,SAAS,UAAU,WAAW,QAAQ,YAAY,KAAK;AAC1E,cAAM,IAAI,OAAO,QAAQ,KAAK;AAC9B,YAAI,MAAM;AAAI,iBAAO,KAAK,KAAK;AAAA;AAC1B,iBAAO,OAAO,GAAG,CAAC;AAAA,MAC3B;AAAA,IACJ;AACA,UAAM,WAAW,KAAK,MAAM,SAAS,OAAO,QAAM,OAAO,QAAQ,EAAE,MAAM,EAAE;AAC3E,SAAK,OAAO,GAAG,MAAM;AACrB,SAAK,SAAS,GAAG,QAAQ;AAAA,EAC7B;AAAA,EACA,gBAAgB,YAAsC,UAAmB;AACrE,UAAM,EAAE,cAAc,YAAY,SAAS,IAAI,KAAK;AACpD,UAAM,UAAU,eAAe,qBAAqB;AACpD,UAAM,QAAQ,mBAAK;AACnB,QAAI,UAAU;AACV,YAAM,OAAO,KAAK,MAAM,QAAQ,EAAE,OAAO;AACzC,UAAI,CAAC,2DAAa,CAAC,IAAI;AAAG,eAAO,EAAE,GAAG,GAAG,GAAG,EAAE;AAC9C,YAAM,IAAI,aAAa,KAAK,OAAO,KAAK,CAAC,IAAI,WAAW,KAAK,KAAK,MAAM,KAAK,CAAC,CAAC,IAAI,KAAK,MAAM,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,WAAW;AAC7H,YAAM,IAAI,aAAa,KAAK,OAAO,KAAK,CAAC,IAAI,WAAW,KAAK,KAAK,MAAM,KAAK,CAAC,CAAC,IAAI,KAAK,MAAM,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,WAAW;AAAA,IACjI;AACA,QAAI,CAAC,MAAM,KAAK,CAAC,MAAM;AAAG,aAAO;AACjC,SAAK,KAAK,UAAU,OAAO,YAAY;AACvC,WAAO,EAAE,GAAG,WAAW,IAAI,MAAM,GAAG,GAAG,WAAW,IAAI,MAAM,EAAE;AAAA,EAClE;AAAA,EACA,QAAQ,UAAoB,OAAiC;AACzD,UAAM,EAAE,aAAa,IAAI,KAAK;AAC9B,UAAM,UAAU,eAAe,qBAAqB;AACpD,QAAI,MAAM,SAAS,OAAO,QAAM,GAAG,WAAW,KAAK,KAAK,KAAK,MAAM,EAAE,CAAC;AACtE,QAAI;AAAc,YAAM,IAAI,OAAO,QAAM,2DAAa,CAAC,KAAK,MAAM,EAAE,EAAE,OAAO,CAAC,CAAC;AAC/E,UAAM,QAAQ,IAAI,IAAI,QAAM,KAAK,MAAM,EAAE,CAAC;AAC1C,UAAM,QAAQ,SAAO,IAAI,KAAK,eAAe,4BAA4B,eAAe,GAAG,CAAC;AAC5F,SAAK,KAAK,SAAS,EAAE,OAAO,UAAU,KAAK,cAAc,KAAK,MAAM,aAAa,CAAC;AAAA,EACtF;AAAA,EACA,KAAK,UAAoB,OAAiC,cAAuB;AAC7E,QAAI,KAAK,MAAM;AAAiB,WAAK,OAAO,GAAG,QAAQ;AACvD,UAAM,UAAU,eAAe,qBAAqB;AACpD,QAAI,MAAM,SAAS,OAAO,QAAM,GAAG,WAAW,KAAK,KAAK,KAAK,MAAM,EAAE,CAAC;AACtE,QAAI;AAAc,YAAM,IAAI,OAAO,QAAM,2DAAa,CAAC,KAAK,MAAM,EAAE,EAAE,OAAO,CAAC,CAAC;AAC/E,UAAM,QAAQ,IAAI,IAAI,QAAM,KAAK,MAAM,EAAE,CAAC;AAC1C,QAAI,MAAM,WAAW;AAAG;AACxB,QAAI,CAAC,MAAM,GAAG,IAAI,MAAM,CAAC,EAAE,OAAO;AAClC,aAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACnC,YAAM,MAAM,MAAM,CAAC;AACnB,YAAM,CAAC,OAAO,IAAI,IAAI,IAAI,OAAO;AACjC,UAAI,QAAQ;AAAM,eAAO;AACzB,UAAI,OAAO;AAAK,cAAM;AAAA,IAC1B;AAEA,UAAM,IAAI,KAAK,IAAI,MAAM,GAAG,CAAC,IAAI;AACjC,UAAM,IAAI,KAAK,IAAI,MAAM,GAAG,CAAC,GAAG;AAChC,QAAI,MAAM;AAAG,YAAM,QAAQ,SAAQ,IAAI,OAAO,EAAY,CAAC,KAAK,MAAM,CAAC;AACvE,QAAI,MAAM;AAAG,YAAM,QAAQ,SAAQ,IAAI,OAAO,EAAY,CAAC,KAAK,MAAM,CAAC;AAEvE,QAAI,CAAC,MAAM,KAAK,CAAC,MAAM;AAAG;AAC1B,QAAI,iBAAiB,KAAK,MAAM;AAAc;AAE9C,SAAK,KAAK,UAAU,EAAE,UAAU,KAAK,OAAO,aAAa,CAAC;AAC1D,QAAI;AAAc;AAClB,UAAM,UAAU,oBAAI,IAAU;AAC9B,UAAM,QAAQ,CAAC,QAAQ;AACnB,UAAI,QAAQ,QAAQ,SAAO,IAAI,QAAQ,UAAQ,QAAQ,IAAI,IAAI,CAAC,CAAC;AAAA,IACrE,CAAC;AACD,YAAQ,QAAQ,UAAQ,KAAK,KAAK,cAAc,IAAI,CAAC;AAAA,EACzD;AAAA,EACA,kBAAkB,OAAe,YAAsC,MAA0B;AAC7F,UAAM,EAAE,cAAc,YAAY,SAAS,IAAI,KAAK;AACpD,UAAM,UAAU,eAAe,qBAAqB;AACpD,UAAM,OAAO,KAAK,MAAM,KAAK,EAAE,OAAO;AACtC,QAAI,CAAC,6DAAe,CAAC,IAAI;AAAG,aAAO,EAAE,GAAG,GAAG,GAAG,EAAE;AAChD,UAAM,QAAQ,EAAE,GAAG,GAAG,GAAG,EAAE;AAE3B,QAAI,SAAS,OAAO,SAAS,QAAQ,SAAS,MAAM;AAChD,YAAM,IAAI,aAAa,KAAK,OAAO,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,WAAW,KAAK,KAAK,MAAM,KAAK,CAAC,CAAC,IAAI,KAAK,MAAM,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,WAAW;AAAA,IACrJ;AACA,QAAI,SAAS,OAAO,SAAS,QAAQ,SAAS,MAAM;AAChD,YAAM,IAAI,aAAa,KAAK,OAAO,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,WAAW,KAAK,KAAK,MAAM,KAAK,CAAC,CAAC,IAAI,KAAK,MAAM,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,WAAW;AAAA,IACrJ;AACA,QAAI,SAAS,OAAO,SAAS,QAAQ,SAAS,MAAM;AAChD,YAAM,IAAI,aAAa,KAAK,OAAO,KAAK,CAAC,IAAI,WAAW,KAAK,KAAK,MAAM,KAAK,CAAC,CAAC,IAAI,KAAK,MAAM,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,WAAW;AAAA,IACjI;AACA,QAAI,SAAS,OAAO,SAAS,QAAQ,SAAS,MAAM;AAChD,YAAM,IAAI,aAAa,KAAK,OAAO,KAAK,CAAC,IAAI,WAAW,KAAK,KAAK,MAAM,KAAK,CAAC,CAAC,IAAI,KAAK,MAAM,KAAK,CAAC,IAAI,KAAK,CAAC,IAAI,WAAW;AAAA,IACjI;AACA,QAAI,CAAC,MAAM,KAAK,CAAC,MAAM;AAAG,aAAO;AACjC,SAAK,OAAO,UAAU,OAAO,MAAM,YAAY;AAC/C,WAAO,EAAE,GAAG,WAAW,IAAI,MAAM,GAAG,GAAG,WAAW,IAAI,MAAM,EAAE;AAAA,EAClE;AAAA,EACA,UAAU,UAAoB,OAAiC,MAA0B;AACrF,UAAM,EAAE,aAAa,IAAI,KAAK;AAC9B,SAAK,KAAK,WAAW,EAAE,OAAO,MAAM,UAAU,aAAa,CAAC;AAAA,EAChE;AAAA,EACA,OAAO,UAAoB,OAAiC,MAA0B,cAAuB;AACzG,QAAI,KAAK,MAAM;AAAiB,WAAK,OAAO,GAAG,QAAQ;AACvD,UAAM,UAAU,eAAe,qBAAqB;AACpD,QAAI,MAAM,SAAS,OAAO,QAAM,GAAG,WAAW,KAAK,KAAK,KAAK,MAAM,EAAE,CAAC;AACtE,QAAI;AAAc,YAAM,IAAI,OAAO,QAAM,6DAAe,CAAC,KAAK,MAAM,EAAE,EAAE,OAAO,CAAC,CAAC;AACjF,UAAM,QAAQ,IAAI,IAAI,QAAM,KAAK,MAAM,EAAE,CAAC;AAC1C,QAAI,MAAM,WAAW;AAAG;AACxB,QAAI,CAAC,MAAM,KAAK,OAAO,MAAM,IAAI,MAAM,CAAC,EAAE,OAAO;AACjD,aAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACnC,YAAM,MAAM,MAAM,CAAC;AACnB,YAAM,CAAC,OAAO,MAAM,QAAQ,OAAO,IAAI,IAAI,OAAO;AAClD,UAAI,QAAQ;AAAM,eAAO;AACzB,UAAI,OAAO;AAAK,cAAM;AACtB,UAAI,SAAS;AAAO,gBAAQ;AAC5B,UAAI,UAAU;AAAQ,iBAAS;AAAA,IACnC;AAEA,QAAI,SAAS,QAAQ,SAAS,OAAO,SAAS;AAAM,YAAM,IAAI,KAAK,IAAI,MAAM,GAAG,CAAC,IAAI;AACrF,QAAI,SAAS,QAAQ,SAAS,OAAO,SAAS;AAAM,YAAM,IAAI,KAAK,IAAI,MAAM,GAAG,CAAC,GAAG;AAEpF,QAAI,SAAS,QAAQ,SAAS,OAAO,SAAS;AAAM,YAAM,IAAI,KAAK,IAAI,MAAM,GAAG,KAAK,KAAK;AAC1F,QAAI,SAAS,QAAQ,SAAS,OAAO,SAAS;AAAM,YAAM,IAAI,KAAK,IAAI,MAAM,GAAG,QAAQ,EAAE;AAC1F,QAAI,SAAS,QAAQ,SAAS,OAAO,SAAS;AAAM,YAAM,IAAI,KAAK,IAAI,MAAM,GAAG,KAAK,MAAM;AAC3F,QAAI,SAAS,QAAQ,SAAS,OAAO,SAAS;AAAM,YAAM,IAAI,KAAK,IAAI,MAAM,GAAG,SAAS,EAAE;AAC3F,UAAM,QAAQ,CAAC,QAAQ;AA3mB/B;AA4mBY,YAAM,UAAU,IAAI,OAAK,SAAI,OAAJ,mBAAQ,YAAW,kBAAgB,SAAI,OAAJ,mBAAQ,YAAW,SAAS;AACxF,YAAM,UAAU,IAAI,OAAK,SAAI,OAAJ,mBAAQ,YAAW,gBAAc,SAAI,OAAJ,mBAAQ,YAAW,SAAS;AACtF,UAAI,MAAM,KAAK,SAAS;AACpB,YAAI,SAAS,QAAQ,SAAS,OAAO,SAAS;AAAM,UAAC,IAAI,OAAO,EAAY,CAAC,KAAK,MAAM;AACxF,YAAI,SAAS,QAAQ,SAAS,OAAO,SAAS,MAAM;AAChD,UAAC,IAAI,OAAO,EAAY,CAAC,KAAK,MAAM;AACpC,UAAC,IAAI,OAAO,EAAY,CAAC,KAAK,MAAM;AAAA,QACxC;AAAA,MACJ;AACA,UAAI,MAAM,KAAK,SAAS;AACpB,YAAI,SAAS,QAAQ,SAAS,OAAO,SAAS;AAAM,UAAC,IAAI,OAAO,EAAY,CAAC,KAAK,MAAM;AACxF,YAAI,SAAS,QAAQ,SAAS,OAAO,SAAS,MAAM;AAChD,UAAC,IAAI,OAAO,EAAY,CAAC,KAAK,MAAM;AACpC,UAAC,IAAI,OAAO,EAAY,CAAC,KAAK,MAAM;AAAA,QACxC;AAAA,MACJ;AAAA,IACJ,CAAC;AAED,QAAI,CAAC,MAAM,KAAK,CAAC,MAAM;AAAG;AAC1B,QAAI,iBAAiB,KAAK,MAAM;AAAc;AAC9C,UAAM,QAAQ,SAAO,IAAI,KAAK,eAAe,4BAA4B,eAAe,GAAG,CAAC;AAC5F,QAAI;AAAc;AAClB,UAAM,UAAU,oBAAI,IAAU;AAC9B,UAAM,QAAQ,CAAC,QAAQ;AACnB,UAAI,QAAQ,QAAQ,SAAO,IAAI,QAAQ,UAAQ,QAAQ,IAAI,IAAI,CAAC,CAAC;AAAA,IACrE,CAAC;AACD,YAAQ,QAAQ,UAAQ,KAAK,KAAK,cAAc,IAAI,CAAC;AAAA,EACzD;AAAA,EACA,gBAAgB,MAAc,KAAa,MAAwB,IAAuB;AACtF,QAAI,UAA4B,CAAC,MAAM,IAAI;AAC3C,QAAI,cAAc;AAElB,QAAI,MAAM,KAAK,mBAAmB,KAAK,CAAC,GAAG,KAAK,CAAC,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG;AAC/D,YAAM,aAAa,KAAK,MAAM,GAAG,CAAC,CAAC,EAAE,SAAS,GAAG,CAAC,CAAC;AACnD,YAAM,oBAAoB,WAAW,OAAO,SAAS,KAAK,WAAW,MAAM,QAAQ,MAAM;AACzF,UAAI,kBAAkB,KAAK;AACvB,kBAAU;AACV,sBAAc;AAAA,MAClB;AAAA,IACJ;AAEA,eAAW,MAAM,KAAK,OAAO;AACzB,YAAM,MAAM,KAAK,MAAM,EAAE;AACzB,UAAI,YAAY,IAAI,CAAC,KAAK,OAAO,EAAE,KAAK,GAAG,YAAY,KAAK,mBAAmB,KAAK,CAAC,GAAG,KAAK,CAAC,GAAG,IAAI,CAAC,EAAE,EAAE,EACrG,OAAO,CAAC,EAAE,WAAW,MAAM,UAAU,EACrC,QAAQ,CAAC,EAAE,KAAK,EAAE,MAAM;AACrB,cAAM,aAAa,IAAI,OAAO,SAAS,KAAK,IAAI,MAAM,QAAQ,MAAM;AACpE,YAAI,WAAW,aAAa;AACxB,gBAAM,gBAA+B,EAAE,KAAK,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;AAC/D,gBAAM,YAAY,KAAK,SAAS,cAAc,aAAa;AAC3D,cAAI,CAAC;AAAW;AAChB,oBAAU,CAAC,IAAI,CAAC;AAChB,wBAAc;AAAA,QAClB;AAAA,MACJ,CAAC;AAAA,IACT;AACA,WAAO;AAAA,EACX;AAAA,EACA,aAAa,OAAe,IAAY;AACpC,UAAM,MAAM,KAAK,MAAM,KAAK;AAC5B,QAAI,CAAC,OAAO,KAAK,IAAI,IAAI,QAAQ;AAC7B,aAAO,CAAC;AAAA,IACZ;AAEA,UAAM,QAAQ,CAAC;AAEf,QAAI,IAAI,KAAK,WAAW,KAAK,GAAG;AAC5B,eAAS,OAAO,KAAK,OAAO;AACxB,YAAI,OAAO,KAAK,MAAM,GAAG;AACzB,YAAI,KAAK,QAAQ,SAAS,KAAK,QAAQ,OAAO;AAC1C,gBAAM,KAAK,IAAI;AAAA,QACnB;AAAA,MACJ;AAAA,IACJ,OAAO;AACH,eAAS,OAAO,KAAK,OAAO;AACxB,YAAI,OAAO,KAAK,MAAM,GAAG;AACzB,YAAK,KAAK,QAAQ,SAAS,KAAK,IAAI,CAAC,MAAM,MAAQ,KAAK,QAAQ,SAAS,KAAK,IAAI,CAAC,MAAM,IAAK;AAC1F,gBAAM,KAAK,IAAI;AAAA,QACnB;AAAA,MACJ;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AAAA,EACA,iBAAiB,OAAe,IAAY;AACxC,QAAI,QAAQ,KAAK,aAAa,OAAO,EAAE;AAEvC,QAAI,YAAY,MAAM,QAAQ,UAAQ,CAAC,KAAK,KAAK,KAAK,GAAG,CAAC;AAC1D,QAAI,eAAe,MAAM,KAAK,oBAAI,IAAI,CAAC,GAAG,WAAW,CAAC,OAAO,EAAE,CAAqB,CAAC,CAAC;AAEtF,WAAO,aAAa,IAAI,CAAC,CAAC,IAAIA,GAAE,MAAM,KAAK,MAAM,EAAE,EAAE,KAAK,IAAIA,GAAE,EAAE,GAAG;AAAA,EACzE;AAAA,EACA,mBAAmB,MAAc,KAAa,MAAc,KAAa;AAErE,QAAI,SAAS,MAAM;AACf,aAAO;AAAA,IACX;AAEA,QAAI,QAAQ,KAAK,iBAAiB,MAAM,GAAG;AAC3C,QAAI,QAAQ,KAAK,iBAAiB,MAAM,GAAG;AAE3C,WAAO,8DAAc,CAAC,CAAC,GAAG,OAAO,GAAG,KAAK,CAAC;AAAA,EAC9C;AAAA;AAAA,EAEA,qBAAqB,SAAkB,YAAsC,MAAwB,IAAuB;AACxH,UAAM,UAAU,KAAK,KAAK,MAAM,GAAG,CAAC,CAAC,EAAE,SAAS,GAAG,CAAC,CAAC,IAAI,KAAK,MAAM,KAAK,CAAC,CAAC,EAAE,SAAS,KAAK,CAAC,CAAC;AAC7F,UAAM,OAAO,QAAQ,OAAO,WAAW;AACvC,UAAM,MAAM,QAAQ,MAAM,WAAW;AACrC,UAAM,CAAC,OAAO,SAAS,IAAI,KAAK,gBAAgB,MAAM,KAAK,MAAM,EAAE;AAEnE,QAAI;AAAO,WAAK,cAAc,OAAO,SAAS,SAAS;AAAA;AAClD,WAAK,gBAAgB;AAC1B,WAAO,CAAC,OAAO,SAAS;AAAA,EAC5B;AAAA,EACA,aAAa,OAAe;AACxB,SAAK,KAAK,gBAAgB,KAAK;AAAA,EACnC;AAAA,EACA,cAAc,OAAe,OAAgB,WAAmB;AAC5D,SAAK,KAAK,iBAAiB,EAAE,OAAO,OAAO,GAAG,UAAU,CAAC;AAAA,EAC7D;AAAA,EACA,kBAAkB;AACd,SAAK,KAAK,iBAAiB,IAAI;AAAA,EACnC;AAAA,EACA,YAAY,OAAe,WAAmB,KAAc;AACxD,SAAK,KAAK,eAAe,EAAE,OAAO,GAAG,WAAW,IAAI,CAAC;AAAA,EACzD;AAAA,EACA,gBAAgB;AACZ,SAAK,KAAK,eAAe,IAAI;AAAA,EACjC;AAAA,EACA,SAAS,SAAkB,MAAwB;AAC/C,SAAK,KAAK,YAAY,EAAE,SAAS,KAAK,CAAC;AACvC,SAAK,YAAY,KAAK,CAAC,GAAG,KAAK,CAAC,GAAG,KAAK,MAAM,KAAK,CAAC,CAAC,EAAE,KAAK,IAAI,KAAK,CAAC,CAAC,EAAE,GAAG;AAC5E,WAAO;AAAA,EACX;AAAA,EACA,UAAU,KAAW;AACjB,QAAI;AAAK,WAAK,KAAK,WAAW;AAAA,aACrB,KAAK,MAAM,SAAS,QAAQ;AACjC,YAAM,QAAQ,KAAK,MAAM,SAAS,KAAK,QAAM,GAAG,WAAW,KAAK,CAAC;AACjE,UAAI,SAAS,KAAK,MAAM,KAAK;AAAG,aAAK,KAAK,WAAW;AAAA,IACzD;AAAA,EACJ;AAAA,EACA,UAAU,KAAW;AACjB,QAAI;AAAK,WAAK,KAAK,WAAW;AAAA,aACrB,KAAK,MAAM,SAAS,QAAQ;AACjC,YAAM,QAAQ,KAAK,MAAM,SAAS,KAAK,QAAM,GAAG,WAAW,KAAK,CAAC;AACjE,UAAI,SAAS,KAAK,MAAM,KAAK;AAAG,aAAK,KAAK,WAAW;AAAA,IACzD;AAAA,EACJ;AAAA,EACA,KAAK,KAAW;AACZ,QAAI,KAAK;AACL,WAAK,KAAK,MAAM;AAAA,IACpB,WAAW,KAAK,MAAM,SAAS,QAAQ;AACnC,YAAM,QAAQ,KAAK,MAAM,SAAS,KAAK,QAAM,GAAG,WAAW,KAAK,CAAC;AACjE,UAAI,SAAS,KAAK,MAAM,KAAK,GAAG;AAC5B,aAAK,KAAK,MAAM;AAAA,MACpB;AAAA,IACJ;AAAA,EACJ;AAAA,EACA,OAAO,KAAW;AACd,QAAI,OAAO,IAAI,GAAG;AAAU,WAAK,KAAK,UAAU,IAAI,EAAE;AAAA,aAC7C,KAAK,MAAM,SAAS,QAAQ;AACjC,YAAM,QAAQ,KAAK,MAAM,SAAS,KAAK,QAAM,GAAG,WAAW,KAAK,CAAC;AACjE,UAAI,SAAS,KAAK,MAAM,KAAK,KAAK,KAAK,MAAM,KAAK,EAAE,GAAG;AAAU,aAAK,KAAK,UAAU,KAAK;AAAA,IAC9F;AAAA,EACJ;AAAA,EACA,cAAc;AAAA,EAAE;AAAA,EAChB,MAAM,aAAa;AACf,WAAO,KAAK,SAAS,eAAe;AAAA,EACxC;AACJ;;;;;;;;;;;;;;;;;ACnxB8D;AAa/C,MAAM,qBAAqB,gEAAiB,CAAuB;AAAA,EAU9E,YAAY,WAAoB,QAAuB;AACnD,UAAM;AAJV,oBAAW;AAqJX,sBAAa,MAAM;AACf,YAAM,OAAO,KAAK,SAAS;AAC3B,UAAI,SAAS,KAAK,OAAO;AACrB,aAAK,QAAQ;AACb,aAAK,KAAK,eAAe,IAAI;AAAA,MACjC;AAAA,IACJ;AAtJI,SAAK,KAAK,OAAO;AACjB,SAAK,MAAM,OAAO;AAClB,SAAK,MAAM,OAAO;AAClB,SAAK,WAAW;AAChB,SAAK,WAAW;AAChB,UAAM,EAAE,MAAM,KAAK,IAAI;AACvB,SAAK,QAAQ,KAAK,SAAS;AAC3B,QAAI,MAAM;AACN,WAAK,GAAG,eAAe,KAAK,UAAU;AACtC,WAAK,UAAU,MAAM,IAAI;AAAA,IAC7B;AACA,QAAI,MAAM;AACN,WAAK,GAAG,eAAe,KAAK,UAAU;AACtC,WAAK,UAAU,MAAM,KAAK;AAAA,IAC9B;AAAA,EACJ;AAAA,EA1BA,OAAO,QAAQ,OAAqB,OAAqB;AACrD,WAAO,MAAM,eAAe,MAAM;AAAA,EACtC;AAAA,EAyBA,IAAI,eAAe;AACf,WAAO,KAAK,QAAQ,KAAK,KAAK,gBAAgB,KAAK,QAAQ,KAAK,KAAK;AAAA,EACzE;AAAA,EACA,KAAK,GAAqB;AACtB,UAAM,MAAM,EAAE,CAAC;AACf,UAAM,MAAM,EAAE,CAAC;AACf,QAAI,QAAQ,KAAK,IAAI,CAAC,KAAK,QAAQ,KAAK,IAAI,CAAC;AAAG,aAAO;AACvD,SAAK,KAAK,IAAI,eAAe,KAAK,UAAU;AAC5C,SAAK,QAAQ;AACb,SAAK,KAAK,aAAa,MAAM,IAAI;AACjC,SAAK,MAAM,CAAC,KAAK,GAAG;AACpB,SAAK,KAAK,UAAU,MAAM,IAAI;AAC9B,SAAK,OAAO;AACZ,SAAK,KAAK,GAAG,eAAe,KAAK,UAAU;AAC3C,SAAK,WAAW;AAChB,WAAO,KAAK,UAAU;AAAA,EAC1B;AAAA,EACA,OAAO;AACH,WAAO,KAAK;AAAA,EAChB;AAAA,EACA,YAAY;AACR,SAAK,KAAK,eAAe,KAAK,IAAI;AAClC,WAAO;AAAA,EACX;AAAA,EACA,KAAK,GAAqB;AACtB,UAAM,MAAM,EAAE,CAAC;AACf,UAAM,MAAM,EAAE,CAAC;AACf,QAAI,QAAQ,KAAK,IAAI,CAAC,KAAK,QAAQ,KAAK,IAAI,CAAC;AAAG,aAAO;AACvD,SAAK,KAAK,IAAI,eAAe,KAAK,UAAU;AAC5C,SAAK,QAAQ;AACb,SAAK,KAAK,aAAa,MAAM,KAAK;AAClC,SAAK,MAAM,CAAC,KAAK,GAAG;AACpB,SAAK,KAAK,aAAa,MAAM,KAAK;AAClC,SAAK,OAAO;AACZ,SAAK,KAAK,GAAG,eAAe,KAAK,UAAU;AAC3C,SAAK,WAAW;AAChB,WAAO,KAAK,UAAU;AAAA,EAC1B;AAAA,EACA,OAAO;AACH,WAAO,KAAK;AAAA,EAChB;AAAA,EACA,YAAY;AACR,SAAK,KAAK,eAAe,KAAK,IAAI;AAClC,WAAO;AAAA,EACX;AAAA,EACA,QAAQ,MAA8B;AAClC,QAAI,SAAS;AACT,aAAO,KAAK,OAAO;AACvB,QAAI,KAAK;AACL,aAAO;AACX,SAAK,WAAW;AAChB,UAAM,EAAE,MAAM,KAAK,IAAI;AACvB,QAAI,KAAK,SAAS,cAAc,KAAK,KAAK,KAAK,KAAK,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,CAAC,EAAE,SAAS;AACnF,aAAO;AACX,SAAK,eAAe,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,KAAK,EAAE;AAC9D,SAAK,eAAe,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,KAAK,EAAE;AAC9D,WAAO;AAAA,EACX;AAAA,EACA,OAAO,MAA8B;AACjC,QAAI,SAAS;AACT,aAAO,KAAK,QAAQ;AACxB,QAAI,CAAC,KAAK;AACN,aAAO;AACX,UAAM,EAAE,MAAM,KAAK,IAAI;AACvB,QAAI,KAAK,IAAI,CAAC,KAAK,KAAK,IAAI,UAAU,KAAK,IAAI,CAAC,KAAK,KAAK,IAAI;AAC1D,aAAO,KAAK,SAAS,WAAW,KAAK,EAAE;AAC3C,QAAI,KAAK,SAAS,cAAc,KAAK,KAAK,KAAK,KAAK,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,CAAC,EAAE,SAAS;AACnF,aAAO;AACX,SAAK,WAAW;AAChB,SAAK,YAAY,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,KAAK,EAAE;AAC3D,SAAK,YAAY,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,KAAK,EAAE;AAC3D,WAAO;AAAA,EACX;AAAA,EACA,UAAU;AACN,SAAK,KAAK,IAAI,eAAe,KAAK,UAAU;AAC5C,SAAK,KAAK,IAAI,eAAe,KAAK,UAAU;AAC5C,SAAK,QAAQ;AACb,SAAK,KAAK,aAAa,MAAM,IAAI;AACjC,SAAK,KAAK,aAAa,MAAM,KAAK;AAClC,WAAO,KAAK,SAAS,MAAM,KAAK,EAAE;AAClC,WAAO;AAAA,EACX;AAAA,EACA,KAAK,MAAW;AACZ,SAAK,KAAK,YAAY,IAAI;AAC1B,WAAO,KAAK,WAAW,OAAO,KAAK,KAAK,GAAG,KAAK,IAAI,CAAC,GAAG,IAAI;AAAA,EAChE;AAAA,EACA,IAAI,eAAe;AACf,UAAM,EAAE,KAAK,KAAK,IAAI,KAAK,SAAS,MAAM,KAAK,IAAI,CAAC,CAAC,EAAE,SAAS,KAAK,IAAI,CAAC,CAAC;AAC3E,WAAO,OAAO,QAAQ;AAAA,EAC1B;AAAA,EACA,IAAI,OAAO;AACP,WAAO,KAAK,SAAS,MAAM,KAAK,IAAI,CAAC,CAAC,EAAE,SAAS,KAAK,IAAI,CAAC,CAAC;AAAA,EAChE;AAAA,EACA,IAAI,OAAO;AACP,WAAO,KAAK,SAAS,MAAM,KAAK,IAAI,CAAC,CAAC,EAAE,SAAS,KAAK,IAAI,CAAC,CAAC;AAAA,EAChE;AAAA,EACA,IAAI,MAAM;AACN,WAAO,KAAK,IAAI,CAAC;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAIA,IAAI,MAAM;AACN,WAAO,KAAK,IAAI,CAAC;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAIA,IAAI,OAAO;AACP,WAAO,KAAK,SAAS,MAAM,KAAK,IAAI,CAAC,CAAC;AAAA,EAC1C;AAAA,EACA,IAAI,OAAO;AACP,WAAO,KAAK,SAAS,MAAM,KAAK,IAAI,CAAC,CAAC;AAAA,EAC1C;AAAA,EACQ,WAAW;AAYf,WAAO;AAAA,EACX;AAAA,EAQA,IAAI,OAA0B;AAC1B,WAAO,KAAK;AAAA,EAChB;AAAA,EACA,WAAW;AACP,WAAO,KAAK,UAAU,KAAK,eAAe,CAAC;AAAA,EAC/C;AAAA,EACA,iBAAgC;AAC5B,UAAM,EAAE,IAAI,KAAK,KAAK,SAAS,IAAI;AACnC,WAAO,EAAE,IAAI,KAAK,CAAC,GAAG,GAAG,GAAG,KAAK,CAAC,GAAG,GAAG,GAAG,SAAS;AAAA,EACxD;AACJ","sources":["webpack://DaisyBell/./src/core/hardware/Box.ts","webpack://DaisyBell/./src/core/hardware/Compatibility.ts","webpack://DaisyBell/./src/core/hardware/HardwareEditor.ts","webpack://DaisyBell/./src/core/hardware/Line.ts"],"sourcesContent":["import TypedEventEmitter from \"../../utils/TypedEventEmitter\";\nimport { isTRect, parseToPrimitive, isTPresentationRect, isRectMovable, isRectResizable } from \"../../utils/utils\";\nimport type Patcher from \"./Patcher\";\nimport HardwareLine from \"./Line\";\nimport type { TRect, TPresentationRect } from \"../types\";\nimport type { IoPosition, THardwareBox } from \"./types\";\nimport type { Args, Data, IHardwarePatcherObject, HardwarePatcherObjectEventMap, ObjectUpdateOptions, Props, State, IIosMeta } from \"./objects/base/AbstractHardwareObject\";\n\nexport interface BoxEventMap extends Pick<HardwarePatcherObjectEventMap<any, any, any, any, any, any, any, any, any>, \"metaUpdated\" | \"argsUpdated\" | \"propsUpdated\" | \"dataUpdated\" | \"stateUpdated\"> {\n    \"rectChanged\": HardwareBox;\n    \"presentationRectChanged\": HardwareBox;\n    \"backgroundChanged\": HardwareBox;\n    \"presentationChanged\": HardwareBox;\n    \"textChanged\": HardwareBox;\n    \"error\": string;\n    \"connectedPort\": { io: number; last?: false };\n    \"disconnectedPort\": { io: number; last?: boolean };\n    \"ioCountChanged\": HardwareBox;\n}\n\nexport default class HardwareBox<T extends IHardwarePatcherObject = IHardwarePatcherObject> extends TypedEventEmitter<BoxEventMap> {\n    readonly id: string;\n    text = \"\";\n    ios: IoPosition[];\n    rect: TRect;\n    background: boolean;\n    presentation: boolean;\n    presentationRect: TPresentationRect;\n    /** A timestamp to order boxes UI on z-axis, default = 0, negative = send to back, positive = bring to front */\n    zIndex: number;\n    data: Data<T>;\n    args: Args<T>;\n    props: Props<T>;\n    _editing: boolean;\n    static ios: IIosMeta;\n    private _parsed: { class: string; args: Args<T>; props: Props<T> };\n    private _object: T;\n    private _Object: typeof IHardwarePatcherObject;\n    private readonly _patcher: Patcher;\n    private readonly _ioLines: Set<HardwareLine>[];\n    constructor(patcherIn: Patcher, boxIn: THardwareBox) {\n        super();\n        this.id = boxIn.id;\n        this.text = boxIn.text;\n        this.args = (boxIn.args || []) as Args<T>;\n        this.props = (boxIn.props || {}) as Props<T>;\n        this.ios = boxIn.ios;\n        this._ioLines = new Array(this.ios).fill(null).map(() => new Set<HardwareLine>());\n        this.rect = boxIn.rect;\n        this.background = boxIn.background;\n        this.presentation = boxIn.presentation;\n        this.presentationRect = boxIn.presentationRect;\n        if (!this.presentationRect) this.presentationRect = this.rect.slice() as TRect;\n        this.zIndex = boxIn.zIndex || 0;\n        this.data = boxIn.data || (boxIn as any).prevData?.storage || {};\n        this._editing = !!boxIn._editing;\n        this._patcher = patcherIn;\n        this.on(\"dataUpdated\", () => this._patcher.emitChanged());\n        this.on(\"argsUpdated\", () => this._patcher.emitChanged());\n        this.on(\"propsUpdated\", () => this._patcher.emitChanged());\n    }\n    async init() {\n        this._parsed = HardwareBox.parseObjText(this.text) as { class: string; args: Args<T>; props: Props<T> };\n        const newMeta = this._patcher.getObjectMeta(this._parsed);\n        for (const key in this.props) {\n            if (!newMeta.props[key]) delete this.props[key];\n        }\n        if (this._parsed.args.length) this.args = this._parsed.args;\n        Object.assign(this.props, this._parsed.props);\n        const Constructor = this._patcher.getObjectConstructor(this._parsed);\n        if (Constructor === this._patcher.activeLib.InvalidObject) {\n            this.error(`Object ${this._parsed.class} not found.`);\n        }\n        this._Object = Constructor;\n        if (!this.size.every(v => v > 0)) this.size = this.defaultSize;\n        if (!isTPresentationRect(this.presentationRect) || (this.presentationSize.every(v => typeof v === \"number\") && !this.presentationSize.every(v => v > 0))) this.presentationSize = this.defaultSize;\n        if (this.objectInit) {\n            this._object = new Constructor(this, this._patcher) as T;\n            await this._object.init();\n        }\n        return this;\n    }\n    async postInit() {\n        await this._object?.postInit();\n        return this;\n    }\n    /**\n     * Main function when receive data from a inlet (base 0)\n     */\n    fn(inlet: number, data: any) {\n        this._object?.fn(inlet, data);\n        return this;\n    }\n    get UI() {\n        return this._Object.UI;\n    }\n    get defaultSize() {\n        return this.UI?.defaultSize || [90, 20];\n    }\n    get meta() {\n        return this._object?.meta;\n    }\n    get ioLines() {\n        return this._ioLines;\n    }\n    get objectInit() {\n        return this._patcher.props.objectInit;\n    }\n    get object() {\n        return this._object;\n    }\n    set object(oIn: T) {\n        this._object = oIn;\n    }\n    get Object() {\n        return this._Object;\n    }\n    get parsed() {\n        return this._parsed;\n    }\n    addIoLine(line: HardwareLine, isA: boolean) {\n        const index = isA ? line.aIo[1] : line.bIo[1];\n        if (!this._ioLines[index])\n            this._ioLines[index] = new Set<HardwareLine>();\n        this._ioLines[index].add(line);\n    }\n    removeIoLine(line: HardwareLine, isA: boolean) {\n        const index = isA ? line.aIo[1] : line.bIo[1];\n        if (this._ioLines[index])\n            this._ioLines[index].delete(line);\n    }\n\n    setIos(positions: IoPosition[]) {\n        const lines = this.allLines;\n        lines.forEach(line => line.disable());\n\n        this.ios = positions;\n        lines.forEach(line => line.enable());\n\n        const linesSetLen = this._ioLines.length;\n        if (positions.length > linesSetLen)\n            this._ioLines.push(...new Array(positions.length - linesSetLen).fill(null).map(() => new Set<HardwareLine>()));\n        else if (positions.length < linesSetLen)\n            this._ioLines.splice(positions.length);\n        this._ioLines.forEach(set => set.forEach(line => { line.uiUpdateA(); line.uiUpdateB(); }));\n        this.emit(\"ioCountChanged\", this);\n    }\n\n    getIoPos(port: number) {\n        const { rect, ios } = this;\n        const [left, top, width, height] = rect;\n\n        const [x1, y1, x2, y2] = {\n            \"T\": [left, top, left + width, top],\n            \"B\": [left, top + height, left + width, top + height],\n            \"L\": [left, top, left, top + height],\n            \"R\": [left + width, top, left + width, top + height],\n        }[ios[port].edge];\n\n        let [diffx, diffy] = [x2 - x1, y2 - y1];\n        let magnitude = ios[port].position;\n\n        return { top: y1 + diffy * magnitude, left: x1 + diffx * magnitude };\n    }\n\n    get ioPositions() {\n        const positions = [];\n        for (let i = 0; i < this.ios.length; i++) {\n            positions[i] = this.getIoPos(i);\n        }\n        return positions;\n    }\n\n    get allLines() {\n        return this._ioLines.flatMap(set => Array.from(set.values()));\n    }\n    connectedIo(io: number, otherBoxIo: number, otherBoxId: string, lineId: string) {\n        if (this._object) this._object.connectedIo(io, otherBoxIo, otherBoxId, lineId);\n        this.emit(\"connectedPort\", { io });\n        return this;\n    }\n    disconnectedIo(io: number, otherBoxIo: number, otherBoxId: string, lineId: string) {\n        if (this._object) this._object.disconnectedIo(io, otherBoxIo, otherBoxId, lineId);\n        this.emit(\"connectedPort\", { io });\n        return this;\n    }\n\n    // // called when inlet or outlet are connected or disconnected\n    // connectedOutlet(outlet: number, destBoxId: string, destInlet: number, lineId: string) {\n    //     if (this._object) this._object.connectedOutlet(outlet, destBoxId, destInlet, lineId);\n    //     this.emit(\"connectedPort\", { isSrc: true, i: outlet });\n    //     return this;\n    // }\n    // connectedInlet(inlet: number, srcBoxId: string, srcOutlet: number, lineId: string) {\n    //     if (this._object) this._object.connectedInlet(inlet, srcBoxId, srcOutlet, lineId);\n    //     this.emit(\"connectedPort\", { isSrc: false, i: inlet });\n    //     return this;\n    // }\n    // disconnectedOutlet(outlet: number, destBoxId: string, destInlet: number, lineId: string) {\n    //     if (this._object) this._object.disconnectedOutlet(outlet, destBoxId, destInlet, lineId);\n    //     const last = this._patcher.getLinesBySrcID(this.id)[outlet].length === 1;\n    //     this.emit(\"disconnectedPort\", { isSrc: true, i: outlet, last });\n    //     return this;\n    // }\n    // disconnectedInlet(inlet: number, srcBoxId: string, srcOutlet: number, lineId: string) {\n    //     if (this._object) this._object.disconnectedInlet(inlet, srcBoxId, srcOutlet, lineId);\n    //     const last = this._patcher.getLinesByDestID(this.id)[inlet].length === 1;\n    //     this.emit(\"disconnectedPort\", { isSrc: false, i: inlet, last });\n    //     return this;\n    // }\n    // isOutletTo(outlet: number, box: HardwareBox, inlet: number) {\n    //     const iterator = this._outletLines[outlet].values();\n    //     let r: IteratorResult<HardwareLine, HardwareLine>;\n    //     while (!(r = iterator.next()).done) {\n    //         const line = r.value;\n    //         if (line.destBox === box && line.destInlet === inlet) return true;\n    //     }\n    //     return false;\n    // }\n    // isInletFrom(inlet: number, box: HardwareBox, outlet: number) {\n    //     const iterator = this._inletLines[inlet].values();\n    //     let r: IteratorResult<HardwareLine, HardwareLine>;\n    //     while (!(r = iterator.next()).done) {\n    //         const line = r.value;\n    //         if (line.srcBox === box && line.srcOutlet === outlet) return true;\n    //     }\n    //     return false;\n    // }\n    isConnectedTo(io: number, otherBox: HardwareBox, otherIo: number) {\n        const iterator = this._ioLines[io].values();\n        let iter: IteratorResult<HardwareLine, HardwareLine>;\n        while (!(iter = iterator.next()).done) {\n            const line = iter.value;\n            if ((line.aBox === otherBox && line.aIo[1] === otherIo) || (line.bBox === otherBox && line.bIo[1] === otherIo))\n                return true;\n        }\n        return false;\n    }\n\n    async changeText(textIn: string, force?: boolean) {\n        if (!force && textIn === this.text) return this;\n        const { defaultSize: oldDefaultSize } = this;\n        this.allLines.forEach(line => line.disable());\n        await this._object?.destroy();\n        this.text = textIn;\n        this.args = [] as Args<T>;\n        await this.init();\n        this.allLines.forEach(line => line.enable());\n        const { defaultSize } = this;\n        if (!defaultSize.every((v, i) => v === oldDefaultSize[i])) {\n            this.size = defaultSize;\n            this.presentationSize = defaultSize;\n        }\n        this.emit(\"textChanged\", this);\n        this._object?.setMeta(this._object.meta);\n        await this.postInit();\n        return this;\n    }\n    update(e: { args?: any[]; props?: Record<string, any> }) {\n        const { args, props } = e;\n        if (args) this.args = args as Args<T>;\n        if (props) {\n            if (isTRect(props.rect)) {\n                this.setRect(props.rect);\n                delete props.rect;\n            }\n            if (isTPresentationRect(props.presentationRect)) {\n                this.setPresentationRect(props.presentationRect);\n                delete props.presentationRect;\n            }\n            if (typeof props.presentation === \"boolean\") {\n                this.setPresentation(props.presentation);\n                delete props.presentation;\n            }\n            if (typeof props.background === \"boolean\") {\n                this.setBackground(props.background);\n                delete props.background;\n            }\n            this.props = Object.assign(this.props, props);\n        }\n        return this;\n    }\n    get position() {\n        return this.rect.slice(0, 2) as [number, number];\n    }\n    set position([leftIn, topIn]: [number, number]) {\n        const [left, top, width, height] = this.rect;\n        this.setRect([typeof leftIn === \"number\" ? leftIn : left, typeof topIn === \"number\" ? topIn : top, width, height] as TRect);\n    }\n    get presentationPosition() {\n        return this.presentationRect.slice(0, 2) as [number | string, number | string];\n    }\n    set presentationPosition([leftIn, topIn]: [number | string, number | string]) {\n        const [left, top, width, height] = this.presentationRect;\n        this.setPresentationRect([typeof leftIn === \"number\" || typeof leftIn === \"string\" ? leftIn : left, typeof topIn === \"number\" || typeof topIn === \"string\" ? topIn : top, width, height] as TPresentationRect);\n    }\n    get size() {\n        return this.rect.slice(2) as [number, number];\n    }\n    set size([widthIn, heightIn]: [number, number]) {\n        const [left, top, width, height] = this.rect;\n        this.setRect([left, top, widthIn || width, heightIn || height] as TRect);\n    }\n    get presentationSize() {\n        return this.presentationRect.slice(2) as [number | string, number | string];\n    }\n    set presentationSize([widthIn, heightIn]: [number | string, number | string]) {\n        const [left, top, width, height] = this.presentationRect;\n        this.setPresentationRect([left, top, widthIn || width, heightIn || height] as TPresentationRect);\n    }\n    getLeft(inPresentation = false) {\n        const rectKey = inPresentation ? \"presentationRect\" : \"rect\";\n        return this[rectKey][0];\n    }\n    setLeft(leftIn: number | string, inPresentation = false) {\n        const positionKey = inPresentation ? \"presentationPosition\" : \"position\";\n        this[positionKey] = [leftIn as any, undefined];\n    }\n    getTop(inPresentation = false) {\n        const rectKey = inPresentation ? \"presentationRect\" : \"rect\";\n        return this[rectKey][1];\n    }\n    setTop(topIn: number | string, inPresentation = false) {\n        const positionKey = inPresentation ? \"presentationPosition\" : \"position\";\n        this[positionKey] = [undefined, topIn as any];\n    }\n    getWidth(inPresentation = false) {\n        const rectKey = inPresentation ? \"presentationRect\" : \"rect\";\n        return this[rectKey][2];\n    }\n    setWidth(widthIn: number | string, inPresentation = false) {\n        const sizeKey = inPresentation ? \"presentationSize\" : \"size\";\n        this[sizeKey] = [widthIn as any, undefined];\n    }\n    getHeight(inPresentation = false) {\n        const rectKey = inPresentation ? \"presentationRect\" : \"rect\";\n        return this[rectKey][3];\n    }\n    setHeight(heightIn: number | string, inPresentation = false) {\n        const sizeKey = inPresentation ? \"presentationSize\" : \"size\";\n        this[sizeKey] = [undefined, heightIn as any];\n    }\n    setBackground(bool: boolean) {\n        if (!!this.background === !!bool) return this;\n        this.background = bool;\n        this.emit(\"backgroundChanged\", this);\n        return this;\n    }\n    setPresentation(bool: boolean) {\n        if (!!this.presentation === !!bool) return this;\n        this.presentation = bool;\n        if (bool) this.presentationRect = this.rect.slice() as TRect;\n        this.emit(\"presentationChanged\", this);\n        return this;\n    }\n    setRect(rect: TRect) {\n        if (!isTRect(rect)) return this;\n        rect[0] = Math.max(0, rect[0]);\n        rect[1] = Math.max(0, rect[1]);\n        rect[2] = Math.max(15, rect[2]);\n        rect[3] = Math.max(15, rect[3]);\n        this.rect = rect;\n        this.ioLines.forEach(set => set.forEach(line => { line.uiUpdateA(); line.uiUpdateB(); }));\n\n        // this.inletLines.forEach(set => set.forEach(line => line.uiUpdateDest()));\n        // this.outletLines.forEach(set => set.forEach(line => line.uiUpdateSrc()));\n        this.emit(\"rectChanged\", this);\n        return this;\n    }\n    setPresentationRect(rect: TPresentationRect) {\n        if (!isTPresentationRect(rect)) return this;\n        if (typeof rect[0] === \"number\") rect[0] = Math.max(0, rect[0]);\n        if (typeof rect[1] === \"number\") rect[1] = Math.max(0, rect[1]);\n        if (typeof rect[2] === \"number\") rect[2] = Math.max(15, rect[2]);\n        if (typeof rect[3] === \"number\") rect[3] = Math.max(15, rect[3]);\n        this.presentationRect = rect;\n        this.emit(\"presentationRectChanged\", this);\n        return this;\n    }\n    getIsMovable(inPresentation = false) {\n        if (!inPresentation) return true;\n        return isRectMovable(this.presentationRect);\n    }\n    getIsResizable(inPresentation = false) {\n        if (!inPresentation) return true;\n        return isRectResizable(this.presentationRect);\n    }\n    setZIndex(zIndex: number) {\n        const oldZIndex = this.zIndex;\n        this.zIndex = zIndex;\n        this.undoable({ oldZIndex, zIndex });\n        this._patcher.emit(\"zIndexChanged\", { boxId: this.id, zIndex });\n    }\n    error(text: string) {\n        this.emit(\"error\", text);\n        this._patcher.newLog(\"error\", \"Patcher\", text, this);\n    }\n    highlight() {\n        this._patcher.emit(\"highlightBox\", this.id);\n    }\n    highlightPort(isSrc: boolean, portIndex: number) {\n        this._patcher.emit(\"highlightPort\", { boxId: this.id, isSrc, i: portIndex });\n    }\n    undoable(e: { oldArgs?: Args<T>; args?: Args<T>; oldProps?: Props<T>; props?: Props<T>; oldState?: State<T>; state?: State<T>; oldZIndex: number; zIndex?: number }) {\n        this._patcher.boxChanged(this.id, e);\n    }\n    minWidth() {\n        // const mostBubbles = this.inlets > this.outlets ? this.inlets : this.outlets;\n        // const minWidth = mostBubbles ? 20 + (mostBubbles - 1) * 20 : 30;\n        return 20;\n    }\n    async changeObject({ args, props, state, zIndex }: { args?: Args<T>; props?: Props<T>; state?: State<T>; zIndex?: number }, options?: ObjectUpdateOptions) {\n        if (args) await this._object?.updateArgs(args, options);\n        if (props) await this._object?.updateProps(props, options);\n        if (state) await this._object?.updateState(state, options);\n    }\n    async destroy() {\n        this.allLines.forEach(line => this._patcher.deleteLine(line.id));\n        delete this._patcher.boxes[this.id];\n        await this._object?.destroy();\n        return this;\n    }\n    static parseObjText(strIn: string) {\n        const REGEX = /[^\\s]+/gi;\n        const strArray = [];\n        let match = REGEX.exec(strIn);\n        while (match != null) {\n            // Index 1 in the array is the captured group if it exists\n            // Index 0 is the matched text, which we use if no captured group exists\n            strArray.push(match[1] ? match[1] : match[0]);\n            // Each call to exec returns the next regex match as an array\n            match = REGEX.exec(strIn);\n        }\n        const objOut: { class: string; args: any[]; props: Record<string, any> } = { class: \"\", args: [], props: {} };\n        let lastProp;\n        if (strArray.length) objOut.class = strArray.shift();\n        while (strArray.length) {\n            const el = strArray.shift();\n            if (typeof lastProp === \"undefined\" && el.charAt(0) !== \"@\") { // is arg, to push\n\n                const number = Number(el);\n\n                if (!isNaN(number)) {\n                    objOut.args.push(number);\n                    continue;\n                }\n\n                try {\n                    objOut.args.push(JSON.parse(el));\n                } catch (e) {\n                    objOut.args.push(el);\n                }\n                continue;\n            }\n            if (el.length > 1 && el.charAt(0) === \"@\") { // is prop key\n                lastProp = el.substr(1);\n                objOut.props[lastProp] = [];\n                continue;\n            }\n            try { // is prop value\n                objOut.props[lastProp].push(JSON.parse(el));\n            } catch (e) {\n                objOut.props[lastProp].push(el);\n            }\n        }\n        for (const key in objOut.props) { // no value = true, one value need to parse, else array\n            if (objOut.props[key].length === 0) objOut.props[key] = true;\n            else if (objOut.props[key].length === 1) objOut.props[key] = parseToPrimitive(objOut.props[key][0]);\n            else objOut.props[key] = parseToPrimitive(objOut.props[key].join(\" \"));\n        }\n        return objOut;\n    }\n    toString() {\n        const { id, text, ios, rect, background, presentation, presentationRect, args, props, data, zIndex } = this;\n\n        const defaultProps: Record<string, any> = structuredClone(props);\n        let pinNames: string[] = [];\n        if (this.meta) {\n            for (const key in this.meta.props) {\n                if (this.meta.props[key].alwaysSerialize) {\n                    if (!(key in defaultProps)) {\n                        defaultProps[key] = this.meta.props[key].default;\n                    }\n                }\n            }\n            pinNames = this.meta.ios.map(io => io.pin.pinName);\n        }\n\n        return JSON.stringify({ id, text, pinNames, rect, background, presentation, presentationRect, args, props: defaultProps, data, zIndex });\n    }\n    toSerializable(): THardwareBox {\n        return JSON.parse(this.toString());\n    }\n}\n","import { BasePin, I2CBus, USBBus } from \"./types\";\n\nfunction compatibleI2c(pins: BasePin[]) {\n  let sdaCount = 0;\n  let sclCount = 0;\n\n  pins.forEach((pin) => {\n    if (pin.busCapabilities) {\n      for (const busType in pin.busCapabilities) {\n        const bus = pin.busCapabilities[busType] as I2CBus;\n        if (bus.i2c) {\n          // Increment counters based on I2C capabilities\n          if (bus.sda) sdaCount++;\n          if (bus.scl) sclCount++;\n        }\n      }\n    }\n  });\n\n  return sdaCount > 1 || sclCount > 1;\n}\n\nfunction compatibleUsb(pins: BasePin[]) {\n  let dplusCount = 0;\n  let dminusCount = 0;\n  let idCount = 0;\n\n  pins.forEach((pin) => {\n    if (pin.busCapabilities) {\n      for (const busType in pin.busCapabilities) {\n        const bus = pin.busCapabilities[busType] as USBBus;\n        if (bus.usb) {\n          // Increment counters based on USB capabilities\n          if (bus.dplus) dplusCount++;\n          if (bus.dminus) dminusCount++;\n          if (bus.id) idCount++;\n        }\n      }\n    }\n  });\n\n  // Let's consider tie flexibility\n  const tiePinsCount = pins.filter((p) => p.tie).length;\n\n  if (\n    pins.length === 2 &&\n    (dplusCount === 1 || dminusCount === 1 || idCount === 1) &&\n    tiePinsCount === 1\n  ) {\n    // If there's only one dplus, dminus, or id, the tie pin can accommodate it\n    return true;\n  }\n\n  if (dplusCount >= 2 || dminusCount >= 2) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction compatibleBus(pins: BasePin[]) {\n  let compatibilities = [compatibleUsb, compatibleI2c];\n\n  return compatibilities.some((f) => f(pins));\n}\n\nfunction compatibleDigital(pins: BasePin[]) {\n  let num_outputs = pins.filter((p) => p.digitalOutput && !p.digitalInput).length;\n\n  if (num_outputs > 1) {\n    return false;\n  }\n\n  // now, for all fixed outputs, every other pin must have an input\n  let outputs = pins.map((p, i) => ({ p, i })).filter(({ p }) => p.digitalOutput);\n\n  let some_valid_config = false;\n  for (const output of outputs) {\n    const { p: pin, i: index } = output;\n\n    // In any configuration where an output is able to not conflict, there must be a compatibility\n    if (pins.filter((_, i) => i !== index).every((p) => p.digitalInput || p.tie)) {\n      some_valid_config = true;\n      break;\n    }\n  }\n\n  // otherwise, simple analog connections should be compatible\n  return some_valid_config;\n}\n\nfunction compatibleAnalog(pins: BasePin[]) {\n  let num_outputs = pins.filter((p) => p.analogOutput && !p.analogInput).length;\n\n  if (num_outputs > 1) {\n    return false;\n  }\n\n  // now, for all outputs, every other pin must have an input\n  let outputs = pins.map((p, i) => ({ p, i })).filter(({ p }) => p.analogOutput);\n\n  let some_valid_config = false;\n  for (const output of outputs) {\n    const { p: pin, i: index } = output;\n\n    // In any configuration where an output is able to not conflict, there must be a compatibility\n    if (pins.filter((_, i) => i !== index).every((p) => p.analogInput || p.tie)) {\n      some_valid_config = true;\n      break;\n    }\n  }\n\n  // otherwise, simple analog connections should be compatible\n  return some_valid_config;\n}\n\nexport function compatiblePins(pins: BasePin[]) {\n  let compatibilities = [compatibleBus, compatibleDigital, compatibleAnalog];\n\n  // If any of the compatibilities are true, then the pins are compatible\n  // TODO -- this should probably return exactly which aspects are compatible\n  return compatibilities.some((f) => f(pins));\n}\n","import type { SemanticICONS } from \"semantic-ui-react\";\nimport { getTimestamp, isRectMovable, isRectResizable, isTRect } from \"../../utils/utils\";\nimport FileEditor from \"../file/FileEditor\";\nimport Box from \"./Box\";\nimport Line from \"./Line\";\nimport type { TRect, TResizeHandlerType } from \"../types\";\nimport type { BasePin, RawHardwarePatcher, THardwareBox, THardwareLine } from \"./types\";\nimport type Patcher from \"./Patcher\";\nimport type PersistentProjectFile from \"../file/PersistentProjectFile\";\nimport type TempPatcherFile from \"./TempHardwareFile\";\nimport type { IJSPatcherEnv } from \"../Env\";\nimport type { IProject } from \"../Project\";\nimport type { PatcherEventMap, TPublicPatcherProps } from \"./Patcher\";\nimport HardwareLine from \"./Line\";\nimport { compatiblePins } from \"./Compatibility\";\n\nexport interface PatcherEditorEventMap extends PatcherEditorState {\n    \"create\": RawHardwarePatcher;\n    \"delete\": RawHardwarePatcher;\n    \"changeBoxText\": { boxId: string; oldText: string; text: string };\n    \"boxChanged\": { boxId: string; oldArgs?: any[]; args?: any[]; oldProps?: Record<string, any>; props?: Record<string, any>; oldState?: Record<string, any>; state?: Record<string, any>; oldZIndex?: number; zIndex?: number };\n    \"zIndexChanged\": { boxId: string; zIndex: number };\n    \"changeLineA\": { lineId: string, oldA: [string, number]; newA: [string, number] };\n    \"changeLineB\": { lineId: string, oldB: [string, number]; newB: [string, number] };\n\n    // \"changeLineSrc\": { lineId: string; oldSrc: [string, number]; src: [string, number] };\n    // \"changeLineDest\": { lineId: string; oldDest: [string, number]; dest: [string, number] };\n    \"selected\": string[];\n    \"moving\": { selected: string[]; delta: { x: number; y: number }; presentation: boolean };\n    \"moved\": { selected: string[]; delta: { x: number; y: number }; presentation: boolean };\n    \"resized\": { selected: string[]; delta: { x: number; y: number }; type: TResizeHandlerType; presentation: boolean };\n    \"tempLine\": { findSrc: boolean; from: [string, number] };\n    \"inspector\": never;\n    \"reference\": never;\n    \"help\": never;\n    \"dockUI\": string;\n    \"propsChanged\": { props: Partial<TPublicPatcherProps>; oldProps: Partial<TPublicPatcherProps> };\n    \"highlightBox\": string;\n    \"highlightPort\": { boxId: string; isSrc: boolean; i: number } | null;\n    \"bubblePorts\": { boxId: string; i: number; pin: BasePin } | null;\n}\n\nexport interface PatcherHistoryEventMap extends Pick<PatcherEditorEventMap, \"create\" | \"delete\" | \"changeBoxText\" | \"changeLineA\" | \"changeLineB\" | \"moved\" | \"resized\" | \"boxChanged\" | \"propsChanged\"> { }\n\nexport interface PatcherEditorState {\n    locked: boolean;\n    presentation: boolean;\n    showGrid: boolean;\n    snapToGrid: boolean;\n    selectAfterEdit: boolean;\n    selected: string[];\n}\n\nexport default class PatcherEditor extends FileEditor<Patcher, PatcherEditorEventMap> {\n    static async fromProjectItem({ file, env, project, instanceId }: { file: PersistentProjectFile | TempPatcherFile; env: IJSPatcherEnv; project?: IProject; instanceId?: string }): Promise<PatcherEditor> {\n        const patcher = await file.instantiate({ env, project, instanceId }) as Patcher;\n        const editor = new this(patcher);\n        return editor.init();\n    }\n    state: PatcherEditorState = {\n        locked: false,\n        presentation: false,\n        showGrid: true,\n        snapToGrid: true,\n        selectAfterEdit: true,\n        selected: []\n    };\n    get isLocked() {\n        return this.state.locked;\n    }\n    get boxes() {\n        return this.instance.boxes;\n    }\n    get lines() {\n        return this.instance.lines;\n    }\n    get props() {\n        return this.instance.props;\n    }\n    get publicProps() {\n        return this.instance.publicProps;\n    }\n    get fileExtension() {\n        return this.instance.fileExtension;\n    }\n    get fileName() {\n        return this.instance.fileName;\n    }\n    get fileIcon(): SemanticICONS {\n        return \"sitemap\";\n    }\n    handleChangeBoxText = (e: PatcherEventMap[\"changeBoxText\"]) => this.emit(\"changeBoxText\", e);\n    handlePassiveDeleteLine = (e: PatcherEventMap[\"passiveDeleteLine\"]) => this.emit(\"delete\", { boxes: {}, lines: { [e.id]: e.toSerializable() } });\n    handleBoxChanged = (e: PatcherEventMap[\"boxChanged\"]) => this.emit(\"boxChanged\", e);\n    handlePropsChanged = (e: PatcherEventMap[\"propsChanged\"]) => this.emit(\"propsChanged\", e);\n    handleZIndexChanged = (e: PatcherEventMap[\"zIndexChanged\"]) => this.emit(\"zIndexChanged\", e);\n    handleHighlightBox = (e: PatcherEventMap[\"highlightBox\"]) => this.emit(\"highlightBox\", e);\n    handleHighlightPort = (e: PatcherEventMap[\"highlightPort\"]) => this.emit(\"highlightPort\", e);\n    handleChanged = () => this.instance.emitChanged();\n    constructor(instance: Patcher) {\n        super(instance);\n        const { openInPresentation } = this.props;\n        this.setState({\n            locked: false,\n            presentation: !!openInPresentation,\n            showGrid: true,\n            snapToGrid: true,\n            selectAfterEdit: true,\n            selected: []\n        });\n    }\n    async init() {\n        if (!this.instance.isReady) {\n            await new Promise<void>((resolve, reject) => {\n                const handleReady = () => {\n                    resolve();\n                    this.instance.off(\"ready\", handleReady);\n                };\n                this.instance.on(\"ready\", handleReady);\n            });\n        }\n        this.on(\"changed\", this.handleChanged);\n        this.instance.on(\"changeBoxText\", this.handleChangeBoxText);\n        this.instance.on(\"passiveDeleteLine\", this.handlePassiveDeleteLine);\n        this.instance.on(\"boxChanged\", this.handleBoxChanged);\n        this.instance.on(\"propsChanged\", this.handlePropsChanged);\n        this.instance.on(\"zIndexChanged\", this.handleZIndexChanged);\n        this.instance.on(\"highlightBox\", this.handleHighlightBox);\n        this.instance.on(\"highlightPort\", this.handleHighlightPort);\n        const { openInPresentation } = this.props;\n        this.setState({\n            locked: false,\n            presentation: !!openInPresentation,\n            showGrid: true,\n            snapToGrid: true,\n            selectAfterEdit: true,\n            selected: []\n        });\n        this._isReady = true;\n        this.emit(\"ready\");\n        return this;\n    }\n    setState(state: Partial<PatcherEditorState>) {\n        let changed = false;\n        for (const keyIn in state) {\n            const key = keyIn as keyof PatcherEditorState;\n            if (this.state[key] === state[key]) continue;\n            changed = true;\n            if (key === \"locked\" || key === \"presentation\") this.deselectAll();\n            this.state[key] = state[key] as any;\n            this.emit(key, state[key]);\n        }\n        // if (changed) this.emit(\"stateChanged\", this.state);\n        return changed;\n    }\n    async createBox(boxIn: THardwareBox) {\n        const box = await this.instance.createBox(boxIn);\n        this.emit(\"create\", { boxes: { [box.id]: box.toSerializable() }, lines: {} });\n        await box.postInit();\n        return box;\n    }\n    async createBoxFromFile(file: PersistentProjectFile, boxIn: Omit<THardwareBox, \"text\">) {\n        const path = file.projectPath;\n        const type = file.type;\n        const ext = file.fileExtension;\n        if (type === \"patcher\") {\n            const extMap: Record<string, string> = this.props.mode === \"daisy\"\n                ? { json: \"p\", jspat: \"p\", maxpat: \"max\", gendsp: \"gen\", dsppat: \"pfaust\" }\n                : this.props.mode === \"faust\"\n                    ? { gendsp: \"gen\", dsppat: \"p\" }\n                    : this.props.mode === \"gen\"\n                        ? { gendsp: \"gen\" }\n                        : {};\n            const obj = extMap[ext];\n            if (obj) await this.createBox({ text: `${obj} ${path}`, ...boxIn });\n        } else if (type === \"audio\") {\n            await this.createBox({ text: `buffer~ ${path}`, ...boxIn });\n        } else if (type === \"image\") {\n            await this.createBox({ text: `img ${path}`, ...boxIn });\n        } else if (type === \"text\") {\n            await this.createBox({ text: `ptext ${path}`, ...boxIn });\n        }\n    }\n    async deleteBox(boxId: string) {\n        this.deselect(boxId);\n        const box = await this.instance.deleteBox(boxId);\n        if (!box) return null;\n        this.emit(\"delete\", { boxes: { [box.id]: box.toSerializable() }, lines: {} });\n        return box;\n    }\n    createLine(lineIn: THardwareLine) {\n        const line = this.instance.createLine(lineIn);\n        if (!line) return null;\n        this.emit(\"create\", { boxes: {}, lines: { [line.id]: line.toSerializable() } });\n        return line;\n    }\n    deleteLine(lineId: string) {\n        this.deselect(lineId);\n        const line = this.instance.deleteLine(lineId);\n        if (!line) return null;\n        this.emit(\"delete\", { boxes: {}, lines: { [line.id]: line.toSerializable() } });\n        return line;\n    }\n    changeLineA(lineId: string, aId: string, aIo: number) {\n        const e = this.instance.changeLineA(lineId, aId, aIo);\n        this.emit(\"changeLineA\", e);\n    }\n    changeLineB(lineId: string, bId: string, bIo: number) {\n        const e = this.instance.changeLineB(lineId, bId, bIo);\n        this.emit(\"changeLineB\", e);\n    }\n    async changeBox(boxId: string, change: { args?: any[]; props?: Record<string, any>; state?: Record<string, any>; zIndex?: number }) {\n        if (typeof change.zIndex === \"number\") this.instance.boxes[boxId]?.setZIndex(change.zIndex);\n        await this.instance.boxes[boxId]?.changeObject(change);\n    }\n\n    select(...ids: string[]) {\n        ids.forEach((id) => {\n            if (this.state.selected.indexOf(id) >= 0) return;\n            if (this.boxes[id] || this.lines[id]) this.state.selected.push(id);\n        });\n        this.emit(\"selected\", this.state.selected.slice());\n    }\n    selectAllBoxes() {\n        let ids = Object.keys(this.boxes);\n        if (this.state.presentation) ids = ids.filter(id => this.boxes[id].presentation);\n        this.state.selected = ids;\n        this.emit(\"selected\", ids);\n    }\n    selectOnly(...ids: string[]) {\n        this.state.selected = [];\n        this.select(...ids);\n    }\n    deselect(...ids: string[]) {\n        ids.forEach((id) => {\n            const i = this.state.selected.indexOf(id);\n            if (i === -1) return;\n            this.state.selected.splice(i, 1);\n        });\n        this.emit(\"selected\", this.state.selected.slice());\n    }\n    deselectAll() {\n        this.state.selected = [];\n        this.emit(\"selected\", []);\n    }\n    selectedToString() {\n        const lineSet = new Set<Line>();\n        const patcher: RawHardwarePatcher = { lines: {}, boxes: {} };\n        this.state.selected\n            .filter(id => id.startsWith(\"box\") && this.boxes[id])\n            .map(id => this.boxes[id])\n            .forEach((box) => {\n                box.allLines.forEach(line => lineSet.add(line));\n                patcher.boxes[box.id] = box.toSerializable();\n            });\n        lineSet.forEach((line) => {\n            if (patcher.boxes[line.aId] && patcher.boxes[line.bId])\n                patcher.lines[line.id] = line.toSerializable();\n        });\n        if (!Object.keys(patcher.boxes)) return undefined;\n        return JSON.stringify(patcher, undefined, 4);\n    }\n    bringToFront() {\n        this.state.selected\n            .filter(id => id.startsWith(\"box\") && this.boxes[id])\n            .map(id => this.boxes[id])\n            .forEach((box) => {\n                box.setZIndex(getTimestamp());\n            });\n    }\n    sendToBack() {\n        this.state.selected\n            .filter(id => id.startsWith(\"box\") && this.boxes[id])\n            .map(id => this.boxes[id])\n            .forEach((box) => {\n                box.setZIndex(-getTimestamp());\n            });\n    }\n    async pasteToPatcher(clipboard: RawHardwarePatcher) {\n        const idMap: Record<string, string> = {};\n        const pasted: RawHardwarePatcher = { boxes: {}, lines: {} };\n        if (!clipboard || !clipboard.boxes) return pasted;\n        const $init: Promise<Box>[] = [];\n        const $postInit: Promise<Box>[] = [];\n        // if (Array.isArray(clipboard.boxes)) { // Max Patcher\n        //     this.instance.state.preventEmitChanged = true;\n        //     const maxBoxes = clipboard.boxes;\n        //     for (let i = 0; i < maxBoxes.length; i++) {\n        //         const maxBox = maxBoxes[i].box;\n        //         const numID = parseInt(maxBox.id.match(/\\d+/)[0]);\n        //         let id = \"box-\" + numID;\n        //         if (this.boxes[id]) {\n        //             idMap[id] = \"box-\" + ++this.props.boxIndexCount;\n        //             id = idMap[id];\n        //         } else {\n        //             idMap[id] = id;\n        //             if (numID > this.props.boxIndexCount) this.props.boxIndexCount = numID;\n        //         }\n        //         const box: THardwareBox = {\n        //             id,\n        //             ios: max\n        //             inlets: maxBox.numinlets,\n        //             outlets: maxBox.numoutlets,\n        //             rect: maxBox.patching_rect,\n        //             text: (maxBox.maxclass === \"newobj\" ? \"\" : maxBox.maxclass + \" \") + (maxBox.text ? maxBox.text : \"\")\n        //         };\n        //         $init.push(this.instance.createBox(box));\n        //     }\n        //     const createdBoxes = (await Promise.all($init)).filter(box => !!box);\n        //     createdBoxes.forEach((box) => {\n        //         pasted.boxes[box.id] = box.toSerializable();\n        //         $postInit.push(box.postInit());\n        //     });\n        //     if (Array.isArray(clipboard.lines)) {\n        //         const maxLines = clipboard.lines;\n        //         for (let i = 0; i < maxLines.length; i++) {\n        //             const lineArgs = maxLines[i].patchline;\n        //             const id = \"line-\" + ++this.props.lineIndexCount;\n        //             const line: THardwareLine = {\n        //                 id,\n        //                 src: [idMap[lineArgs.source[0].replace(/obj/, \"box\")], lineArgs.source[1]],\n        //                 dest: [idMap[lineArgs.destination[0].replace(/obj/, \"box\")], lineArgs.destination[1]]\n        //             };\n        //             const createdLine = this.instance.createLine(line);\n        //             if (createdLine) pasted.lines[createdLine.id] = createdLine.toSerializable();\n        //         }\n        //     }\n        //     this.instance.state.preventEmitChanged = false;\n        //     if (Object.keys(pasted.boxes).length) {\n        //         if (this.state.selectAfterEdit) {\n        //             this.deselectAll();\n        //             this.select(...Object.keys(pasted.boxes));\n        //         }\n        //         this.emit(\"create\", pasted);\n        //         this.instance.emitGraphChanged();\n        //         await Promise.all($postInit);\n        //     }\n        //     return pasted;\n        // }\n        if (Array.isArray(clipboard.boxes) || Array.isArray(clipboard.lines))\n            return pasted;\n        this.instance.state.preventEmitChanged = true;\n        for (const boxId in clipboard.boxes) {\n            const box = clipboard.boxes[boxId];\n            if (this.boxes[box.id]) {\n                idMap[box.id] = \"box-\" + ++this.props.boxIndexCount;\n                box.id = idMap[box.id];\n            } else {\n                idMap[box.id] = box.id;\n                const numID = parseInt(box.id.match(/\\d+/)[0]);\n                if (numID > this.props.boxIndexCount) this.props.boxIndexCount = numID;\n            }\n            box.rect = [box.rect[0] + 30, box.rect[1] + 30, box.rect[2], box.rect[3]];\n            $init.push(this.instance.createBox(box));\n        }\n        const createdBoxes = (await Promise.all($init)).filter(box => !!box);\n        createdBoxes.forEach((box) => {\n            pasted.boxes[box.id] = box.toSerializable();\n            $postInit.push(box.postInit());\n        });\n        await Promise.all($postInit);\n        for (const lineId in clipboard.lines) {\n            const line = clipboard.lines[lineId];\n            line.id = \"line-\" + ++this.props.lineIndexCount;\n            line.aIo[0] = idMap[line.aIo[0]];\n            line.bIo[0] = idMap[line.bIo[0]];\n            const createdLine = this.instance.createLine(line);\n            if (createdLine) pasted.lines[createdLine.id] = createdLine.toSerializable();\n        }\n        this.instance.state.preventEmitChanged = false;\n        if (Object.keys(pasted.boxes).length) {\n            if (this.state.selectAfterEdit) {\n                this.deselectAll();\n                this.select(...Object.keys(pasted.boxes));\n            }\n            this.emit(\"create\", pasted);\n            this.instance.emitGraphChanged();\n        }\n        return pasted;\n    }\n    async create(objects: RawHardwarePatcher) {\n        const $init: Promise<Box>[] = [];\n        const $postInit: Promise<Box>[] = [];\n        const created: RawHardwarePatcher = { boxes: {}, lines: {} };\n        for (const boxId in objects.boxes) {\n            const boxIn = objects.boxes[boxId];\n            const box = new Box(this.instance, boxIn);\n            this.boxes[box.id] = box;\n            created.boxes[box.id] = box.toSerializable();\n            $init.push(box.init());\n            $postInit.push(box.postInit());\n        }\n        await Promise.all($init);\n        await Promise.all($postInit);\n        for (const lineId in objects.lines) {\n            const lineIn = objects.lines[lineId];\n            if (!this.instance.canCreateLine(lineIn)) continue;\n            const line = new Line(this.instance, lineIn);\n            this.lines[line.id] = line;\n            created.lines[line.id] = line.toSerializable();\n            line.enable();\n        }\n        if (this.state.selectAfterEdit) {\n            this.deselectAll();\n            this.select(...Object.keys(objects.boxes));\n        }\n        this.emit(\"create\", created);\n        this.instance.emitGraphChanged();\n    }\n    async deleteSelected() {\n        const boxSet = new Set<Box>();\n        const lineSet = new Set<Line>();\n        this.state.selected.filter(id => id.startsWith(\"line\")).forEach(id => lineSet.add(this.lines[id]));\n        this.state.selected.filter(id => id.startsWith(\"box\")).forEach((id) => {\n            boxSet.add(this.boxes[id]);\n            this.boxes[id].allLines.forEach(line => lineSet.add(line));\n        });\n        if (!boxSet.size && !lineSet.size) return undefined;\n        this.state.selected = [];\n        const deleted: RawHardwarePatcher = { boxes: {}, lines: {} };\n        const promises: Promise<Box>[] = [];\n        lineSet.forEach((line) => {\n            deleted.lines[line.id] = line.toSerializable();\n            line.destroy();\n        });\n        boxSet.forEach((box) => {\n            deleted.boxes[box.id] = box.toSerializable();\n            promises.push(box.destroy());\n        });\n        await Promise.all(promises);\n        this.emit(\"selected\", this.state.selected.slice());\n        this.emit(\"delete\", deleted);\n        this.instance.emitGraphChanged();\n        return deleted;\n    }\n    async delete(objects: RawHardwarePatcher) {\n        const deleted: RawHardwarePatcher = { boxes: {}, lines: {} };\n\n        console.log(`deleted objects: ${objects}`);\n        console.log(this.instance);\n        console.log(Object.keys(this.lines));\n\n        for (const id in objects.lines) {\n            console.log(`id: ${id}`);\n            deleted.lines[id] = this.lines[id].destroy().toSerializable();\n        }\n        const promises: Promise<Box>[] = [];\n        for (const id in objects.boxes) {\n            deleted.boxes[id] = this.boxes[id].toSerializable();\n            promises.push(this.boxes[id].destroy());\n        }\n        await Promise.all(promises);\n        this.emit(\"selected\", this.state.selected.slice());\n        this.emit(\"delete\", deleted);\n        this.instance.emitGraphChanged();\n    }\n    async cut() {\n        if (this.state.locked) return;\n        await this.copy();\n        this.deleteSelected();\n    }\n    async copy() {\n        if (this.state.locked) return;\n        const s = this.selectedToString();\n        if (!s) return;\n        await navigator.clipboard.writeText(s);\n    }\n    async paste() {\n        if (this.state.locked) return;\n        const s = await navigator.clipboard.readText();\n        if (!s) return;\n        let parsed: RawHardwarePatcher;\n        try {\n            parsed = JSON.parse(s);\n        } catch (e) { } // eslint-disable-line no-empty\n        await this.pasteToPatcher(parsed);\n    }\n    async duplicate() {\n        if (this.state.locked) return;\n        const s = this.selectedToString();\n        if (!s) return;\n        let parsed: RawHardwarePatcher;\n        try {\n            parsed = JSON.parse(s);\n        } catch (e) { } // eslint-disable-line no-empty\n        await this.pasteToPatcher(parsed);\n    }\n    async selectAll() {\n        this.selectAllBoxes();\n    }\n    selectRegion(selectionRect: number[], selectedBefore: string[]) {\n        let [left, top, right, bottom] = selectionRect;\n        if (left > right) [left, right] = [right, left];\n        if (top > bottom) [top, bottom] = [bottom, top];\n        const { presentation } = this.state;\n        const rectKey = presentation ? \"presentationRect\" : \"rect\";\n        const select = selectedBefore.slice();\n        for (const boxId in this.boxes) {\n            const box = this.boxes[boxId];\n            if (presentation && !box.presentation) continue;\n            const rect = box[rectKey];\n            if (!isTRect(rect)) continue;\n            const [boxLeft, boxTop, boxWidth, boxHeight] = rect;\n            const [boxRight, boxBottom] = [boxLeft + boxWidth, boxTop + boxHeight];\n            if (boxLeft < right && boxTop < bottom && boxRight > left && boxBottom > top) {\n                const i = select.indexOf(boxId);\n                if (i === -1) select.push(boxId);\n                else select.splice(i, 1);\n            }\n        }\n        const deselect = this.state.selected.filter(id => select.indexOf(id) === -1);\n        this.select(...select);\n        this.deselect(...deselect);\n    }\n    moveSelectedBox(dragOffset: { x: number; y: number }, refBoxID?: string) {\n        const { presentation, snapToGrid, selected } = this.state;\n        const rectKey = presentation ? \"presentationRect\" : \"rect\";\n        const delta = { ...dragOffset };\n        if (refBoxID) {\n            const rect = this.boxes[refBoxID][rectKey];\n            if (!isRectMovable(rect)) return { x: 0, y: 0 };\n            delta.x = snapToGrid ? Math.round((rect[0] + dragOffset.x) / this.props.grid[0]) * this.props.grid[0] - rect[0] : dragOffset.x;\n            delta.y = snapToGrid ? Math.round((rect[1] + dragOffset.y) / this.props.grid[1]) * this.props.grid[1] - rect[1] : dragOffset.y;\n        }\n        if (!delta.x && !delta.y) return dragOffset;\n        this.move(selected, delta, presentation);\n        return { x: dragOffset.x - delta.x, y: dragOffset.y - delta.y };\n    }\n    moveEnd(selected: string[], delta: { x: number; y: number }) {\n        const { presentation } = this.state;\n        const rectKey = presentation ? \"presentationRect\" : \"rect\";\n        let ids = selected.filter(id => id.startsWith(\"box\") && this.boxes[id]);\n        if (presentation) ids = ids.filter(id => isRectMovable(this.boxes[id][rectKey]));\n        const boxes = ids.map(id => this.boxes[id]);\n        boxes.forEach(box => box.emit(presentation ? \"presentationRectChanged\" : \"rectChanged\", box));\n        this.emit(\"moved\", { delta, selected: ids, presentation: this.state.presentation });\n    }\n    move(selected: string[], delta: { x: number; y: number }, presentation: boolean) {\n        if (this.state.selectAfterEdit) this.select(...selected);\n        const rectKey = presentation ? \"presentationRect\" : \"rect\";\n        let ids = selected.filter(id => id.startsWith(\"box\") && this.boxes[id]);\n        if (presentation) ids = ids.filter(id => isRectMovable(this.boxes[id][rectKey]));\n        const boxes = ids.map(id => this.boxes[id]);\n        if (boxes.length === 0) return;\n        let [left, top] = boxes[0][rectKey] as TRect;\n        for (let i = 1; i < boxes.length; i++) {\n            const box = boxes[i];\n            const [$left, $top] = box[rectKey] as TRect;\n            if ($left < left) left = $left;\n            if ($top < top) top = $top;\n        }\n        // Not allowing resize out of bound\n        delta.x = Math.max(delta.x, -left);\n        delta.y = Math.max(delta.y, -top);\n        if (delta.x) boxes.forEach(box => (box[rectKey] as TRect)[0] += delta.x);\n        if (delta.y) boxes.forEach(box => (box[rectKey] as TRect)[1] += delta.y);\n        // Emit events\n        if (!delta.x && !delta.y) return;\n        if (presentation !== this.state.presentation) return;\n        // boxes.forEach(box => box.emit(presentation ? \"presentationRectChanged\" : \"rectChanged\", box));\n        this.emit(\"moving\", { selected: ids, delta, presentation });\n        if (presentation) return;\n        const lineSet = new Set<Line>();\n        boxes.forEach((box) => {\n            box.ioLines.forEach(set => set.forEach(line => lineSet.add(line)));\n        });\n        lineSet.forEach(line => line.emit(\"posChanged\", line));\n    }\n    resizeSelectedBox(boxId: string, dragOffset: { x: number; y: number }, type: TResizeHandlerType) {\n        const { presentation, snapToGrid, selected } = this.state;\n        const rectKey = presentation ? \"presentationRect\" : \"rect\";\n        const rect = this.boxes[boxId][rectKey];\n        if (!isRectResizable(rect)) return { x: 0, y: 0 };\n        const delta = { x: 0, y: 0 };\n        // Round delta to grid\n        if (type === \"e\" || type === \"se\" || type === \"ne\") {\n            delta.x = snapToGrid ? Math.round((rect[0] + rect[2] + dragOffset.x) / this.props.grid[0]) * this.props.grid[0] - rect[0] - rect[2] : dragOffset.x;\n        }\n        if (type === \"s\" || type === \"se\" || type === \"sw\") {\n            delta.y = snapToGrid ? Math.round((rect[1] + rect[3] + dragOffset.y) / this.props.grid[1]) * this.props.grid[1] - rect[1] - rect[3] : dragOffset.y;\n        }\n        if (type === \"w\" || type === \"nw\" || type === \"sw\") {\n            delta.x = snapToGrid ? Math.round((rect[0] + dragOffset.x) / this.props.grid[0]) * this.props.grid[0] - rect[0] : dragOffset.x;\n        }\n        if (type === \"n\" || type === \"nw\" || type === \"ne\") {\n            delta.y = snapToGrid ? Math.round((rect[1] + dragOffset.y) / this.props.grid[1]) * this.props.grid[1] - rect[1] : dragOffset.y;\n        }\n        if (!delta.x && !delta.y) return dragOffset;\n        this.resize(selected, delta, type, presentation);\n        return { x: dragOffset.x - delta.x, y: dragOffset.y - delta.y };\n    }\n    resizeEnd(selected: string[], delta: { x: number; y: number }, type: TResizeHandlerType) {\n        const { presentation } = this.state;\n        this.emit(\"resized\", { delta, type, selected, presentation });\n    }\n    resize(selected: string[], delta: { x: number; y: number }, type: TResizeHandlerType, presentation: boolean) {\n        if (this.state.selectAfterEdit) this.select(...selected);\n        const rectKey = presentation ? \"presentationRect\" : \"rect\";\n        let ids = selected.filter(id => id.startsWith(\"box\") && this.boxes[id]);\n        if (presentation) ids = ids.filter(id => isRectResizable(this.boxes[id][rectKey]));\n        const boxes = ids.map(id => this.boxes[id]);\n        if (boxes.length === 0) return;\n        let [left, top, width, height] = boxes[0][rectKey] as TRect;\n        for (let i = 1; i < boxes.length; i++) {\n            const box = boxes[i];\n            const [$left, $top, $width, $height] = box[rectKey] as TRect;\n            if ($left < left) left = $left;\n            if ($top < top) top = $top;\n            if ($width < width) width = $width;\n            if ($height < height) height = $height;\n        }\n        // Not allowing resize out of bound\n        if (type === \"sw\" || type === \"w\" || type === \"nw\") delta.x = Math.max(delta.x, -left);\n        if (type === \"nw\" || type === \"n\" || type === \"ne\") delta.y = Math.max(delta.y, -top);\n        // Not allowing resize below 15px width or height\n        if (type === \"ne\" || type === \"e\" || type === \"se\") delta.x = Math.max(delta.x, 15 - width);\n        if (type === \"sw\" || type === \"w\" || type === \"nw\") delta.x = Math.min(delta.x, width - 15);\n        if (type === \"se\" || type === \"s\" || type === \"sw\") delta.y = Math.max(delta.y, 15 - height);\n        if (type === \"nw\" || type === \"n\" || type === \"ne\") delta.y = Math.min(delta.y, height - 15);\n        boxes.forEach((box) => {\n            const sizingX = box.UI ? box.UI?.sizing === \"horizontal\" || box.UI?.sizing === \"both\" : true;\n            const sizingY = box.UI ? box.UI?.sizing === \"vertical\" || box.UI?.sizing === \"both\" : true;\n            if (delta.x && sizingX) {\n                if (type === \"ne\" || type === \"e\" || type === \"se\") (box[rectKey] as TRect)[2] += delta.x;\n                if (type === \"sw\" || type === \"w\" || type === \"nw\") {\n                    (box[rectKey] as TRect)[2] -= delta.x;\n                    (box[rectKey] as TRect)[0] += delta.x;\n                }\n            }\n            if (delta.y && sizingY) {\n                if (type === \"se\" || type === \"s\" || type === \"sw\") (box[rectKey] as TRect)[3] += delta.y;\n                if (type === \"nw\" || type === \"n\" || type === \"ne\") {\n                    (box[rectKey] as TRect)[3] -= delta.y;\n                    (box[rectKey] as TRect)[1] += delta.y;\n                }\n            }\n        });\n        // Emit events\n        if (!delta.x && !delta.y) return;\n        if (presentation !== this.state.presentation) return;\n        boxes.forEach(box => box.emit(presentation ? \"presentationRectChanged\" : \"rectChanged\", box));\n        if (presentation) return;\n        const lineSet = new Set<Line>();\n        boxes.forEach((box) => {\n            box.ioLines.forEach(set => set.forEach(line => lineSet.add(line)));\n        });\n        lineSet.forEach(line => line.emit(\"posChanged\", line));\n    }\n    findNearestPort(left: number, top: number, from: [string, number], to?: [string, number]) {\n        let nearest: [string, number] = [null, null];\n        let minDistance = 100;\n\n        if (to && this.getPortsCompatible(from[0], from[1], to[0], to[1])) {\n            const currentPos = this.boxes[to[0]].getIoPos(to[1]);\n            const currentDistance = ((currentPos.left - left) ** 2 + (currentPos.top - top) ** 2) ** 0.5;\n            if (currentDistance < 100) {\n                nearest = to;\n                minDistance = currentDistance;\n            }\n        }\n\n        for (const id in this.boxes) {\n            const box = this.boxes[id];\n            box.ioPositions.map((pos, i) => ({ pos, i, compatible: this.getPortsCompatible(from[0], from[1], id, i) }))\n                .filter(({ compatible }) => compatible)\n                .forEach(({ pos, i }) => {\n                    const distance = ((pos.left - left) ** 2 + (pos.top - top) ** 2) ** 0.5;\n                    if (distance < minDistance) {\n                        const potentialLine: THardwareLine = { aIo: from, bIo: [id, i] };\n                        const canCreate = this.instance.canCreateLine(potentialLine);\n                        if (!canCreate) return;\n                        nearest = [id, i];\n                        minDistance = distance;\n                    }\n                });\n        }\n        return nearest;\n    }\n    getLinesByIo(boxId: string, io: number) {\n        const box = this.boxes[boxId];\n        if (!box || io > box.ios.length) {\n            return [];\n        }\n\n        const lines = [];\n\n        if (box.text.startsWith(\"tie\")) {\n            for (let key in this.lines) {\n                let line = this.lines[key];\n                if (line.aId === boxId || line.bId === boxId) {\n                    lines.push(line);\n                }\n            }\n        } else {\n            for (let key in this.lines) {\n                let line = this.lines[key];\n                if ((line.aId === boxId && line.aIo[1] === io) || (line.bId === boxId && line.bIo[1] === io)) {\n                    lines.push(line);\n                }\n            }\n        }\n        return lines;\n    }\n    getConnectedPins(boxId: string, io: number) {\n        let lines = this.getLinesByIo(boxId, io);\n\n        let all_boxes = lines.flatMap(line => [line.aIo, line.bIo]);\n        let unique_boxes = Array.from(new Set([...all_boxes, [boxId, io] as [string, number]]));\n\n        return unique_boxes.map(([id, io]) => this.boxes[id].meta.ios[io].pin);\n    }\n    getPortsCompatible(aBox: string, aIo: number, bBox: string, bIo: number) {\n\n        if (aBox === bBox) {\n            return false;\n        }\n\n        let aPins = this.getConnectedPins(aBox, aIo);\n        let bPins = this.getConnectedPins(bBox, bIo);\n\n        return compatiblePins([...aPins, ...bPins]);\n    }\n    // TODO -- this is where the magic happens\n    highlightNearestPort(findSrc: boolean, dragOffset: { x: number; y: number }, from: [string, number], to?: [string, number]) { // to = the port need to be reconnect\n        const origPos = to ? this.boxes[to[0]].getIoPos(to[1]) : this.boxes[from[0]].getIoPos(from[1]);\n        const left = origPos.left + dragOffset.x;\n        const top = origPos.top + dragOffset.y;\n        const [boxId, portIndex] = this.findNearestPort(left, top, from, to);\n\n        if (boxId) this.highlightPort(boxId, findSrc, portIndex);\n        else this.unhighlightPort();\n        return [boxId, portIndex] as [string, number];\n    }\n    highlightBox(boxId: string) {\n        this.emit(\"highlightBox\", boxId);\n    }\n    highlightPort(boxId: string, isSrc: boolean, portIndex: number) {\n        this.emit(\"highlightPort\", { boxId, isSrc, i: portIndex });\n    }\n    unhighlightPort() {\n        this.emit(\"highlightPort\", null);\n    }\n    bubblePorts(boxId: string, portIndex: number, pin: BasePin) {\n        this.emit(\"bubblePorts\", { boxId, i: portIndex, pin });\n    }\n    unBubblePorts() {\n        this.emit(\"bubblePorts\", null);\n    }\n    tempLine(findSrc: boolean, from: [string, number]) {\n        this.emit(\"tempLine\", { findSrc, from });\n        this.bubblePorts(from[0], from[1], this.boxes[from[0]].meta.ios[from[1]].pin);\n        return this;\n    }\n    inspector(box?: Box) {\n        if (box) this.emit(\"inspector\");\n        else if (this.state.selected.length) {\n            const found = this.state.selected.find(id => id.startsWith(\"box\"));\n            if (found && this.boxes[found]) this.emit(\"inspector\");\n        }\n    }\n    reference(box?: Box) {\n        if (box) this.emit(\"reference\");\n        else if (this.state.selected.length) {\n            const found = this.state.selected.find(id => id.startsWith(\"box\"));\n            if (found && this.boxes[found]) this.emit(\"reference\");\n        }\n    }\n    help(box?: Box) {\n        if (box) {\n            this.emit(\"help\");\n        } else if (this.state.selected.length) {\n            const found = this.state.selected.find(id => id.startsWith(\"box\"));\n            if (found && this.boxes[found]) {\n                this.emit(\"help\");\n            }\n        }\n    }\n    dockUI(box?: Box) {\n        if (box && box.UI.dockable) this.emit(\"dockUI\", box.id);\n        else if (this.state.selected.length) {\n            const found = this.state.selected.find(id => id.startsWith(\"box\"));\n            if (found && this.boxes[found] && this.boxes[found].UI.dockable) this.emit(\"dockUI\", found);\n        }\n    }\n    onUiResized() { }\n    async toTempData() {\n        return this.instance.toSerializable();\n    }\n}\n","import type { WamNode } from \"@webaudiomodules/api\";\nimport TypedEventEmitter from \"../../utils/TypedEventEmitter\";\nimport type Patcher from \"./Patcher\";\nimport type { THardwareLine, THardwareLineType } from \"./types\";\nimport type { IJSPatcherObject, TMetaType } from \"../objects/base/AbstractObject\";\n\nexport interface HardwareLineEventMap {\n    \"passData\": any;\n    \"bPosChanged\": { top: number; left: number };\n    \"aPosChanged\": { top: number; left: number };\n    \"posChanged\": HardwareLine;\n    \"typeChanged\": THardwareLineType;\n}\n\nexport default class HardwareLine extends TypedEventEmitter<HardwareLineEventMap> {\n    static compare(line1: HardwareLine, line2: HardwareLine) {\n        return line2.positionHash - line1.positionHash;\n    }\n    readonly id: string;\n    aIo: [string, number];\n    bIo: [string, number];\n    disabled = true;\n    private _type: THardwareLineType;\n    private readonly _patcher: Patcher;\n    constructor(patcherIn: Patcher, lineIn: THardwareLine) {\n        super();\n        this.id = lineIn.id;\n        this.aIo = lineIn.aIo;\n        this.bIo = lineIn.bIo;\n        this.disabled = true;\n        this._patcher = patcherIn;\n        const { aBox, bBox } = this;\n        this._type = this.calcType();\n        if (aBox) {\n            aBox.on(\"metaUpdated\", this.updateType);\n            aBox.addIoLine(this, true);\n        }\n        if (bBox) {\n            bBox.on(\"metaUpdated\", this.updateType);\n            bBox.addIoLine(this, false);\n        }\n    }\n    get presentation() {\n        return this.aBox && this.aBox.presentation && this.bBox && this.bBox.presentation;\n    }\n    setA(a: [string, number]) {\n        const aId = a[0];\n        const aIo = a[1];\n        if (aId === this.aIo[0] && aIo === this.aIo[1]) return this;\n        this.aBox.off(\"metaUpdated\", this.updateType);\n        this.disable();\n        this.aBox.removeIoLine(this, true);\n        this.aIo = [aId, aIo];\n        this.aBox.addIoLine(this, true);\n        this.enable();\n        this.aBox.on(\"metaUpdated\", this.updateType);\n        this.updateType();\n        return this.uiUpdateA();\n    }\n    getA() {\n        return this.aIo;\n    }\n    uiUpdateA() {\n        this.emit(\"aPosChanged\", this.aPos);\n        return this;\n    }\n    setB(b: [string, number]) {\n        const bId = b[0];\n        const bIo = b[1];\n        if (bId === this.bIo[0] && bIo === this.bIo[1]) return this;\n        this.aBox.off(\"metaUpdated\", this.updateType);\n        this.disable();\n        this.bBox.removeIoLine(this, false);\n        this.bIo = [bId, bIo];\n        this.bBox.removeIoLine(this, false);\n        this.enable();\n        this.bBox.on(\"metaUpdated\", this.updateType);\n        this.updateType();\n        return this.uiUpdateB();\n    }\n    getB() {\n        return this.aIo;\n    }\n    uiUpdateB() {\n        this.emit(\"bPosChanged\", this.bPos);\n        return this;\n    }\n    disable(bool?: boolean): HardwareLine {\n        if (bool === false)\n            return this.enable();\n        if (this.disabled)\n            return this;\n        this.disabled = true;\n        const { aBox, bBox } = this;\n        if (this._patcher.getLinesByBox(this.aId, this.bId, this.aIo[1], this.bIo[1]).length > 1)\n            return this; // not last cable\n        aBox.disconnectedIo(this.aIo[1], this.bIo[1], bBox.id, this.id);\n        bBox.disconnectedIo(this.bIo[1], this.aIo[1], aBox.id, this.id);\n        return this;\n    }\n    enable(bool?: boolean): HardwareLine {\n        if (bool === false)\n            return this.disable();\n        if (!this.disabled)\n            return this;\n        const { aBox, bBox } = this;\n        if (this.aIo[1] >= aBox.ios.length || this.bIo[1] >= bBox.ios.length)\n            return this._patcher.deleteLine(this.id);\n        if (this._patcher.getLinesByBox(this.aId, this.bId, this.aIo[1], this.bIo[1]).length > 1)\n            return this; // not last cable\n        this.disabled = false;\n        aBox.connectedIo(this.aIo[1], this.bIo[1], bBox.id, this.id);\n        bBox.connectedIo(this.bIo[1], this.aIo[1], aBox.id, this.id);\n        return this;\n    }\n    destroy() {\n        this.bBox.off(\"metaUpdated\", this.updateType);\n        this.aBox.off(\"metaUpdated\", this.updateType);\n        this.disable();\n        this.aBox.removeIoLine(this, true);\n        this.bBox.removeIoLine(this, false);\n        delete this._patcher.lines[this.id];\n        return this;\n    }\n    pass(data: any) {\n        this.emit(\"passData\", data);\n        return this.disabled ? this : this.bBox.fn(this.bIo[1], data);\n    }\n    get positionHash() {\n        const { top, left } = this._patcher.boxes[this.bIo[0]].getIoPos(this.bIo[1]);\n        return left * 65536 + top;\n    }\n    get aPos() {\n        return this._patcher.boxes[this.aIo[0]].getIoPos(this.aIo[1]);\n    }\n    get bPos() {\n        return this._patcher.boxes[this.bIo[0]].getIoPos(this.bIo[1]);\n    }\n    get aId() {\n        return this.aIo[0];\n    }\n    // get srcOutlet() {\n    //     return this.src[1];\n    // }\n    get bId() {\n        return this.bIo[0];\n    }\n    // get destInlet() {\n    //     return this.bIo[1];\n    // }\n    get aBox() {\n        return this._patcher.boxes[this.aIo[0]];\n    }\n    get bBox() {\n        return this._patcher.boxes[this.bIo[0]];\n    }\n    private calcType() {\n        // const srcMeta = this.srcBox.object.meta.outlets;\n        // const destMeta = this.destBox.object.meta.inlets;\n        // let srcType: TMetaType = \"anything\";\n        // let destType: TMetaType = \"anything\";\n        // if (srcMeta[this.srcOutlet]) srcType = srcMeta[this.srcOutlet].type;\n        // else if (srcMeta[srcMeta.length - 1] && srcMeta[srcMeta.length - 1].varLength) srcType = srcMeta[srcMeta.length - 1].type;\n        // if (destMeta[this.destInlet]) destType = destMeta[this.destInlet].type;\n        // else if (destMeta[destMeta.length - 1] && destMeta[destMeta.length - 1].varLength) destType = destMeta[destMeta.length - 1].type;\n        // return srcType === \"signal\" && destType === \"signal\" ? \"audio\" : \"normal\";\n\n        // TODO -- complete this implementation\n        return \"analog\" as THardwareLineType;\n    }\n    updateType = () => {\n        const type = this.calcType();\n        if (type !== this._type) {\n            this._type = type;\n            this.emit(\"typeChanged\", type);\n        }\n    };\n    get type(): THardwareLineType {\n        return this._type;\n    }\n    toString() {\n        return JSON.stringify(this.toSerializable());\n    }\n    toSerializable(): THardwareLine {\n        const { id, aIo, bIo, disabled } = this;\n        return { id, aIo: [...aIo], bIo: [...bIo], disabled };\n    }\n}\n"],"names":["io"],"sourceRoot":""}