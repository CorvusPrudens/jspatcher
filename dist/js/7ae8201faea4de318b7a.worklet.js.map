{"version":3,"sources":["webpack://JSPatcher/./src/core/worklets/AudioWorkletProxyProcessor.ts","webpack://JSPatcher/./src/utils/buffer.ts","webpack://JSPatcher/./src/utils/math.ts","webpack://JSPatcher/./src/utils/utils.ts","webpack://JSPatcher/./src/utils/yin.ts","webpack://JSPatcher/webpack/bootstrap","webpack://JSPatcher/webpack/runtime/define property getters","webpack://JSPatcher/webpack/runtime/hasOwnProperty shorthand","webpack://JSPatcher/webpack/runtime/make namespace object","webpack://JSPatcher/./src/core/worklets/TemporalAnalyser.worklet.ts"],"names":["AudioWorkletProcessor","globalThis","Processor","fnNames","constructor","options","resolves","rejects","messagePortRequestId","handleDisposed","port","removeEventListener","handleMessage","close","e","id","call","args","value","error","data","r","postMessage","_disposed","Promise","resolve","reject","Ctor","forEach","name","start","addEventListener","sum","array","from","length","l","i","mean","median","Error","sortedArray","Array","isArray","slice","concat","sliceBuffer","sort","maxIndex","index","max","cur","energy","signal","sample","rms","Math","sqrt","absMax","abs","zcr","lastPositive","positive","centroid","weightedSum","weight","conjugatedCentroid","factor","geometricMean","log","exp","flatness","flux","prev","norm","halfRectify","diff","kurtosis","c1","c2","c3","c4","numerator","denominator","skewness","rolloff","cutoff","threshold","n","element","slope","xSum","x2Sum","ySum","xySum","y","x","spread","setTypedArray","to","offsetTo","offsetFrom","toLength","fromLength","spillLength","min","spilled","$to","mod","$from","$spillLength","$fromEnd","set","subarray","getSubTypedArray","offset","$","fftw2Amp","windowEnergyFactor","amps","Float32Array","real","imag","estimateFreq","sampleRate","indexToFreq","fftBins","round","floor","ceil","toRad","degrees","PI","toMIDI","f","atodb","a","log10","dbtoa","db","iNormExp","normExp","scale","l1","h1","l2","h2","r1","r2","scaleClip","isIdentityMatrix","every","row","isNumberArray","j","identityMatrix","dim","fill","undefined","map","isStringArray","isTRect","isTPresentationRect","v","isRectMovable","isRectResizable","isMIDIEvent","Uint8Array","stringifyError","message","JSON","stringify","parseToPrimitive","parse","toString","rgbaMax2Css","maxColor","cssColor","join","css2RgbaMax","color","matched","match","split","s","decodeBPF","sIn","tupleLength","numbers","filter","find","isFinite","tuples","$tuple","decodeCurve","decodeLine","detectOS","appVersion","navigator","indexOf","detectBrowserCore","window","chrome","InstallTrigger","vendor","roundedRect","ctx","width","height","radius","radii","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","stroke","fillRoundedRect","selectElementRange","elementIsEditable","nodeName","selection","getSelection","focus","select","setBaseAndExtent","hasChildNodes","addRange","removeAllRanges","document","createRange","range","selectNodeContents","selectElementPos","pos","setStart","childNodes","collapse","findFromAscendants","predict","ascendants","parent","parentElement","body","push","getPropertyDescriptor","obj","key","Object","getOwnPropertyDescriptor","getPrototypeOf","getPropertyDescriptors","getOwnPropertyDescriptors","proto","prototype","assign","extToType","ext","max2js","patcherIn","mode","patcher","boxes","lines","maxPatcher","props","bgColor","bgcolor","editingBgColor","editing_bgcolor","dependencies","grid","gridsize","openInPresentation","openinpresentation","maxBoxes","maxLines","maxBox","box","numID","parseInt","inlets","numinlets","outlets","numoutlets","rect","patching_rect","presentationRect","presentation_rect","background","presentation","text","maxclass","lineArgs","patchline","src","source","replace","dest","destination","js2max","line","convertSampleToUnit","unit","bpm","beatsPerMeasure","division","str","values","milliseconds","roundedMs","dpms","totalDivisions","roundedTotalDivisions","divisions","beats","measure","padStart","ms","h","MEASURE_UNIT_REGEX","TIME_UNIT_REGEX","convertUnitToSample","measureIn","beatsIn","divisionsIn","bps","samplesPerBeat","measures","hIn","minIn","msIn","ab2sab","ab","ArrayBuffer","sab","SharedArrayBuffer","byteLength","ui8ab","ui8sab","sab2ab","ab2str","buf","String","fromCharCode","apply","Uint16Array","str2ab","bufView","strLen","charCodeAt","detect","bufferIn","paramsIn","probabilityThreshold","bufferSize","yinBufferSize","yinBuffer","prob","tau","delta","t","runningSum","betterTau","x0","x2","s0","s1","s2","processorId","registerProcessor","TemporalAnalyserAtoms","$read","_$read","$write","_$write","$total","_$total","asObject","_sab","Uint32Array","BYTES_PER_ELEMENT","TemporalAnalyserProcessor","AudioWorkletProxyProcessor","parameterDescriptors","defaultValue","maxValue","minValue","atoms","getRms","windowSize","getAbsMax","getZcr","getEstimatedFreq","ch","yinEstimate","getBuffer","gets","result","analysis","method","charAt","toUpperCase","destroy","destroyed","_windowSize","sizeIn","process","inputs","outputs","parameters","input","windowSab","splice","c","dataSize","oldWindow","channel","console","warn"],"mappings":";;;;;;;;;;;;;;;;AAIA,MAAM;AAAEA;AAAF,IAA4BC,UAAlC;AAEA,MAAMC,SAAS,GAAG,MAAZA,SAAY,SAAcF,qBAAd,CAAoC;AAChC,aAAPG,OAAO,GAAa;AAC3B,WAAO,EAAP;AACH;;AAEDC,aAAW,CAACC,OAAD,EAAmC;AAAA;;AAC1C,UAAMA,OAAN,CAD0C;AAAA;;AAAA,uCADlC,KACkC;;AAE1C,UAAMC,QAAmD,GAAG,EAA5D;AACA,UAAMC,OAAkD,GAAG,EAA3D;AACA,QAAIC,oBAAoB,GAAG,CAAC,CAA5B;;AACA,UAAMC,cAAc,GAAG,MAAM;AACzB,WAAKC,IAAL,CAAUC,mBAAV,CAA8B,SAA9B,EAAyCC,aAAzC;AACA,WAAKF,IAAL,CAAUG,KAAV;AACH,KAHD;;AAIA,UAAMD,aAAa,GAAG,MAAOE,CAAP,IAA0E;AAC5F,YAAM;AAAEC,UAAF;AAAMC,YAAN;AAAYC,YAAZ;AAAkBC,aAAlB;AAAyBC;AAAzB,UAAmCL,CAAC,CAACM,IAA3C;;AACA,UAAIJ,IAAJ,EAAU;AACN,cAAMK,CAAsB,GAAG;AAAEN;AAAF,SAA/B;;AACA,YAAI;AACAM,WAAC,CAACH,KAAF,GAAU,MAAO,IAAD,CAAcF,IAAd,EAAoB,GAAGC,IAAvB,CAAhB;AACH,SAFD,CAEE,OAAOH,CAAP,EAAU;AACRO,WAAC,CAACF,KAAF,GAAUL,CAAV;AACH;;AACD,aAAKJ,IAAL,CAAUY,WAAV,CAAsBD,CAAtB;AACA,YAAI,KAAKE,SAAT,EAAoBd,cAAc;AACrC,OATD,MASO;AACH,YAAIU,KAAJ,EAAW;AACP,cAAIZ,OAAO,CAACQ,EAAD,CAAX,EAAiBR,OAAO,CAACQ,EAAD,CAAP,CAAYI,KAAZ;AACjB,iBAAOZ,OAAO,CAACQ,EAAD,CAAd;AACA;AACH;;AACD,YAAIT,QAAQ,CAACS,EAAD,CAAZ,EAAkB;AACdT,kBAAQ,CAACS,EAAD,CAAR,CAAaG,KAAb;AACA,iBAAOZ,QAAQ,CAACS,EAAD,CAAf;AACH;AACJ;AACJ,KAtBD;;AAuBA,UAAMC,IAAI,GAAG,cAACA,KAAD;AAAA,wCAAkBC,IAAlB;AAAkBA,YAAlB;AAAA;;AAAA,aAAkC,IAAIO,OAAJ,CAAiB,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACjF,cAAMX,EAAE,GAAGP,oBAAoB,EAA/B;AACAF,gBAAQ,CAACS,EAAD,CAAR,GAAeU,OAAf;AACAlB,eAAO,CAACQ,EAAD,CAAP,GAAcW,MAAd;;AACA,aAAI,CAAChB,IAAL,CAAUY,WAAV,CAAsB;AAAEP,YAAF;AAAMC,cAAI,EAAJA,KAAN;AAAYC;AAAZ,SAAtB;AACH,OAL8C,CAAlC;AAAA,KAAb;;AAMA,UAAMU,IAAI,GAAI,KAAKvB,WAAnB;AACAuB,QAAI,CAACxB,OAAL,CAAayB,OAAb,CAAqBC,IAAI,IAAK,IAAD,CAAcA,IAAd,IAAsB;AAAA,yCAAIZ,IAAJ;AAAIA,YAAJ;AAAA;;AAAA,aAAoBD,IAAI,CAACa,IAAD,EAAO,GAAGZ,IAAV,CAAxB;AAAA,KAAnD;AACA,SAAKP,IAAL,CAAUoB,KAAV;AACA,SAAKpB,IAAL,CAAUqB,gBAAV,CAA2B,SAA3B,EAAsCnB,aAAtC;AACH;;AA/CiD,CAAtD;AAkDA,iEAAeV,SAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxDA;AAIO,MAAM8B,GAAG,GAAG,aAACC,KAAD,EAAmE;AAAA,MAApCC,IAAoC,uEAA7B,CAA6B;AAAA,MAA1BC,MAA0B,uEAAjBF,KAAK,CAACE,MAAW;AAClF,MAAIH,GAAG,GAAG,CAAV;AACA,QAAMI,CAAC,GAAGH,KAAK,CAACE,MAAhB;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAApB,EAA4BE,CAAC,EAA7B,EAAiC;AAC7BL,OAAG,IAAIC,KAAK,CAAC,CAACC,IAAI,GAAGG,CAAR,IAAaD,CAAd,CAAZ;AACH;;AACD,SAAOJ,GAAP;AACH,CAPM;AAQA,MAAMM,IAAI,GAAG,SAAPA,IAAO,CAACL,KAAD;AAAA,MAA+BC,IAA/B,uEAAsC,CAAtC;AAAA,MAAyCC,MAAzC,uEAAkDF,KAAK,CAACE,MAAxD;AAAA,SAAmEH,GAAG,CAACC,KAAD,EAAQC,IAAR,EAAcC,MAAd,CAAH,GAA2BA,MAA9F;AAAA,CAAb;AACA,MAAMI,MAAM,GAAG,SAATA,MAAS,CAACN,KAAD,EAAmE;AAAA,MAApCC,IAAoC,uEAA7B,CAA6B;AAAA,MAA1BC,MAA0B,uEAAjBF,KAAK,CAACE,MAAW;AACrF,MAAIA,MAAM,KAAK,CAAf,EAAkB,MAAM,IAAIK,KAAJ,CAAU,2CAAV,CAAN;AAClB,QAAMC,WAAW,GAAG,CAACP,IAAI,GAAGC,MAAP,GAAgBF,KAAK,CAACE,MAAtB,GAA+BO,KAAK,CAACC,OAAN,CAAcV,KAAd,IAAuBA,KAAK,CAACW,KAAN,CAAYV,IAAZ,EAAkBW,MAAlB,CAAyBZ,KAAK,CAACW,KAAN,CAAY,CAAZ,EAAeV,IAAI,GAAGC,MAAP,GAAgBF,KAAK,CAACE,MAArC,CAAzB,CAAvB,GAAgGW,WAAW,CAACb,KAAD,EAAQE,MAAR,EAAgBD,IAAhB,CAA1I,GAAkKD,KAAK,CAACW,KAAN,CAAYV,IAAZ,EAAkBA,IAAI,GAAGC,MAAzB,CAAnK,EAAqMY,IAArM,EAApB;AACA,MAAIZ,MAAM,GAAG,CAAT,KAAe,CAAnB,EAAsB,OAAO,CAACM,WAAW,CAACN,MAAM,GAAG,CAAT,GAAa,CAAd,CAAX,GAA8BM,WAAW,CAACN,MAAM,GAAG,CAAV,CAA1C,IAA0D,CAAjE;AACtB,SAAOM,WAAW,CAAC,CAAC,EAAEN,MAAM,GAAG,CAAX,CAAF,CAAlB;AACH,CALM;AAMA,MAAMa,QAAQ,GAAG,SAAXA,QAAW,CAACf,KAAD,EAAmE;AAAA,MAApCC,IAAoC,uEAA7B,CAA6B;AAAA,MAA1BC,MAA0B,uEAAjBF,KAAK,CAACE,MAAW;AACvF,QAAMC,CAAC,GAAGH,KAAK,CAACE,MAAhB;AACA,MAAI,CAACC,CAAL,EAAQ,OAAO,CAAP;AACR,MAAIa,KAAK,GAAG,CAAZ;AACA,MAAIC,GAAG,GAAGjB,KAAK,CAAC,CAAD,CAAf;AACA,MAAII,CAAC,GAAGF,MAAR;;AACA,SAAOE,CAAC,KAAK,CAAb,EAAgB;AACZ,UAAMc,GAAG,GAAGlB,KAAK,CAAC,CAACC,IAAI,GAAGG,CAAR,IAAaD,CAAd,CAAjB;AACA,QAAIe,GAAG,IAAID,GAAX,EAAgB;AAChBA,OAAG,GAAGC,GAAN;AACAF,SAAK,GAAGZ,CAAR;AACH;;AACD,SAAOY,KAAP;AACH,CAbM;AAcA,MAAMG,MAAM,GAAG,SAATA,MAAS,CAACC,MAAD,EAAqE;AAAA,MAArCnB,IAAqC,uEAA9B,CAA8B;AAAA,MAA3BC,MAA2B,uEAAlBkB,MAAM,CAAClB,MAAW;AACvF,MAAIH,GAAG,GAAG,CAAV;AACA,MAAIsB,MAAM,GAAG,CAAb;AACA,QAAMlB,CAAC,GAAGiB,MAAM,CAAClB,MAAjB;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAApB,EAA4BE,CAAC,EAA7B,EAAiC;AAC7BiB,UAAM,GAAGD,MAAM,CAAC,CAACnB,IAAI,GAAGG,CAAR,IAAaD,CAAd,CAAf;AACAJ,OAAG,IAAIsB,MAAM,GAAGA,MAAhB;AACH;;AACD,SAAOtB,GAAP;AACH,CATM;AAUA,MAAMuB,GAAG,GAAG,SAANA,GAAM,CAACF,MAAD;AAAA,MAAgCnB,IAAhC,uEAAuC,CAAvC;AAAA,MAA0CC,MAA1C,uEAAmDkB,MAAM,CAAClB,MAA1D;AAAA,SAAqEqB,IAAI,CAACC,IAAL,CAAUL,MAAM,CAACC,MAAD,EAASnB,IAAT,EAAeC,MAAf,CAAN,GAA+BkB,MAAM,CAAClB,MAAhD,CAArE;AAAA,CAAZ;AACA,MAAMuB,MAAM,GAAG,SAATA,MAAS,CAACL,MAAD,EAAqE;AAAA,MAArCnB,IAAqC,uEAA9B,CAA8B;AAAA,MAA3BC,MAA2B,uEAAlBkB,MAAM,CAAClB,MAAW;AACvF,MAAIe,GAAG,GAAG,CAAV;AACA,MAAII,MAAM,GAAG,CAAb;AACA,QAAMlB,CAAC,GAAGiB,MAAM,CAAClB,MAAjB;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAApB,EAA4BE,CAAC,EAA7B,EAAiC;AAC7BiB,UAAM,GAAGE,IAAI,CAACG,GAAL,CAASN,MAAM,CAAC,CAACnB,IAAI,GAAGG,CAAR,IAAaD,CAAd,CAAf,CAAT;AACA,QAAIkB,MAAM,GAAGJ,GAAb,EAAkBA,GAAG,GAAGI,MAAN;AACrB;;AACD,SAAOJ,GAAP;AACH,CATM;AAUA,MAAMU,GAAG,GAAG,aAACP,MAAD,EAAqE;AAAA,MAArCnB,IAAqC,uEAA9B,CAA8B;AAAA,MAA3BC,MAA2B,uEAAlBkB,MAAM,CAAClB,MAAW;AACpF,MAAIyB,GAAG,GAAG,CAAV;AACA,MAAIC,YAAY,GAAG,IAAnB;AACA,MAAIC,QAAQ,GAAG,IAAf;AACA,QAAM1B,CAAC,GAAGiB,MAAM,CAAClB,MAAjB;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAApB,EAA4BE,CAAC,EAA7B,EAAiC;AAC7ByB,YAAQ,GAAGT,MAAM,CAAC,CAACnB,IAAI,GAAGG,CAAR,IAAaD,CAAd,CAAN,IAA0B,CAArC;AACA,QAAI0B,QAAQ,KAAKD,YAAjB,EAA+BD,GAAG;AAClCC,gBAAY,GAAGC,QAAf;AACH;;AACD,SAAOF,GAAP;AACH,CAXM;AAYA,MAAMG,QAAQ,GAAG,SAAXA,QAAW,CAAC9B,KAAD,EAAmE;AAAA,MAApCC,IAAoC,uEAA7B,CAA6B;AAAA,MAA1BC,MAA0B,uEAAjBF,KAAK,CAACE,MAAW;AACvF,MAAI6B,WAAW,GAAG,CAAlB;AACA,MAAIC,MAAM,GAAG,CAAb;AACA,MAAIX,MAAM,GAAG,CAAb;AACA,QAAMlB,CAAC,GAAGH,KAAK,CAACE,MAAhB;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAApB,EAA4BE,CAAC,EAA7B,EAAiC;AAC7BiB,UAAM,GAAGrB,KAAK,CAAC,CAACC,IAAI,GAAGG,CAAR,IAAaD,CAAd,CAAd;AACA4B,eAAW,IAAI3B,CAAC,GAAGmB,IAAI,CAACG,GAAL,CAASL,MAAT,CAAnB;AACAW,UAAM,IAAIX,MAAV;AACH;;AACD,SAAOW,MAAM,KAAK,CAAX,GAAe,CAAf,GAAmBD,WAAW,GAAGC,MAAxC;AACH,CAXM;AAYA,MAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,CAACjC,KAAD,EAA+BkC,MAA/B,EAAmF;AAAA,MAApCjC,IAAoC,uEAA7B,CAA6B;AAAA,MAA1BC,MAA0B,uEAAjBF,KAAK,CAACE,MAAW;AACjH,MAAI6B,WAAW,GAAG,CAAlB;AACA,MAAIC,MAAM,GAAG,CAAb;AACA,MAAIX,MAAM,GAAG,CAAb;AACA,QAAMlB,CAAC,GAAGH,KAAK,CAACE,MAAhB;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAApB,EAA4BE,CAAC,EAA7B,EAAiC;AAC7BiB,UAAM,GAAGrB,KAAK,CAAC,CAACC,IAAI,GAAGG,CAAR,IAAaD,CAAd,CAAd;AACA4B,eAAW,IAAK3B,CAAC,IAAI8B,MAAN,GAAgBX,IAAI,CAACG,GAAL,CAASL,MAAT,CAA/B;AACAW,UAAM,IAAIX,MAAV;AACH;;AACD,SAAOW,MAAM,KAAK,CAAX,GAAe,CAAf,GAAmBD,WAAW,GAAGC,MAAxC;AACH,CAXM;AAYA,MAAMG,aAAa,GAAG,SAAhBA,aAAgB,CAACnC,KAAD,EAAmE;AAAA,MAApCC,IAAoC,uEAA7B,CAA6B;AAAA,MAA1BC,MAA0B,uEAAjBF,KAAK,CAACE,MAAW;AAC5F,MAAIH,GAAG,GAAG,CAAV;AACA,MAAIsB,MAAM,GAAG,CAAb;AACA,QAAMlB,CAAC,GAAGH,KAAK,CAACE,MAAhB;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAApB,EAA4BE,CAAC,EAA7B,EAAiC;AAC7BiB,UAAM,GAAGrB,KAAK,CAAC,CAACC,IAAI,GAAGG,CAAR,IAAaD,CAAd,CAAd;AACA,QAAIkB,MAAM,IAAI,CAAd,EAAiB,OAAO,CAAP;AACjBtB,OAAG,IAAIwB,IAAI,CAACa,GAAL,CAASf,MAAT,CAAP;AACH;;AACD,SAAOE,IAAI,CAACc,GAAL,CAAStC,GAAG,GAAGG,MAAf,CAAP;AACH,CAVM;AAWA,MAAMoC,QAAQ,GAAG,SAAXA,QAAW,CAACtC,KAAD;AAAA,MAA+BC,IAA/B,uEAAsC,CAAtC;AAAA,MAAyCC,MAAzC,uEAAkDF,KAAK,CAACE,MAAxD;AAAA,SAAmEiC,aAAa,CAACnC,KAAD,EAAQC,IAAR,EAAcC,MAAd,CAAb,GAAqCG,IAAI,CAACL,KAAD,EAAQC,IAAR,EAAcC,MAAd,CAA5G;AAAA,CAAjB;AACP;AACA;AACA;;AACO,MAAMqC,IAAI,GAAG,CAACrB,GAAD,EAA6BsB,IAA7B,EAA0DC,IAA1D,EAA8EC,WAA9E,KAAwG;AACxH,MAAIH,IAAI,GAAG,CAAX;;AACA,MAAIE,IAAI,KAAK,IAAb,EAAmB;AACf,QAAIC,WAAW,KAAK,IAApB,EAA0B;AAAE;AACxB,WAAK,IAAItC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGc,GAAG,CAAChB,MAAxB,EAAgCE,CAAC,EAAjC,EAAqC;AACjC,cAAMuC,IAAI,GAAGzB,GAAG,CAACd,CAAD,CAAH,GAASoC,IAAI,CAACpC,CAAD,CAA1B;AACA,YAAIuC,IAAI,GAAG,CAAX,EAAc;AACdJ,YAAI,IAAII,IAAI,GAAGA,IAAf;AACH;;AACD,aAAOpB,IAAI,CAACC,IAAL,CAAUe,IAAV,CAAP;AACH;;AACD,SAAK,IAAInC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGc,GAAG,CAAChB,MAAxB,EAAgCE,CAAC,EAAjC,EAAqC;AAAE;AACnC,YAAMuC,IAAI,GAAGzB,GAAG,CAACd,CAAD,CAAH,GAASoC,IAAI,CAACpC,CAAD,CAA1B;AACAmC,UAAI,IAAII,IAAI,GAAGA,IAAf;AACH;;AACD,WAAOpB,IAAI,CAACC,IAAL,CAAUe,IAAV,CAAP;AACH;;AACD,MAAIG,WAAW,KAAK,IAApB,EAA0B;AAAE;AACxB,SAAK,IAAItC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGc,GAAG,CAAChB,MAAxB,EAAgCE,CAAC,EAAjC,EAAqC;AACjC,YAAMuC,IAAI,GAAGzB,GAAG,CAACd,CAAD,CAAH,GAASoC,IAAI,CAACpC,CAAD,CAA1B;AACA,UAAIuC,IAAI,GAAG,CAAX,EAAc;AACdJ,UAAI,IAAII,IAAR;AACH;;AACD,WAAOJ,IAAP;AACH;;AACD,OAAK,IAAInC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGc,GAAG,CAAChB,MAAxB,EAAgCE,CAAC,EAAjC,EAAqC;AAAE;AACnC,UAAMuC,IAAI,GAAGzB,GAAG,CAACd,CAAD,CAAH,GAASoC,IAAI,CAACpC,CAAD,CAA1B;AACAmC,QAAI,IAAIhB,IAAI,CAACG,GAAL,CAASiB,IAAT,CAAR;AACH;;AACD,SAAOJ,IAAP;AACH,CA9BM;AA+BP;AACA;AACA;;AACO,MAAMK,QAAQ,GAAG,SAAXA,QAAW,CAAC5C,KAAD,EAAmE;AAAA,MAApCC,IAAoC,uEAA7B,CAA6B;AAAA,MAA1BC,MAA0B,uEAAjBF,KAAK,CAACE,MAAW;AACvF,QAAM2C,EAAE,GAAGf,QAAQ,CAAC9B,KAAD,EAAQC,IAAR,EAAcC,MAAd,CAAnB;AACA,QAAM4C,EAAE,GAAGb,kBAAkB,CAACjC,KAAD,EAAQ,CAAR,EAAWC,IAAX,EAAiBC,MAAjB,CAA7B;AACA,QAAM6C,EAAE,GAAGd,kBAAkB,CAACjC,KAAD,EAAQ,CAAR,EAAWC,IAAX,EAAiBC,MAAjB,CAA7B;AACA,QAAM8C,EAAE,GAAGf,kBAAkB,CAACjC,KAAD,EAAQ,CAAR,EAAWC,IAAX,EAAiBC,MAAjB,CAA7B;AACA,QAAM+C,SAAS,GAAG,CAAC,CAAD,GAAKJ,EAAE,IAAI,CAAX,GAAe,IAAIA,EAAJ,GAASC,EAAxB,GAA6B,IAAID,EAAJ,GAASE,EAAtC,GAA2CC,EAA7D;AACA,QAAME,WAAW,GAAG,CAACJ,EAAE,GAAGD,EAAE,IAAI,CAAZ,KAAkB,CAAtC;AACA,SAAOI,SAAS,GAAGC,WAAnB;AACH,CARM;AASP;AACA;AACA;;AACO,MAAMC,QAAQ,GAAG,SAAXA,QAAW,CAACnD,KAAD,EAAmE;AAAA,MAApCC,IAAoC,uEAA7B,CAA6B;AAAA,MAA1BC,MAA0B,uEAAjBF,KAAK,CAACE,MAAW;AACvF,QAAM2C,EAAE,GAAGf,QAAQ,CAAC9B,KAAD,EAAQC,IAAR,EAAcC,MAAd,CAAnB;AACA,QAAM4C,EAAE,GAAGb,kBAAkB,CAACjC,KAAD,EAAQ,CAAR,EAAWC,IAAX,EAAiBC,MAAjB,CAA7B;AACA,QAAM6C,EAAE,GAAGd,kBAAkB,CAACjC,KAAD,EAAQ,CAAR,EAAWC,IAAX,EAAiBC,MAAjB,CAA7B;AACA,QAAM+C,SAAS,GAAG,IAAIJ,EAAE,IAAI,CAAV,GAAc,IAAIA,EAAJ,GAASC,EAAvB,GAA4BC,EAA9C;AACA,QAAMG,WAAW,GAAG,CAACJ,EAAE,GAAGD,EAAE,IAAI,CAAZ,KAAkB,GAAtC;AACA,SAAOI,SAAS,GAAGC,WAAnB;AACH,CAPM;AAQP;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,MAAME,OAAO,GAAG,SAAVA,OAAU,CAACpD,KAAD,EAAoF;AAAA,MAArDC,IAAqD,uEAA9C,CAA8C;AAAA,MAA3CC,MAA2C,uEAAlCF,KAAK,CAACE,MAA4B;AAAA,MAApBmD,MAAoB;AACvG,MAAIxE,CAAC,GAAGsC,MAAM,CAACnB,KAAD,EAAQC,IAAR,EAAcC,MAAd,CAAd;AACA,QAAMoD,SAAS,GAAG,CAACD,MAAM,IAAI,IAAX,IAAmBxE,CAArC;AACA,MAAI0E,CAAC,GAAGrD,MAAM,GAAG,CAAjB;AACA,MAAIsD,OAAJ;;AACA,SAAO3E,CAAC,GAAGyE,SAAJ,IAAiBC,CAAC,IAAI,CAA7B,EAAgC;AAC5BC,WAAO,GAAGxD,KAAK,CAAC,CAACuD,CAAC,GAAGtD,IAAL,IAAaC,MAAd,CAAf;AACArB,KAAC,IAAI2E,OAAO,GAAGA,OAAf;AACA,MAAED,CAAF;AACH;;AACD,SAAOA,CAAC,GAAG,CAAX;AACH,CAXM;AAYA,MAAME,KAAK,GAAG,SAARA,KAAQ,CAACzD,KAAD,EAA8D;AAAA,MAA/BC,IAA+B,uEAAxB,CAAwB;AAAA,MAArBsD,CAAqB,uEAAjBvD,KAAK,CAACE,MAAW;AAC/E,QAAMwD,IAAI,GAAGH,CAAC,GAAGA,CAAJ,GAAQ,CAArB;AACA,QAAMI,KAAK,GAAG,CAACJ,CAAC,GAAG,CAAL,IAAUA,CAAV,IAAe,IAAIA,CAAJ,GAAQ,CAAvB,IAA4B,CAA1C;AACA,MAAIK,IAAI,GAAG,CAAX;AACA,MAAIC,KAAK,GAAG,CAAZ;AACA,MAAIC,CAAJ;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,CAApB,EAAuBQ,CAAC,EAAxB,EAA4B;AACxBD,KAAC,GAAG9D,KAAK,CAAC,CAAC+D,CAAC,GAAG9D,IAAL,IAAasD,CAAd,CAAT;AACAK,QAAI,IAAIE,CAAR;AACAD,SAAK,IAAIE,CAAC,GAAGD,CAAb;AACH;;AACD,SAAO,CAACP,CAAC,GAAGM,KAAJ,GAAYH,IAAI,GAAGE,IAApB,KAA6BL,CAAC,GAAGI,KAAJ,GAAYD,IAAI,GAAGA,IAAhD,CAAP;AACH,CAZM;AAaA,MAAMM,MAAM,GAAG,SAATA,MAAS,CAAChE,KAAD;AAAA,MAA+BC,IAA/B,uEAAsC,CAAtC;AAAA,MAAyCC,MAAzC,uEAAkDF,KAAK,CAACE,MAAxD;AAAA,SAAmEqB,IAAI,CAACC,IAAL,CAAUS,kBAAkB,CAACjC,KAAD,EAAQ,CAAR,EAAWC,IAAX,EAAiBC,MAAjB,CAA5B,IAAwD4B,QAAQ,CAAC9B,KAAD,EAAQC,IAAR,EAAcC,MAAd,CAAR,IAAiC,CAA5J;AAAA,CAAf;AACP;AACA;AACA;;AACO,MAAM+D,aAAa,GAAG,CAAoCC,EAApC,EAA2CjE,IAA3C,EAAoDkE,QAApD,EAAuEC,UAAvE,KAA+F;AACxH,QAAMC,QAAQ,GAAGH,EAAE,CAAChE,MAApB;AACA,QAAMoE,UAAU,GAAGrE,IAAI,CAACC,MAAxB;AACA,QAAMqE,WAAW,GAAGhD,IAAI,CAACiD,GAAL,CAASH,QAAT,EAAmBC,UAAnB,CAApB;AACA,MAAIG,OAAO,GAAG,CAAd;AACA,MAAIC,GAAG,GAAGC,0CAAG,CAACR,QAAD,EAAWE,QAAX,CAAH,IAA2B,CAArC;AACA,MAAIO,KAAK,GAAGD,0CAAG,CAACP,UAAD,EAAaE,UAAb,CAAH,IAA+B,CAA3C;;AACA,SAAOG,OAAO,GAAGF,WAAjB,EAA8B;AAC1B,UAAMM,YAAY,GAAGtD,IAAI,CAACiD,GAAL,CAASD,WAAW,GAAGE,OAAvB,EAAgCJ,QAAQ,GAAGK,GAA3C,EAAgDJ,UAAU,GAAGM,KAA7D,CAArB;AACA,UAAME,QAAQ,GAAGF,KAAK,GAAGC,YAAzB;AACA,QAAID,KAAK,KAAK,CAAV,IAAeE,QAAQ,KAAKR,UAAhC,EAA4CJ,EAAE,CAACa,GAAH,CAAO9E,IAAP,EAAayE,GAAb,EAA5C,KACKR,EAAE,CAACa,GAAH,CAAO9E,IAAI,CAAC+E,QAAL,CAAcJ,KAAd,EAAqBE,QAArB,CAAP,EAAuCJ,GAAvC;AACLA,OAAG,GAAG,CAACA,GAAG,GAAGG,YAAP,IAAuBR,QAA7B;AACAO,SAAK,GAAGE,QAAQ,GAAGR,UAAnB;AACAG,WAAO,IAAII,YAAX;AACH;;AACD,SAAOH,GAAP;AACH,CAjBM;AAmBA,MAAMO,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAoChF,IAApC,EAA6CC,MAA7C,EAA4E;AAAA,MAAfgF,MAAe,uEAAN,CAAM;AACxG,QAAMZ,UAAU,GAAGrE,IAAI,CAACC,MAAxB;AACA,QAAMiF,CAAC,GAAGR,0CAAG,CAACO,MAAD,EAASZ,UAAT,CAAH,IAA2B,CAArC;AACA,MAAIa,CAAC,KAAK,CAAN,IAAWjF,MAAM,KAAKoE,UAA1B,EAAsC,OAAOrE,IAAP;AACtC,MAAIkF,CAAC,GAAGjF,MAAJ,GAAaoE,UAAjB,EAA6B,OAAOrE,IAAI,CAAC+E,QAAL,CAAcG,CAAd,EAAiBA,CAAC,GAAGjF,MAArB,CAAP;AAC7B,QAAMgE,EAAE,GAAG,IAAKjE,IAAI,CAAC9B,WAAV,CAAgD+B,MAAhD,CAAX;AACA+D,eAAa,CAACC,EAAD,EAAKjE,IAAL,EAAW,CAAX,EAAckF,CAAd,CAAb;AACA,SAAOjB,EAAP;AACH,CARM;AAUA,MAAMrD,WAAW,GAAG,CAAoCZ,IAApC,EAA6CC,MAA7C,EAA6DgF,MAA7D,KAAiF;AACxG,QAAMZ,UAAU,GAAGrE,IAAI,CAACC,MAAxB;AACA,QAAMiF,CAAC,GAAGR,0CAAG,CAACO,MAAD,EAASZ,UAAT,CAAH,IAA2B,CAArC;AACA,MAAIa,CAAC,KAAK,CAAN,IAAWjF,MAAM,KAAKoE,UAA1B,EAAsC,OAAOrE,IAAI,CAACU,KAAL,EAAP;AACtC,MAAIwE,CAAC,GAAGjF,MAAJ,GAAaoE,UAAjB,EAA6B,OAAOrE,IAAI,CAACU,KAAL,CAAWwE,CAAX,EAAcA,CAAC,GAAGjF,MAAlB,CAAP;AAC7B,QAAMgE,EAAE,GAAG,IAAKjE,IAAI,CAAC9B,WAAV,CAAgD+B,MAAhD,CAAX;AACA+D,eAAa,CAACC,EAAD,EAAKjE,IAAL,EAAW,CAAX,EAAckF,CAAd,CAAb;AACA,SAAOjB,EAAP;AACH,CARM;AASP;AACA;AACA;;AACO,MAAMkB,QAAQ,GAAG,CAACnF,IAAD,EAAqBoF,kBAArB,KAAoD;AACxE,QAAM;AAAEnF;AAAF,MAAaD,IAAnB;AACA,QAAMqF,IAAI,GAAG,IAAIC,YAAJ,CAAiBrF,MAAM,GAAG,CAA1B,CAAb;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAAM,GAAG,CAA7B,EAAgCE,CAAC,EAAjC,EAAqC;AACjC,UAAMoF,IAAI,GAAGvF,IAAI,CAACG,CAAD,CAAjB;AACA,UAAMqF,IAAI,GAAIrF,CAAC,KAAK,CAAN,IAAWA,CAAC,KAAKF,MAAM,GAAG,CAAT,GAAa,CAA/B,GAAoC,CAApC,GAAwCD,IAAI,CAACC,MAAM,GAAGE,CAAV,CAAzD;AACAkF,QAAI,CAAClF,CAAD,CAAJ,GAAU,CAACoF,IAAI,GAAGA,IAAP,GAAcC,IAAI,GAAGA,IAAtB,KAA+B,GAA/B,GAAqCvF,MAArC,GAA8CmF,kBAAxD;AACH;;AACD,SAAOC,IAAP;AACH,CATM;AAUA,MAAMI,YAAY,GAAG,CAACJ,IAAD,EAAqBK,UAArB,KAA4CC,WAAW,CAAC7E,QAAQ,CAACuE,IAAD,CAAT,EAAiBA,IAAI,CAACpF,MAAtB,EAA8ByF,UAA9B,CAA5E;AACA,MAAMC,WAAW,GAAG,CAACxF,CAAD,EAAYyF,OAAZ,EAA6BF,UAA7B,KAAqDvF,CAAC,GAAGyF,OAAL,GAAgBA,OAAhB,GAA0BF,UAA1B,GAAuC,CAA/G,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvPP;AAEA;AACA;AACA;;AACO,MAAMhB,GAAG,GAAG,CAACZ,CAAD,EAAYD,CAAZ,KAAkC,CAACC,CAAC,GAAGD,CAAJ,GAAQA,CAAT,IAAcA,CAA5D;AACP;AACA;AACA;;AACO,MAAMgC,KAAK,GAAG,CAAC/B,CAAD,EAAYG,EAAZ,KAAoC3C,IAAI,CAACG,GAAL,CAASwC,EAAT,IAAe,CAAf,GAAmB3C,IAAI,CAACuE,KAAL,CAAW/B,CAAC,IAAI,IAAIG,EAAR,CAAZ,KAA4B,IAAIA,EAAhC,CAAnB,GAAyD3C,IAAI,CAACuE,KAAL,CAAW/B,CAAC,GAAGG,EAAf,IAAqBA,EAAhI;AACP;AACA;AACA;;AACO,MAAM6B,KAAK,GAAG,CAAChC,CAAD,EAAYG,EAAZ,KAAoC3C,IAAI,CAACG,GAAL,CAASwC,EAAT,IAAe,CAAf,GAAmB3C,IAAI,CAACwE,KAAL,CAAWhC,CAAC,IAAI,IAAIG,EAAR,CAAZ,KAA4B,IAAIA,EAAhC,CAAnB,GAAyD3C,IAAI,CAACwE,KAAL,CAAWhC,CAAC,GAAGG,EAAf,IAAqBA,EAAhI;AACP;AACA;AACA;;AACO,MAAM8B,IAAI,GAAG,CAACjC,CAAD,EAAYG,EAAZ,KAAoC3C,IAAI,CAACG,GAAL,CAASwC,EAAT,IAAe,CAAf,GAAmB3C,IAAI,CAACyE,IAAL,CAAUjC,CAAC,IAAI,IAAIG,EAAR,CAAX,KAA2B,IAAIA,EAA/B,CAAnB,GAAwD3C,IAAI,CAACyE,IAAL,CAAUjC,CAAC,GAAGG,EAAd,IAAoBA,EAA7H;AACP;AACA;AACA;;AACO,MAAM+B,KAAK,GAAIC,OAAD,IAA6BA,OAAO,GAAG3E,IAAI,CAAC4E,EAAf,GAAoB,GAA/D;AACP;AACA;AACA;;AACO,MAAMC,MAAM,GAAIC,CAAD,IAAuB,CAAC,GAAD,EAAM,IAAN,EAAY,GAAZ,EAAiB,IAAjB,EAAuB,GAAvB,EAA4B,GAA5B,EAAiC,IAAjC,EAAuC,GAAvC,EAA4C,IAA5C,EAAkD,GAAlD,EAAuD,IAAvD,EAA6D,GAA7D,EAAkE,CAACA,CAAC,GAAG,EAAJ,GAAS,EAAV,IAAgB,EAAlF,IAAwF9E,IAAI,CAACuE,KAAL,CAAWO,CAAC,GAAG,EAAJ,GAAS,CAApB,CAA9H;AACP;AACA;AACA;AACA;AACA;AACA;;AACO,MAAMC,KAAK,GAAIC,CAAD,IAAuB,KAAKhF,IAAI,CAACiF,KAAL,CAAWD,CAAX,CAA1C;AACP;AACA;AACA;AACA;AACA;AACA;;AACO,MAAME,KAAK,GAAIC,EAAD,IAAwB,OAAOA,EAAE,GAAG,EAAZ,CAAtC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,MAAMC,QAAQ,GAAG,CAAC5C,CAAD,EAAYlF,CAAZ,KAAkC0C,IAAI,CAACN,GAAL,CAAS,CAAT,EAAY8C,CAAZ,KAAmB,OAAO,CAAClF,CAA9E;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,MAAM+H,OAAO,GAAG,CAAC7C,CAAD,EAAYlF,CAAZ,KAAkC0C,IAAI,CAACN,GAAL,CAAS,CAAT,EAAY8C,CAAZ,KAAmB,OAAOlF,CAA5E;AAEA,MAAMgI,KAAK,GAAG,CAAC9C,CAAD,EAAY+C,EAAZ,EAAwBC,EAAxB,EAAoCC,EAApC,EAAgDC,EAAhD,KAA+D;AAChF,QAAMC,EAAE,GAAGH,EAAE,GAAGD,EAAhB;AACA,QAAMK,EAAE,GAAGF,EAAE,GAAGD,EAAhB;AACA,SAAO,CAACjD,CAAC,GAAG+C,EAAL,IAAWI,EAAX,GAAgBC,EAAhB,GAAqBH,EAA5B;AACH,CAJM;AAMA,MAAMI,SAAS,GAAG,CAACrD,CAAD,EAAY+C,EAAZ,EAAwBC,EAAxB,EAAoCC,EAApC,EAAgDC,EAAhD,KAA+D1F,IAAI,CAACN,GAAL,CAAS+F,EAAT,EAAazF,IAAI,CAACiD,GAAL,CAASyC,EAAT,EAAaJ,KAAK,CAAC9C,CAAD,EAAI+C,EAAJ,EAAQC,EAAR,EAAYC,EAAZ,EAAgBC,EAAhB,CAAlB,CAAb,CAAjF,C,CAEP;;AACO,MAAMI,gBAAgB,GAAItD,CAAD,IAAmB;AAC/C,SAAOtD,KAAK,CAACC,OAAN,CAAcqD,CAAd,KACJA,CAAC,CAACuD,KAAF,CAAQ,CAACC,GAAD,EAAMnH,CAAN,KAAYoH,qDAAa,CAACD,GAAD,CAAb,IACpBA,GAAG,CAACrH,MAAJ,KAAe6D,CAAC,CAAC7D,MADG,IAEpBqH,GAAG,CAACD,KAAJ,CAAU,CAACzI,CAAD,EAAI4I,CAAJ,KAAU5I,CAAC,MAAM4I,CAAC,KAAKrH,CAAN,GAAU,CAAV,GAAc,CAApB,CAArB,CAFA,CADH;AAIH,CALM;AAOA,MAAMsH,cAAc,GAAIC,GAAD,IAAiB,IAAIlH,KAAJ,CAAUkH,GAAV,EAAeC,IAAf,CAAoBC,SAApB,EAA+BC,GAA/B,CAAmC,CAAC/D,CAAD,EAAI3D,CAAJ,KAAU,IAAIK,KAAJ,CAAUkH,GAAV,EAAeC,IAAf,CAAoBC,SAApB,EAA+BC,GAA/B,CAAmC,CAAChE,CAAD,EAAI2D,CAAJ,KAAU,EAAErH,CAAC,KAAKqH,CAAR,CAA7C,CAA7C,CAAxC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzEP;AAIO,MAAMM,aAAa,GAAIhE,CAAD,IAA2BtD,KAAK,CAACC,OAAN,CAAcqD,CAAd,KAAoBA,CAAC,CAACuD,KAAF,CAAQzI,CAAC,IAAI,OAAOA,CAAP,KAAa,QAA1B,CAArE;AACA,MAAM2I,aAAa,GAAIzD,CAAD,IAA2BtD,KAAK,CAACC,OAAN,CAAcqD,CAAd,KAAoBA,CAAC,CAACuD,KAAF,CAAQzI,CAAC,IAAI,OAAOA,CAAP,KAAa,QAA1B,CAArE;AACA,MAAMmJ,OAAO,GAAIjE,CAAD,IAAwB;AAC3C,SAAOyD,aAAa,CAACzD,CAAD,CAAb,IACAA,CAAC,CAAC7D,MAAF,KAAa,CADb,IAEA6D,CAAC,CAAC,CAAD,CAAD,IAAQ,CAFR,IAGAA,CAAC,CAAC,CAAD,CAAD,IAAQ,CAHR,IAIAA,CAAC,CAAC,CAAD,CAAD,IAAQ,EAJR,IAKAA,CAAC,CAAC,CAAD,CAAD,IAAQ,EALf;AAMH,CAPM;AAQA,MAAMkE,mBAAmB,GAAIlE,CAAD,IAAoC;AACnE,SAAOtD,KAAK,CAACC,OAAN,CAAcqD,CAAd,KACAA,CAAC,CAAC7D,MAAF,KAAa,CADb,IAEA6D,CAAC,CAACuD,KAAF,CAAQY,CAAC,IAAI,OAAOA,CAAP,KAAa,QAAb,IAAyB,OAAOA,CAAP,KAAa,QAAnD,CAFP;AAGH,CAJM;AAKA,MAAMC,aAAa,GAAIpE,CAAD,IAAqE;AAC9F,SAAOkE,mBAAmB,CAAClE,CAAD,CAAnB,IAA0B,OAAOA,CAAC,CAAC,CAAD,CAAR,KAAgB,QAA1C,IAAsD,OAAOA,CAAC,CAAC,CAAD,CAAR,KAAgB,QAA7E;AACH,CAFM;AAGA,MAAMqE,eAAe,GAAIrE,CAAD,IAAwBiE,OAAO,CAACjE,CAAD,CAAvD;AACA,MAAMsE,WAAW,GAAItE,CAAD,IAA6B,CAACyD,aAAa,CAACzD,CAAD,CAAb,IAAoBA,CAAC,YAAYuE,UAAlC,KAAiDvE,CAAC,CAAC7D,MAAF,KAAa,CAA/G;AACA,MAAMqI,cAAc,GAAIpJ,IAAD,IAAe;AACzC,MAAI,OAAOA,IAAP,KAAgB,QAApB,EAA8B,OAAOA,IAAP;AAC9B,MAAIA,IAAI,YAAYoB,KAApB,EAA2B,OAAOpB,IAAI,CAACqJ,OAAZ;AAC3B,MAAI,OAAOrJ,IAAP,KAAgB,QAApB,EAA8B,OAAOsJ,IAAI,CAACC,SAAL,CAAevJ,IAAf,CAAP;AAC9B,mBAAUA,IAAV;AACH,CALM;AAMA,MAAMwJ,gBAAgB,GAAI1J,KAAD,IAAgB;AAC5C,MAAI;AACA,WAAOwJ,IAAI,CAACG,KAAL,CAAW3J,KAAX,CAAP;AACH,GAFD,CAEE,OAAOJ,CAAP,EAAU;AACR,WAAOI,KAAK,CAAC4J,QAAN,EAAP;AACH;AACJ,CANM;AAOA,MAAMC,WAAW,GAAIC,QAAD,IAAwB;AAC/C,QAAMC,QAAQ,GAAG,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,CAAhB,CAAjB;;AACA,MAAIvI,KAAK,CAACC,OAAN,CAAcqI,QAAd,CAAJ,EAA6B;AACzB,SAAK,IAAI3I,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxB,UAAI,OAAO2I,QAAQ,CAAC3I,CAAD,CAAf,KAAuB,QAA3B,EAAqC4I,QAAQ,CAAC5I,CAAD,CAAR,GAAcmB,IAAI,CAACwE,KAAL,CAAWgD,QAAQ,CAAC3I,CAAD,CAAR,GAAc,GAAzB,CAAd;AACxC;;AACD,QAAI,OAAO2I,QAAQ,CAAC,CAAD,CAAf,KAAuB,QAA3B,EAAqCC,QAAQ,CAAC,CAAD,CAAR,GAAcD,QAAQ,CAAC,CAAD,CAAtB;AACxC;;AACD,wBAAeC,QAAQ,CAACC,IAAT,CAAc,GAAd,CAAf;AACH,CATM;AAUA,MAAMC,WAAW,GAAIC,KAAD,IAAmB;AAC1C,QAAMJ,QAAQ,GAAG,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,CAAhB,CAAjB;AACA,QAAMK,OAAO,GAAGD,KAAK,CAACE,KAAN,CAAY,cAAZ,CAAhB;AACA,MAAI,CAACD,OAAL,EAAc,OAAOL,QAAP;AACd,QAAMC,QAAQ,GAAGI,OAAO,CAAC,CAAD,CAAP,CAAWE,KAAX,CAAiB,GAAjB,EAAsBxB,GAAtB,CAA0ByB,CAAC,IAAI,CAACA,CAAhC,CAAjB;;AACA,OAAK,IAAInJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxB,QAAI,OAAO4I,QAAQ,CAAC5I,CAAD,CAAf,KAAuB,QAA3B,EAAqC2I,QAAQ,CAAC3I,CAAD,CAAR,GAAc4I,QAAQ,CAAC5I,CAAD,CAAR,GAAc,GAA5B;AACrC,QAAI,OAAO4I,QAAQ,CAAC,CAAD,CAAf,KAAuB,QAA3B,EAAqCD,QAAQ,CAAC,CAAD,CAAR,GAAcC,QAAQ,CAAC,CAAD,CAAtB;AACxC;;AACD,SAAOD,QAAP;AACH,CAVM;AAWP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,MAAMS,SAAS,GAAG,CAACC,GAAD,EAAYC,WAAZ,KAAgD;AACrE,MAAI,OAAOD,GAAP,KAAe,QAAnB,EAA6B,OAAO,CAAC,CAACA,GAAD,CAAD,CAAP;AAC7B,MAAIjC,aAAa,CAACiC,GAAD,CAAjB,EAAwB,OAAO,CAACA,GAAD,CAAP;AACxB,MAAIhJ,KAAK,CAACC,OAAN,CAAc+I,GAAd,KAAsBA,GAAG,CAACnC,KAAJ,CAAUf,CAAC,IAAIiB,aAAa,CAACjB,CAAD,CAA5B,CAA1B,EAA4D,OAAOkD,GAAP;AAC5D,MAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B,MAAM,IAAIlJ,KAAJ,CAAU,yBAAV,CAAN;AAC7B,QAAMoJ,OAAO,GAAGF,GAAG,CAACH,KAAJ,CAAU,GAAV,EAAeM,MAAf,CAAsBL,CAAC,IAAI,CAAC,CAACA,CAA7B,EAAgCzB,GAAhC,CAAoCyB,CAAC,IAAI,CAACA,CAA1C,CAAhB;AACA,MAAII,OAAO,CAACE,IAAR,CAAa3B,CAAC,IAAI,CAAC4B,QAAQ,CAAC5B,CAAD,CAA3B,CAAJ,EAAqC,MAAM,IAAI3H,KAAJ,CAAU,8BAAV,CAAN;AACrC,QAAMwJ,MAAkB,GAAG,EAA3B;;AACA,OAAK,IAAI3J,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuJ,OAAO,CAACzJ,MAA5B,EAAoCE,CAAC,EAArC,EAAyC;AACrC,UAAM4J,MAAM,GAAG,CAAC,EAAE5J,CAAC,GAAGsJ,WAAN,CAAhB;AACA,UAAMvE,CAAC,GAAG/E,CAAC,GAAGsJ,WAAd;AACA,QAAI,CAACK,MAAM,CAACC,MAAD,CAAX,EAAqBD,MAAM,CAACC,MAAD,CAAN,GAAiB,EAAjB;AACrBD,UAAM,CAACC,MAAD,CAAN,CAAe7E,CAAf,IAAoBwE,OAAO,CAACvJ,CAAD,CAA3B;AACH;;AACD,SAAO2J,MAAP;AACH,CAfM;AAgBA,MAAME,WAAW,GAAIR,GAAD,IAAeD,SAAS,CAACC,GAAD,EAAM,CAAN,CAA5C;AACA,MAAMS,UAAU,GAAIT,GAAD,IAAeD,SAAS,CAACC,GAAD,EAAM,CAAN,CAA3C;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,MAAMU,QAAQ,GAAG,MAA0D;AAC9E,QAAM;AAAEC;AAAF,MAAiBC,SAAvB;AACA,MAAID,UAAU,CAACE,OAAX,CAAmB,KAAnB,MAA8B,CAAC,CAAnC,EAAsC,OAAO,SAAP;AACtC,MAAIF,UAAU,CAACE,OAAX,CAAmB,KAAnB,MAA8B,CAAC,CAAnC,EAAsC,OAAO,OAAP;AACtC,MAAIF,UAAU,CAACE,OAAX,CAAmB,KAAnB,MAA8B,CAAC,CAAnC,EAAsC,OAAO,MAAP;AACtC,MAAIF,UAAU,CAACE,OAAX,CAAmB,OAAnB,MAAgC,CAAC,CAArC,EAAwC,OAAO,OAAP;AACxC,SAAO,SAAP;AACH,CAPM;AAQA,MAAMC,iBAAiB,GAAG,MAAM;AACnC,MAAKC,MAAD,CAAgBC,MAApB,EAA4B,OAAO,UAAP;AAC5B,MAAKD,MAAD,CAAgBE,cAApB,EAAoC,OAAO,OAAP;AACpC,MAAIL,SAAS,CAACM,MAAV,CAAiBL,OAAjB,CAAyB,OAAzB,MAAsC,CAAC,CAA3C,EAA8C,OAAO,QAAP;AAC9C,SAAO,SAAP;AACH,CALM;AAMA,MAAMM,WAAW,GAAG,CAACC,GAAD,EAAgC9G,CAAhC,EAA2CD,CAA3C,EAAsDgH,KAAtD,EAAqEC,MAArE,EAAqFC,MAArF,KAAmH;AAC1I,QAAMC,KAAK,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAd;AACA,MAAI,OAAOD,MAAP,KAAkB,QAAtB,EAAgCC,KAAK,CAACrD,IAAN,CAAWoD,MAAX,EAAhC,KACKA,MAAM,CAACrL,OAAP,CAAe,CAACuI,CAAD,EAAI9H,CAAJ,KAAU6K,KAAK,CAAC7K,CAAD,CAAL,GAAW8H,CAApC;AACL2C,KAAG,CAACK,SAAJ;AACAL,KAAG,CAACM,MAAJ,CAAWpH,CAAC,GAAGkH,KAAK,CAAC,CAAD,CAApB,EAAyBnH,CAAzB;AACA+G,KAAG,CAACO,MAAJ,CAAWrH,CAAC,GAAG+G,KAAJ,GAAYG,KAAK,CAAC,CAAD,CAA5B,EAAiCnH,CAAjC;AACA+G,KAAG,CAACQ,gBAAJ,CAAqBtH,CAAC,GAAG+G,KAAzB,EAAgChH,CAAhC,EAAmCC,CAAC,GAAG+G,KAAvC,EAA8ChH,CAAC,GAAGmH,KAAK,CAAC,CAAD,CAAvD;AACAJ,KAAG,CAACO,MAAJ,CAAWrH,CAAC,GAAG+G,KAAf,EAAsBhH,CAAC,GAAGiH,MAAJ,GAAaE,KAAK,CAAC,CAAD,CAAxC;AACAJ,KAAG,CAACQ,gBAAJ,CAAqBtH,CAAC,GAAG+G,KAAzB,EAAgChH,CAAC,GAAGiH,MAApC,EAA4ChH,CAAC,GAAG+G,KAAJ,GAAYG,KAAK,CAAC,CAAD,CAA7D,EAAkEnH,CAAC,GAAGiH,MAAtE;AACAF,KAAG,CAACO,MAAJ,CAAWrH,CAAC,GAAGkH,KAAK,CAAC,CAAD,CAApB,EAAyBnH,CAAC,GAAGiH,MAA7B;AACAF,KAAG,CAACQ,gBAAJ,CAAqBtH,CAArB,EAAwBD,CAAC,GAAGiH,MAA5B,EAAoChH,CAApC,EAAuCD,CAAC,GAAGiH,MAAJ,GAAaE,KAAK,CAAC,CAAD,CAAzD;AACAJ,KAAG,CAACO,MAAJ,CAAWrH,CAAX,EAAcD,CAAC,GAAGmH,KAAK,CAAC,CAAD,CAAvB;AACAJ,KAAG,CAACQ,gBAAJ,CAAqBtH,CAArB,EAAwBD,CAAxB,EAA2BC,CAAC,GAAGkH,KAAK,CAAC,CAAD,CAApC,EAAyCnH,CAAzC;AACA+G,KAAG,CAACS,SAAJ;AACAT,KAAG,CAACU,MAAJ;AACH,CAhBM;AAiBA,MAAMC,eAAe,GAAG,CAACX,GAAD,EAAgC9G,CAAhC,EAA2CD,CAA3C,EAAsDgH,KAAtD,EAAqEC,MAArE,EAAqFC,MAArF,KAAmH;AAC9I,QAAMC,KAAK,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAd;AACA,MAAI,OAAOD,MAAP,KAAkB,QAAtB,EAAgCC,KAAK,CAACrD,IAAN,CAAWoD,MAAX,EAAhC,KACKA,MAAM,CAACrL,OAAP,CAAe,CAACuI,CAAD,EAAI9H,CAAJ,KAAU6K,KAAK,CAAC7K,CAAD,CAAL,GAAW8H,CAApC;AACL2C,KAAG,CAACK,SAAJ;AACAL,KAAG,CAACM,MAAJ,CAAWpH,CAAC,GAAGkH,KAAK,CAAC,CAAD,CAApB,EAAyBnH,CAAzB;AACA+G,KAAG,CAACO,MAAJ,CAAWrH,CAAC,GAAG+G,KAAJ,GAAYG,KAAK,CAAC,CAAD,CAA5B,EAAiCnH,CAAjC;AACA+G,KAAG,CAACQ,gBAAJ,CAAqBtH,CAAC,GAAG+G,KAAzB,EAAgChH,CAAhC,EAAmCC,CAAC,GAAG+G,KAAvC,EAA8ChH,CAAC,GAAGmH,KAAK,CAAC,CAAD,CAAvD;AACAJ,KAAG,CAACO,MAAJ,CAAWrH,CAAC,GAAG+G,KAAf,EAAsBhH,CAAC,GAAGiH,MAAJ,GAAaE,KAAK,CAAC,CAAD,CAAxC;AACAJ,KAAG,CAACQ,gBAAJ,CAAqBtH,CAAC,GAAG+G,KAAzB,EAAgChH,CAAC,GAAGiH,MAApC,EAA4ChH,CAAC,GAAG+G,KAAJ,GAAYG,KAAK,CAAC,CAAD,CAA7D,EAAkEnH,CAAC,GAAGiH,MAAtE;AACAF,KAAG,CAACO,MAAJ,CAAWrH,CAAC,GAAGkH,KAAK,CAAC,CAAD,CAApB,EAAyBnH,CAAC,GAAGiH,MAA7B;AACAF,KAAG,CAACQ,gBAAJ,CAAqBtH,CAArB,EAAwBD,CAAC,GAAGiH,MAA5B,EAAoChH,CAApC,EAAuCD,CAAC,GAAGiH,MAAJ,GAAaE,KAAK,CAAC,CAAD,CAAzD;AACAJ,KAAG,CAACO,MAAJ,CAAWrH,CAAX,EAAcD,CAAC,GAAGmH,KAAK,CAAC,CAAD,CAAvB;AACAJ,KAAG,CAACQ,gBAAJ,CAAqBtH,CAArB,EAAwBD,CAAxB,EAA2BC,CAAC,GAAGkH,KAAK,CAAC,CAAD,CAApC,EAAyCnH,CAAzC;AACA+G,KAAG,CAACS,SAAJ;AACAT,KAAG,CAACjD,IAAJ;AACH,CAhBM;AAiBA,MAAM6D,kBAAkB,GAAI5M,CAAD,IAAoB;AAClD,QAAM6M,iBAAiB,GAAI7M,CAAD,IAAiE,CAAC,CAACA,CAAC,CAAC8M,QAAF,CAAWtC,KAAX,CAAiB,qBAAjB,CAA7F;;AACA,QAAMuC,SAAS,GAAGpB,MAAM,CAACqB,YAAP,EAAlB;;AACA,MAAIH,iBAAiB,CAAC7M,CAAD,CAArB,EAA0B;AACtBA,KAAC,CAACiN,KAAF;AACAjN,KAAC,CAACkN,MAAF;AACA;AACH;;AACD,MAAIH,SAAS,CAACI,gBAAd,EAAgC;AAC5B;AACAJ,aAAS,CAACI,gBAAV,CAA2BnN,CAA3B,EAA8B,CAA9B,EAAiCA,CAAjC,EAAoCA,CAAC,CAACoN,aAAF,KAAoB,CAApB,GAAwB,CAA5D;AACA;AACH;;AACD,MAAIL,SAAS,CAACM,QAAV,IAAsBN,SAAS,CAACO,eAAhC,IAAmDC,QAAQ,CAACC,WAAhE,EAA6E;AACzE;AACA,UAAMC,KAAK,GAAGF,QAAQ,CAACC,WAAT,EAAd;AACAC,SAAK,CAACC,kBAAN,CAAyB1N,CAAzB;AACA+M,aAAS,CAACO,eAAV;AACAP,aAAS,CAACM,QAAV,CAAmBI,KAAnB;AACH;AACJ,CApBM;AAqBA,MAAME,gBAAgB,GAAG,CAAC3N,CAAD,EAAiB4N,GAAjB,KAAiC;AAC7D,QAAMH,KAAK,GAAGF,QAAQ,CAACC,WAAT,EAAd;AACA,QAAMT,SAAS,GAAGpB,MAAM,CAACqB,YAAP,EAAlB;AACAS,OAAK,CAACI,QAAN,CAAe7N,CAAC,CAAC8N,UAAF,CAAa,CAAb,CAAf,EAAgCF,GAAhC;AACAH,OAAK,CAACM,QAAN,CAAe,IAAf;AACAhB,WAAS,CAACO,eAAV;AACAP,WAAS,CAACM,QAAV,CAAmBI,KAAnB;AACH,CAPM;AAQA,MAAMO,kBAAkB,GAAG,CAAChO,CAAD,EAAiBiO,OAAjB,KAA0D;AACxF,QAAMC,UAAU,GAAG,EAAnB;AACA,MAAIC,MAAM,GAAGnO,CAAC,CAACoO,aAAf;;AACA,SAAOD,MAAM,KAAKZ,QAAQ,CAACc,IAA3B,EAAiC;AAC7BH,cAAU,CAACI,IAAX,CAAgBH,MAAhB;AACAA,UAAM,GAAGA,MAAM,CAACC,aAAhB;AACH;;AACD,SAAOF,UAAU,CAAClD,IAAX,CAAgBiD,OAAhB,CAAP;AACH,CARM,C,CASP;;AACO,MAAMM,qBAAqB,GAAG,CAACC,GAAD,EAA2BC,GAA3B,KAA+D;AAChG,SAAOC,MAAM,CAACC,wBAAP,CAAgCH,GAAhC,EAAqCC,GAArC,KAA6CF,qBAAqB,CAACG,MAAM,CAACE,cAAP,CAAsBJ,GAAtB,CAAD,EAA6BC,GAA7B,CAAzE;AACH,CAFM;AAGA,MAAMI,sBAAsB,GAAIL,GAAD,IAAgE;AAClG,MAAI,OAAOA,GAAP,KAAe,UAAnB,EAA+B,OAAOE,MAAM,CAACI,yBAAP,CAAiCN,GAAjC,CAAP;AAC/B,QAAMO,KAAK,GAAGL,MAAM,CAACE,cAAP,CAAsBJ,GAAtB,CAAd;AACA,MAAIA,GAAG,KAAKE,MAAM,CAACM,SAAf,IAA4BD,KAAK,KAAKL,MAAM,CAACM,SAAjD,EAA4D,OAAON,MAAM,CAACI,yBAAP,CAAiCN,GAAjC,CAAP;AAC5D,SAAOE,MAAM,CAACO,MAAP,CAAcF,KAAK,GAAGF,sBAAsB,CAACE,KAAD,CAAzB,GAAmC,EAAtD,EAA0DL,MAAM,CAACI,yBAAP,CAAiCN,GAAjC,CAA1D,CAAP;AACH,CALM;AAOA,MAAMU,SAAS,GAAIC,GAAD,IAAqD;AAC1E,MAAI,CAAC,OAAD,EAAU,QAAV,EAAoB,QAApB,EAA8B,QAA9B,EAAwC1D,OAAxC,CAAgD0D,GAAhD,MAAyD,CAAC,CAA9D,EAAiE,OAAO,SAAP;AACjE,MAAI,CAAC,KAAD,EAAQ,KAAR,EAAe,MAAf,EAAuB,KAAvB,EAA8B,KAA9B,EAAqC,MAArC,EAA6C,KAA7C,EAAoD,KAApD,EAA2D1D,OAA3D,CAAmE0D,GAAnE,MAA4E,CAAC,CAAjF,EAAoF,OAAO,OAAP;AACpF,MAAI,CAAC,KAAD,EAAQ,MAAR,EAAgB1D,OAAhB,CAAwB0D,GAAxB,MAAiC,CAAC,CAAtC,EAAyC,OAAO,MAAP;AACzC,MAAI,CAAC,MAAD,EAAS,MAAT,EAAiB,KAAjB,EAAwB,KAAxB,EAA+B,MAA/B,EAAuC,MAAvC,EAA+C,OAA/C,EAAwD,KAAxD,EAA+D,KAA/D,EAAsE,KAAtE,EAA6E,MAA7E,EAAqF,KAArF,EAA4F,KAA5F,EAAmG,KAAnG,EAA0G,KAA1G,EAAiH,MAAjH,EAAyH1D,OAAzH,CAAiI0D,GAAjI,MAA0I,CAAC,CAA/I,EAAkJ,OAAO,OAAP;AAClJ,MAAI,CAAC,KAAD,EAAQ,MAAR,EAAgB,KAAhB,EAAuB1D,OAAvB,CAA+B0D,GAA/B,MAAwC,CAAC,CAA7C,EAAgD,OAAO,OAAP;AAChD,SAAO,SAAP;AACH,CAPM;AASA,MAAMC,MAAM,GAAG,SAATA,MAAS,CAACC,SAAD,EAA+E;AAAA,MAAtDC,IAAsD,uEAA/C,KAA+C;AACjG,QAAMC,OAAmB,GAAG;AAAEC,SAAK,EAAE,EAAT;AAAaC,SAAK,EAAE;AAApB,GAA5B;AACA,QAAMC,UAAU,GAAIL,SAAD,CAA2BE,OAA9C;AACAA,SAAO,CAACI,KAAR,GAAgB;AACZC,WAAO,EAAE3F,WAAW,CAACyF,UAAU,CAACG,OAAZ,CADR;AAEZC,kBAAc,EAAE7F,WAAW,CAACyF,UAAU,CAACK,eAAZ,CAFf;AAGZC,gBAAY,EAAE,EAHF;AAIZC,QAAI,EAAEP,UAAU,CAACQ,QAJL;AAKZC,sBAAkB,EAAE,CAAC,CAACT,UAAU,CAACU,kBALrB;AAMZd;AANY,GAAhB;AAQA,QAAMe,QAAQ,GAAGX,UAAU,CAACF,KAA5B;AACA,QAAMc,QAAQ,GAAGZ,UAAU,CAACD,KAA5B;;AACA,OAAK,IAAIlO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8O,QAAQ,CAAChP,MAA7B,EAAqCE,CAAC,EAAtC,EAA0C;AACtC,UAAMgP,MAAM,GAAGF,QAAQ,CAAC9O,CAAD,CAAR,CAAYiP,GAA3B;AACA,UAAMC,KAAK,GAAGC,QAAQ,CAACH,MAAM,CAACtQ,EAAP,CAAUuK,KAAV,CAAgB,KAAhB,EAAuB,CAAvB,CAAD,CAAtB;AACA,UAAMvK,EAAE,GAAG,SAASwQ,KAApB;AACAlB,WAAO,CAACC,KAAR,CAAcvP,EAAd,IAAoB;AAChBA,QADgB;AAEhB0Q,YAAM,EAAEJ,MAAM,CAACK,SAFC;AAGhBC,aAAO,EAAEN,MAAM,CAACO,UAHA;AAIhBC,UAAI,EAAER,MAAM,CAACS,aAJG;AAKhBC,sBAAgB,EAAEV,MAAM,CAACW,iBALT;AAMhBC,gBAAU,EAAE,CAAC,CAACZ,MAAM,CAACY,UANL;AAOhBC,kBAAY,EAAE,CAAC,CAACb,MAAM,CAACa,YAPP;AAQhBC,UAAI,EAAE,CAACd,MAAM,CAACe,QAAP,KAAoB,QAApB,GAA+B,EAA/B,GAAoCf,MAAM,CAACe,QAAP,GAAkB,GAAvD,KAA+Df,MAAM,CAACc,IAAP,GAAcd,MAAM,CAACc,IAArB,GAA4B,EAA3F;AARU,KAApB;AAUH;;AACD,OAAK,IAAI9P,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+O,QAAQ,CAACjP,MAA7B,EAAqCE,CAAC,EAAtC,EAA0C;AACtC,UAAMgQ,QAAQ,GAAGjB,QAAQ,CAAC/O,CAAD,CAAR,CAAYiQ,SAA7B;AACA,UAAMvR,EAAE,GAAG,UAAUsB,CAArB;AACAgO,WAAO,CAACE,KAAR,CAAcxP,EAAd,IAAoB;AAChBA,QADgB;AAEhBwR,SAAG,EAAE,CAACF,QAAQ,CAACG,MAAT,CAAgB,CAAhB,EAAmBC,OAAnB,CAA2B,KAA3B,EAAkC,KAAlC,CAAD,EAA2CJ,QAAQ,CAACG,MAAT,CAAgB,CAAhB,CAA3C,CAFW;AAGhBE,UAAI,EAAE,CAACL,QAAQ,CAACM,WAAT,CAAqB,CAArB,EAAwBF,OAAxB,CAAgC,KAAhC,EAAuC,KAAvC,CAAD,EAAgDJ,QAAQ,CAACM,WAAT,CAAqB,CAArB,CAAhD;AAHU,KAApB;AAKH;;AACD,SAAOtC,OAAP;AACH,CAtCM;AAwCA,MAAMuC,MAAM,GAAIzC,SAAD,IAAwC;AAC1D,QAAMK,UAAkC,GAAG;AACvCF,SAAK,EAAE,EADgC;AAEvCC,SAAK,EAAE,EAFgC;AAGvCsB,QAAI,EAAE/H,SAHiC;AAIvC6G,WAAO,EAAExF,WAAW,CAACgF,SAAS,CAACM,KAAV,CAAgBC,OAAjB,CAJmB;AAKvCG,mBAAe,EAAE1F,WAAW,CAACgF,SAAS,CAACM,KAAV,CAAgBG,cAAjB,CALW;AAMvCI,YAAQ,EAAEb,SAAS,CAACM,KAAV,CAAgBM,IANa;AAOvCG,sBAAkB,EAAE,CAACf,SAAS,CAACM,KAAV,CAAgBQ;AAPE,GAA3C;;AASA,OAAK,MAAMlQ,EAAX,IAAiBoP,SAAS,CAACG,KAA3B,EAAkC;AAC9B,UAAMgB,GAAG,GAAGnB,SAAS,CAACG,KAAV,CAAgBvP,EAAhB,CAAZ;AACA,UAAMwQ,KAAK,GAAGC,QAAQ,CAACzQ,EAAE,CAACuK,KAAH,CAAS,KAAT,EAAgB,CAAhB,CAAD,CAAtB;AACAkF,cAAU,CAACF,KAAX,CAAiBlB,IAAjB,CAAsB;AAClBkC,SAAG,EAAE;AACDvQ,UAAE,gBAASwQ,KAAT,CADD;AAEDa,gBAAQ,EAAE,QAFT;AAGDV,iBAAS,EAAEJ,GAAG,CAACG,MAHd;AAIDG,kBAAU,EAAEN,GAAG,CAACK,OAJf;AAKDG,qBAAa,EAAER,GAAG,CAACO,IALlB;AAMDK,oBAAY,EAAE,CAACZ,GAAG,CAACY,YANlB;AAODD,kBAAU,EAAE,CAACX,GAAG,CAACW,UAPhB;AAQDE,YAAI,EAAEb,GAAG,CAACa;AART;AADa,KAAtB;AAYH;;AACD,OAAK,MAAMpR,EAAX,IAAiBoP,SAAS,CAACI,KAA3B,EAAkC;AAC9B,UAAMsC,IAAI,GAAG1C,SAAS,CAACI,KAAV,CAAgBxP,EAAhB,CAAb;AACAyP,cAAU,CAACD,KAAX,CAAiBnB,IAAjB,CAAsB;AAClBkD,eAAS,EAAE;AACPE,cAAM,EAAE,CAACK,IAAI,CAACN,GAAL,CAAS,CAAT,EAAYE,OAAZ,CAAoB,KAApB,EAA2B,KAA3B,CAAD,EAAoCI,IAAI,CAACN,GAAL,CAAS,CAAT,CAApC,CADD;AAEPI,mBAAW,EAAE,CAACE,IAAI,CAACH,IAAL,CAAU,CAAV,EAAaD,OAAb,CAAqB,KAArB,EAA4B,KAA5B,CAAD,EAAqCI,IAAI,CAACH,IAAL,CAAU,CAAV,CAArC;AAFN;AADO,KAAtB;AAMH;;AACD,SAAO;AAAErC,WAAO,EAAEG;AAAX,GAAP;AACH,CApCM;AAsCA,MAAMsC,mBAAmB,GAAG,CAACxP,MAAD,EAAiByP,IAAjB,WAA4G;AAAA,MAAzE;AAAEnL,cAAU,GAAG,KAAf;AAAsBoL,OAAG,GAAG,EAA5B;AAAgCC,mBAAe,GAAG,CAAlD;AAAqDC,YAAQ,GAAG;AAAhE,GAAyE;AAC3I,MAAIH,IAAI,KAAK,QAAb,EAAuB,OAAO;AAAEA,QAAF;AAAQI,OAAG,EAAE7P,MAAM,CAACwH,QAAP,EAAb;AAAgC5J,SAAK,EAAEoC,MAAvC;AAA+C8P,UAAM,EAAE,CAAC9P,MAAD;AAAvD,GAAP;AACvB,QAAM+P,YAAY,GAAG/P,MAAM,GAAG,IAAT,GAAgBsE,UAArC;AACA,QAAM0L,SAAS,GAAG9P,IAAI,CAACuE,KAAL,CAAWsL,YAAX,CAAlB;;AACA,MAAIN,IAAI,KAAK,SAAb,EAAwB;AACpB,UAAMQ,IAAI,GAAGP,GAAG,GAAGE,QAAN,GAAiB,KAA9B;AACA,UAAMM,cAAc,GAAGD,IAAI,GAAGF,YAA9B;AACA,UAAMI,qBAAqB,GAAGF,IAAI,GAAGF,YAArC;AACA,UAAMK,SAAS,GAAG,CAAC,EAAED,qBAAqB,GAAGP,QAA1B,CAAnB;AACA,UAAMS,KAAK,GAAG,CAAC,EAAEF,qBAAqB,GAAGP,QAA1B,CAAD,GAAuCD,eAAvC,GAAyD,CAAvE;AACA,UAAMW,OAAO,GAAG,CAAC,EAAEH,qBAAqB,GAAGR,eAAxB,GAA0CC,QAA5C,CAAD,GAAyD,CAAzE;AACA,UAAMC,GAAG,aAAMS,OAAN,cAAiBD,KAAjB,cAA0BD,SAAS,CAAC5I,QAAV,GAAqB+I,QAArB,CAA8B,CAA9B,EAAiC,GAAjC,CAA1B,CAAT;AACA,WAAO;AAAEd,UAAF;AAAQI,SAAR;AAAajS,WAAK,EAAEsS,cAAc,GAAGN,QAArC;AAA+CE,YAAM,EAAE,CAACQ,OAAD,EAAUD,KAAV,EAAiBD,SAAjB;AAAvD,KAAP;AACH,GAb0I,CAc3I;;;AACA,QAAMI,EAAE,GAAGR,SAAS,GAAG,IAAvB;AACA,QAAM9H,CAAC,GAAG,CAAC,EAAE8H,SAAS,GAAG,IAAd,CAAD,GAAuB,EAAjC;AACA,QAAM7M,GAAG,GAAG,CAAC,EAAE6M,SAAS,GAAG,KAAd,CAAD,GAAwB,EAApC;AACA,QAAMS,CAAC,GAAG,CAAC,EAAET,SAAS,GAAG,OAAd,CAAX;AACA,QAAMH,GAAG,GAAG,CAAC1M,GAAD,aAAU+E,CAAV,cAAesI,EAAE,CAAChJ,QAAH,GAAc+I,QAAd,CAAuB,CAAvB,EAA0B,GAA1B,CAAf,IACN,CAACE,CAAD,aAAQtN,GAAR,cAAe+E,CAAC,CAACV,QAAF,GAAa+I,QAAb,CAAsB,CAAtB,EAAyB,GAAzB,CAAf,cAAgDC,EAAE,CAAChJ,QAAH,GAAc+I,QAAd,CAAuB,CAAvB,EAA0B,GAA1B,CAAhD,cACOE,CADP,cACYtN,GAAG,CAACqE,QAAJ,GAAe+I,QAAf,CAAwB,CAAxB,EAA2B,GAA3B,CADZ,cAC+CrI,CAAC,CAACV,QAAF,GAAa+I,QAAb,CAAsB,CAAtB,EAAyB,GAAzB,CAD/C,cACgFC,EAAE,CAAChJ,QAAH,GAAc+I,QAAd,CAAuB,CAAvB,EAA0B,GAA1B,CADhF,CADN;AAGA,SAAO;AAAEd,QAAF;AAAQI,OAAR;AAAajS,SAAK,EAAEmS,YAAY,GAAG,IAAnC;AAAyCD,UAAM,EAAE,CAACW,CAAD,EAAItN,GAAJ,EAAS+E,CAAT,EAAYsI,EAAZ;AAAjD,GAAP;AACH,CAvBM;AAwBA,MAAME,kBAAkB,GAAG,2BAA3B;AACA,MAAMC,eAAe,GAAG,qCAAxB;AACA,MAAMC,mBAAmB,GAAG,CAACf,GAAD,EAAcJ,IAAd,YAAyG;AAAA,MAAzE;AAAEnL,cAAU,GAAG,KAAf;AAAsBoL,OAAG,GAAG,EAA5B;AAAgCC,mBAAe,GAAG,CAAlD;AAAqDC,YAAQ,GAAG;AAAhE,GAAyE;AACxI,MAAIH,IAAI,KAAK,QAAb,EAAuB,OAAO,CAACI,GAAD,IAAQ,CAAf;;AACvB,MAAIJ,IAAI,KAAK,SAAb,EAAwB;AACpB,UAAM1H,OAAO,GAAG8H,GAAG,CAAC7H,KAAJ,CAAU0I,kBAAV,CAAhB;AACA,QAAI,CAAC3I,OAAL,EAAc,MAAM,IAAI7I,KAAJ,kBAAoB2Q,GAApB,kCAA+CJ,IAA/C,EAAN;AACd,UAAM,IAAKoB,SAAL,EAAgBC,OAAhB,EAAyBC,WAAzB,IAAwChJ,OAA9C;AACA,UAAMiJ,GAAG,GAAGtB,GAAG,GAAG,EAAlB;AACA,UAAMuB,cAAc,GAAG3M,UAAU,GAAG0M,GAApC;AACA,QAAIE,QAAQ,GAAG,CAACL,SAAD,IAAc,CAA7B;AACA,QAAIR,KAAK,GAAG,CAACS,OAAD,IAAY,CAAxB;AACA,QAAIV,SAAS,GAAG,CAACW,WAAD,IAAgB,CAAhC;AACAV,SAAK,IAAI,CAAC,EAAED,SAAS,GAAGR,QAAd,CAAV;AACAQ,aAAS,IAAIR,QAAb;AACAsB,YAAQ,IAAI,CAAC,EAAEb,KAAK,GAAGV,eAAV,CAAb;AACAU,SAAK,IAAIV,eAAT;AACA,WAAO,CAACuB,QAAQ,GAAGvB,eAAX,GAA6BU,KAA7B,GAAqCD,SAAS,GAAGR,QAAlD,IAA8DqB,cAArE;AACH;;AACD,QAAMlJ,OAAO,GAAG8H,GAAG,CAAC7H,KAAJ,CAAU2I,eAAV,CAAhB;AACA,MAAI,CAAC5I,OAAL,EAAc,MAAM,IAAI7I,KAAJ,kBAAoB2Q,GAApB,kCAA+CJ,IAA/C,EAAN;AACd,QAAM,IAAK0B,GAAL,GAAYC,KAAZ,EAAmBhJ,GAAnB,EAAwBiJ,IAAxB,IAAgCtJ,OAAtC;AACA,MAAI0I,CAAC,GAAG,CAACU,GAAD,IAAQ,CAAhB;AACA,MAAIhO,GAAG,GAAG,CAACiO,KAAD,IAAU,CAApB;AACA,MAAIlJ,CAAC,GAAG,CAACE,GAAD,IAAQ,CAAhB;AACA,MAAIoI,EAAE,GAAG,CAACa,IAAD,IAAS,CAAlB;AACAnJ,GAAC,IAAI,CAAC,EAAEsI,EAAE,GAAG,IAAP,CAAN;AACAA,IAAE,IAAI,IAAN;AACArN,KAAG,IAAI,CAAC,EAAE+E,CAAC,GAAG,EAAN,CAAR;AACAA,GAAC,IAAI,EAAL;AACAuI,GAAC,IAAI,CAAC,EAAEtN,GAAG,GAAG,EAAR,CAAN;AACAA,KAAG,IAAI,EAAP;AACA,SAAO,CAACsN,CAAC,GAAG,IAAJ,GAAWtN,GAAG,GAAG,EAAjB,GAAsB+E,CAAtB,GAA0BsI,EAAE,GAAG,IAAhC,IAAwClM,UAA/C;AACH,CA/BM;AAiCA,MAAMgN,MAAM,GAAIC,EAAD,IAAyC;AAC3D,MAAIA,EAAE,YAAYC,WAAlB,EAA+B,OAAOD,EAAP;AAC/B,QAAME,GAAG,GAAG,IAAIC,iBAAJ,CAAsBH,EAAE,CAACI,UAAzB,CAAZ;AACA,QAAMC,KAAK,GAAG,IAAI3K,UAAJ,CAAesK,EAAf,CAAd;AACA,QAAMM,MAAM,GAAG,IAAI5K,UAAJ,CAAewK,GAAf,CAAf;;AACA,OAAK,IAAI1S,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6S,KAAK,CAAC/S,MAA1B,EAAkCE,CAAC,EAAnC,EAAuC;AACnC8S,UAAM,CAAC9S,CAAD,CAAN,GAAY6S,KAAK,CAAC7S,CAAD,CAAjB;AACH;;AACD,SAAO0S,GAAP;AACH,CATM;AAWA,MAAMK,MAAM,GAAIL,GAAD,IAA0C;AAC5D,MAAIA,GAAG,YAAYC,iBAAnB,EAAsC,OAAOD,GAAP;AACtC,QAAMF,EAAE,GAAG,IAAIC,WAAJ,CAAgBC,GAAG,CAACE,UAApB,CAAX;AACA,QAAMC,KAAK,GAAG,IAAI3K,UAAJ,CAAesK,EAAf,CAAd;AACA,QAAMM,MAAM,GAAG,IAAI5K,UAAJ,CAAewK,GAAf,CAAf;;AACA,OAAK,IAAI1S,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8S,MAAM,CAAChT,MAA3B,EAAmCE,CAAC,EAApC,EAAwC;AACpC6S,SAAK,CAAC7S,CAAD,CAAL,GAAW8S,MAAM,CAAC9S,CAAD,CAAjB;AACH;;AACD,SAAOwS,EAAP;AACH,CATM;AAUA,MAAMQ,MAAM,GAAIC,GAAD,IAAsB;AACxC,SAAOC,MAAM,CAACC,YAAP,CAAoBC,KAApB,CAA0B,IAA1B,EAAgC,IAAIC,WAAJ,CAAgBJ,GAAhB,CAAhC,CAAP;AACH,CAFM;AAIA,MAAMK,MAAM,GAAIxC,GAAD,IAAiB;AACnC,QAAMmC,GAAG,GAAG,IAAIR,WAAJ,CAAgB3B,GAAG,CAAChR,MAAJ,GAAa,CAA7B,CAAZ,CADmC,CACU;;AAC7C,QAAMyT,OAAO,GAAG,IAAIF,WAAJ,CAAgBJ,GAAhB,CAAhB;;AACA,OAAK,IAAIjT,CAAC,GAAG,CAAR,EAAWwT,MAAM,GAAG1C,GAAG,CAAChR,MAA7B,EAAqCE,CAAC,GAAGwT,MAAzC,EAAiDxT,CAAC,EAAlD,EAAsD;AAClDuT,WAAO,CAACvT,CAAD,CAAP,GAAa8Q,GAAG,CAAC2C,UAAJ,CAAezT,CAAf,CAAb;AACH;;AACD,SAAOiT,GAAP;AACH,CAPM,C;;;;;;;;;;;;;;ACrWP,MAAMS,MAAM,GAAG,CAACC,QAAD,EAAyBC,QAAzB,KAA2D;AACtE,QAAM;AAAE1Q,aAAS,GAAG,GAAd;AAAmBqC,cAAU,GAAG,KAAhC;AAAuCsO,wBAAoB,GAAG;AAA9D,MAAsED,QAA5E;AACA,MAAIE,UAAU,GAAG,CAAjB;;AACA,SAAOA,UAAU,GAAGH,QAAQ,CAAC7T,MAA7B,EAAqC;AACjCgU,cAAU,IAAI,CAAd;AACH;;AACDA,YAAU,IAAI,CAAd;AAEA,QAAMC,aAAa,GAAGD,UAAU,GAAG,CAAnC;AACA,QAAME,SAAS,GAAG,IAAI7O,YAAJ,CAAiB4O,aAAjB,CAAlB;AAEA,MAAIE,IAAI,GAAG,CAAX;AACA,MAAIC,GAAJ;AACA,MAAIC,KAAJ;;AAEA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,aAApB,EAAmCK,CAAC,EAApC,EAAwC;AACpC,SAAK,IAAIpU,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+T,aAApB,EAAmC/T,CAAC,EAApC,EAAwC;AACpCmU,WAAK,GAAGR,QAAQ,CAAC3T,CAAD,CAAR,GAAc2T,QAAQ,CAAC3T,CAAC,GAAGoU,CAAL,CAA9B;AACAJ,eAAS,CAACI,CAAD,CAAT,IAAgBD,KAAK,GAAGA,KAAxB;AACH;AACJ;;AACDH,WAAS,CAAC,CAAD,CAAT,GAAe,CAAf;AACAA,WAAS,CAAC,CAAD,CAAT,GAAe,CAAf;AACA,MAAIK,UAAU,GAAG,CAAjB;;AACA,OAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,aAApB,EAAmCK,CAAC,EAApC,EAAwC;AACpCC,cAAU,IAAIL,SAAS,CAACI,CAAD,CAAvB;AACAJ,aAAS,CAACI,CAAD,CAAT,IAAgBA,CAAC,GAAGC,UAApB;AACH;;AACD,OAAKH,GAAG,GAAG,CAAX,EAAcA,GAAG,GAAGH,aAApB,EAAmCG,GAAG,EAAtC,EAA0C;AACtC,QAAIF,SAAS,CAACE,GAAD,CAAT,GAAiBhR,SAArB,EAAgC;AAC5B,aAAOgR,GAAG,GAAG,CAAN,GAAUH,aAAV,IAA2BC,SAAS,CAACE,GAAG,GAAG,CAAP,CAAT,GAAqBF,SAAS,CAACE,GAAD,CAAhE,EAAuE;AACnEA,WAAG;AACN;;AACDD,UAAI,GAAG,IAAID,SAAS,CAACE,GAAD,CAApB;AACA;AACH;AACJ;;AACD,MAAIA,GAAG,KAAKH,aAAR,IAAyBC,SAAS,CAACE,GAAD,CAAT,IAAkBhR,SAA/C,EAA0D;AACtD,WAAO,IAAP;AACH;;AACD,MAAI+Q,IAAI,GAAGJ,oBAAX,EAAiC;AAC7B,WAAO,IAAP;AACH;;AACD,MAAIS,SAAJ;AACA,MAAIC,EAAJ;AACA,MAAIC,EAAJ;;AACA,MAAIN,GAAG,GAAG,CAAV,EAAa;AACTK,MAAE,GAAGL,GAAL;AACH,GAFD,MAEO;AACHK,MAAE,GAAGL,GAAG,GAAG,CAAX;AACH;;AACD,MAAIA,GAAG,GAAG,CAAN,GAAUH,aAAd,EAA6B;AACzBS,MAAE,GAAGN,GAAG,GAAG,CAAX;AACH,GAFD,MAEO;AACHM,MAAE,GAAGN,GAAL;AACH;;AACD,MAAIK,EAAE,KAAKL,GAAX,EAAgB;AACZ,QAAIF,SAAS,CAACE,GAAD,CAAT,IAAkBF,SAAS,CAACQ,EAAD,CAA/B,EAAqC;AACjCF,eAAS,GAAGJ,GAAZ;AACH,KAFD,MAEO;AACHI,eAAS,GAAGE,EAAZ;AACH;AACJ,GAND,MAMO,IAAIA,EAAE,KAAKN,GAAX,EAAgB;AACnB,QAAIF,SAAS,CAACE,GAAD,CAAT,IAAkBF,SAAS,CAACO,EAAD,CAA/B,EAAqC;AACjCD,eAAS,GAAGJ,GAAZ;AACH,KAFD,MAEO;AACHI,eAAS,GAAGC,EAAZ;AACH;AACJ,GANM,MAMA;AACH,UAAME,EAAE,GAAGT,SAAS,CAACO,EAAD,CAApB;AACA,UAAMG,EAAE,GAAGV,SAAS,CAACE,GAAD,CAApB;AACA,UAAMS,EAAE,GAAGX,SAAS,CAACQ,EAAD,CAApB;AACAF,aAAS,GAAGJ,GAAG,GAAG,CAACS,EAAE,GAAGF,EAAN,KAAa,KAAK,IAAIC,EAAJ,GAASC,EAAT,GAAcF,EAAnB,CAAb,CAAlB;AACH;;AAED,SAAOlP,UAAU,GAAG+O,SAApB;AACH,CA5ED;;AA6EA,iEAAeZ,MAAf,E;;;;;;UCnFA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,wCAAwC,yCAAyC;WACjF;WACA;WACA,E;;;;;WCPA,wF;;;;;WCAA;WACA;WACA;WACA,sDAAsD,kBAAkB;WACxE;WACA,+CAA+C,cAAc;WAC7D,E;;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AAGA;AAEA,MAAMkB,WAAW,GAAG,8BAApB;AAEA,IAAI,CAAChX,UAAU,CAAC+U,iBAAhB,EAAmC/U,UAAU,CAAC+U,iBAAX,GAA+BF,WAA/B;AACnC,MAAM;AAAEoC,mBAAF;AAAqBtP;AAArB,IAAoC3H,UAA1C;AAEA;AACA;AACA;;AACA,MAAMkX,qBAAN,CAA4B;AAKxB;AACS,MAALC,KAAK,GAAW;AAChB,WAAO,KAAKC,MAAL,CAAY,CAAZ,CAAP;AACH;;AACQ,MAALD,KAAK,CAAClW,KAAD,EAAgB;AACrB,SAAKmW,MAAL,CAAY,CAAZ,IAAiBnW,KAAjB;AACH;AACD;;;AACU,MAANoW,MAAM,GAAW;AACjB,WAAO,KAAKC,OAAL,CAAa,CAAb,CAAP;AACH;;AACS,MAAND,MAAM,CAACpW,KAAD,EAAgB;AACtB,SAAKqW,OAAL,CAAa,CAAb,IAAkBrW,KAAlB;AACH;AACD;;;AACU,MAANsW,MAAM,GAAW;AACjB,WAAO,KAAKC,OAAL,CAAa,CAAb,CAAP;AACH;;AACS,MAAND,MAAM,CAACtW,KAAD,EAAgB;AACtB,SAAKuW,OAAL,CAAa,CAAb,IAAkBvW,KAAlB;AACH;AACD;;;AACY,MAARwW,QAAQ,GAAG;AACX,WAAO;AAAEJ,YAAM,EAAE,KAAKC,OAAf;AAAwBH,WAAK,EAAE,KAAKC,MAApC;AAA4CG,YAAM,EAAE,KAAKC;AAAzD,KAAP;AACH;;AACDrX,aAAW,GAAG;AAAA;;AAAA;;AAAA;;AAAA;;AACV,SAAKuX,IAAL,GAAY,IAAI3C,iBAAJ,CAAsB,IAAI4C,WAAW,CAACC,iBAAtC,CAAZ;AACA,SAAKR,MAAL,GAAc,IAAIO,WAAJ,CAAgB,KAAKD,IAArB,EAA2B,CAA3B,EAA8B,CAA9B,CAAd;AACA,SAAKJ,OAAL,GAAe,IAAIK,WAAJ,CAAgB,KAAKD,IAArB,EAA2B,CAA3B,EAA8B,CAA9B,CAAf;AACA,SAAKF,OAAL,GAAe,IAAIG,WAAJ,CAAgB,KAAKD,IAArB,EAA2B,CAA3B,EAA8B,CAA9B,CAAf;AACH;;AAnCuB;;AAqC5B,MAAMG,yBAAN,SAAwCC,gEAAxC,CAAwL;AAAA;AAAA;;AAAA,uCAShK,KATgK;;AAAA,mCAU3J,IAAIZ,qBAAJ,EAV2J;;AAAA,uCAYlI,EAZkI;;AAAA,oCAc1I,EAd0I;;AAAA,yCAkE9J,IAlE8J;AAAA;;AACrJ,aAApBa,oBAAoB,GAA4D;AACvF,WAAO,CAAC;AACJC,kBAAY,EAAE,IADV;AAEJC,cAAQ,EAAE,KAAK,EAFX;AAGJC,cAAQ,EAAE,GAHN;AAIJtW,UAAI,EAAE;AAJF,KAAD,CAAP;AAMH;;AAOD;AACS,MAALuV,KAAK,GAAG;AACR,WAAO,KAAKgB,KAAL,CAAWhB,KAAlB;AACH;;AACQ,MAALA,KAAK,CAAClW,KAAD,EAAgB;AACrB,SAAKkX,KAAL,CAAWhB,KAAX,GAAmBlW,KAAnB;AACH;AACD;;;AACU,MAANoW,MAAM,GAAG;AACT,WAAO,KAAKc,KAAL,CAAWd,MAAlB;AACH;;AACS,MAANA,MAAM,CAACpW,KAAD,EAAgB;AACtB,SAAKkX,KAAL,CAAWd,MAAX,GAAoBpW,KAApB;AACH;AACD;;;AACU,MAANsW,MAAM,GAAG;AACT,WAAO,KAAKY,KAAL,CAAWZ,MAAlB;AACH;;AACS,MAANA,MAAM,CAACtW,KAAD,EAAgB;AACtB,SAAKkX,KAAL,CAAWZ,MAAX,GAAoBtW,KAApB;AACH;;AACDmX,QAAM,GAAG;AACL,WAAO,KAAK5L,MAAL,CAAY1C,GAAZ,CAAgBvB,CAAC,IAAIjF,kDAAG,CAACiF,CAAD,EAAI,KAAK4O,KAAT,EAAgB,KAAKkB,UAArB,CAAxB,CAAP;AACH;;AACDC,WAAS,GAAG;AACR,WAAO,KAAK9L,MAAL,CAAY1C,GAAZ,CAAgBvB,CAAC,IAAI9E,qDAAM,CAAC8E,CAAD,EAAI,KAAK4O,KAAT,EAAgB,KAAKkB,UAArB,CAA3B,CAAP;AACH;;AACDE,QAAM,GAAG;AACL,WAAO,KAAK/L,MAAL,CAAY1C,GAAZ,CAAgBvB,CAAC,IAAI5E,kDAAG,CAAC4E,CAAD,EAAI,KAAK4O,KAAT,EAAgB,KAAKkB,UAArB,CAAxB,CAAP;AACH;;AACDG,kBAAgB,CAAClT,SAAD,EAAqB2Q,oBAArB,EAAoD;AAChE,WAAO,KAAKzJ,MAAL,CAAY1C,GAAZ,CAAgB2O,EAAE,IAAIC,mDAAW,CAACD,EAAD,EAAK;AAAE9Q,gBAAF;AAAcrC,eAAd;AAAyB2Q;AAAzB,KAAL,CAAjC,CAAP;AACH;;AACD0C,WAAS,GAAG;AACR,UAAMxX,IAAI,GAAG,KAAKqL,MAAlB;AACA,UAAM;AAAE2K,WAAF;AAASE,YAAT;AAAiBE;AAAjB,QAA4B,KAAKY,KAAL,CAAWV,QAA7C;AACA,WAAO;AAAEtW,UAAF;AAAQgW,WAAR;AAAeE,YAAf;AAAuBE;AAAvB,KAAP;AACH;;AACDqB,MAAI,GAAqD;AACrD,UAAMC,MAAiC,GAAG,EAA1C;;AADqD,sCAAfC,QAAe;AAAfA,cAAe;AAAA;;AAErD,SAAK,MAAMxJ,GAAX,IAAkBwJ,QAAlB,EAA4B;AACxB,UAAI,OAAOxJ,GAAP,KAAe,QAAf,IAA2B,CAACA,GAAG,CAACpN,MAApC,EAA4C;AAC5C,YAAM6W,MAAM,gBAASzJ,GAAG,CAAC0J,MAAJ,CAAW,CAAX,EAAcC,WAAd,EAAT,SAAuC3J,GAAG,CAAC3M,KAAJ,CAAU,CAAV,CAAvC,CAAZ;AACA,UAAI,KAAKoW,MAAL,CAAJ,EAAkBF,MAAM,CAACvJ,GAAD,CAAN,GAAc,KAAKyJ,MAAL,GAAd;AACrB;;AACD,WAAOF,MAAP;AACH;;AACDK,SAAO,GAAG;AACN,SAAKC,SAAL,GAAiB,IAAjB;AACA,SAAK7X,SAAL,GAAiB,IAAjB;AACH;;AAEa,MAAV+W,UAAU,GAAG;AACb,WAAO,KAAKe,WAAZ;AACH;;AACa,MAAVf,UAAU,CAACgB,MAAD,EAAiB;AAC3B,SAAKD,WAAL,GAAmB,CAAC,CAAC7V,IAAI,CAACiD,GAAL,CAAS,KAAK,EAAd,EAAkBjD,IAAI,CAACN,GAAL,CAAS,GAAT,EAAcoW,MAAM,IAAI,IAAxB,CAAlB,CAArB;AACH;;AACDC,SAAO,CAACC,MAAD,EAA2BC,OAA3B,EAAsDC,UAAtD,EAAoH;AACvH,QAAI,KAAKN,SAAT,EAAoB,OAAO,KAAP;AACpB,UAAMO,KAAK,GAAGH,MAAM,CAAC,CAAD,CAApB;AACA,SAAKlB,UAAL,GAAkB,CAAC,CAACoB,UAAU,CAACpB,UAAX,CAAsB,CAAtB,CAApB;AACA,UAAM;AAAEA;AAAF,QAAiB,IAAvB;;AAEA,QAAI,KAAK7L,MAAL,CAAYtK,MAAZ,GAAqBwX,KAAK,CAACxX,MAA/B,EAAuC;AAAE;AACrC,WAAKyX,SAAL,CAAeC,MAAf,CAAsBF,KAAK,CAACxX,MAA5B;AACA,WAAKsK,MAAL,CAAYoN,MAAZ,CAAmBF,KAAK,CAACxX,MAAzB;AACH;;AACD,QAAIwX,KAAK,CAACxX,MAAN,KAAiB,CAArB,EAAwB,OAAO,IAAP;AAExB,UAAMgU,UAAU,GAAG3S,IAAI,CAACN,GAAL,CAAS,GAAGyW,KAAK,CAAC5P,GAAN,CAAU+P,CAAC,IAAIA,CAAC,CAAC3X,MAAjB,CAAZ,KAAyC,GAA5D;AAEA,UAAM4X,QAAQ,GAAGzB,UAAU,GAAG1Q,UAA9B;AACA,SAAK0P,MAAL,IAAeyC,QAAf;AACA,SAAKvC,MAAL,IAAerB,UAAf;AACA,QAAI;AAAEmB;AAAF,QAAa,IAAjB,CAjBuH,CAkBvH;;AACA,SAAK,IAAIjV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsX,KAAK,CAACxX,MAA1B,EAAkCE,CAAC,EAAnC,EAAuC;AACnCiV,YAAM,GAAG,KAAKA,MAAd;;AACA,UAAI,CAAC,KAAK7K,MAAL,CAAYpK,CAAZ,CAAL,EAAqB;AAAE;AACnB,aAAKuX,SAAL,CAAevX,CAAf,IAAoB,IAAI2S,iBAAJ,CAAsB+E,QAAQ,GAAGvS,YAAY,CAACqQ,iBAA9C,CAApB;AACA,aAAKpL,MAAL,CAAYpK,CAAZ,IAAiB,IAAImF,YAAJ,CAAiB,KAAKoS,SAAL,CAAevX,CAAf,CAAjB,CAAjB;AACH,OAHD,MAGO;AACH,YAAI,KAAKoK,MAAL,CAAYpK,CAAZ,EAAeF,MAAf,KAA0B4X,QAA9B,EAAwC;AAAE;AACtC,gBAAMC,SAAS,GAAG,KAAKvN,MAAL,CAAYpK,CAAZ,CAAlB;AACA,gBAAMuX,SAAS,GAAG,IAAI5E,iBAAJ,CAAsB+E,QAAQ,GAAGvS,YAAY,CAACqQ,iBAA9C,CAAlB;AACA,gBAAMpL,MAAM,GAAG,IAAIjF,YAAJ,CAAiBoS,SAAjB,CAAf;AACAtC,gBAAM,GAAGpR,4DAAa,CAACuG,MAAD,EAASuN,SAAT,EAAoB,CAApB,EAAuB1C,MAAM,GAAG9T,IAAI,CAACiD,GAAL,CAASsT,QAAT,EAAmBC,SAAS,CAAC7X,MAA7B,CAAhC,CAAtB;AACA,eAAKyX,SAAL,CAAevX,CAAf,IAAoBuX,SAApB;AACA,eAAKnN,MAAL,CAAYpK,CAAZ,IAAiBoK,MAAjB;AACH;AACJ;AACJ;;AACD,SAAK6K,MAAL,GAAcA,MAAd,CAnCuH,CAoCvH;;AACA,SAAK,IAAIjV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsX,KAAK,CAACxX,MAA1B,EAAkCE,CAAC,EAAnC,EAAuC;AACnC,YAAMoK,MAAM,GAAG,KAAKA,MAAL,CAAYpK,CAAZ,CAAf;AACA,YAAM4X,OAAO,GAAGN,KAAK,CAACtX,CAAD,CAAL,CAASF,MAAT,GAAkBwX,KAAK,CAACtX,CAAD,CAAvB,GAA6B,IAAImF,YAAJ,CAAiB2O,UAAjB,CAA7C;;AACA,UAAIA,UAAU,GAAG4D,QAAjB,EAA2B;AACvBzC,cAAM,GAAGpR,4DAAa,CAACuG,MAAD,EAASwN,OAAO,CAAChT,QAAR,CAAiBkP,UAAU,GAAG4D,QAA9B,CAAT,EAAkD,KAAKzC,MAAvD,CAAtB;AACH,OAFD,MAEO;AACHA,cAAM,GAAGpR,4DAAa,CAACuG,MAAD,EAASwN,OAAT,EAAkB,KAAK3C,MAAvB,CAAtB;AACH;AACJ;;AACD,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKF,KAAL,GAAaxQ,gDAAG,CAAC0Q,MAAM,GAAGgB,UAAV,EAAsByB,QAAtB,CAAhB;AACA,WAAO,IAAP;AACH;;AA1HmL;;AA4HxL,IAAI;AACA7C,mBAAiB,CAACD,WAAD,EAAca,yBAAd,CAAjB;AACH,CAFD,CAEE,OAAO3W,KAAP,EAAc;AACZ;AACA+Y,SAAO,CAACC,IAAR,CAAahZ,KAAb;AACH,C","file":"js/7ae8201faea4de318b7a.worklet.js","sourcesContent":["import { AudioWorkletGlobalScope, MessagePortRequest, MessagePortResponse, TypedMessageEvent } from \"./TypedAudioWorklet\";\nimport { AudioWorkletProxyProcessor } from \"./AudioWorkletProxyProcessor.types\";\n\ndeclare const globalThis: AudioWorkletGlobalScope;\nconst { AudioWorkletProcessor } = globalThis;\n\nconst Processor = class extends AudioWorkletProcessor {\n    static get fnNames(): string[] {\n        return [];\n    }\n    _disposed = false;\n    constructor(options: AudioWorkletNodeOptions) {\n        super(options);\n        const resolves: Record<number, ((...args: any[]) => any)> = {};\n        const rejects: Record<number, ((...args: any[]) => any)> = {};\n        let messagePortRequestId = -1;\n        const handleDisposed = () => {\n            this.port.removeEventListener(\"message\", handleMessage);\n            this.port.close();\n        };\n        const handleMessage = async (e: TypedMessageEvent<MessagePortResponse & MessagePortRequest>) => {\n            const { id, call, args, value, error } = e.data;\n            if (call) {\n                const r: MessagePortResponse = { id };\n                try {\n                    r.value = await (this as any)[call](...args);\n                } catch (e) {\n                    r.error = e;\n                }\n                this.port.postMessage(r as any);\n                if (this._disposed) handleDisposed();\n            } else {\n                if (error) {\n                    if (rejects[id]) rejects[id](error);\n                    delete rejects[id];\n                    return;\n                }\n                if (resolves[id]) {\n                    resolves[id](value);\n                    delete resolves[id];\n                }\n            }\n        };\n        const call = (call: string, ...args: any[]) => new Promise<any>((resolve, reject) => {\n            const id = messagePortRequestId--;\n            resolves[id] = resolve;\n            rejects[id] = reject;\n            this.port.postMessage({ id, call, args });\n        });\n        const Ctor = (this.constructor as typeof AudioWorkletProxyProcessor);\n        Ctor.fnNames.forEach(name => (this as any)[name] = (...args: any[]) => call(name, ...args));\n        this.port.start();\n        this.port.addEventListener(\"message\", handleMessage);\n    }\n} as typeof AudioWorkletProxyProcessor;\n\nexport default Processor;\n","import { mod } from \"./math\";\n\ntype TypedArray = Int8Array | Uint8Array | Int16Array | Uint16Array | Int32Array | Uint32Array | Uint8ClampedArray | Float32Array | Float64Array;\ntype TypedArrayConstructor = typeof Int8Array | typeof Uint8Array | typeof Int16Array | typeof Uint16Array | typeof Int32Array | typeof Uint32Array | typeof Uint8ClampedArray | typeof Float32Array | typeof Float64Array;\nexport const sum = (array: TypedArray | number[], from = 0, length = array.length) => {\n    let sum = 0;\n    const l = array.length;\n    for (let i = 0; i < length; i++) {\n        sum += array[(from + i) % l];\n    }\n    return sum;\n};\nexport const mean = (array: TypedArray | number[], from = 0, length = array.length) => sum(array, from, length) / length;\nexport const median = (array: TypedArray | number[], from = 0, length = array.length) => {\n    if (length === 0) throw new Error(\"trying to calculate median of empty array\");\n    const sortedArray = (from + length > array.length ? Array.isArray(array) ? array.slice(from).concat(array.slice(0, from + length - array.length)) : sliceBuffer(array, length, from) : array.slice(from, from + length)).sort();\n    if (length % 2 === 0) return (sortedArray[length / 2 - 1] + sortedArray[length / 2]) / 2;\n    return sortedArray[~~(length / 2)];\n};\nexport const maxIndex = (array: TypedArray | number[], from = 0, length = array.length) => {\n    const l = array.length;\n    if (!l) return 0;\n    let index = 0;\n    let max = array[0];\n    let i = length;\n    while (i-- > 1) {\n        const cur = array[(from + i) % l];\n        if (cur <= max) continue;\n        max = cur;\n        index = i;\n    }\n    return index;\n};\nexport const energy = (signal: TypedArray | number[], from = 0, length = signal.length) => {\n    let sum = 0;\n    let sample = 0;\n    const l = signal.length;\n    for (let i = 0; i < length; i++) {\n        sample = signal[(from + i) % l];\n        sum += sample * sample;\n    }\n    return sum;\n};\nexport const rms = (signal: TypedArray | number[], from = 0, length = signal.length) => Math.sqrt(energy(signal, from, length) / signal.length);\nexport const absMax = (signal: TypedArray | number[], from = 0, length = signal.length) => {\n    let max = 0;\n    let sample = 0;\n    const l = signal.length;\n    for (let i = 0; i < length; i++) {\n        sample = Math.abs(signal[(from + i) % l]);\n        if (sample > max) max = sample;\n    }\n    return max;\n};\nexport const zcr = (signal: TypedArray | number[], from = 0, length = signal.length) => {\n    let zcr = 0;\n    let lastPositive = true;\n    let positive = true;\n    const l = signal.length;\n    for (let i = 0; i < length; i++) {\n        positive = signal[(from + i) % l] >= 0;\n        if (positive !== lastPositive) zcr++;\n        lastPositive = positive;\n    }\n    return zcr;\n};\nexport const centroid = (array: TypedArray | number[], from = 0, length = array.length) => {\n    let weightedSum = 0;\n    let weight = 0;\n    let sample = 0;\n    const l = array.length;\n    for (let i = 0; i < length; i++) {\n        sample = array[(from + i) % l];\n        weightedSum += i * Math.abs(sample);\n        weight += sample;\n    }\n    return weight === 0 ? 0 : weightedSum / weight;\n};\nexport const conjugatedCentroid = (array: TypedArray | number[], factor: number, from = 0, length = array.length) => {\n    let weightedSum = 0;\n    let weight = 0;\n    let sample = 0;\n    const l = array.length;\n    for (let i = 0; i < length; i++) {\n        sample = array[(from + i) % l];\n        weightedSum += (i ** factor) * Math.abs(sample);\n        weight += sample;\n    }\n    return weight === 0 ? 0 : weightedSum / weight;\n};\nexport const geometricMean = (array: TypedArray | number[], from = 0, length = array.length) => {\n    let sum = 0;\n    let sample = 0;\n    const l = array.length;\n    for (let i = 0; i < length; i++) {\n        sample = array[(from + i) % l];\n        if (sample <= 0) return 0;\n        sum += Math.log(sample);\n    }\n    return Math.exp(sum / length);\n};\nexport const flatness = (array: TypedArray | number[], from = 0, length = array.length) => geometricMean(array, from, length) / mean(array, from, length);\n/**\n * https://essentia.upf.edu/reference/std_Flux.html\n */\nexport const flux = (cur: TypedArray | number[], prev: TypedArray | number[], norm?: \"L1\" | \"L2\", halfRectify?: boolean) => {\n    let flux = 0;\n    if (norm === \"L2\") {\n        if (halfRectify === true) { // L2 + halfRectify\n            for (let i = 0; i < cur.length; i++) {\n                const diff = cur[i] - prev[i];\n                if (diff < 0) continue;\n                flux += diff * diff;\n            }\n            return Math.sqrt(flux);\n        }\n        for (let i = 0; i < cur.length; i++) { // L2 not halfRectify\n            const diff = cur[i] - prev[i];\n            flux += diff * diff;\n        }\n        return Math.sqrt(flux);\n    }\n    if (halfRectify === true) { // L1 + halfRectify\n        for (let i = 0; i < cur.length; i++) {\n            const diff = cur[i] - prev[i];\n            if (diff < 0) continue;\n            flux += diff;\n        }\n        return flux;\n    }\n    for (let i = 0; i < cur.length; i++) { // L1 not halfRectify\n        const diff = cur[i] - prev[i];\n        flux += Math.abs(diff);\n    }\n    return flux;\n};\n/**\n * https://github.com/meyda/meyda/blob/master/src/extractors/spectralKurtosis.js=\n */\nexport const kurtosis = (array: TypedArray | number[], from = 0, length = array.length) => {\n    const c1 = centroid(array, from, length);\n    const c2 = conjugatedCentroid(array, 2, from, length);\n    const c3 = conjugatedCentroid(array, 3, from, length);\n    const c4 = conjugatedCentroid(array, 4, from, length);\n    const numerator = -3 * c1 ** 4 + 6 * c1 * c2 - 4 * c1 * c3 + c4;\n    const denominator = (c2 - c1 ** 2) ** 2;\n    return numerator / denominator;\n};\n/**\n * https://github.com/meyda/meyda/blob/master/src/extractors/spectralSkewness.js\n */\nexport const skewness = (array: TypedArray | number[], from = 0, length = array.length) => {\n    const c1 = centroid(array, from, length);\n    const c2 = conjugatedCentroid(array, 2, from, length);\n    const c3 = conjugatedCentroid(array, 3, from, length);\n    const numerator = 2 * c1 ** 3 - 3 * c1 * c2 + c3;\n    const denominator = (c2 - c1 ** 2) ** 1.5;\n    return numerator / denominator;\n};\n/**\n * https://essentia.upf.edu/reference/std_RollOff.html\n *\n * @param {TypedArray} array\n * @param {number} [cutoff] Between 0 - 1\n * @returns\n */\nexport const rolloff = (array: TypedArray | number[], from = 0, length = array.length, cutoff?: number) => {\n    let e = energy(array, from, length);\n    const threshold = (cutoff || 0.99) * e;\n    let n = length - 1;\n    let element;\n    while (e > threshold && n >= 0) {\n        element = array[(n + from) % length];\n        e -= element * element;\n        --n;\n    }\n    return n + 1;\n};\nexport const slope = (array: TypedArray | number[], from = 0, n = array.length) => {\n    const xSum = n * n / 2;\n    const x2Sum = (n - 1) * n * (2 * n - 1) / 6;\n    let ySum = 0;\n    let xySum = 0;\n    let y;\n    for (let x = 0; x < n; x++) {\n        y = array[(x + from) % n];\n        ySum += y;\n        xySum += x * y;\n    }\n    return (n * xySum - xSum * ySum) / (n * x2Sum - xSum * xSum);\n};\nexport const spread = (array: TypedArray | number[], from = 0, length = array.length) => Math.sqrt(conjugatedCentroid(array, 2, from, length)) - centroid(array, from, length) ** 2;\n/**\n * Copy buffer to another, support negative offset index\n */\nexport const setTypedArray = <T extends TypedArray = TypedArray>(to: T, from: T, offsetTo?: number, offsetFrom?: number) => {\n    const toLength = to.length;\n    const fromLength = from.length;\n    const spillLength = Math.min(toLength, fromLength);\n    let spilled = 0;\n    let $to = mod(offsetTo, toLength) || 0;\n    let $from = mod(offsetFrom, fromLength) || 0;\n    while (spilled < spillLength) {\n        const $spillLength = Math.min(spillLength - spilled, toLength - $to, fromLength - $from);\n        const $fromEnd = $from + $spillLength;\n        if ($from === 0 && $fromEnd === fromLength) to.set(from, $to);\n        else to.set(from.subarray($from, $fromEnd), $to);\n        $to = ($to + $spillLength) % toLength;\n        $from = $fromEnd % fromLength;\n        spilled += $spillLength;\n    }\n    return $to;\n};\n\nexport const getSubTypedArray = <T extends TypedArray = TypedArray>(from: T, length: number, offset = 0) => {\n    const fromLength = from.length;\n    const $ = mod(offset, fromLength) || 0;\n    if ($ === 0 && length === fromLength) return from;\n    if ($ + length < fromLength) return from.subarray($, $ + length) as T;\n    const to = new (from.constructor as TypedArrayConstructor)(length) as T;\n    setTypedArray(to, from, 0, $);\n    return to;\n};\n\nexport const sliceBuffer = <T extends TypedArray = TypedArray>(from: T, length: number, offset?: number) => {\n    const fromLength = from.length;\n    const $ = mod(offset, fromLength) || 0;\n    if ($ === 0 && length === fromLength) return from.slice();\n    if ($ + length < fromLength) return from.slice($, $ + length) as T;\n    const to = new (from.constructor as TypedArrayConstructor)(length) as T;\n    setTypedArray(to, from, 0, $);\n    return to;\n};\n/**\n * http://www.fftw.org/fftw3_doc/The-Halfcomplex_002dformat-DFT.html\n */\nexport const fftw2Amp = (from: Float32Array, windowEnergyFactor: number) => {\n    const { length } = from;\n    const amps = new Float32Array(length / 2);\n    for (let i = 0; i < length / 2; i++) {\n        const real = from[i];\n        const imag = (i === 0 || i === length / 2 - 1) ? 0 : from[length - i];\n        amps[i] = (real * real + imag * imag) ** 0.5 / length * windowEnergyFactor;\n    }\n    return amps;\n};\nexport const estimateFreq = (amps: Float32Array, sampleRate: number) => indexToFreq(maxIndex(amps), amps.length, sampleRate);\nexport const indexToFreq = (i: number, fftBins: number, sampleRate: number) => (i % fftBins) / fftBins * sampleRate / 2;\n","import { isNumberArray } from \"./utils\";\n\n/**\n * Mod support wrapping with negative numbers\n */\nexport const mod = (x: number, y: number): number => (x % y + y) % y;\n/**\n * Round a number to multiple of another\n */\nexport const round = (x: number, to: number): number => (Math.abs(to) < 1 ? Math.round(x * (1 / to)) / (1 / to) : Math.round(x / to) * to);\n/**\n * Floor a number to multiple of another\n */\nexport const floor = (x: number, to: number): number => (Math.abs(to) < 1 ? Math.floor(x * (1 / to)) / (1 / to) : Math.floor(x / to) * to);\n/**\n * Ceil a number to multiple of another\n */\nexport const ceil = (x: number, to: number): number => (Math.abs(to) < 1 ? Math.ceil(x * (1 / to)) / (1 / to) : Math.ceil(x / to) * to);\n/**\n * Degree to radian\n */\nexport const toRad = (degrees: number): number => degrees * Math.PI / 180;\n/**\n * MIDI note number to string\n */\nexport const toMIDI = (f: number): string => [\"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\", \"G\", \"G#\", \"A\", \"A#\", \"B\"][(f % 12 + 12) % 12] + Math.round(f / 12 - 2);\n/**\n * Linear amplitude ([0, 1]) to dB ([-Inf, 0])\n *\n * @param {number} a linear amplitude value\n * @returns {number} dB value\n */\nexport const atodb = (a: number): number => 20 * Math.log10(a);\n/**\n * dB ([-Inf, 0]) to Linear mplitude ([0, 1])\n *\n * @param {number} db dB value\n * @returns {number} linear amplitude value\n */\nexport const dbtoa = (db: number): number => 10 ** (db / 20);\n/**\n * De-scale a exponently scaled value\n *\n * @param {number} x normalized value to scale between ([0, 1])\n * @param {number} e exponent factor used to scale, 0 means linear, 1 does ** 1.5 curve\n * @returns {number} de-scaled value\n */\nexport const iNormExp = (x: number, e: number): number => Math.max(0, x) ** (1.5 ** -e);\n/**\n * Scale exponently a normalized value\n *\n * @param {number} x normalized value to scale between ([0, 1])\n * @param {number} e exponent factor, 0 means linear, 1 does ** 1.5 curve\n * @returns {number} scaled value\n */\nexport const normExp = (x: number, e: number): number => Math.max(0, x) ** (1.5 ** e);\n\nexport const scale = (x: number, l1: number, h1: number, l2: number, h2: number) => {\n    const r1 = h1 - l1;\n    const r2 = h2 - l2;\n    return (x - l1) / r1 * r2 + l2;\n};\n\nexport const scaleClip = (x: number, l1: number, h1: number, l2: number, h2: number) => Math.max(l2, Math.min(h2, scale(x, l1, h1, l2, h2)));\n\n// eslint-disable-next-line arrow-body-style\nexport const isIdentityMatrix = (x: number[][]) => {\n    return Array.isArray(x)\n    && x.every((row, i) => isNumberArray(row)\n    && row.length === x.length\n    && row.every((e, j) => e === (j === i ? 1 : 0)));\n};\n\nexport const identityMatrix = (dim: number) => new Array(dim).fill(undefined).map((x, i) => new Array(dim).fill(undefined).map((y, j) => +(i === j)));\n","/* eslint-disable arrow-body-style */\nimport type { TPatcherProps } from \"../core/patcher/Patcher\";\nimport type { TMIDIEvent, TBPF, TRect, TPresentationRect, ProjectItemType, RawPatcher, TMaxPatcher, TAudioUnit } from \"../core/types\";\n\nexport const isStringArray = (x: any): x is string[] => Array.isArray(x) && x.every(e => typeof e === \"string\");\nexport const isNumberArray = (x: any): x is number[] => Array.isArray(x) && x.every(e => typeof e === \"number\");\nexport const isTRect = (x: any): x is TRect => {\n    return isNumberArray(x)\n        && x.length === 4\n        && x[0] >= 0\n        && x[1] >= 0\n        && x[2] >= 15\n        && x[3] >= 15;\n};\nexport const isTPresentationRect = (x: any): x is TPresentationRect => {\n    return Array.isArray(x)\n        && x.length === 4\n        && x.every(v => typeof v === \"number\" || typeof v === \"string\");\n};\nexport const isRectMovable = (x: any): x is [number, number, number | string, number | string] => {\n    return isTPresentationRect(x) && typeof x[0] === \"number\" && typeof x[1] === \"number\";\n};\nexport const isRectResizable = (x: any): x is TRect => isTRect(x);\nexport const isMIDIEvent = (x: any): x is TMIDIEvent => (isNumberArray(x) || x instanceof Uint8Array) && x.length === 3;\nexport const stringifyError = (data: any) => {\n    if (typeof data === \"string\") return data;\n    if (data instanceof Error) return data.message;\n    if (typeof data === \"object\") return JSON.stringify(data);\n    return `${data}`;\n};\nexport const parseToPrimitive = (value: any) => {\n    try {\n        return JSON.parse(value);\n    } catch (e) {\n        return value.toString();\n    }\n};\nexport const rgbaMax2Css = (maxColor: number[]) => {\n    const cssColor = [255, 255, 255, 1] as TRect;\n    if (Array.isArray(maxColor)) {\n        for (let i = 0; i < 3; i++) {\n            if (typeof maxColor[i] === \"number\") cssColor[i] = Math.floor(maxColor[i] * 255);\n        }\n        if (typeof maxColor[3] === \"number\") cssColor[3] = maxColor[3];\n    }\n    return `rgba(${cssColor.join(\",\")})`;\n};\nexport const css2RgbaMax = (color: string) => {\n    const maxColor = [0.2, 0.2, 0.2, 1] as TRect;\n    const matched = color.match(/rgba\\((.+)\\)/);\n    if (!matched) return maxColor;\n    const cssColor = matched[1].split(\",\").map(s => +s);\n    for (let i = 0; i < 3; i++) {\n        if (typeof cssColor[i] === \"number\") maxColor[i] = cssColor[i] / 255;\n        if (typeof cssColor[3] === \"number\") maxColor[3] = cssColor[3];\n    }\n    return maxColor;\n};\n/**\n * A BPF can be described as a succesion of three number tuples.\n * i.e. `1 1 0.5 2 1 1` curve mode means go to 0 immediately then go to 1 in 1s with a curve of e^0.5, then go to 2 in 1s linear.\n * The function transform the string to number[][], i.e. `[[1, 1, 0.5], [2, 1, 1]]`\n *\n * @param {TBPF} sIn\n * @returns {number[][]}\n */\nexport const decodeBPF = (sIn: TBPF, tupleLength: number): number[][] => {\n    if (typeof sIn === \"number\") return [[sIn]];\n    if (isNumberArray(sIn)) return [sIn];\n    if (Array.isArray(sIn) && sIn.every(a => isNumberArray(a))) return sIn;\n    if (typeof sIn !== \"string\") throw new Error(\"Failed to decode curve.\");\n    const numbers = sIn.split(\" \").filter(s => !!s).map(s => +s);\n    if (numbers.find(v => !isFinite(v))) throw new Error(\"BPF contains invalid number.\");\n    const tuples: number[][] = [];\n    for (let i = 0; i < numbers.length; i++) {\n        const $tuple = ~~(i / tupleLength);\n        const $ = i % tupleLength;\n        if (!tuples[$tuple]) tuples[$tuple] = [];\n        tuples[$tuple][$] = numbers[i];\n    }\n    return tuples;\n};\nexport const decodeCurve = (sIn: TBPF) => decodeBPF(sIn, 3);\nexport const decodeLine = (sIn: TBPF) => decodeBPF(sIn, 2);\n\n/**\n * Gives OS name as follows:\n * \"Windows\"    for all versions of Windows,\n * \"MacOS\"      for all versions of Macintosh OS,\n * \"Linux\"      for all versions of Linux,\n * \"UNIX\"       for all other UNIX flavors,\n * \"Unknown\" indicates failure to detect the OS\n *\n * @returns {\"Windows\" | \"MacOS\" | \"UNIX\" | \"Linux\" | \"Unknown\"} OS name\n */\nexport const detectOS = (): \"Windows\" | \"MacOS\" | \"UNIX\" | \"Linux\" | \"Unknown\" => {\n    const { appVersion } = navigator;\n    if (appVersion.indexOf(\"Win\") !== -1) return \"Windows\";\n    if (appVersion.indexOf(\"Mac\") !== -1) return \"MacOS\";\n    if (appVersion.indexOf(\"X11\") !== -1) return \"UNIX\";\n    if (appVersion.indexOf(\"Linux\") !== -1) return \"Linux\";\n    return \"Unknown\";\n};\nexport const detectBrowserCore = () => {\n    if ((window as any).chrome) return \"Chromium\";\n    if ((window as any).InstallTrigger) return \"Gecko\";\n    if (navigator.vendor.indexOf(\"Apple\") !== -1) return \"WebKit\";\n    return \"Unknown\";\n};\nexport const roundedRect = (ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, radius: number | number[]) => {\n    const radii = [0, 0, 0, 0];\n    if (typeof radius === \"number\") radii.fill(radius);\n    else radius.forEach((v, i) => radii[i] = v);\n    ctx.beginPath();\n    ctx.moveTo(x + radii[0], y);\n    ctx.lineTo(x + width - radii[1], y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radii[1]);\n    ctx.lineTo(x + width, y + height - radii[2]);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radii[2], y + height);\n    ctx.lineTo(x + radii[3], y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radii[3]);\n    ctx.lineTo(x, y + radii[0]);\n    ctx.quadraticCurveTo(x, y, x + radii[0], y);\n    ctx.closePath();\n    ctx.stroke();\n};\nexport const fillRoundedRect = (ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, radius: number | number[]) => {\n    const radii = [0, 0, 0, 0];\n    if (typeof radius === \"number\") radii.fill(radius);\n    else radius.forEach((v, i) => radii[i] = v);\n    ctx.beginPath();\n    ctx.moveTo(x + radii[0], y);\n    ctx.lineTo(x + width - radii[1], y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radii[1]);\n    ctx.lineTo(x + width, y + height - radii[2]);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radii[2], y + height);\n    ctx.lineTo(x + radii[3], y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radii[3]);\n    ctx.lineTo(x, y + radii[0]);\n    ctx.quadraticCurveTo(x, y, x + radii[0], y);\n    ctx.closePath();\n    ctx.fill();\n};\nexport const selectElementRange = (e: HTMLElement) => {\n    const elementIsEditable = (e: HTMLElement): e is HTMLInputElement | HTMLTextAreaElement => !!e.nodeName.match(/^(INPUT|TEXTAREA)$/i);\n    const selection = window.getSelection();\n    if (elementIsEditable(e)) {\n        e.focus();\n        e.select();\n        return;\n    }\n    if (selection.setBaseAndExtent) {\n        // Safari\n        selection.setBaseAndExtent(e, 0, e, e.hasChildNodes() ? 1 : 0);\n        return;\n    }\n    if (selection.addRange && selection.removeAllRanges && document.createRange) {\n        // Mozilla or Opera 10.5+\n        const range = document.createRange();\n        range.selectNodeContents(e);\n        selection.removeAllRanges();\n        selection.addRange(range);\n    }\n};\nexport const selectElementPos = (e: HTMLElement, pos: number) => {\n    const range = document.createRange();\n    const selection = window.getSelection();\n    range.setStart(e.childNodes[0], pos);\n    range.collapse(true);\n    selection.removeAllRanges();\n    selection.addRange(range);\n};\nexport const findFromAscendants = (e: HTMLElement, predict: (e: HTMLElement) => boolean) => {\n    const ascendants = [];\n    let parent = e.parentElement;\n    while (parent !== document.body) {\n        ascendants.push(parent);\n        parent = parent.parentElement;\n    }\n    return ascendants.find(predict);\n};\n// eslint-disable-next-line arrow-body-style\nexport const getPropertyDescriptor = (obj: Record<string, any>, key: string): PropertyDescriptor => {\n    return Object.getOwnPropertyDescriptor(obj, key) || getPropertyDescriptor(Object.getPrototypeOf(obj), key);\n};\nexport const getPropertyDescriptors = (obj: Function | Record<string, any>): PropertyDescriptorMap => {\n    if (typeof obj === \"function\") return Object.getOwnPropertyDescriptors(obj);\n    const proto = Object.getPrototypeOf(obj);\n    if (obj !== Object.prototype && proto === Object.prototype) return Object.getOwnPropertyDescriptors(obj);\n    return Object.assign(proto ? getPropertyDescriptors(proto) : {}, Object.getOwnPropertyDescriptors(obj));\n};\n\nexport const extToType = (ext: string): Exclude<ProjectItemType, \"folder\"> => {\n    if ([\"jspat\", \"maxpat\", \"gendsp\", \"dsppat\"].indexOf(ext) !== -1) return \"patcher\";\n    if ([\"wav\", \"aif\", \"aiff\", \"mp3\", \"aac\", \"flac\", \"ogg\", \"m4a\"].indexOf(ext) !== -1) return \"audio\";\n    if ([\"txt\", \"json\"].indexOf(ext) !== -1) return \"text\";\n    if ([\"apng\", \"avif\", \"gif\", \"jpg\", \"jpeg\", \"jfif\", \"pjpeg\", \"pjp\", \"png\", \"svg\", \"webp\", \"bmp\", \"ico\", \"cur\", \"tif\", \"tiff\"].indexOf(ext) !== -1) return \"image\";\n    if ([\"mp4\", \"webm\", \"3gp\"].indexOf(ext) !== -1) return \"video\";\n    return \"unknown\";\n};\n\nexport const max2js = (patcherIn: TMaxPatcher, mode = \"max\" as TPatcherProps[\"mode\"]): RawPatcher => {\n    const patcher: RawPatcher = { boxes: {}, lines: {} };\n    const maxPatcher = (patcherIn as TMaxPatcher).patcher;\n    patcher.props = {\n        bgColor: rgbaMax2Css(maxPatcher.bgcolor),\n        editingBgColor: rgbaMax2Css(maxPatcher.editing_bgcolor),\n        dependencies: [],\n        grid: maxPatcher.gridsize,\n        openInPresentation: !!maxPatcher.openinpresentation,\n        mode\n    };\n    const maxBoxes = maxPatcher.boxes;\n    const maxLines = maxPatcher.lines;\n    for (let i = 0; i < maxBoxes.length; i++) {\n        const maxBox = maxBoxes[i].box;\n        const numID = parseInt(maxBox.id.match(/\\d+/)[0]);\n        const id = \"box-\" + numID;\n        patcher.boxes[id] = {\n            id,\n            inlets: maxBox.numinlets,\n            outlets: maxBox.numoutlets,\n            rect: maxBox.patching_rect,\n            presentationRect: maxBox.presentation_rect,\n            background: !!maxBox.background,\n            presentation: !!maxBox.presentation,\n            text: (maxBox.maxclass === \"newobj\" ? \"\" : maxBox.maxclass + \" \") + (maxBox.text ? maxBox.text : \"\")\n        };\n    }\n    for (let i = 0; i < maxLines.length; i++) {\n        const lineArgs = maxLines[i].patchline;\n        const id = \"line-\" + i;\n        patcher.lines[id] = {\n            id,\n            src: [lineArgs.source[0].replace(/obj/, \"box\"), lineArgs.source[1]],\n            dest: [lineArgs.destination[0].replace(/obj/, \"box\"), lineArgs.destination[1]]\n        };\n    }\n    return patcher;\n};\n\nexport const js2max = (patcherIn: RawPatcher): TMaxPatcher => {\n    const maxPatcher: TMaxPatcher[\"patcher\"] = {\n        boxes: [],\n        lines: [],\n        rect: undefined,\n        bgcolor: css2RgbaMax(patcherIn.props.bgColor),\n        editing_bgcolor: css2RgbaMax(patcherIn.props.editingBgColor),\n        gridsize: patcherIn.props.grid,\n        openinpresentation: +patcherIn.props.openInPresentation\n    };\n    for (const id in patcherIn.boxes) {\n        const box = patcherIn.boxes[id];\n        const numID = parseInt(id.match(/\\d+/)[0]);\n        maxPatcher.boxes.push({\n            box: {\n                id: `obj-${numID}`,\n                maxclass: \"newobj\",\n                numinlets: box.inlets,\n                numoutlets: box.outlets,\n                patching_rect: box.rect,\n                presentation: +box.presentation,\n                background: +box.background,\n                text: box.text\n            }\n        });\n    }\n    for (const id in patcherIn.lines) {\n        const line = patcherIn.lines[id];\n        maxPatcher.lines.push({\n            patchline: {\n                source: [line.src[0].replace(/box/, \"obj\"), line.src[1]],\n                destination: [line.dest[0].replace(/box/, \"obj\"), line.dest[1]]\n            }\n        });\n    }\n    return { patcher: maxPatcher };\n};\n\nexport const convertSampleToUnit = (sample: number, unit: TAudioUnit, { sampleRate = 48000, bpm = 60, beatsPerMeasure = 4, division = 16 }) => {\n    if (unit === \"sample\") return { unit, str: sample.toString(), value: sample, values: [sample] };\n    const milliseconds = sample * 1000 / sampleRate;\n    const roundedMs = Math.round(milliseconds);\n    if (unit === \"measure\") {\n        const dpms = bpm * division / 60000;\n        const totalDivisions = dpms * milliseconds;\n        const roundedTotalDivisions = dpms * milliseconds;\n        const divisions = ~~(roundedTotalDivisions % division);\n        const beats = ~~(roundedTotalDivisions / division) % beatsPerMeasure + 1;\n        const measure = ~~(roundedTotalDivisions / beatsPerMeasure / division) + 1;\n        const str = `${measure}:${beats}.${divisions.toString().padStart(2, \"0\")}`;\n        return { unit, str, value: totalDivisions / division, values: [measure, beats, divisions] };\n    }\n    // if (unit === \"time\")\n    const ms = roundedMs % 1000;\n    const s = ~~(roundedMs / 1000) % 60;\n    const min = ~~(roundedMs / 60000) % 60;\n    const h = ~~(roundedMs / 3600000);\n    const str = !min ? `${s}.${ms.toString().padStart(3, \"0\")}`\n        : !h ? `${min}:${s.toString().padStart(2, \"0\")}.${ms.toString().padStart(3, \"0\")}`\n            : `${h}:${min.toString().padStart(2, \"0\")}:${s.toString().padStart(2, \"0\")}.${ms.toString().padStart(3, \"0\")}`;\n    return { unit, str, value: milliseconds / 1000, values: [h, min, s, ms] };\n};\nexport const MEASURE_UNIT_REGEX = /^((\\d+):)?(\\d+)\\.?(\\d+)?$/;\nexport const TIME_UNIT_REGEX = /^((\\d+):)??((\\d+):)?(\\d+)\\.?(\\d+)?$/;\nexport const convertUnitToSample = (str: string, unit: TAudioUnit, { sampleRate = 48000, bpm = 60, beatsPerMeasure = 4, division = 16 }) => {\n    if (unit === \"sample\") return +str || 0;\n    if (unit === \"measure\") {\n        const matched = str.match(MEASURE_UNIT_REGEX);\n        if (!matched) throw new Error(`String ${str} cannot be parsed to ${unit}`);\n        const [, , measureIn, beatsIn, divisionsIn] = matched;\n        const bps = bpm / 60;\n        const samplesPerBeat = sampleRate / bps;\n        let measures = +measureIn || 0;\n        let beats = +beatsIn || 0;\n        let divisions = +divisionsIn || 0;\n        beats += ~~(divisions / division);\n        divisions %= division;\n        measures += ~~(beats / beatsPerMeasure);\n        beats %= beatsPerMeasure;\n        return (measures * beatsPerMeasure + beats + divisions / division) * samplesPerBeat;\n    }\n    const matched = str.match(TIME_UNIT_REGEX);\n    if (!matched) throw new Error(`String ${str} cannot be parsed to ${unit}`);\n    const [, , hIn, , minIn, sIn, msIn] = matched;\n    let h = +hIn || 0;\n    let min = +minIn || 0;\n    let s = +sIn || 0;\n    let ms = +msIn || 0;\n    s += ~~(ms / 1000);\n    ms %= 1000;\n    min += ~~(s / 60);\n    s %= 60;\n    h += ~~(min / 60);\n    min %= 60;\n    return (h * 3600 + min * 60 + s + ms / 1000) * sampleRate;\n};\n\nexport const ab2sab = (ab: SharedArrayBuffer | ArrayBuffer) => {\n    if (ab instanceof ArrayBuffer) return ab;\n    const sab = new SharedArrayBuffer(ab.byteLength);\n    const ui8ab = new Uint8Array(ab);\n    const ui8sab = new Uint8Array(sab);\n    for (let i = 0; i < ui8ab.length; i++) {\n        ui8sab[i] = ui8ab[i];\n    }\n    return sab;\n};\n\nexport const sab2ab = (sab: SharedArrayBuffer | ArrayBuffer) => {\n    if (sab instanceof SharedArrayBuffer) return sab;\n    const ab = new ArrayBuffer(sab.byteLength);\n    const ui8ab = new Uint8Array(ab);\n    const ui8sab = new Uint8Array(sab);\n    for (let i = 0; i < ui8sab.length; i++) {\n        ui8ab[i] = ui8sab[i];\n    }\n    return ab;\n};\nexport const ab2str = (buf: ArrayBuffer) => {\n    return String.fromCharCode.apply(null, new Uint16Array(buf));\n};\n\nexport const str2ab = (str: string) => {\n    const buf = new ArrayBuffer(str.length * 2); // 2 bytes for each char\n    const bufView = new Uint16Array(buf);\n    for (let i = 0, strLen = str.length; i < strLen; i++) {\n        bufView[i] = str.charCodeAt(i);\n    }\n    return buf;\n};\n","interface YinParams {\n    threshold: number;\n    sampleRate: number;\n    probabilityThreshold: number;\n}\n\nconst detect = (bufferIn: Float32Array, paramsIn?: Partial<YinParams>) => {\n    const { threshold = 0.1, sampleRate = 48000, probabilityThreshold = 0.1 } = paramsIn;\n    let bufferSize = 1;\n    while (bufferSize < bufferIn.length) {\n        bufferSize *= 2;\n    }\n    bufferSize /= 2;\n\n    const yinBufferSize = bufferSize / 2;\n    const yinBuffer = new Float32Array(yinBufferSize);\n\n    let prob = 0;\n    let tau;\n    let delta;\n\n    for (let t = 1; t < yinBufferSize; t++) {\n        for (let i = 0; i < yinBufferSize; i++) {\n            delta = bufferIn[i] - bufferIn[i + t];\n            yinBuffer[t] += delta * delta;\n        }\n    }\n    yinBuffer[0] = 1;\n    yinBuffer[1] = 1;\n    let runningSum = 0;\n    for (let t = 1; t < yinBufferSize; t++) {\n        runningSum += yinBuffer[t];\n        yinBuffer[t] *= t / runningSum;\n    }\n    for (tau = 2; tau < yinBufferSize; tau++) {\n        if (yinBuffer[tau] < threshold) {\n            while (tau + 1 < yinBufferSize && yinBuffer[tau + 1] < yinBuffer[tau]) {\n                tau++;\n            }\n            prob = 1 - yinBuffer[tau];\n            break;\n        }\n    }\n    if (tau === yinBufferSize || yinBuffer[tau] >= threshold) {\n        return null;\n    }\n    if (prob < probabilityThreshold) {\n        return null;\n    }\n    let betterTau;\n    let x0;\n    let x2;\n    if (tau < 1) {\n        x0 = tau;\n    } else {\n        x0 = tau - 1;\n    }\n    if (tau + 1 < yinBufferSize) {\n        x2 = tau + 1;\n    } else {\n        x2 = tau;\n    }\n    if (x0 === tau) {\n        if (yinBuffer[tau] <= yinBuffer[x2]) {\n            betterTau = tau;\n        } else {\n            betterTau = x2;\n        }\n    } else if (x2 === tau) {\n        if (yinBuffer[tau] <= yinBuffer[x0]) {\n            betterTau = tau;\n        } else {\n            betterTau = x0;\n        }\n    } else {\n        const s0 = yinBuffer[x0];\n        const s1 = yinBuffer[tau];\n        const s2 = yinBuffer[x2];\n        betterTau = tau + (s2 - s0) / (2 * (2 * s1 - s2 - s0));\n    }\n\n    return sampleRate / betterTau;\n};\nexport default detect;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { rms, zcr, setTypedArray, absMax } from \"../../utils/buffer\";\nimport { mod } from \"../../utils/math\";\nimport yinEstimate from \"../../utils/yin\";\nimport { AudioWorkletGlobalScope, TypedAudioParamDescriptor } from \"./TypedAudioWorklet\";\nimport { ITemporalAnalyserProcessor, ITemporalAnalyserNode, TemporalAnalyserParameters, TemporalAnalysis } from \"./TemporalAnalyserWorklet.types\";\nimport AudioWorkletProxyProcessor from \"./AudioWorkletProxyProcessor\";\n\nconst processorId = \"__JSPatcher_TemporalAnalyser\";\ndeclare const globalThis: AudioWorkletGlobalScope & { SharedArrayBuffer: typeof SharedArrayBuffer | typeof ArrayBuffer; Atomics: typeof Atomics };\nif (!globalThis.SharedArrayBuffer) globalThis.SharedArrayBuffer = ArrayBuffer;\nconst { registerProcessor, sampleRate } = globalThis;\n\n/**\n * Some data to transfer across threads\n */\nclass TemporalAnalyserAtoms {\n    private readonly _sab: SharedArrayBuffer;\n    private readonly _$read: Uint32Array;\n    private readonly _$write: Uint32Array;\n    private readonly _$total: Uint32Array;\n    /** Audio sample index reading in the window */\n    get $read(): number {\n        return this._$read[0];\n    }\n    set $read(value: number) {\n        this._$read[0] = value;\n    }\n    /** Next audio sample index to write into the window */\n    get $write(): number {\n        return this._$write[0];\n    }\n    set $write(value: number) {\n        this._$write[0] = value;\n    }\n    /** Total samples written counter */\n    get $total(): number {\n        return this._$total[0];\n    }\n    set $total(value: number) {\n        this._$total[0] = value;\n    }\n    /** Get all atoms */\n    get asObject() {\n        return { $write: this._$write, $read: this._$read, $total: this._$total };\n    }\n    constructor() {\n        this._sab = new SharedArrayBuffer(3 * Uint32Array.BYTES_PER_ELEMENT);\n        this._$read = new Uint32Array(this._sab, 0, 1);\n        this._$write = new Uint32Array(this._sab, 4, 1);\n        this._$total = new Uint32Array(this._sab, 8, 1);\n    }\n}\nclass TemporalAnalyserProcessor extends AudioWorkletProxyProcessor<ITemporalAnalyserProcessor, ITemporalAnalyserNode, TemporalAnalyserParameters> implements ITemporalAnalyserProcessor {\n    static get parameterDescriptors(): TypedAudioParamDescriptor<TemporalAnalyserParameters>[] {\n        return [{\n            defaultValue: 1024,\n            maxValue: 2 ** 32,\n            minValue: 128,\n            name: \"windowSize\"\n        }];\n    }\n    private destroyed = false;\n    private readonly atoms = new TemporalAnalyserAtoms();\n    /** Concatenated audio data, array of channels */\n    private readonly windowSab: SharedArrayBuffer[] = [];\n    /** Float32Array Buffer view of window */\n    private readonly window: Float32Array[] = [];\n    /** Audio sample index reading in the window */\n    get $read() {\n        return this.atoms.$read;\n    }\n    set $read(value: number) {\n        this.atoms.$read = value;\n    }\n    /** Next audio sample index to write into the window */\n    get $write() {\n        return this.atoms.$write;\n    }\n    set $write(value: number) {\n        this.atoms.$write = value;\n    }\n    /** Total samples written counter */\n    get $total() {\n        return this.atoms.$total;\n    }\n    set $total(value: number) {\n        this.atoms.$total = value;\n    }\n    getRms() {\n        return this.window.map(a => rms(a, this.$read, this.windowSize));\n    }\n    getAbsMax() {\n        return this.window.map(a => absMax(a, this.$read, this.windowSize));\n    }\n    getZcr() {\n        return this.window.map(a => zcr(a, this.$read, this.windowSize));\n    }\n    getEstimatedFreq(threshold?: number, probabilityThreshold?: number) {\n        return this.window.map(ch => yinEstimate(ch, { sampleRate, threshold, probabilityThreshold }));\n    }\n    getBuffer() {\n        const data = this.window;\n        const { $read, $write, $total } = this.atoms.asObject;\n        return { data, $read, $write, $total };\n    }\n    gets<K extends keyof TemporalAnalysis>(...analysis: K[]) {\n        const result: Partial<TemporalAnalysis> = {};\n        for (const key of analysis) {\n            if (typeof key !== \"string\" || !key.length) continue;\n            const method = `get${key.charAt(0).toUpperCase()}${key.slice(1)}` as `get${Capitalize<string & K>}`;\n            if (this[method]) result[key] = this[method]() as TemporalAnalysis[K];\n        }\n        return result;\n    }\n    destroy() {\n        this.destroyed = true;\n        this._disposed = true;\n    }\n    private _windowSize = 1024;\n    get windowSize() {\n        return this._windowSize;\n    }\n    set windowSize(sizeIn: number) {\n        this._windowSize = ~~Math.min(2 ** 32, Math.max(128, sizeIn || 1024));\n    }\n    process(inputs: Float32Array[][], outputs: Float32Array[][], parameters: Record<TemporalAnalyserParameters, Float32Array>) {\n        if (this.destroyed) return false;\n        const input = inputs[0];\n        this.windowSize = ~~parameters.windowSize[0];\n        const { windowSize } = this;\n\n        if (this.window.length > input.length) { // Too much channels ?\n            this.windowSab.splice(input.length);\n            this.window.splice(input.length);\n        }\n        if (input.length === 0) return true;\n\n        const bufferSize = Math.max(...input.map(c => c.length)) || 128;\n\n        const dataSize = windowSize + sampleRate;\n        this.$write %= dataSize;\n        this.$total += bufferSize;\n        let { $write } = this;\n        // Init windows\n        for (let i = 0; i < input.length; i++) {\n            $write = this.$write;\n            if (!this.window[i]) { // Initialise channel if not exist\n                this.windowSab[i] = new SharedArrayBuffer(dataSize * Float32Array.BYTES_PER_ELEMENT);\n                this.window[i] = new Float32Array(this.windowSab[i]);\n            } else {\n                if (this.window[i].length !== dataSize) { // adjust window size if not corresponded\n                    const oldWindow = this.window[i];\n                    const windowSab = new SharedArrayBuffer(dataSize * Float32Array.BYTES_PER_ELEMENT);\n                    const window = new Float32Array(windowSab);\n                    $write = setTypedArray(window, oldWindow, 0, $write - Math.min(dataSize, oldWindow.length));\n                    this.windowSab[i] = windowSab;\n                    this.window[i] = window;\n                }\n            }\n        }\n        this.$write = $write;\n        // Write\n        for (let i = 0; i < input.length; i++) {\n            const window = this.window[i];\n            const channel = input[i].length ? input[i] : new Float32Array(bufferSize);\n            if (bufferSize > dataSize) {\n                $write = setTypedArray(window, channel.subarray(bufferSize - dataSize), this.$write);\n            } else {\n                $write = setTypedArray(window, channel, this.$write);\n            }\n        }\n        this.$write = $write;\n        this.$read = mod($write - windowSize, dataSize);\n        return true;\n    }\n}\ntry {\n    registerProcessor(processorId, TemporalAnalyserProcessor);\n} catch (error) {\n    // eslint-disable-next-line no-console\n    console.warn(error);\n}\n"],"sourceRoot":""}