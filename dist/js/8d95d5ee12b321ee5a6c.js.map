{"version":3,"sources":["webpack://JSPatcher/./src/core/objects/dsp/AudioWorklet/Base.ts","webpack://JSPatcher/./src/core/objects/dsp/AudioWorklet/SpectralAnalyser.ts","webpack://JSPatcher/./src/core/objects/dsp/AudioWorklet/SpectralAnalyser.worklet.ts","webpack://JSPatcher/./src/core/objects/dsp/AudioWorklet/TemporalAnalyser.ts","webpack://JSPatcher/./src/core/objects/dsp/AudioWorklet/TemporalAnalyser.worklet.ts","webpack://JSPatcher/./src/core/objects/dsp/Base.ts","webpack://JSPatcher/./src/core/objects/dsp/Oscilloscope.ts","webpack://JSPatcher/./src/core/objects/dsp/SpectralAnalyser.ts","webpack://JSPatcher/./src/core/objects/dsp/Spectrogram.ts","webpack://JSPatcher/./src/core/objects/dsp/Spectroscope.ts","webpack://JSPatcher/./src/core/objects/dsp/TemporalAnalyser.ts","webpack://JSPatcher/./src/core/objects/dsp/exports.ts"],"names":["registeredProcessors","Set","AWN","window","AudioWorkletNode","DisposableAudioWorkletNode","port","parameters","destroy","postMessage","close","destroyed","constructor","context","name","options","AudioWorkletRegister","registered","has","processorID","b","add","registerProcessor","audioWorklet","registering","url","processorURL","URL","createObjectURL","Blob","processor","toString","type","addModule","resolves","forEach","f","e","rejects","register","promise","Promise","resolve","reject","push","SpectralAnalyserNode","numberOfInputs","numberOfOutputs","onmessage","id","data","gets","Error","promiseID","SpectralAnalyserRegister","TemporalAnalyserNode","rms","zcr","buffer","TemporalAnalyserRegister","BaseDSP","BaseAudioObject","DefaultDSP","DefaultAudioObject","OscilloscopeUI","CanvasUI","componentDidMount","bgColor","state","ctx","width","height","fullSize","fillStyle","fillRect","paint","continuous","schedulePaint","object","node","stablize","interleaved","range","autoRange","showStats","phosphorColor","hueOffset","textColor","gridColor","seperatorColor","left","bottom","estimatedFreq","sampleRate","audioCtx","clearRect","$","$ui32","t","lock","length","Atomics","load","store","channels","l","min","max","yFactor","i","s","j","Math","abs","strokeStyle","vStep","beginPath","setLineDash","gridChannels","channelHeight","y","moveTo","lineTo","stroke","lineWidth","channelColor","$zerox","period","times","floor","$0","$1","drawL","thresh","isFinite","round","gridX","step","Color","shiftHue","toHSL","maxInStep","minInStep","$j","samp","$step","x","font","textAlign","textBaseline","fillText","toFixed","freqStatY","freq","Oscilloscope","undefined","subscribe","on","inlets","outlets","props","windowFunction","applyBPF","get","indexOf","fftSize","fftOverlap","windowSize","Node","getProp","disconnectAudioInlet","inletConnections","index","connectAudioInlet","inlet","Bang","updateUI","isHot","description","default","enums","isUIState","frameRate","SpectralAnalyser","$requestTimer","startRequest","request","extractorKeys","key","got","outlet","scheduleRequest","setTimeout","clearTimeout","speedLim","lastAmplitudes","allAmplitudes","amplitude","centroid","flatness","flux","kurtosis","skewness","rolloff","slope","spread","SpectrogramUI","document","createElement","getContext","offscreenCtx","frames","canvas","offscreenVRes","$totalFrames","fftBins","bins","framesIn","$frame","$frameUi32","$lastFrame","$frame0","$frame1","osChannelHeight","vGrid","k","atodb","normalized","hue","lum","hStep","save","globalCompositeOperation","imageSmoothingEnabled","drawImage","sSplit","dSplit","restore","Spectrogram","SpectroscopeUI","fgColor","closePath","fill","Spectroscope","TemporalAnalyser"],"mappings":"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","file":"js/8d95d5ee12b321ee5a6c.js","sourcesContent":["export const registeredProcessors = new Set<string>();\n\nconst AWN: typeof AudioWorkletNode = window.AudioWorkletNode ? AudioWorkletNode : null;\ntype DataToProcessor = DisposableAudioWorkletMessageEventDataToProcessor;\nexport class DisposableAudioWorkletNode<F extends Record<string, any> = Record<string, any>, T extends DataToProcessor = DataToProcessor, P extends string = string, O extends any = any> extends AWN {\n    get port(): AudioWorkletMessagePort<F, T> {\n        return super.port;\n    }\n    get parameters(): DisposableAudioParamMap<P> {\n        return super.parameters as DisposableAudioParamMap<P>;\n    }\n    protected readonly options: TypedAudioWorkletNodeOptions<O>;\n    destroyed = false;\n    destroy() {\n        this.port.postMessage({ destroy: true } as T);\n        this.port.close();\n        this.destroyed = true;\n    }\n    constructor(context: BaseAudioContext, name: string, options?: TypedAudioWorkletNodeOptions<O>) {\n        super(context, name, options);\n        this.options = options;\n    }\n}\n\nexport abstract class AudioWorkletRegister {\n    static processorID: string;\n    static processorURL: string;\n    static registeredProcessors = registeredProcessors;\n    static registering = false;\n    static get registered() {\n        return this.registeredProcessors.has(this.processorID);\n    }\n    static set registered(b: boolean) {\n        this.registeredProcessors.add(this.processorID);\n    }\n    static processor: () => void;\n    static Node: new (context: BaseAudioContext, options?: AudioWorkletNodeOptions) => DisposableAudioWorkletNode;\n    private static resolves: { [id: string]: ((value?: void | PromiseLike<void>) => void)[]} = {};\n    private static rejects: { [id: string]: ((reason?: any) => void)[] } = {};\n    private static async registerProcessor(audioWorklet: AudioWorklet) {\n        this.registering = true;\n        try {\n            const url = this.processorURL || window.URL.createObjectURL(new Blob([`(${this.processor.toString()})();`], { type: \"text/javascript\" }));\n            await audioWorklet.addModule(url);\n            this.resolves[this.processorID].forEach(f => f());\n            this.registering = false;\n            this.registered = true;\n        } catch (e) {\n            this.rejects[this.processorID].forEach(f => f(e));\n        }\n        this.rejects[this.processorID] = [];\n        this.resolves[this.processorID] = [];\n    }\n    static async register(audioWorklet: AudioWorklet): Promise<void> {\n        if (!this.resolves[this.processorID]) this.resolves[this.processorID] = [];\n        if (!this.rejects[this.processorID]) this.rejects[this.processorID] = [];\n        const promise = new Promise<void>((resolve, reject) => {\n            this.resolves[this.processorID].push(resolve);\n            this.rejects[this.processorID].push(reject);\n        });\n        if (this.registered) return new Promise<void>(resolve => resolve());\n        if (this.registering) return promise;\n        if (!this.registered && audioWorklet) this.registerProcessor(audioWorklet);\n        return promise;\n    }\n}\n","import { AudioWorkletRegister, DisposableAudioWorkletNode } from \"./Base\";\nimport processorURL from \"./SpectralAnalyser.worklet.ts\"; // eslint-disable-line import/extensions\n\nexport type TWindowFunction = \"blackman\" | \"hamming\" | \"hann\" | \"triangular\";\nexport interface DataToProcessor extends DisposableAudioWorkletMessageEventDataToProcessor {\n    id: number;\n    buffer?: boolean;\n    lastAmplitudes?: boolean;\n    allAmplitudes?: boolean;\n    amplitude?: boolean;\n    estimatedFreq?: boolean;\n    centroid?: boolean;\n    flatness?: boolean;\n    flux?: boolean;\n    kurtosis?: boolean;\n    skewness?: boolean;\n    rolloff?: boolean;\n    slope?: boolean;\n    spread?: boolean;\n}\nexport interface DataFromProcessor {\n    id: number;\n    buffer?: { $: Uint32Array; data: Float32Array[]; $total: Uint32Array; lock: Int32Array };\n    lastAmplitudes?: { $frame: number; data: Float32Array[]; $totalFrames: number };\n    allAmplitudes?: { $frame: Uint32Array; data: Float32Array[]; frames: number; fftBins: number; fftHopSize: number; $totalFrames: Uint32Array; lock: Int32Array };\n    amplitude?: number[];\n    estimatedFreq?: number[];\n    centroid?: number[];\n    flatness?: number[];\n    flux?: number[];\n    kurtosis?: number[];\n    skewness?: number[];\n    rolloff?: number[];\n    slope?: number[];\n    spread?: number[];\n}\nexport type Parameters = \"windowSize\" | \"fftSize\" | \"fftOverlap\" | \"windowFunction\";\nexport const processorID = \"__JSPatcher_SpectralAnalyser\";\nexport class SpectralAnalyserNode extends DisposableAudioWorkletNode<DataFromProcessor, DataToProcessor, Parameters> {\n    private promiseID = 0;\n    private resolves: { [id: number]: (rms?: DataFromProcessor | PromiseLike<DataFromProcessor>) => any } = {};\n    constructor(context: BaseAudioContext) {\n        super(context, processorID, { numberOfInputs: 1, numberOfOutputs: 0 });\n        this.port.onmessage = (e: AudioWorkletMessageEvent<DataFromProcessor>) => {\n            const { id } = e.data;\n            delete e.data.id;\n            const f = this.resolves[id];\n            if (f) f(e.data);\n            delete this.resolves[id];\n        };\n    }\n    gets(options: Omit<DataToProcessor, \"id\">) {\n        if (this.destroyed) throw new Error(\"The Node is already destroyed.\");\n        const promise = new Promise<DataFromProcessor>(resolve => this.resolves[this.promiseID] = resolve);\n        this.port.postMessage({ id: this.promiseID++, ...options });\n        return promise;\n    }\n}\nexport class SpectralAnalyserRegister extends AudioWorkletRegister {\n    static processorID = processorID;\n    static processorURL = processorURL;\n    static Node = SpectralAnalyserNode;\n}\n","module.exports = __webpack_public_path__ + \"js/d0a48ae56cd511de667e.worklet.js\";","import { AudioWorkletRegister, DisposableAudioWorkletNode } from \"./Base\";\nimport processorURL from \"./TemporalAnalyser.worklet.ts\"; // eslint-disable-line import/extensions\n\nexport interface DataToProcessor extends DisposableAudioWorkletMessageEventDataToProcessor {\n    id: number;\n    rms?: boolean;\n    zcr?: boolean;\n    buffer?: boolean;\n}\nexport interface DataFromProcessor {\n    id: number;\n    rms?: number[];\n    zcr?: number[];\n    buffer?: { $: Uint32Array; data: Float32Array[]; $total: Uint32Array; lock: Int32Array };\n}\nexport type Parameters = \"windowSize\";\nexport const processorID = \"__JSPatcher_TemporalAnalyser\";\nexport class TemporalAnalyserNode extends DisposableAudioWorkletNode<DataFromProcessor, DataToProcessor, Parameters> {\n    private promiseID = 0;\n    private resolves: { [id: number]: (rms?: DataFromProcessor | PromiseLike<DataFromProcessor>) => any } = {};\n    constructor(context: BaseAudioContext) {\n        super(context, processorID, { numberOfInputs: 1, numberOfOutputs: 0 });\n        this.port.onmessage = (e: AudioWorkletMessageEvent<DataFromProcessor>) => {\n            const { id } = e.data;\n            delete e.data.id;\n            const f = this.resolves[id];\n            if (f) f(e.data);\n            delete this.resolves[id];\n        };\n    }\n    get rms() {\n        return this.gets({ rms: true });\n    }\n    get zcr() {\n        return this.gets({ zcr: true });\n    }\n    get buffer() {\n        return this.gets({ buffer: true });\n    }\n    gets(options: Omit<DataToProcessor, \"id\">) {\n        if (this.destroyed) throw new Error(\"The Node is already destroyed.\");\n        const promise = new Promise<DataFromProcessor>(resolve => this.resolves[this.promiseID] = resolve);\n        this.port.postMessage({ id: this.promiseID++, ...options });\n        return promise;\n    }\n}\nexport class TemporalAnalyserRegister extends AudioWorkletRegister {\n    static processorID = processorID;\n    static processorURL = processorURL;\n    static Node = TemporalAnalyserNode;\n}\n","module.exports = __webpack_public_path__ + \"js/6c74c1a3f009d1037f95.worklet.js\";","import { BaseAudioObject, DefaultAudioObject } from \"../Base\";\n\nexport class BaseDSP<\n    D extends {} = {}, S extends {} = {},\n    I extends any[] = any[], O extends any[] = any[],\n    A extends any[] = any[], P extends {} = {},\n    U extends {} = {}, E extends {} = {}\n> extends BaseAudioObject<D, S, I, O, A, P, U, E> {\n    static package = \"dsp\";\n    static author = \"Fr0stbyteR\";\n    static version = \"1.0.0\";\n}\n\nexport class DefaultDSP<\n    D extends {} = {}, S extends {} = {},\n    I extends any[] = any[], O extends any[] = any[],\n    A extends any[] = any[], P extends {} = {},\n    U extends {} = {}, E extends {} = {}\n> extends DefaultAudioObject<D, S, I, O, A, P, U, E> {\n    static package = \"dsp\";\n    static author = \"Fr0stbyteR\";\n    static version = \"1.0.0\";\n}\n","import * as Color from \"color-js\";\nimport { CanvasUI } from \"../BaseUI\";\nimport { SpectralAnalyserRegister, SpectralAnalyserNode, TWindowFunction } from \"./AudioWorklet/SpectralAnalyser\";\nimport { TMeta, TPropsMeta } from \"../../types\";\nimport { BaseDSP } from \"./Base\";\nimport { Bang } from \"../Base\";\n\nexport interface OscilloscopeUIState {\n    continuous: boolean;\n    frameRate: number;\n    interleaved: boolean;\n    stablize: boolean;\n    $cursor: number;\n    zoom: number;\n    zoomOffset: number;\n    range: number;\n    autoRange: boolean;\n    showStats: boolean;\n    bgColor: string;\n    phosphorColor: string;\n    hueOffset: number;\n    textColor: string;\n    gridColor: string;\n    seperatorColor: string;\n    paint: {};\n}\nexport class OscilloscopeUI extends CanvasUI<Oscilloscope, {}, OscilloscopeUIState> {\n    static defaultSize = [120, 60] as [number, number];\n    componentDidMount() {\n        const { bgColor } = this.state;\n        const ctx = this.ctx;\n        if (!ctx) return;\n        const [width, height] = this.fullSize();\n        // Background\n        ctx.fillStyle = bgColor;\n        ctx.fillRect(0, 0, width, height);\n        super.componentDidMount();\n    }\n    async paint() {\n        if (this.state.continuous) this.schedulePaint();\n        if (!this.object.state.node) return;\n        if (this.object.state.node.destroyed) return;\n        const {\n            // width,\n            // height,\n            // zoom,\n            // zoomOffset,\n            stablize,\n            interleaved,\n            // $cursor,\n            range,\n            autoRange,\n            showStats,\n            bgColor,\n            phosphorColor,\n            hueOffset,\n            textColor,\n            gridColor,\n            seperatorColor\n        } = this.state;\n        const ctx = this.ctx;\n        if (!ctx) return;\n\n\n        const left = 0;\n        const bottom = 0;\n\n        const { estimatedFreq, buffer } = await this.object.state.node.gets({ estimatedFreq: true, buffer: true });\n        const { sampleRate } = this.object.audioCtx;\n\n        // Background\n        const [width, height] = this.fullSize();\n        ctx.clearRect(0, 0, width, height);\n        ctx.fillStyle = bgColor;\n        ctx.fillRect(0, 0, width, height);\n\n        if (!buffer) return;\n\n        const { $: $ui32, data: t, lock } = buffer;\n        if (!t || !t.length || !t[0].length) return;\n\n        while (Atomics.load(lock, 0));\n        Atomics.store(lock, 0, 1);\n        const $ = $ui32[0];\n        const channels = t.length;\n        const l = t[0].length;\n        // Vertical Range\n        let min = -range;\n        let max = range;\n        let yFactor = range;\n        if (autoRange) {\n            // Fastest way to get min and max to have: 1. max abs value for y scaling, 2. mean value for zero-crossing\n            let i = channels;\n            let s = 0;\n            while (i--) {\n                let j = l;\n                while (j--) {\n                    s = t[i][j];\n                    if (s < min) min = s;\n                    else if (s > max) max = s;\n                }\n            }\n            yFactor = Math.max(1, Math.abs(min), Math.abs(max))/* * vzoom*/;\n        }\n        // Grids\n        ctx.strokeStyle = gridColor;\n        let vStep = 0.25;\n        while (yFactor / 2 / vStep > 2) vStep *= 2; // Minimum horizontal grids in channel one side = 2\n        ctx.beginPath();\n        ctx.setLineDash([]);\n        const gridChannels = interleaved ? channels : 1;\n        const channelHeight = (height - bottom) / gridChannels;\n        for (let i = 0; i < gridChannels; i++) {\n            let y = (i + 0.5) * channelHeight;\n            ctx.moveTo(left, y);\n            ctx.lineTo(width, y); // 0-line\n            for (let j = vStep; j < yFactor; j += vStep) {\n                y = (i + 0.5 + j / yFactor / 2) * channelHeight;\n                ctx.moveTo(left, y);\n                ctx.lineTo(width, y); // below 0\n                y = (i + 0.5 - j / yFactor / 2) * channelHeight;\n                ctx.moveTo(left, y);\n                ctx.lineTo(width, y); // above 0\n            }\n        }\n        ctx.stroke();\n\n        ctx.beginPath();\n        ctx.setLineDash([4, 2]);\n        ctx.strokeStyle = seperatorColor;\n        for (let i = 1; i < gridChannels; i++) {\n            ctx.moveTo(left, i * channelHeight);\n            ctx.lineTo(width, i * channelHeight);\n        }\n        ctx.stroke();\n        ctx.setLineDash([]);\n        ctx.lineWidth = 2;\n        const channelColor: string[] = [];\n        let $zerox = 0; // First Zero-crossing of first channel\n        const period = sampleRate / estimatedFreq[0];\n        const times = Math.floor(l / period) - 1;\n        for (let i = 0; i < channels; i++) {\n            // Horizontal Range\n            let $0 = 0; // Draw start\n            let $1 = l; // Draw End\n            let drawL = l; // Length to draw\n            if (stablize) { // Stablization\n                if (i === 0) {\n                    const thresh = (min + max) * 0.5 + 0.001; // the zero-crossing with \"offset\"\n                    while ($zerox < l && t[i][($ + $zerox++) % l] > thresh); // Find first raise\n                    if ($zerox >= l - 1) { // Found nothing, no stablization\n                        $zerox = 0;\n                    } else {\n                        while ($zerox < l && t[i][($ + $zerox++) % l] < thresh); // Find first drop\n                        $zerox--;\n                        if ($zerox >= l - 1 || $zerox < 0) {\n                            $zerox = 0;\n                        }\n                    }\n                }\n                drawL = times > 0 && isFinite(period) ? ~~Math.min(period * times, l - $zerox) : l - $zerox; // length to draw\n            }\n            $0 = Math.round($zerox/* + drawL * zoomOffset*/);\n            $1 = Math.round($zerox + drawL/* / zoom + drawL * zoomOffset*/);\n            const gridX = (width - left) / ($1 - $0);\n            const step = Math.max(1, Math.round(1 / gridX));\n\n            ctx.beginPath();\n            channelColor[i] = Color(phosphorColor).shiftHue(i * hueOffset).toHSL();\n            ctx.strokeStyle = channelColor[i];\n            let maxInStep;\n            let minInStep;\n            for (let j = $0; j < $1; j++) {\n                const $j = (j + $) % l;\n                const samp = t[i][$j];\n                const $step = (j - $0) % step;\n                if ($step === 0) {\n                    maxInStep = samp;\n                    minInStep = samp;\n                }\n                if ($step !== step - 1) {\n                    if ($step !== 0) {\n                        if (samp > maxInStep) maxInStep = samp;\n                        if (samp < minInStep) minInStep = samp;\n                    }\n                    continue;\n                }\n                const x = (j - $0) * gridX + left;\n                let y = channelHeight * (+interleaved * i + 0.5 - maxInStep / yFactor * 0.5);\n                if (j === $0) ctx.moveTo(x, y);\n                else ctx.lineTo(x, y);\n                if (minInStep !== maxInStep) {\n                    y = channelHeight * (+interleaved * i + 0.5 - minInStep / yFactor * 0.5);\n                    ctx.lineTo(x, y);\n                }\n            }\n            ctx.stroke();\n        }\n        Atomics.store(lock, 0, 0);\n        // Stats\n        if (showStats) {\n            ctx.font = \"bold 12px Consolas, monospace\";\n            ctx.fillStyle = textColor;\n            ctx.textAlign = \"left\";\n            ctx.textBaseline = \"top\";\n            ctx.fillText(yFactor.toFixed(2), 2, 2);\n            ctx.textBaseline = \"bottom\";\n            ctx.fillText((-yFactor).toFixed(2), 2, height - 2);\n            ctx.textAlign = \"right\";\n            const freqStatY = height - 2 - (estimatedFreq.length - 1) * 14;\n            for (let i = 0; i < estimatedFreq.length; i++) {\n                const freq = estimatedFreq[i];\n                ctx.fillStyle = channelColor[i];\n                const y = interleaved ? channelHeight * (i + 1) - 2 : freqStatY + 14 * i;\n                ctx.fillText(freq.toFixed(2) + \"Hz\", width - 2, y);\n            }\n        }\n    }\n}\nexport interface State {\n    node: SpectralAnalyserNode;\n}\nexport interface Props extends Omit<OscilloscopeUIState, \"$cursor\" | \"zoom\" | \"zoomOffset\" | \"paint\"> {\n    windowSize: number;\n    fftSize: number;\n    fftOverlap: number;\n    windowFunction: TWindowFunction;\n}\nexport class Oscilloscope extends BaseDSP<{}, State, [Bang], [], [], Props, OscilloscopeUIState> {\n    static description = \"Oscilloscope\";\n    static inlets: TMeta[\"inlets\"] = [{\n        isHot: true,\n        type: \"signal\",\n        description: \"Signal\"\n    }];\n    static props: TPropsMeta<Props> = {\n        windowSize: {\n            type: \"number\",\n            default: 1024,\n            description: \"Signal window size\"\n        },\n        fftSize: {\n            type: \"number\",\n            default: 1024,\n            description: \"FFT Size for analysis\"\n        },\n        fftOverlap: {\n            type: \"number\",\n            default: 2,\n            description: \"FFT overlap count (integer)\"\n        },\n        windowFunction: {\n            type: \"enum\",\n            enums: [\"blackman\", \"hamming\", \"hann\", \"triangular\"],\n            default: \"blackman\",\n            description: \"Window Function aoolied for FFT analysis window\"\n        },\n        continuous: {\n            type: \"boolean\",\n            default: true,\n            description: \"Continuous drawing\",\n            isUIState: true\n        },\n        frameRate: {\n            type: \"number\",\n            default: 60,\n            description: \"UI refresh rate\",\n            isUIState: true\n        },\n        interleaved: {\n            type: \"boolean\",\n            default: false,\n            description: \"Draw channels seperately\",\n            isUIState: true\n        },\n        stablize: {\n            type: \"boolean\",\n            default: true,\n            description: \"Stablize\",\n            isUIState: true\n        },\n        range: {\n            type: \"number\",\n            default: 1,\n            description: \"Vertical range\",\n            isUIState: true\n        },\n        autoRange: {\n            type: \"boolean\",\n            default: true,\n            description: \"Auto adjust range if > 1\",\n            isUIState: true\n        },\n        showStats: {\n            type: \"boolean\",\n            default: true,\n            description: \"Show stats texts\",\n            isUIState: true\n        },\n        bgColor: {\n            type: \"color\",\n            default: \"rgb(40, 40, 40)\",\n            description: \"Background color\",\n            isUIState: true\n        },\n        phosphorColor: {\n            type: \"color\",\n            default: \"hsl(0, 100%, 85%)\",\n            description: \"Phosphor color\",\n            isUIState: true\n        },\n        hueOffset: {\n            type: \"number\",\n            default: 60,\n            description: \"Channel Color Hue offset\",\n            isUIState: true\n        },\n        textColor: {\n            type: \"color\",\n            default: \"#DDDD99\",\n            description: \"Info text color\",\n            isUIState: true\n        },\n        gridColor: {\n            type: \"color\",\n            default: \"#404040\",\n            description: \"Grid color\",\n            isUIState: true\n        },\n        seperatorColor: {\n            type: \"color\",\n            default: \"white\",\n            description: \"Channel seperator color\",\n            isUIState: true\n        }\n    };\n    static ui = OscilloscopeUI;\n    state: State = { node: undefined };\n    subscribe() {\n        super.subscribe();\n        this.on(\"preInit\", () => {\n            this.inlets = 1;\n            this.outlets = 0;\n        });\n        this.on(\"updateProps\", (props) => {\n            if (this.state.node) {\n                const { parameters } = this.state.node;\n                if (props.windowFunction) this.applyBPF(parameters.get(\"windowFunction\"), [[[\"blackman\", \"hamming\", \"hann\", \"triangular\"].indexOf(props.windowFunction)]]);\n                if (props.fftSize) this.applyBPF(parameters.get(\"fftSize\"), [[props.fftSize]]);\n                if (props.fftOverlap) this.applyBPF(parameters.get(\"fftOverlap\"), [[props.fftOverlap]]);\n                if (props.windowSize) this.applyBPF(parameters.get(\"windowSize\"), [[props.windowSize]]);\n            }\n        });\n        this.on(\"postInit\", async () => {\n            await SpectralAnalyserRegister.register(this.audioCtx.audioWorklet);\n            this.state.node = new SpectralAnalyserRegister.Node(this.audioCtx);\n            const { parameters } = this.state.node;\n            this.applyBPF(parameters.get(\"windowFunction\"), [[[\"blackman\", \"hamming\", \"hann\", \"triangular\"].indexOf(this.getProp(\"windowFunction\"))]]);\n            this.applyBPF(parameters.get(\"fftSize\"), [[this.getProp(\"fftSize\")]]);\n            this.applyBPF(parameters.get(\"fftOverlap\"), [[this.getProp(\"fftOverlap\")]]);\n            this.applyBPF(parameters.get(\"windowSize\"), [[this.getProp(\"windowSize\")]]);\n            this.disconnectAudioInlet();\n            this.inletConnections[0] = { node: this.state.node, index: 0 };\n            this.connectAudioInlet();\n        });\n        this.on(\"inlet\", ({ data, inlet }) => {\n            if (inlet === 0) {\n                if (data instanceof Bang) this.updateUI({ paint: {} });\n            }\n        });\n        this.on(\"destroy\", () => {\n            if (this.state.node) this.state.node.destroy();\n        });\n    }\n}\n","import { DefaultDSP } from \"./Base\";\nimport { TWindowFunction, SpectralAnalyserRegister, SpectralAnalyserNode, DataFromProcessor, DataToProcessor } from \"./AudioWorklet/SpectralAnalyser\";\nimport { TMeta, TPropsMeta } from \"../../types\";\nimport { Bang } from \"../Base\";\n\nexport interface Props extends Omit<DataToProcessor, \"id\"> {\n    speedLim: number;\n    windowSize: number;\n    fftSize: number;\n    fftOverlap: number;\n    windowFunction: TWindowFunction;\n    continuous: boolean;\n}\nexport interface State {\n    node: SpectralAnalyserNode;\n    $requestTimer: number;\n}\ntype Outlet0 = Omit<DataFromProcessor, \"id\">;\nexport class SpectralAnalyser extends DefaultDSP<{}, State, [Bang], [Outlet0], [], Props> {\n    static description = \"Spectral feature extractor\";\n    static inlets: TMeta[\"inlets\"] = [{\n        isHot: true,\n        type: \"signal\",\n        description: \"Signal, bang to extract features\"\n    }];\n    static outlets: TMeta[\"outlets\"] = [{\n        type: \"object\",\n        description: \"Features chosen as object\"\n    }];\n    static props: TPropsMeta<Props> = {\n        speedLim: {\n            type: \"number\",\n            default: 16,\n            description: \"If continuous, value output speed limit in ms\"\n        },\n        windowSize: {\n            type: \"number\",\n            default: 1024,\n            description: \"Buffer window size\"\n        },\n        fftSize: {\n            type: \"number\",\n            default: 1024,\n            description: \"FFT Size for analysis\"\n        },\n        fftOverlap: {\n            type: \"number\",\n            default: 2,\n            description: \"FFT overlap count (integer)\"\n        },\n        windowFunction: {\n            type: \"enum\",\n            enums: [\"blackman\", \"hamming\", \"hann\", \"triangular\"],\n            default: \"blackman\",\n            description: \"Window Function aoolied for FFT analysis window\"\n        },\n        continuous: {\n            type: \"boolean\",\n            default: false,\n            description: \"Whether output is continuous\"\n        },\n        buffer: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the signal buffer\"\n        },\n        lastAmplitudes: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the last amplitudes frame\"\n        },\n        allAmplitudes: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting all the amplitudes frame\"\n        },\n        amplitude: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the sum of the last amplitude frame\"\n        },\n        estimatedFreq: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the estimated frequency\"\n        },\n        centroid: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the spectral centroid\"\n        },\n        flatness: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the spectral flatness\"\n        },\n        flux: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the spectral flux\"\n        },\n        kurtosis: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the spectral kurtosis\"\n        },\n        skewness: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the spectral skewness\"\n        },\n        rolloff: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the spectral rolloff\"\n        },\n        slope: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the spectral slope\"\n        },\n        spread: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the spectral spread\"\n        }\n    };\n    state: State = { node: undefined, $requestTimer: -1 };\n    subscribe() {\n        super.subscribe();\n        const startRequest = () => {\n            const request = async () => {\n                if (this.state.node && !this.state.node.destroyed) {\n                    const extractorKeys = [\n                        \"buffer\",\n                        \"lastAmplitudes\",\n                        \"allAmplitudes\",\n                        \"amplitude\",\n                        \"estimatedFreq\",\n                        \"centroid\",\n                        \"flatness\",\n                        \"flux\",\n                        \"kurtosis\",\n                        \"skewness\",\n                        \"rolloff\",\n                        \"slope\",\n                        \"spread\"\n                    ] as (keyof Omit<DataToProcessor, \"id\">)[];\n                    const gets: Omit<DataToProcessor, \"id\"> = {};\n                    extractorKeys.forEach(key => gets[key] = this.getProp(key));\n                    const got = await this.state.node.gets(gets);\n                    this.outlet(0, got);\n                }\n                if (this.getProp(\"continuous\")) scheduleRequest();\n            };\n            const scheduleRequest = () => {\n                this.state.$requestTimer = window.setTimeout(request, this.getProp(\"speedLim\"));\n            };\n            request();\n        };\n        this.on(\"preInit\", () => {\n            this.inlets = 1;\n            this.outlets = 1;\n        });\n        this.on(\"updateProps\", (props) => {\n            if (this.state.node) {\n                const { parameters } = this.state.node;\n                if (props.continuous) startRequest();\n                if (props.windowFunction) this.applyBPF(parameters.get(\"windowFunction\"), [[[\"blackman\", \"hamming\", \"hann\", \"triangular\"].indexOf(props.windowFunction)]]);\n                if (props.fftSize) this.applyBPF(parameters.get(\"fftSize\"), [[props.fftSize]]);\n                if (props.fftOverlap) this.applyBPF(parameters.get(\"fftOverlap\"), [[props.fftOverlap]]);\n                if (props.windowSize) this.applyBPF(parameters.get(\"windowSize\"), [[props.windowSize]]);\n            }\n        });\n        this.on(\"postInit\", async () => {\n            await SpectralAnalyserRegister.register(this.audioCtx.audioWorklet);\n            this.state.node = new SpectralAnalyserRegister.Node(this.audioCtx);\n            const { parameters } = this.state.node;\n            this.applyBPF(parameters.get(\"windowFunction\"), [[[\"blackman\", \"hamming\", \"hann\", \"triangular\"].indexOf(this.getProp(\"windowFunction\"))]]);\n            this.applyBPF(parameters.get(\"fftSize\"), [[this.getProp(\"fftSize\")]]);\n            this.applyBPF(parameters.get(\"fftOverlap\"), [[this.getProp(\"fftOverlap\")]]);\n            this.applyBPF(parameters.get(\"windowSize\"), [[this.getProp(\"windowSize\")]]);\n            this.disconnectAudioInlet();\n            this.inletConnections[0] = { node: this.state.node, index: 0 };\n            this.connectAudioInlet();\n            if (this.getProp(\"continuous\")) startRequest();\n            this.on(\"inlet\", (e) => {\n                if (e.inlet === 0) {\n                    if (e.data instanceof Bang) startRequest();\n                }\n            });\n        });\n        this.on(\"destroy\", () => {\n            window.clearTimeout(this.state.$requestTimer);\n            if (this.state.node) this.state.node.destroy();\n        });\n    }\n}\n","// import * as Color from \"color-js\";\nimport { CanvasUI } from \"../BaseUI\";\nimport { SpectralAnalyserRegister, SpectralAnalyserNode, TWindowFunction } from \"./AudioWorklet/SpectralAnalyser\";\nimport { TMeta, TPropsMeta } from \"../../types\";\nimport { BaseDSP } from \"./Base\";\nimport { Bang } from \"../Base\";\nimport { atodb } from \"../../../utils/math\";\n\nexport interface SpectrogramUIState {\n    continuous: boolean;\n    frameRate: number;\n    cursorX: number;\n    cursorY: number;\n    zoom: number;\n    zoomOffset: number;\n    bgColor: string;\n    // textColor: string;\n    gridColor: string;\n    seperatorColor: string;\n    paint: {};\n}\nexport class SpectrogramUI extends CanvasUI<Spectrogram, {}, SpectrogramUIState> {\n    static defaultSize = [120, 60] as [number, number];\n    $lastFrame = -1;\n    frames = 1;\n    offscreenCtx = document.createElement(\"canvas\").getContext(\"2d\");\n    offscreenVRes = 1024;\n    componentDidMount() {\n        const { bgColor } = this.state;\n        const { ctx, offscreenCtx, frames } = this;\n        if (!ctx) return;\n        const [width, height] = this.fullSize();\n        offscreenCtx.canvas.width = frames;\n        offscreenCtx.canvas.height = this.offscreenVRes;\n        // Background\n        ctx.fillStyle = bgColor;\n        ctx.fillRect(0, 0, width, height);\n        super.componentDidMount();\n    }\n    async paint() {\n        if (this.state.continuous) this.schedulePaint();\n        if (!this.object.state.node) return;\n        if (this.object.state.node.destroyed) return;\n        const {\n            // width,\n            // height,\n            // zoom,\n            // zoomOffset,\n            // $cursor,\n            bgColor,\n            gridColor,\n            seperatorColor\n        } = this.state;\n        const { ctx, offscreenCtx, offscreenVRes } = this;\n        if (!ctx || !offscreenCtx) return;\n\n        const left = 0;\n        const bottom = 0;\n\n        const { allAmplitudes } = await this.object.state.node.gets({ allAmplitudes: true });\n\n        // Background\n\n        const [width, height] = this.fullSize();\n        ctx.clearRect(0, 0, width, height);\n        ctx.fillStyle = bgColor;\n        ctx.fillRect(0, 0, width, height);\n\n        if (!allAmplitudes) return;\n        const { data: f, $totalFrames, fftBins: bins, frames: framesIn, $frame: $frameUi32, lock } = allAmplitudes;\n        if (!f || !f.length || !f[0].length) return;\n        const l = f[0].length;\n        const channels = f.length;\n\n        while (Atomics.load(lock, 0));\n        Atomics.store(lock, 0, 1);\n        // Draw to offscreen canvas\n        let frames = this.frames;\n        const $lastFrame = $totalFrames[0] - 1;\n        const $frame = $frameUi32[0];\n        let $frame0 = $frame;\n        const $frame1 = $frame0 + framesIn;\n        if (frames !== framesIn) {\n            offscreenCtx.canvas.width = framesIn;\n            this.frames = framesIn;\n            frames = framesIn;\n        } else if ($lastFrame >= this.$lastFrame) {\n            $frame0 = Math.max($frame0, $frame1 - ($lastFrame - this.$lastFrame));\n        }\n        this.$lastFrame = $lastFrame;\n        const osChannelHeight = offscreenVRes / channels;\n        const step = Math.max(1, Math.round(bins / osChannelHeight));\n        const vGrid = osChannelHeight / bins;\n        for (let i = 0; i < f.length; i++) {\n            for (let j = $frame0; j < $frame1; j++) {\n                let maxInStep;\n                offscreenCtx.fillStyle = \"black\";\n                offscreenCtx.fillRect(j % frames, i * osChannelHeight, 1, osChannelHeight);\n                for (let k = 0; k < bins; k++) {\n                    const samp = atodb(f[i][(k + j * bins) % l]);\n                    const $step = k % step;\n                    if ($step === 0) maxInStep = samp;\n                    if ($step !== step - 1) {\n                        if ($step !== 0 && samp > maxInStep) maxInStep = samp;\n                        continue;\n                    }\n                    const normalized = Math.min(1, Math.max(0, (maxInStep + 10) / 100 + 1));\n                    if (normalized === 0) continue;\n                    const hue = (normalized * 180 + 240) % 360;\n                    const lum = normalized * 50;\n                    offscreenCtx.fillStyle = `hsl(${hue}, 100%, ${lum}%)`;\n                    offscreenCtx.fillRect(j % frames, (bins - k - 1) * vGrid + i * osChannelHeight, 1, Math.max(1, vGrid));\n                }\n            }\n        }\n        Atomics.store(lock, 0, 0);\n        // Grids\n        ctx.strokeStyle = gridColor;\n        const vStep = 0.25;\n        const hStep = 0.25;\n        ctx.beginPath();\n        ctx.setLineDash([]);\n        const gridChannels = channels;\n        const channelHeight = (height - bottom) / gridChannels;\n        for (let i = 0; i < gridChannels; i++) {\n            for (let j = vStep; j < 1; j += vStep) { // Horizontal lines\n                const y = (i + j) * channelHeight;\n                ctx.moveTo(left, y);\n                ctx.lineTo(width, y);\n            }\n        }\n        for (let i = hStep; i < 1; i += hStep) {\n            const x = left + (width - left) * i;\n            ctx.moveTo(x, 0);\n            ctx.lineTo(x, bottom);\n        }\n        ctx.stroke();\n\n        ctx.beginPath();\n        ctx.setLineDash([4, 2]);\n        ctx.strokeStyle = seperatorColor;\n        for (let i = 1; i < gridChannels; i++) {\n            ctx.moveTo(left, i * channelHeight);\n            ctx.lineTo(width, i * channelHeight);\n        }\n        ctx.stroke();\n        ctx.setLineDash([]);\n        // Horizontal Range\n        ctx.save();\n        ctx.globalCompositeOperation = \"lighter\";\n        ctx.imageSmoothingEnabled = false;\n        $frame0 = $frame;\n        if ($frame1 === frames) {\n            ctx.drawImage(offscreenCtx.canvas, 0, 0, frames, offscreenVRes, left, 0, width - left, height - bottom);\n        } else {\n            const sSplit = frames - $frame0;\n            const dSplit = sSplit / frames * (width - left);\n            ctx.drawImage(offscreenCtx.canvas, $frame0, 0, sSplit, offscreenVRes, left, 0, dSplit, height - bottom);\n            ctx.drawImage(offscreenCtx.canvas, 0, 0, $frame1 - frames - 0.01, offscreenVRes, dSplit + left, 0, width - left - dSplit, height - bottom);\n        }\n        ctx.restore();\n    }\n}\nexport interface State {\n    node: SpectralAnalyserNode;\n}\nexport interface Props extends Omit<SpectrogramUIState, \"cursorX\" | \"cursorY\" | \"zoom\" | \"zoomOffset\" | \"paint\"> {\n    windowSize: number;\n    fftSize: number;\n    fftOverlap: number;\n    windowFunction: TWindowFunction;\n}\nexport class Spectrogram extends BaseDSP<{}, State, [Bang], [], [], Props, SpectrogramUIState> {\n    static description = \"Spectroscope\";\n    static inlets: TMeta[\"inlets\"] = [{\n        isHot: true,\n        type: \"signal\",\n        description: \"Signal\"\n    }];\n    static props: TPropsMeta<Props> = {\n        windowSize: {\n            type: \"number\",\n            default: 1024,\n            description: \"Signal window size\"\n        },\n        fftSize: {\n            type: \"number\",\n            default: 1024,\n            description: \"FFT Size for analysis\"\n        },\n        fftOverlap: {\n            type: \"number\",\n            default: 2,\n            description: \"FFT overlap count (integer)\"\n        },\n        windowFunction: {\n            type: \"enum\",\n            enums: [\"blackman\", \"hamming\", \"hann\", \"triangular\"],\n            default: \"blackman\",\n            description: \"Window Function aoolied for FFT analysis window\"\n        },\n        continuous: {\n            type: \"boolean\",\n            default: true,\n            description: \"Continuous drawing\",\n            isUIState: true\n        },\n        frameRate: {\n            type: \"number\",\n            default: 60,\n            description: \"UI refresh rate\",\n            isUIState: true\n        },\n        bgColor: {\n            type: \"color\",\n            default: \"rgb(40, 40, 40)\",\n            description: \"Background color\",\n            isUIState: true\n        },\n        gridColor: {\n            type: \"color\",\n            default: \"#404040\",\n            description: \"Grid color\",\n            isUIState: true\n        },\n        seperatorColor: {\n            type: \"color\",\n            default: \"white\",\n            description: \"Channel seperator color\",\n            isUIState: true\n        }\n    };\n    static ui = SpectrogramUI;\n    state: State = { node: undefined };\n    subscribe() {\n        super.subscribe();\n        this.on(\"preInit\", () => {\n            this.inlets = 1;\n            this.outlets = 0;\n        });\n        this.on(\"updateProps\", (props) => {\n            if (this.state.node) {\n                const { parameters } = this.state.node;\n                if (props.windowFunction) this.applyBPF(parameters.get(\"windowFunction\"), [[[\"blackman\", \"hamming\", \"hann\", \"triangular\"].indexOf(props.windowFunction)]]);\n                if (props.fftSize) this.applyBPF(parameters.get(\"fftSize\"), [[props.fftSize]]);\n                if (props.fftOverlap) this.applyBPF(parameters.get(\"fftOverlap\"), [[props.fftOverlap]]);\n                if (props.windowSize) this.applyBPF(parameters.get(\"windowSize\"), [[props.windowSize]]);\n            }\n        });\n        this.on(\"postInit\", async () => {\n            await SpectralAnalyserRegister.register(this.audioCtx.audioWorklet);\n            this.state.node = new SpectralAnalyserRegister.Node(this.audioCtx);\n            const { parameters } = this.state.node;\n            this.applyBPF(parameters.get(\"windowFunction\"), [[[\"blackman\", \"hamming\", \"hann\", \"triangular\"].indexOf(this.getProp(\"windowFunction\"))]]);\n            this.applyBPF(parameters.get(\"fftSize\"), [[this.getProp(\"fftSize\")]]);\n            this.applyBPF(parameters.get(\"fftOverlap\"), [[this.getProp(\"fftOverlap\")]]);\n            this.applyBPF(parameters.get(\"windowSize\"), [[this.getProp(\"windowSize\")]]);\n            this.disconnectAudioInlet();\n            this.inletConnections[0] = { node: this.state.node, index: 0 };\n            this.connectAudioInlet();\n        });\n        this.on(\"inlet\", ({ data, inlet }) => {\n            if (inlet === 0) {\n                if (data instanceof Bang) this.updateUI({ paint: {} });\n            }\n        });\n        this.on(\"destroy\", () => {\n            if (this.state.node) this.state.node.destroy();\n        });\n    }\n}\n","import * as Color from \"color-js\";\nimport { CanvasUI } from \"../BaseUI\";\nimport { SpectralAnalyserRegister, SpectralAnalyserNode, TWindowFunction } from \"./AudioWorklet/SpectralAnalyser\";\nimport { TMeta, TPropsMeta } from \"../../types\";\nimport { BaseDSP } from \"./Base\";\nimport { Bang } from \"../Base\";\nimport { atodb } from \"../../../utils/math\";\n\nexport interface SpectroscopeUIState {\n    continuous: boolean;\n    frameRate: number;\n    $cursor: number;\n    zoom: number;\n    zoomOffset: number;\n    bgColor: string;\n    fgColor: string;\n    hueOffset: number;\n    gridColor: string;\n    seperatorColor: string;\n    paint: {};\n}\nexport class SpectroscopeUI extends CanvasUI<Spectroscope, {}, SpectroscopeUIState> {\n    static defaultSize = [120, 60] as [number, number];\n    componentDidMount() {\n        const { bgColor } = this.state;\n        const ctx = this.ctx;\n        if (!ctx) return;\n        const [width, height] = this.fullSize();\n        // Background\n        ctx.fillStyle = bgColor;\n        ctx.fillRect(0, 0, width, height);\n        super.componentDidMount();\n    }\n    async paint() {\n        if (this.state.continuous) this.schedulePaint();\n        if (!this.object.state.node) return;\n        if (this.object.state.node.destroyed) return;\n        const {\n            // width,\n            // height,\n            // zoom,\n            // zoomOffset,\n            // $cursor,\n            bgColor,\n            fgColor,\n            hueOffset,\n            gridColor,\n            seperatorColor\n        } = this.state;\n        const ctx = this.ctx;\n        if (!ctx) return;\n\n        const left = 0;\n        const bottom = 0;\n\n        const { lastAmplitudes } = await this.object.state.node.gets({ lastAmplitudes: true });\n\n        // Background\n        const [width, height] = this.fullSize();\n        ctx.clearRect(0, 0, width, height);\n        ctx.fillStyle = bgColor;\n        ctx.fillRect(0, 0, width, height);\n\n        if (!lastAmplitudes) return;\n        const { data: f } = lastAmplitudes;\n        if (!f || !f.length || !f[0].length) return;\n        const l = f[0].length;\n        const channels = f.length;\n\n        // Grids\n        ctx.strokeStyle = gridColor;\n        const vStep = 0.25;\n        const hStep = 0.25;\n        ctx.beginPath();\n        ctx.setLineDash([]);\n        const gridChannels = channels;\n        const channelHeight = (height - bottom) / gridChannels;\n        for (let i = 0; i < gridChannels; i++) {\n            for (let j = vStep; j < 1; j += vStep) { // Horizontal lines\n                const y = (i + j) * channelHeight;\n                ctx.moveTo(left, y);\n                ctx.lineTo(width, y);\n            }\n        }\n        for (let i = hStep; i < 1; i += hStep) {\n            const x = left + (width - left) * i;\n            ctx.moveTo(x, 0);\n            ctx.lineTo(x, bottom);\n        }\n        ctx.stroke();\n\n        ctx.beginPath();\n        ctx.setLineDash([4, 2]);\n        ctx.strokeStyle = seperatorColor;\n        for (let i = 1; i < gridChannels; i++) {\n            ctx.moveTo(left, i * channelHeight);\n            ctx.lineTo(width, i * channelHeight);\n        }\n        ctx.stroke();\n        ctx.setLineDash([]);\n        ctx.lineWidth = 2;\n        const channelColor: string[] = [];\n        // Horizontal Range\n        const $0 = 0; // Draw start\n        const $1 = l; // Draw End\n        const gridX = (width - left) / ($1 - $0);\n        const step = Math.max(1, Math.round(1 / gridX));\n        for (let i = 0; i < f.length; i++) {\n            ctx.beginPath();\n            channelColor[i] = Color(fgColor).shiftHue(i * hueOffset).toHSL();\n            ctx.fillStyle = channelColor[i];\n            let maxInStep;\n            for (let j = $0; j < $1; j++) {\n                const samp = atodb(f[i][j]);\n                const $step = (j - $0) % step;\n                if ($step === 0) maxInStep = samp;\n                if ($step !== step - 1) {\n                    if ($step !== 0 && samp > maxInStep) maxInStep = samp;\n                    continue;\n                }\n                const x = (j - $0) * gridX + left;\n                const y = channelHeight * (i + 1 - Math.min(1, Math.max(0, maxInStep / 100 + 1)));\n                if (j === $0) ctx.moveTo(x, y);\n                else ctx.lineTo(x, y);\n            }\n            ctx.lineTo(width, channelHeight * (i + 1));\n            ctx.lineTo(left, channelHeight * (i + 1));\n            ctx.closePath();\n            ctx.fill();\n        }\n    }\n}\nexport interface State {\n    node: SpectralAnalyserNode;\n}\nexport interface Props extends Omit<SpectroscopeUIState, \"$cursor\" | \"zoom\" | \"zoomOffset\" | \"paint\"> {\n    windowSize: number;\n    fftSize: number;\n    fftOverlap: number;\n    windowFunction: TWindowFunction;\n}\nexport class Spectroscope extends BaseDSP<{}, State, [Bang], [], [], Props, SpectroscopeUIState> {\n    static description = \"Spectroscope\";\n    static inlets: TMeta[\"inlets\"] = [{\n        isHot: true,\n        type: \"signal\",\n        description: \"Signal\"\n    }];\n    static props: TPropsMeta<Props> = {\n        windowSize: {\n            type: \"number\",\n            default: 1024,\n            description: \"Signal window size\"\n        },\n        fftSize: {\n            type: \"number\",\n            default: 1024,\n            description: \"FFT Size for analysis\"\n        },\n        fftOverlap: {\n            type: \"number\",\n            default: 2,\n            description: \"FFT overlap count (integer)\"\n        },\n        windowFunction: {\n            type: \"enum\",\n            enums: [\"blackman\", \"hamming\", \"hann\", \"triangular\"],\n            default: \"blackman\",\n            description: \"Window Function aoolied for FFT analysis window\"\n        },\n        continuous: {\n            type: \"boolean\",\n            default: true,\n            description: \"Continuous drawing\",\n            isUIState: true\n        },\n        frameRate: {\n            type: \"number\",\n            default: 60,\n            description: \"UI refresh rate\",\n            isUIState: true\n        },\n        bgColor: {\n            type: \"color\",\n            default: \"rgb(40, 40, 40)\",\n            description: \"Background color\",\n            isUIState: true\n        },\n        fgColor: {\n            type: \"color\",\n            default: \"hsl(0, 100%, 85%)\",\n            description: \"Foreground color\",\n            isUIState: true\n        },\n        hueOffset: {\n            type: \"number\",\n            default: 60,\n            description: \"Channel Color Hue offset\",\n            isUIState: true\n        },\n        gridColor: {\n            type: \"color\",\n            default: \"#404040\",\n            description: \"Grid color\",\n            isUIState: true\n        },\n        seperatorColor: {\n            type: \"color\",\n            default: \"white\",\n            description: \"Channel seperator color\",\n            isUIState: true\n        }\n    };\n    static ui = SpectroscopeUI;\n    state: State = { node: undefined };\n    subscribe() {\n        super.subscribe();\n        this.on(\"preInit\", () => {\n            this.inlets = 1;\n            this.outlets = 0;\n        });\n        this.on(\"updateProps\", (props) => {\n            if (this.state.node) {\n                const { parameters } = this.state.node;\n                if (props.windowFunction) this.applyBPF(parameters.get(\"windowFunction\"), [[[\"blackman\", \"hamming\", \"hann\", \"triangular\"].indexOf(props.windowFunction)]]);\n                if (props.fftSize) this.applyBPF(parameters.get(\"fftSize\"), [[props.fftSize]]);\n                if (props.fftOverlap) this.applyBPF(parameters.get(\"fftOverlap\"), [[props.fftOverlap]]);\n                if (props.windowSize) this.applyBPF(parameters.get(\"windowSize\"), [[props.windowSize]]);\n            }\n        });\n        this.on(\"postInit\", async () => {\n            await SpectralAnalyserRegister.register(this.audioCtx.audioWorklet);\n            this.state.node = new SpectralAnalyserRegister.Node(this.audioCtx);\n            const { parameters } = this.state.node;\n            this.applyBPF(parameters.get(\"windowFunction\"), [[[\"blackman\", \"hamming\", \"hann\", \"triangular\"].indexOf(this.getProp(\"windowFunction\"))]]);\n            this.applyBPF(parameters.get(\"fftSize\"), [[this.getProp(\"fftSize\")]]);\n            this.applyBPF(parameters.get(\"fftOverlap\"), [[this.getProp(\"fftOverlap\")]]);\n            this.applyBPF(parameters.get(\"windowSize\"), [[this.getProp(\"windowSize\")]]);\n            this.disconnectAudioInlet();\n            this.inletConnections[0] = { node: this.state.node, index: 0 };\n            this.connectAudioInlet();\n        });\n        this.on(\"inlet\", ({ data, inlet }) => {\n            if (inlet === 0) {\n                if (data instanceof Bang) this.updateUI({ paint: {} });\n            }\n        });\n        this.on(\"destroy\", () => {\n            if (this.state.node) this.state.node.destroy();\n        });\n    }\n}\n","import { DefaultDSP } from \"./Base\";\nimport { TemporalAnalyserRegister, TemporalAnalyserNode, DataToProcessor, DataFromProcessor } from \"./AudioWorklet/TemporalAnalyser\";\nimport { TMeta, TPropsMeta } from \"../../types\";\nimport { Bang } from \"../Base\";\n\nexport interface Props extends Omit<DataToProcessor, \"id\"> {\n    speedLim: number;\n    windowSize: number;\n    continuous: boolean;\n}\nexport interface State {\n    node: TemporalAnalyserNode;\n    $requestTimer: number;\n}\ntype Outlet0 = Omit<DataFromProcessor, \"id\">;\nexport class TemporalAnalyser extends DefaultDSP<{}, State, [Bang], [Outlet0], [], Props> {\n    static description = \"Temporal feature extractor\";\n    static inlets: TMeta[\"inlets\"] = [{\n        isHot: true,\n        type: \"signal\",\n        description: \"Signal, bang to extract features\"\n    }];\n    static outlets: TMeta[\"outlets\"] = [{\n        type: \"object\",\n        description: \"Features chosen as object\"\n    }];\n    static props: TPropsMeta<Props> = {\n        speedLim: {\n            type: \"number\",\n            default: 16,\n            description: \"If continuous, value output speed limit in ms\"\n        },\n        windowSize: {\n            type: \"number\",\n            default: 1024,\n            description: \"Buffer window size\"\n        },\n        continuous: {\n            type: \"boolean\",\n            default: false,\n            description: \"Whether output is continuous\"\n        },\n        buffer: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the signal buffer\"\n        },\n        rms: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the Root Mean Square\"\n        },\n        zcr: {\n            type: \"boolean\",\n            default: false,\n            description: \"Getting the zero crossing count\"\n        }\n    };\n    state: State = { node: undefined, $requestTimer: -1 };\n    subscribe() {\n        super.subscribe();\n        const startRequest = () => {\n            const request = async () => {\n                if (this.state.node && !this.state.node.destroyed) {\n                    const extractorKeys = [\n                        \"buffer\",\n                        \"rms\",\n                        \"zcr\"\n                    ] as (keyof Omit<DataToProcessor, \"id\">)[];\n                    const gets: Omit<DataToProcessor, \"id\"> = {};\n                    extractorKeys.forEach(key => gets[key] = this.getProp(key));\n                    const got = await this.state.node.gets(gets);\n                    this.outlet(0, got);\n                }\n                if (this.getProp(\"continuous\")) scheduleRequest();\n            };\n            const scheduleRequest = () => {\n                this.state.$requestTimer = window.setTimeout(request, this.getProp(\"speedLim\"));\n            };\n            request();\n        };\n        this.on(\"preInit\", () => {\n            this.inlets = 1;\n            this.outlets = 1;\n        });\n        this.on(\"updateProps\", (props) => {\n            if (this.state.node) {\n                const { parameters } = this.state.node;\n                if (props.continuous) startRequest();\n                if (props.windowSize) this.applyBPF(parameters.get(\"windowSize\"), [[props.windowSize]]);\n            }\n        });\n        this.on(\"postInit\", async () => {\n            await TemporalAnalyserRegister.register(this.audioCtx.audioWorklet);\n            this.state.node = new TemporalAnalyserRegister.Node(this.audioCtx);\n            const { parameters } = this.state.node;\n            this.applyBPF(parameters.get(\"windowSize\"), [[this.getProp(\"windowSize\")]]);\n            this.disconnectAudioInlet();\n            this.inletConnections[0] = { node: this.state.node, index: 0 };\n            this.connectAudioInlet();\n            if (this.getProp(\"continuous\")) startRequest();\n            this.on(\"inlet\", (e) => {\n                if (e.inlet === 0) {\n                    if (e.data instanceof Bang) startRequest();\n                }\n            });\n        });\n        this.on(\"destroy\", () => {\n            window.clearTimeout(this.state.$requestTimer);\n            if (this.state.node) this.state.node.destroy();\n        });\n    }\n}\n","import { SpectralAnalyser } from \"./SpectralAnalyser\";\nimport { TemporalAnalyser } from \"./TemporalAnalyser\";\nimport { Oscilloscope } from \"./Oscilloscope\";\nimport { Spectroscope } from \"./Spectroscope\";\nimport { Spectrogram } from \"./Spectrogram\";\n\nexport default {\n    \"temporalAnalyser~\": TemporalAnalyser,\n    \"spectralAnalyser~\": SpectralAnalyser,\n    \"scope~\": Oscilloscope,\n    \"spectroscope~\": Spectroscope,\n    \"spectrogram~\": Spectrogram\n};\n"],"sourceRoot":""}