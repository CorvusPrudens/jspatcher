{"version":3,"sources":["webpack://JSPatcher/webpack/bootstrap","webpack://JSPatcher/./src/core/objects/dsp/AudioWorklet/Analyser.worklet.ts"],"names":["RMSProcessor","AudioWorkletProcessor","parameterDescriptors","defaultValue","maxValue","sampleRate","minValue","name","constructor","options","destroyed","window","$","port","onmessage","e","data","destroy","get","postMessage","rms","buffer","i","length","channel","sum","sample","j","Math","sqrt","startPointer","process","inputs","outputs","parameters","input","windowSize","splice","bufferSize","Float32Array","oldWindow","oldWindowSize","set","subarray","split","close","registerProcessor"],"mappings":"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","file":"js/2d186d4918aa7b3d433d.worklet.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./node_modules/babel-loader/lib/index.js!./src/core/objects/dsp/AudioWorklet/Analyser.worklet.ts\");\n","export interface DataToProcessor extends DisposableAudioWorkletMessageEventDataToProcessor {\n    get?: \"rms\" | \"buffer\";\n}\nexport interface DataFromProcessor {\n    rms?: number[];\n    buffer?: { startPointer: number; data: Float32Array[] };\n}\nexport type Parameters = \"windowSize\";\ndeclare const currentFrame: number;\ndeclare const currentTime: number;\ndeclare const sampleRate: number;\n\nclass RMSProcessor extends AudioWorkletProcessor<DataToProcessor, DataFromProcessor, Parameters> {\n    static get parameterDescriptors(): AudioWorkletAudioParamDescriptor<Parameters>[] {\n        return [{\n            defaultValue: 1024,\n            maxValue: sampleRate * 16,\n            minValue: 128,\n            name: \"windowSize\"\n        }];\n    }\n    destroyed: boolean;\n    window: Float32Array[];\n    $: number;\n    constructor(options: AudioWorkletNodeOptions) {\n        super(options);\n        this.destroyed = false;\n        this.window = [];\n        this.$ = 0;\n        this.port.onmessage = (e) => {\n            if (e.data.destroy) this.destroy();\n            else if (e.data.get === \"rms\") this.port.postMessage({ rms: this.rms });\n            else if (e.data.get === \"buffer\") this.port.postMessage({ buffer: this.buffer });\n        };\n    }\n    get rms() {\n        const rms: number[] = [];\n        for (let i = 0; i < this.window.length; i++) {\n            const channel = this.window[i];\n            let sum = 0;\n            let sample = 0;\n            const length = channel.length;\n            for (let j = 0; j < length; j++) {\n                sample = channel[j];\n                sum += sample * sample;\n            }\n            rms[i] = Math.sqrt(sum / length);\n        }\n        return rms;\n    }\n    get buffer() {\n        return { startPointer: this.$, data: this.window };\n    }\n    process(inputs: Float32Array[][], outputs: Float32Array[][], parameters: { [key in Parameters]: Float32Array }) {\n        if (this.destroyed) return false;\n        const input = inputs[0];\n        const windowSize = ~~parameters.windowSize[0] || 1024;\n        this.$ %= windowSize;\n        if (this.window.length > input.length) this.window.splice(input.length);\n        for (let i = 0; i < input.length; i++) {\n            let channel = input[i];\n            const bufferSize = channel.length || 128;\n            if (!channel.length) channel = new Float32Array(bufferSize);\n            if (!this.window[i]) this.window[i] = new Float32Array(windowSize);\n            else if (this.window[i].length !== windowSize) {\n                const oldWindow = this.window[i];\n                const oldWindowSize = oldWindow.length;\n                this.window[i] = new Float32Array(windowSize);\n                this.window[i].set(oldWindowSize > windowSize ? oldWindow.subarray(0, windowSize) : oldWindow);\n            }\n            const window = this.window[i];\n            let $ = this.$;\n            if (bufferSize > windowSize) {\n                window.set(channel.subarray(bufferSize - windowSize));\n                $ = 0;\n            } else if (this.$ + bufferSize > windowSize) {\n                const split = windowSize - $;\n                window.set(channel.subarray(0, split), this.$);\n                $ = bufferSize - split;\n                window.set(channel.subarray(0, this.$));\n            } else {\n                window.set(channel, $);\n                $ += bufferSize;\n            }\n            if (i === input.length - 1) this.$ = $;\n        }\n        return true;\n    }\n    destroy() {\n        this.destroyed = true;\n        this.port.close();\n        this.window = [];\n    }\n}\nregisterProcessor(\"__JSPatcher_RMS\", RMSProcessor);\n"],"sourceRoot":""}