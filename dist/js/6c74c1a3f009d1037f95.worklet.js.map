{"version":3,"sources":["webpack://JSPatcher/webpack/bootstrap","webpack://JSPatcher/./src/core/objects/dsp/AudioWorklet/TemporalAnalyser.worklet.ts","webpack://JSPatcher/./src/utils/buffer.ts","webpack://JSPatcher/./src/utils/math.ts","webpack://JSPatcher/./src/utils/utils.ts"],"names":["processorID","TemporalAnalyserAtoms","$","_$","value","$total","_$total","atoms","lock","_lock","wait","Atomics","load","store","unlock","constructor","_sab","SharedArrayBuffer","Uint32Array","BYTES_PER_ELEMENT","Int32Array","TemporalAnalyserProcessor","AudioWorkletProcessor","parameterDescriptors","defaultValue","maxValue","minValue","name","_atoms","options","port","onmessage","e","id","data","destroy","message","rms","zcr","buffer","postMessage","windowF32","map","windowSize","_windowSize","sizeIn","Math","min","max","process","inputs","outputs","parameters","destroyed","input","window","length","splice","bufferSize","c","i","Float32Array","oldWindow","oldWindowSize","setTypedArray","channel","set","subarray","close","registerProcessor","sum","array","mean","median","Error","sortedArray","slice","sort","maxIndex","index","cur","energy","signal","sample","sqrt","lastPositive","positive","centroid","weightedSum","weight","abs","conjugatedCentroid","factor","geometricMean","log","exp","flatness","flux","prev","norm","halfRectify","diff","kurtosis","c1","c2","c3","c4","numerator","denominator","skewness","rolloff","cutoff","threshold","n","element","slope","xSum","x2Sum","ySum","xySum","x","y","spread","to","from","offsetTo","offsetFrom","toLength","fromLength","spillLength","spilled","$to","mod","$from","$spillLength","$fromEnd","getSubTypedArray","offset","sliceBuffer","fftw2Amp","windowEnergyFactor","amps","real","imag","estimateFreq","sampleRate","indexToFreq","fftBins","round","floor","ceil","toRad","degrees","PI","toMIDI","f","atodb","a","log10","dbtoa","db","iNormExp","normExp","scale","l1","h1","l2","h2","r1","r2","scaleClip","isIdentityMatrix","Array","isArray","every","row","isNumberArray","j","identityMatrix","dim","fill","undefined","isStringArray","isTRect","isTPresentationRect","v","isRectMovable","isRectResizable","isMIDIEvent","Uint8Array","stringifyError","JSON","stringify","parseToPrimitive","parse","toString","rgbaMax2Css","maxColor","cssColor","join","css2RgbaMax","color","matched","match","split","s","decodeBPF","sIn","tupleLength","numbers","filter","find","isFinite","tuples","$tuple","decodeCurve","decodeLine","detectOS","appVersion","navigator","indexOf","detectBrowserCore","chrome","InstallTrigger","roundedRect","ctx","width","height","radius","radii","forEach","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","stroke","fillRoundedRect","selectElementRange","elementIsEditable","nodeName","selection","getSelection","focus","select","setBaseAndExtent","hasChildNodes","addRange","removeAllRanges","document","createRange","range","selectNodeContents","selectElementPos","pos","setStart","childNodes","collapse","getPropertyDescriptor","obj","key","Object","getOwnPropertyDescriptor","getPrototypeOf","getPropertyDescriptors","getOwnPropertyDescriptors","proto","prototype","assign","extToType","ext","max2js","patcherIn","patcher","boxes","lines","maxPatcher","props","bgColor","bgcolor","editingBgColor","editing_bgcolor","dependencies","grid","gridsize","openInPresentation","openinpresentation","maxBoxes","maxLines","maxBox","box","numID","parseInt","inlets","numinlets","outlets","numoutlets","rect","patching_rect","presentationRect","presentation_rect","background","presentation","text","maxclass","lineArgs","patchline","src","source","replace","dest","destination","js2max","push","line"],"mappings":"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","file":"js/6c74c1a3f009d1037f95.worklet.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./node_modules/babel-loader/lib/index.js!./src/core/objects/dsp/AudioWorklet/TemporalAnalyser.worklet.ts\");\n","import { DataToProcessor, DataFromProcessor, Parameters } from \"./TemporalAnalyser\";\nimport { rms, zcr, setTypedArray } from \"../../../../utils/buffer\";\n\nconst processorID = \"__JSPatcher_TemporalAnalyser\";\n\n/**\n * Some data to transfer across threads\n *\n * @class TemporalAnalyserAtoms\n */\nclass TemporalAnalyserAtoms {\n    readonly _sab: SharedArrayBuffer;\n    readonly _lock: Int32Array;\n    readonly _$: Uint32Array;\n    readonly _$total: Uint32Array;\n    /**\n     * Next audio sample index to write into window\n     *\n     * @type {number}\n     * @memberof TemporalAnalyserAtoms\n     */\n    get $(): number {\n        return this._$[0];\n    }\n    set $(value: number) {\n        this._$[0] = value;\n    }\n    /**\n     * Total samples written counter\n     *\n     * @type {number}\n     * @memberof TemporalAnalyserAtoms\n     */\n    get $total(): number {\n        return this._$total[0];\n    }\n    set $total(value: number) {\n        this._$total[0] = value;\n    }\n    /**\n     * Get all atoms\n     *\n     * @readonly\n     * @memberof TemporalAnalyserAtoms\n     */\n    get atoms() {\n        return { $: this._$, $total: this._$total, lock: this._lock };\n    }\n    wait() {\n        while (Atomics.load(this._lock, 0));\n    }\n    lock() {\n        return Atomics.store(this._lock, 0, 1);\n    }\n    unlock() {\n        return Atomics.store(this._lock, 0, 0);\n    }\n    constructor() {\n        this._sab = new SharedArrayBuffer(3 * Uint32Array.BYTES_PER_ELEMENT);\n        this._lock = new Int32Array(this._sab, 0, 1);\n        this._$ = new Uint32Array(this._sab, 4, 1);\n        this._$total = new Uint32Array(this._sab, 8, 1);\n    }\n}\n\nclass TemporalAnalyserProcessor extends AudioWorkletProcessor<DataToProcessor, DataFromProcessor, Parameters> {\n    static get parameterDescriptors(): AudioWorkletAudioParamDescriptor<Parameters>[] {\n        return [{\n            defaultValue: 1024,\n            maxValue: 2 ** 32,\n            minValue: 128,\n            name: \"windowSize\"\n        }];\n    }\n    private destroyed = false;\n    /**\n     * Concatenated audio data, array of channels\n     *\n     * @type {SharedArrayBuffer[]}\n     * @memberof TemporalAnalyserProcessor\n     */\n    private readonly window: SharedArrayBuffer[] = [];\n    /**\n     * Float32Array Buffer view of window\n     *\n     * @private\n     * @type {Float32Array[]}\n     * @memberof TemporalAnalyserProcessor\n     */\n    private readonly windowF32: Float32Array[] = [];\n    private readonly _atoms = new TemporalAnalyserAtoms();\n    /**\n     * Shared Data\n     *\n     * @memberof TemporalAnalyserProcessor\n     */\n    get atoms() {\n        return this._atoms.atoms;\n    }\n    /**\n     * Next audio sample index to write into window\n     *\n     * @memberof TemporalAnalyserProcessor\n     */\n    get $() {\n        return this._atoms.$;\n    }\n    set $(value: number) {\n        this._atoms.$ = value;\n    }\n    /**\n     * Total samples written counter\n     *\n     * @memberof TemporalAnalyserProcessor\n     */\n    get $total() {\n        return this._atoms.$total;\n    }\n    set $total(value: number) {\n        this._atoms.$total = value;\n    }\n    private _windowSize = 1024;\n    constructor(options: AudioWorkletNodeOptions) {\n        super(options);\n        this.port.onmessage = (e) => {\n            const { id } = e.data;\n            if (e.data.destroy) this.destroy();\n            const message = {} as DataFromProcessor;\n            if (e.data.rms) message.rms = this.rms;\n            if (e.data.zcr) message.zcr = this.zcr;\n            if (e.data.buffer) message.buffer = this.buffer;\n            this.port.postMessage({ id, ...message });\n        };\n    }\n    get rms(): DataFromProcessor[\"rms\"] {\n        return this.windowF32.map(rms);\n    }\n    get zcr(): DataFromProcessor[\"zcr\"] {\n        return this.windowF32.map(zcr);\n    }\n    get buffer(): DataFromProcessor[\"buffer\"] {\n        const data = this.windowF32;\n        const { $, $total, lock } = this.atoms;\n        return { data, $, $total, lock };\n    }\n    get windowSize() {\n        return this._windowSize;\n    }\n    set windowSize(sizeIn: number) {\n        this._windowSize = ~~Math.min(2 ** 32, Math.max(128, sizeIn || 1024));\n    }\n    process(inputs: Float32Array[][], outputs: Float32Array[][], parameters: { [key in Parameters]: Float32Array }) {\n        if (this.destroyed) return false;\n        const input = inputs[0];\n        this.windowSize = ~~parameters.windowSize[0];\n        const { windowSize } = this;\n\n        if (this.window.length > input.length) { // Too much channels ?\n            this.window.splice(input.length);\n            this.windowF32.splice(input.length);\n        }\n        if (input.length === 0) return true;\n\n        this._atoms.wait();\n        this._atoms.lock();\n\n        this.$ %= windowSize;\n        const bufferSize = Math.max(...input.map(c => c.length)) || 128;\n        this.$total += bufferSize;\n        let { $ } = this;\n        // Init windows\n        for (let i = 0; i < input.length; i++) {\n            $ = this.$;\n            if (!this.window[i]) { // Initialise channel if not exist\n                this.window[i] = new SharedArrayBuffer(windowSize * Float32Array.BYTES_PER_ELEMENT);\n                this.windowF32[i] = new Float32Array(this.window[i]);\n            } else {\n                if (this.windowF32[i].length !== windowSize) { // adjust window size if not corresponded\n                    const oldWindow = this.window[i];\n                    const oldWindowSize = oldWindow.length;\n                    const window = new SharedArrayBuffer(windowSize * Float32Array.BYTES_PER_ELEMENT);\n                    $ = setTypedArray(new Float32Array(window), new Float32Array(oldWindow), 0, $ - Math.min(windowSize, oldWindowSize));\n                    this.window[i] = window;\n                    this.windowF32[i] = new Float32Array(window);\n                }\n            }\n        }\n        this.$ = $;\n        // Write\n        for (let i = 0; i < input.length; i++) {\n            const window = this.windowF32[i];\n            const channel = input[i].length ? input[i] : new Float32Array(bufferSize);\n            $ = this.$;\n            if (bufferSize > windowSize) {\n                window.set(channel.subarray(bufferSize - windowSize));\n                $ = 0;\n            } else {\n                $ = setTypedArray(window, channel, $);\n            }\n        }\n        this.$ = $;\n        this._atoms.unlock();\n        return true;\n    }\n    destroy() {\n        this.destroyed = true;\n        this.port.close();\n    }\n}\nregisterProcessor(processorID, TemporalAnalyserProcessor);\n","import { mod } from \"./math\";\n\ntype TypedArray = Int8Array | Uint8Array | Int16Array | Uint16Array | Int32Array | Uint32Array | Uint8ClampedArray | Float32Array | Float64Array;\ntype TypedArrayConstructor = typeof Int8Array | typeof Uint8Array | typeof Int16Array | typeof Uint16Array | typeof Int32Array | typeof Uint32Array | typeof Uint8ClampedArray | typeof Float32Array | typeof Float64Array;\nexport const sum = (array: TypedArray | number[]) => {\n    let sum = 0;\n    for (let i = 0; i < array.length; i++) {\n        sum += array[i];\n    }\n    return sum;\n};\nexport const mean = (array: TypedArray | number[]) => sum(array) / array.length;\nexport const median = (array: TypedArray | number[]) => {\n    const length = array.length;\n    if (length === 0) throw new Error(\"trying to calculate median of empty array\");\n    const sortedArray = array.slice().sort();\n    if (length % 2 === 0) return (sortedArray[length / 2 - 1] + sortedArray[length / 2]) / 2;\n    return sortedArray[~~(length / 2)];\n};\nexport const maxIndex = (array: TypedArray | number[]) => {\n    if (!array.length) return 0;\n    let index = 0;\n    let max = array[0];\n    let i = array.length;\n    while (i-- > 1) {\n        const cur = array[i];\n        if (cur <= max) continue;\n        max = cur;\n        index = i;\n    }\n    return index;\n};\nexport const energy = (signal: TypedArray | number[]) => {\n    let sum = 0;\n    let sample = 0;\n    for (let i = 0; i < signal.length; i++) {\n        sample = signal[i];\n        sum += sample * sample;\n    }\n    return sum;\n};\nexport const rms = (signal: TypedArray | number[]) => Math.sqrt(energy(signal) / signal.length);\nexport const zcr = (signal: TypedArray | number[]) => {\n    let zcr = 0;\n    let lastPositive = true;\n    let positive = true;\n    for (let i = 0; i < signal.length; i++) {\n        positive = signal[i] >= 0;\n        if (positive !== lastPositive) zcr++;\n        lastPositive = positive;\n    }\n    return zcr;\n};\nexport const centroid = (array: TypedArray | number[]) => {\n    let weightedSum = 0;\n    let weight = 0;\n    for (let i = 0; i < array.length; i++) {\n        weightedSum += i * Math.abs(array[i]);\n        weight += array[i];\n    }\n    return weight === 0 ? 0 : weightedSum / weight;\n};\nexport const conjugatedCentroid = (array: TypedArray | number[], factor: number) => {\n    let weightedSum = 0;\n    let weight = 0;\n    for (let i = 0; i < array.length; i++) {\n        weightedSum += (i ** factor) * Math.abs(array[i]);\n        weight += array[i];\n    }\n    return weight === 0 ? 0 : weightedSum / weight;\n};\nexport const geometricMean = (array: TypedArray | number[]) => {\n    const length = array.length;\n    let sum = 0;\n    let sample = 0;\n    for (let i = 0; i < length; i++) {\n        sample = array[i];\n        if (sample <= 0) return 0;\n        sum += Math.log(array[i]);\n    }\n    return Math.exp(sum / length);\n};\nexport const flatness = (array: TypedArray | number[]) => geometricMean(array) / mean(array);\n/**\n * https://essentia.upf.edu/reference/std_Flux.html\n *\n * @param {TypedArray} cur\n * @param {TypedArray} prev\n * @param {(\"L1\" | \"L2\")} [norm]\n * @param {boolean} [halfRectify]\n * @returns\n */\nexport const flux = (cur: TypedArray | number[], prev: TypedArray | number[], norm?: \"L1\" | \"L2\", halfRectify?: boolean) => {\n    let flux = 0;\n    if (norm === \"L2\") {\n        if (halfRectify === true) { // L2 + halfRectify\n            for (let i = 0; i < cur.length; i++) {\n                const diff = cur[i] - prev[i];\n                if (diff < 0) continue;\n                flux += diff * diff;\n            }\n            return Math.sqrt(flux);\n        }\n        for (let i = 0; i < cur.length; i++) { // L2 not halfRectify\n            const diff = cur[i] - prev[i];\n            flux += diff * diff;\n        }\n        return Math.sqrt(flux);\n    }\n    if (halfRectify === true) { // L1 + halfRectify\n        for (let i = 0; i < cur.length; i++) {\n            const diff = cur[i] - prev[i];\n            if (diff < 0) continue;\n            flux += diff;\n        }\n        return flux;\n    }\n    for (let i = 0; i < cur.length; i++) { // L1 not halfRectify\n        const diff = cur[i] - prev[i];\n        flux += Math.abs(diff);\n    }\n    return flux;\n};\n/**\n * https://github.com/meyda/meyda/blob/master/src/extractors/spectralKurtosis.js\n *\n * @param {TypedArray} array\n */\nexport const kurtosis = (array: TypedArray | number[]) => {\n    const c1 = centroid(array);\n    const c2 = conjugatedCentroid(array, 2);\n    const c3 = conjugatedCentroid(array, 3);\n    const c4 = conjugatedCentroid(array, 4);\n    const numerator = -3 * c1 ** 4 + 6 * c1 * c2 - 4 * c1 * c3 + c4;\n    const denominator = (c2 - c1 ** 2) ** 2;\n    return numerator / denominator;\n};\n/**\n * https://github.com/meyda/meyda/blob/master/src/extractors/spectralSkewness.js\n *\n * @param {TypedArray} array\n */\nexport const skewness = (array: TypedArray | number[]) => {\n    const c1 = centroid(array);\n    const c2 = conjugatedCentroid(array, 2);\n    const c3 = conjugatedCentroid(array, 3);\n    const numerator = 2 * c1 ** 3 - 3 * c1 * c2 + c3;\n    const denominator = (c2 - c1 ** 2) ** 1.5;\n    return numerator / denominator;\n};\n/**\n * https://essentia.upf.edu/reference/std_RollOff.html\n *\n * @param {TypedArray} array\n * @param {number} [cutoff] Between 0 - 1\n * @returns\n */\nexport const rolloff = (array: TypedArray | number[], cutoff?: number) => {\n    const length = array.length;\n    let e = energy(array);\n    const threshold = (cutoff || 0.99) * e;\n    let n = length - 1;\n    while (e > threshold && n >= 0) {\n        const element = array[n];\n        e -= element * element;\n        --n;\n    }\n    return n + 1;\n};\nexport const slope = (array: TypedArray | number[]) => {\n    const n = array.length;\n    const xSum = n * n / 2;\n    const x2Sum = (n - 1) * n * (2 * n - 1) / 6;\n    let ySum = 0;\n    let xySum = 0;\n    for (let x = 0; x < n; x++) {\n        const y = array[x];\n        ySum += y;\n        xySum += x * y;\n    }\n    return (n * xySum - xSum * ySum) / (n * x2Sum - xSum * xSum);\n};\nexport const spread = (array: TypedArray | number[]) => Math.sqrt(conjugatedCentroid(array, 2)) - centroid(array) ** 2;\n/**\n * Copy buffer to another, support negative offset index\n *\n * @template T\n * @param {T} to\n * @param {T} from\n * @param {number} [offsetTo]\n * @param {number} [offsetFrom]\n * @returns\n */\n// eslint-disable-next-line arrow-parens\nexport const setTypedArray = <T extends TypedArray = TypedArray>(to: T, from: T, offsetTo?: number, offsetFrom?: number) => {\n    const toLength = to.length;\n    const fromLength = from.length;\n    const spillLength = Math.min(toLength, fromLength);\n    let spilled = 0;\n    let $to = mod(offsetTo, toLength) || 0;\n    let $from = mod(offsetFrom, fromLength) || 0;\n    while (spilled < spillLength) {\n        const $spillLength = Math.min(spillLength - spilled, toLength - $to, fromLength - $from);\n        const $fromEnd = $from + $spillLength;\n        if ($from === 0 && $fromEnd === fromLength) to.set(from, $to);\n        else to.set(from.subarray($from, $fromEnd), $to);\n        $to = ($to + $spillLength) % toLength;\n        $from = $fromEnd % fromLength;\n        spilled += $spillLength;\n    }\n    return $to;\n};\n// eslint-disable-next-line arrow-parens\nexport const getSubTypedArray = <T extends TypedArray = TypedArray>(from: T, length: number, offset?: number) => {\n    const fromLength = from.length;\n    const $ = mod(offset, fromLength) || 0;\n    if ($ === 0 && length === fromLength) return from;\n    if ($ + length < fromLength) return from.subarray($, $ + length) as T;\n    const to = new (from.constructor as TypedArrayConstructor)(length) as T;\n    setTypedArray(to, from, 0, $);\n    return to;\n};\n// eslint-disable-next-line arrow-parens\nexport const sliceBuffer = <T extends TypedArray = TypedArray>(from: T, length: number, offset?: number) => {\n    const fromLength = from.length;\n    const $ = mod(offset, fromLength) || 0;\n    if ($ === 0 && length === fromLength) return from.slice();\n    if ($ + length < fromLength) return from.slice($, $ + length) as T;\n    const to = new (from.constructor as TypedArrayConstructor)(length) as T;\n    setTypedArray(to, from, 0, $);\n    return to;\n};\n/**\n * http://www.fftw.org/fftw3_doc/The-Halfcomplex_002dformat-DFT.html\n *\n * @param {Float32Array} from\n */\nexport const fftw2Amp = (from: Float32Array, windowEnergyFactor: number) => {\n    const { length } = from;\n    const amps = new Float32Array(length / 2);\n    for (let i = 0; i < length / 2; i++) {\n        const real = from[i];\n        const imag = (i === 0 || i === length / 2 - 1) ? 0 : from[length - i];\n        amps[i] = (real * real + imag * imag) ** 0.5 / length * windowEnergyFactor;\n    }\n    return amps;\n};\nexport const estimateFreq = (amps: Float32Array, sampleRate: number) => indexToFreq(maxIndex(amps), amps.length, sampleRate);\nexport const indexToFreq = (i: number, fftBins: number, sampleRate: number) => (i % fftBins) / fftBins * sampleRate / 2;\n","import { isNumberArray } from \"./utils\";\n\n/**\n * Mod support wrapping with negative numbers\n */\nexport const mod = (x: number, y: number): number => (x % y + y) % y;\n/**\n * Round a number to multiple of another\n */\nexport const round = (x: number, to: number): number => (Math.abs(to) < 1 ? Math.round(x * (1 / to)) / (1 / to) : Math.round(x / to) * to);\n/**\n * Floor a number to multiple of another\n */\nexport const floor = (x: number, to: number): number => (Math.abs(to) < 1 ? Math.floor(x * (1 / to)) / (1 / to) : Math.floor(x / to) * to);\n/**\n * Ceil a number to multiple of another\n */\nexport const ceil = (x: number, to: number): number => (Math.abs(to) < 1 ? Math.ceil(x * (1 / to)) / (1 / to) : Math.ceil(x / to) * to);\n/**\n * Degree to radian\n */\nexport const toRad = (degrees: number): number => degrees * Math.PI / 180;\n/**\n * MIDI note number to string\n */\nexport const toMIDI = (f: number): string => [\"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\", \"G\", \"G#\", \"A\", \"A#\", \"B\"][(f % 12 + 12) % 12] + Math.round(f / 12 - 2);\n/**\n * Linear amplitude ([0, 1]) to dB ([-Inf, 0])\n *\n * @param {number} a linear amplitude value\n * @returns {number} dB value\n */\nexport const atodb = (a: number): number => 20 * Math.log10(a);\n/**\n * dB ([-Inf, 0]) to Linear mplitude ([0, 1])\n *\n * @param {number} db dB value\n * @returns {number} linear amplitude value\n */\nexport const dbtoa = (db: number): number => 10 ** (db / 20);\n/**\n * De-scale a exponently scaled value\n *\n * @param {number} x normalized value to scale between ([0, 1])\n * @param {number} e exponent factor used to scale, 0 means linear, 1 does ** 1.5 curve\n * @returns {number} de-scaled value\n */\nexport const iNormExp = (x: number, e: number): number => Math.max(0, x) ** (1.5 ** -e);\n/**\n * Scale exponently a normalized value\n *\n * @param {number} x normalized value to scale between ([0, 1])\n * @param {number} e exponent factor, 0 means linear, 1 does ** 1.5 curve\n * @returns {number} scaled value\n */\nexport const normExp = (x: number, e: number): number => Math.max(0, x) ** (1.5 ** e);\n\nexport const scale = (x: number, l1: number, h1: number, l2: number, h2: number) => {\n    const r1 = h1 - l1;\n    const r2 = h2 - l2;\n    return (x - l1) / r1 * r2 + l2;\n};\n\nexport const scaleClip = (x: number, l1: number, h1: number, l2: number, h2: number) => Math.max(l2, Math.min(h2, scale(x, l1, h1, l2, h2)));\n\n// eslint-disable-next-line arrow-body-style\nexport const isIdentityMatrix = (x: number[][]) => {\n    return Array.isArray(x)\n    && x.every((row, i) => isNumberArray(row)\n    && row.length === x.length\n    && row.every((e, j) => e === (j === i ? 1 : 0)));\n};\n\nexport const identityMatrix = (dim: number) => new Array(dim).fill(undefined).map((x, i) => new Array(dim).fill(undefined).map((y, j) => +(i === j)));\n","/* eslint-disable arrow-body-style */\nimport { TMIDIEvent, TBPF, TRect, TPresentationRect, FileExtension, ProjectItemType, RawPatcher, TMaxPatcher } from \"../core/types\";\n\nexport const isStringArray = (x: any): x is string[] => Array.isArray(x) && x.every(e => typeof e === \"string\");\nexport const isNumberArray = (x: any): x is number[] => Array.isArray(x) && x.every(e => typeof e === \"number\");\nexport const isTRect = (x: any): x is TRect => {\n    return isNumberArray(x)\n        && x.length === 4\n        && x[0] >= 0\n        && x[1] >= 0\n        && x[2] >= 15\n        && x[3] >= 15;\n};\nexport const isTPresentationRect = (x: any): x is TPresentationRect => {\n    return Array.isArray(x)\n        && x.length === 4\n        && x.every(v => typeof v === \"number\" || typeof v === \"string\");\n};\nexport const isRectMovable = (x: any): x is [number, number, number | string, number | string] => {\n    return isTPresentationRect(x) && typeof x[0] === \"number\" && typeof x[1] === \"number\";\n};\nexport const isRectResizable = (x: any): x is TRect => isTRect(x);\nexport const isMIDIEvent = (x: any): x is TMIDIEvent => (isNumberArray(x) || x instanceof Uint8Array) && x.length === 3;\nexport const stringifyError = (data: any) => {\n    if (typeof data === \"string\") return data;\n    if (data instanceof Error) return data.message;\n    if (typeof data === \"object\") return JSON.stringify(data);\n    return `${data}`;\n};\nexport const parseToPrimitive = (value: any) => {\n    try {\n        return JSON.parse(value);\n    } catch (e) {\n        return value.toString();\n    }\n};\nexport const rgbaMax2Css = (maxColor: number[]) => {\n    const cssColor = [255, 255, 255, 1] as TRect;\n    if (Array.isArray(maxColor)) {\n        for (let i = 0; i < 3; i++) {\n            if (typeof maxColor[i] === \"number\") cssColor[i] = Math.floor(maxColor[i] * 255);\n        }\n        if (typeof maxColor[3] === \"number\") cssColor[3] = maxColor[3];\n    }\n    return `rgba(${cssColor.join(\",\")})`;\n};\nexport const css2RgbaMax = (color: string) => {\n    const maxColor = [0.2, 0.2, 0.2, 1] as TRect;\n    const matched = color.match(/rgba\\((.+)\\)/);\n    if (!matched) return maxColor;\n    const cssColor = matched[1].split(\",\").map(s => +s);\n    for (let i = 0; i < 3; i++) {\n        if (typeof cssColor[i] === \"number\") maxColor[i] = cssColor[i] / 255;\n        if (typeof cssColor[3] === \"number\") maxColor[3] = cssColor[3];\n    }\n    return maxColor;\n};\n/**\n * A BPF can be described as a succesion of three number tuples.\n * i.e. `1 1 0.5 2 1 1` curve mode means go to 0 immediately then go to 1 in 1s with a curve of e^0.5, then go to 2 in 1s linear.\n * The function transform the string to number[][], i.e. `[[1, 1, 0.5], [2, 1, 1]]`\n *\n * @param {TBPF} sIn\n * @returns {number[][]}\n */\nexport const decodeBPF = (sIn: TBPF, tupleLength: number): number[][] => {\n    if (typeof sIn === \"number\") return [[sIn]];\n    if (isNumberArray(sIn)) return [sIn];\n    if (Array.isArray(sIn) && sIn.every(a => isNumberArray(a))) return sIn;\n    if (typeof sIn !== \"string\") throw new Error(\"Failed to decode curve.\");\n    const numbers = sIn.split(\" \").filter(s => !!s).map(s => +s);\n    if (numbers.find(v => !isFinite(v))) throw new Error(\"BPF contains invalid number.\");\n    const tuples: number[][] = [];\n    for (let i = 0; i < numbers.length; i++) {\n        const $tuple = ~~(i / tupleLength);\n        const $ = i % tupleLength;\n        if (!tuples[$tuple]) tuples[$tuple] = [];\n        tuples[$tuple][$] = numbers[i];\n    }\n    return tuples;\n};\nexport const decodeCurve = (sIn: TBPF) => decodeBPF(sIn, 3);\nexport const decodeLine = (sIn: TBPF) => decodeBPF(sIn, 2);\n\n/**\n * Gives OS name as follows:\n * \"Windows\"    for all versions of Windows,\n * \"MacOS\"      for all versions of Macintosh OS,\n * \"Linux\"      for all versions of Linux,\n * \"UNIX\"       for all other UNIX flavors,\n * \"Unknown\" indicates failure to detect the OS\n *\n * @returns {\"Windows\" | \"MacOS\" | \"UNIX\" | \"Linux\" | \"Unknown\"} OS name\n */\nexport const detectOS = (): \"Windows\" | \"MacOS\" | \"UNIX\" | \"Linux\" | \"Unknown\" => {\n    const { appVersion } = navigator;\n    if (appVersion.indexOf(\"Win\") !== -1) return \"Windows\";\n    if (appVersion.indexOf(\"Mac\") !== -1) return \"MacOS\";\n    if (appVersion.indexOf(\"X11\") !== -1) return \"UNIX\";\n    if (appVersion.indexOf(\"Linux\") !== -1) return \"Linux\";\n    return \"Unknown\";\n};\nexport const detectBrowserCore = () => {\n    if ((window as any).chrome) return \"Chromium\";\n    if ((window as any).InstallTrigger) return \"Gecko\";\n    return \"Unknown\";\n};\nexport const roundedRect = (ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, radius: number | number[]) => {\n    const radii = [0, 0, 0, 0];\n    if (typeof radius === \"number\") radii.fill(radius);\n    else radius.forEach((v, i) => radii[i] = v);\n    ctx.beginPath();\n    ctx.moveTo(x + radii[0], y);\n    ctx.lineTo(x + width - radii[1], y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radii[1]);\n    ctx.lineTo(x + width, y + height - radii[2]);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radii[2], y + height);\n    ctx.lineTo(x + radii[3], y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radii[3]);\n    ctx.lineTo(x, y + radii[0]);\n    ctx.quadraticCurveTo(x, y, x + radii[0], y);\n    ctx.closePath();\n    ctx.stroke();\n};\nexport const fillRoundedRect = (ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, radius: number | number[]) => {\n    const radii = [0, 0, 0, 0];\n    if (typeof radius === \"number\") radii.fill(radius);\n    else radius.forEach((v, i) => radii[i] = v);\n    ctx.beginPath();\n    ctx.moveTo(x + radii[0], y);\n    ctx.lineTo(x + width - radii[1], y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radii[1]);\n    ctx.lineTo(x + width, y + height - radii[2]);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radii[2], y + height);\n    ctx.lineTo(x + radii[3], y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radii[3]);\n    ctx.lineTo(x, y + radii[0]);\n    ctx.quadraticCurveTo(x, y, x + radii[0], y);\n    ctx.closePath();\n    ctx.fill();\n};\nexport const selectElementRange = (e: HTMLElement) => {\n    const elementIsEditable = (e: HTMLElement): e is HTMLInputElement | HTMLTextAreaElement => !!e.nodeName.match(/^(INPUT|TEXTAREA)$/i);\n    const selection = window.getSelection();\n    if (elementIsEditable(e)) {\n        e.focus();\n        e.select();\n        return;\n    }\n    if (selection.setBaseAndExtent) {\n        // Safari\n        selection.setBaseAndExtent(e, 0, e, e.hasChildNodes() ? 1 : 0);\n        return;\n    }\n    if (selection.addRange && selection.removeAllRanges && document.createRange) {\n        // Mozilla or Opera 10.5+\n        const range = document.createRange();\n        range.selectNodeContents(e);\n        selection.removeAllRanges();\n        selection.addRange(range);\n    }\n};\nexport const selectElementPos = (e: HTMLElement, pos: number) => {\n    const range = document.createRange();\n    const selection = window.getSelection();\n    range.setStart(e.childNodes[0], pos);\n    range.collapse(true);\n    selection.removeAllRanges();\n    selection.addRange(range);\n};\n// eslint-disable-next-line arrow-body-style\nexport const getPropertyDescriptor = (obj: Record<string, any>, key: string): PropertyDescriptor => {\n    return Object.getOwnPropertyDescriptor(obj, key) || getPropertyDescriptor(Object.getPrototypeOf(obj), key);\n};\nexport const getPropertyDescriptors = (obj: Function | Record<string, any>): PropertyDescriptorMap => {\n    if (typeof obj === \"function\") return Object.getOwnPropertyDescriptors(obj);\n    const proto = Object.getPrototypeOf(obj);\n    if (obj !== Object.prototype && proto === Object.prototype) return Object.getOwnPropertyDescriptors(obj);\n    return Object.assign(proto ? getPropertyDescriptors(proto) : {}, Object.getOwnPropertyDescriptors(obj));\n};\n\nexport const extToType = (ext: FileExtension): Exclude<ProjectItemType, \"folder\"> => {\n    if ([\"jspat\", \"maxpat\", \"gendsp\", \"dsppat\"].indexOf(ext) !== -1) return \"patcher\";\n    if ([\"wav\", \"aif\", \"aiff\", \"mp3\", \"aac\", \"flac\", \"ogg\"].indexOf(ext) !== -1) return \"audio\";\n    if ([\"text\", \"json\"].indexOf(ext) !== -1) return \"text\";\n    return \"unknown\";\n};\n\nexport const max2js = (patcherIn: TMaxPatcher): RawPatcher => {\n    const patcher: RawPatcher = { boxes: {}, lines: {} };\n    const maxPatcher = (patcherIn as TMaxPatcher).patcher;\n    patcher.props = {\n        bgColor: rgbaMax2Css(maxPatcher.bgcolor),\n        editingBgColor: rgbaMax2Css(maxPatcher.editing_bgcolor),\n        dependencies: [],\n        grid: maxPatcher.gridsize,\n        openInPresentation: !!maxPatcher.openinpresentation\n    };\n    const maxBoxes = maxPatcher.boxes;\n    const maxLines = maxPatcher.lines;\n    for (let i = 0; i < maxBoxes.length; i++) {\n        const maxBox = maxBoxes[i].box;\n        const numID = parseInt(maxBox.id.match(/\\d+/)[0]);\n        const id = \"box-\" + numID;\n        patcher.boxes[id] = {\n            id,\n            inlets: maxBox.numinlets,\n            outlets: maxBox.numoutlets,\n            rect: maxBox.patching_rect,\n            presentationRect: maxBox.presentation_rect,\n            background: !!maxBox.background,\n            presentation: !!maxBox.presentation,\n            text: (maxBox.maxclass === \"newobj\" ? \"\" : maxBox.maxclass + \" \") + (maxBox.text ? maxBox.text : \"\")\n        };\n    }\n    for (let i = 0; i < maxLines.length; i++) {\n        const lineArgs = maxLines[i].patchline;\n        const id = \"line-\" + i;\n        patcher.lines[id] = {\n            id,\n            src: [lineArgs.source[0].replace(/obj/, \"box\"), lineArgs.source[1]],\n            dest: [lineArgs.destination[0].replace(/obj/, \"box\"), lineArgs.destination[1]]\n        };\n    }\n    return patcher;\n};\n\nexport const js2max = (patcherIn: RawPatcher): TMaxPatcher => {\n    const maxPatcher: TMaxPatcher[\"patcher\"] = {\n        boxes: [],\n        lines: [],\n        rect: undefined,\n        bgcolor: css2RgbaMax(patcherIn.props.bgColor),\n        editing_bgcolor: css2RgbaMax(patcherIn.props.editingBgColor),\n        gridsize: patcherIn.props.grid,\n        openinpresentation: +patcherIn.props.openInPresentation\n    };\n    for (const id in patcherIn.boxes) {\n        const box = patcherIn.boxes[id];\n        const numID = parseInt(id.match(/\\d+/)[0]);\n        maxPatcher.boxes.push({\n            box: {\n                id: `obj-${numID}`,\n                maxclass: \"newobj\",\n                numinlets: box.inlets,\n                numoutlets: box.outlets,\n                patching_rect: box.rect,\n                presentation: +box.presentation,\n                background: +box.background,\n                text: box.text\n            }\n        });\n    }\n    for (const id in patcherIn.lines) {\n        const line = patcherIn.lines[id];\n        maxPatcher.lines.push({\n            patchline: {\n                source: [line.src[0].replace(/box/, \"obj\"), line.src[1]],\n                destination: [line.dest[0].replace(/box/, \"obj\"), line.dest[1]]\n            }\n        });\n    }\n    return { patcher: maxPatcher };\n};\n"],"sourceRoot":""}